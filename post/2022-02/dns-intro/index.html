<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>DNS Introduction - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="We usually use domain names, such as taoshu.in, to access the Internet. But computers need to use IP addresses when they communicate. The core function of DNS is to save the mapping between domain names and IP addresses. Today, we will introduce how DNS works.
In DNS, the core concept is the domain name. A domain name is a way of organizing information hierarchically, somewhat similar to a computer&amp;rsquo;s folders. Take a Windws system for example, the path where user Demo&amp;rsquo;s desktop is located is C:\Users\Demo\Desktop." /><meta name="keywords" content="dns Intro" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-02/dns-intro/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="DNS Introduction" />
<meta property="og:description" content="We usually use domain names, such as taoshu.in, to access the Internet. But computers need to use IP addresses when they communicate. The core function of DNS is to save the mapping between domain names and IP addresses. Today, we will introduce how DNS works.
In DNS, the core concept is the domain name. A domain name is a way of organizing information hierarchically, somewhat similar to a computer&rsquo;s folders. Take a Windws system for example, the path where user Demo&rsquo;s desktop is located is C:\Users\Demo\Desktop." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-02/dns-intro/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-17T10:28:20+08:00" />
<meta property="article:modified_time" content="2022-02-17T10:28:20+08:00" />

<meta itemprop="name" content="DNS Introduction">
<meta itemprop="description" content="We usually use domain names, such as taoshu.in, to access the Internet. But computers need to use IP addresses when they communicate. The core function of DNS is to save the mapping between domain names and IP addresses. Today, we will introduce how DNS works.
In DNS, the core concept is the domain name. A domain name is a way of organizing information hierarchically, somewhat similar to a computer&rsquo;s folders. Take a Windws system for example, the path where user Demo&rsquo;s desktop is located is C:\Users\Demo\Desktop."><meta itemprop="datePublished" content="2022-02-17T10:28:20+08:00" />
<meta itemprop="dateModified" content="2022-02-17T10:28:20+08:00" />
<meta itemprop="wordCount" content="1493">
<meta itemprop="keywords" content="dns," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DNS Introduction"/>
<meta name="twitter:description" content="We usually use domain names, such as taoshu.in, to access the Internet. But computers need to use IP addresses when they communicate. The core function of DNS is to save the mapping between domain names and IP addresses. Today, we will introduce how DNS works.
In DNS, the core concept is the domain name. A domain name is a way of organizing information hierarchically, somewhat similar to a computer&rsquo;s folders. Take a Windws system for example, the path where user Demo&rsquo;s desktop is located is C:\Users\Demo\Desktop."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">DNS Introduction</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-17 10:28:20 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1493 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>We usually use <strong>domain names</strong>, such as <code>taoshu.in</code>, to access the Internet. But computers need to use IP addresses when they communicate. The core function of DNS is to save the mapping between domain names and IP addresses. Today, we will introduce how DNS works.</p>
<p>In DNS, the core concept is the domain name. A domain name is a way of organizing information hierarchically, somewhat similar to a computer&rsquo;s folders. Take a Windws system for example, the path where user Demo&rsquo;s desktop is located is <code>C:\Users\Demo\Desktop</code>. The first <code>C:</code> indicates that it is on the C drive, which is the top level. Then it is split by a backslash, with each level indicating a folder. So the files on the desktop are saved in the Desktop folder under the Demo folder in the Users folder under the C drive.</p>
<p>The way the folders are organized has the following characteristics.</p>
<ul>
<li>There is a top-level folder (in this case, the C drive)</li>
<li>A splitter is used between folders to indicate the hierarchy</li>
<li>File names under different folders do not conflict with each other</li>
</ul>
<p>Replace the C drive with the root, replace the backslash with a dot, and write the folder path backwards to make the domain name. Let&rsquo;s take <code>www.taoshu.in</code> as an example to analyze the structure of the domain name. In fact, this domain name should be written as <code>www.taoshu.in.</code> in the DNS system, but in actual use, you can omit the last <code>. </code> . Let&rsquo;s look from right to left.</p>
<p>All domain names are subdomains of the root domain. The root domain name is the last omitted period <code>. </code> . If we imagine the root domain as the C drive, then all domains are folders under the C drive. The direct subdomains under the root domain name are also called top-level domains, commonly used are <code>com./net./org.</code> etc. This category is called Top Level Domain (TLD). With the development of the Internet, the governing body also assigns the so-called Country Code top-level domain (ccTLD) to each country. tld is managed by the international Internet organization, ccTLD is managed by each sovereign country itself. China&rsquo;s ccTLD is <code>cn.</code>. When choosing a domain name, generally choose a TLD, such as <code>com.</code>. Of course, there are some ccTLDs that have special meanings and are very much used, such as <code>.io/.tv/.ai</code>. Like this site, we chose the ccTLD domain name <code>in.</code> from India, to take the meaning of happiness in it.</p>
<p>The domain names we usually register are under the top-level domain, also called the first-level domain. For example, in the spirit of <code>taoshu.in.</code> is the first level domain name under <code>in.</code>. For ccTLDs, there are also two levels of first-level domain names, such as <code>com.cn</code>. Although <code>example.com.cn</code> contains three parts, it is still a first-level domain name.</p>
<p>Once a domain name is registered, we can set up a second level or deeper level domain name according to our actual situation, such as <code>wwww.taoshu.in.</code> which means a second level domain name for providing web services. If we want to provide mail service, we can set <code>mail.taoshu.in.</code>.</p>
<p>DNS is a distributed system where each layer only cares about its own direct subdomains, regardless of the subdomains of the subdomains. Take the root domain <code>.</code> for example, its direct subdomains are top-level domains like <code>com./net./org.</code>. So only the IP addresses of the DNS servers of the top-level domain are stored on the servers of the root domain. This data is also called NS records. The file where the data is saved is usually called zone. As of today, the root DNS server has 1489 <a href="https://data.iana.org/TLD/tlds-alpha-by-domain.txt">top-level domain records</a>.</p>
<p>The other top-level domains are managed by their respective servers. For example, all records for first-level domains under <code>in.</code> are managed by India&rsquo;s ccTLD servers, which we can view with the <code>drill</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">➜ dns drill NS in.
in. <span class="m">1268</span> IN NS ns1.registry.in.
in. <span class="m">1268</span> IN NS ns2.registry.in.
in. <span class="m">1268</span> IN NS ns3.registry.in.
in. <span class="m">1268</span> IN NS ns4.registry.in.
in. <span class="m">1268</span> IN NS ns5.registry.in.
in. <span class="m">1268</span> IN NS ns6.registry.in.
</code></pre></td></tr></table>
</div>
</div><p>By registering a domain name, I am gaining the right to write records at a higher level of name servers. For example, if I register a <code>taoshu.in.</code> domain name and support the fee, then I can write information about <code>taoshu.in.</code> in the domain name system of <code>in.</code> and specify the DNS server of the domain name. I now use Cloudflare to resolve.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">➜ dns drill NS taoshu.in.
taoshu.in. <span class="m">3090</span> IN NS earl.ns.cloudflare.com.
taoshu.in. <span class="m">3090</span> IN NS mona.ns.cloudflare.com.
</code></pre></td></tr></table>
</div>
</div><p>Here you can see the two Cloudflare servers. Once the <code>taoshu.in.</code> NS records written to the <code>in.</code> server, the subsequent management can be completed in the Cloudflare backend.</p>
<p>The above is the structure of the domain name and the relationship with the DNS server. That how to find the corresponding IP address through the domain name? Here we will analyze the query process.</p>
<p>The entire DNS system is divided into three parts.</p>
<ul>
<li>A proxy server (stub resolver)</li>
<li>A recursive resolver</li>
<li>multiple authoritative name servers</li>
</ul>
<p>The servers we mentioned above are all authoritative servers. Authoritative means that the final data is kept, and all DNS resolution results are based on the data on the authoritative server.</p>
<p>A proxy server is not a real server, but has a DNS resolution component on each computer system. There are various programs running on each computer that do not need to handle the DNS resolution process themselves, but simply send the requests to the DNS component of the operating system. The DNS component here is called a proxy server.</p>
<p>The recursive resolution server is the server that actually performs the DNS queries. Using <code>www.example.com</code> as an example, the entire query process is as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/17/7c6277098f3d481296ac76ce7e692149.png" alt="sobyte"></p>
<ol>
<li>the proxy server queries the recursive server for the A record of the domain name (i.e., the ipv4 address)</li>
<li>The recursive server sends the query request <strong>as-is</strong> to the root domain&rsquo;s server</li>
<li>the root DNS server only keeps the information of the root domain name, it does not know the information of <code>www.example.com</code>, so it returns the NS record of the <code>com.</code> domain</li>
<li>the recursive server forwards the query request to the domain name server of <code>com.</code> based on the returned NS record</li>
<li>the <code>com.</code> name server also only records the NS server of <code>www.example.com</code>, so it returns the NS record</li>
<li>the recursive server forwards the request to the name servers of <code>example.com.</code>.</li>
<li>In general, the domain name server of <code>example.com.</code> holds the <code>www.example.com.</code> information, so it returns the corresponding A record</li>
</ol>
<p>If the name server of <code>example.com</code> only keeps the NS server information of <code>www.example.com.</code>, then the whole process will continue. It is called a recursive query server because the whole process is recursive in layers.</p>
<p>Each server sends and receives messages to and from each other using port 53 of UDP, <strong>DNS query content is not encrypted, it is all plaintext communication</strong> .</p>
<p>From the query process, we can see that all domain name queries need to visit the server of the root domain first, and then get the servers of all levels of domain names. So how does the recursive service know the IP address of the root server? The answer is <strong>write dead server address in the code</strong> . There are a total of 13 <strong>logical</strong> <a href="https://www.internic.net/domain/named.root">root servers</a> in the world.</p>
<p>Obviously, 13 servers are far from being able to cope with the DNS lookup requests of today&rsquo;s Internet. The so-called Anycast technology has been used to deploy up to 1500 mirror servers around the world. The so-called Anycast is the use of the BGP protocol to broadcast the IP address of the root server across different networks. Requests for the root server can be sent to the nearest mirror server. Each server synchronizes the root domain data regularly. China has deployed five groups of F/I/J/K/L root mirror servers. All domestic users' query requests to the root servers can be completed without going through the international Internet. However, the ones in China are mirror servers, which can only provide query function and cannot change the record content of the root domain name.</p>
<p>Now to summarize the system design of DNS.</p>
<ul>
<li>Domain names are hierarchical, similar to file paths, but using <code>.</code> is split and arranged in reverse order</li>
<li>The DNS is a distributed system, with only sub-domain information recorded at each level of the name servers</li>
<li>The DNS uses the UDP protocol for plaintext communication</li>
<li>The DNS contains three types of servers: proxy/recursive/authoritative</li>
<li>Root servers are deployed globally using Anycast</li>
</ul>
<p>These are the main elements of the DNS system, the oldest protocol on the Internet, which uses UDP for plaintext communication, and therefore the most problematic in terms of security and privacy protection. The Internet is rife with DNS-based content censorship, behavioral monitoring, domain name hijacking, website blocking, denial of service attacks, and other behaviors. The Internet Standards Organization has also been working to address various security issues with DNS. I will cover these later.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/dns/">dns</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-02/elastic-amazon-reach-an-agreement-trademark-infringement-lawsuit/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Elastic: There&#39;s only one Elasticsearch, from Elastic</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-02/principles-for-designing-system/">
            <span class="next-text nav-default">Some of my principles for designing system architecture</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
