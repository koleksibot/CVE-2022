<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>The most common mistakes that beginners make when practicing Flutter - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Typical error one: Future that cannot be mastered Typical error message: NoSuchMethodError: The method &#39;markNeedsBuild&#39; was called on null. This error is often found in asynchronous task (Future) processing, such as a page requesting a web API data and refreshing the Widget State based on the data. This error occurs when the asynchronous task ends after the page has been popped, but does not check if the State is still" /><meta name="keywords" content="flutter, Often, Errors" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-02/the-most-often-errors-in-flutter/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="The most common mistakes that beginners make when practicing Flutter" />
<meta property="og:description" content="Typical error one: Future that cannot be mastered Typical error message: NoSuchMethodError: The method &#39;markNeedsBuild&#39; was called on null. This error is often found in asynchronous task (Future) processing, such as a page requesting a web API data and refreshing the Widget State based on the data. This error occurs when the asynchronous task ends after the page has been popped, but does not check if the State is still" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-02/the-most-often-errors-in-flutter/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-28T10:03:13+08:00" />
<meta property="article:modified_time" content="2022-02-28T10:03:13+08:00" />

<meta itemprop="name" content="The most common mistakes that beginners make when practicing Flutter">
<meta itemprop="description" content="Typical error one: Future that cannot be mastered Typical error message: NoSuchMethodError: The method &#39;markNeedsBuild&#39; was called on null. This error is often found in asynchronous task (Future) processing, such as a page requesting a web API data and refreshing the Widget State based on the data. This error occurs when the asynchronous task ends after the page has been popped, but does not check if the State is still"><meta itemprop="datePublished" content="2022-02-28T10:03:13+08:00" />
<meta itemprop="dateModified" content="2022-02-28T10:03:13+08:00" />
<meta itemprop="wordCount" content="1969">
<meta itemprop="keywords" content="flutter," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The most common mistakes that beginners make when practicing Flutter"/>
<meta name="twitter:description" content="Typical error one: Future that cannot be mastered Typical error message: NoSuchMethodError: The method &#39;markNeedsBuild&#39; was called on null. This error is often found in asynchronous task (Future) processing, such as a page requesting a web API data and refreshing the Widget State based on the data. This error occurs when the asynchronous task ends after the page has been popped, but does not check if the State is still"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">The most common mistakes that beginners make when practicing Flutter</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-28 10:03:13 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1969 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#typical-error-one-future-that-cannot-be-mastered">Typical error one: Future that cannot be mastered</a>
          <ul>
            <li><a href="#sample-code">Sample code</a></li>
            <li><a href="#cause-analysis">Cause analysis</a></li>
            <li><a href="#solution-check-if-mounted-before-setstate">Solution: Check if <code>mounted</code> before <code>setState</code>.</a></li>
            <li><a href="#cause-analysis-1">Cause analysis</a></li>
            <li><a href="#solution-check-if-mounted-before-setstate-1">Solution: Check if <code>mounted</code> before <code>setState</code></a></li>
          </ul>
        </li>
        <li><a href="#typical-error-2-navigatorofcontext-is-a-null">Typical error #2: Navigator.of(context) is a null</a>
          <ul>
            <li><a href="#sample-code-1">Sample code</a></li>
            <li><a href="#cause-analysis-2">Cause Analysis.</a></li>
            <li><a href="#solution">Solution</a></li>
          </ul>
        </li>
        <li><a href="#typical-mistake-3-schrödingers-position-in-scrollcontroller">Typical mistake #3: Schrödinger&rsquo;s position in ScrollController</a>
          <ul>
            <li><a href="#sample-code-2">Sample code</a></li>
            <li><a href="#cause-analysis-3">Cause Analysis</a></li>
            <li><a href="#solution-1">Solution</a></li>
          </ul>
        </li>
        <li><a href="#typical-mistake-4-getting-around-null">Typical mistake #4: Getting around null</a>
          <ul>
            <li><a href="#sample-code-3">Sample code</a></li>
            <li><a href="#cause-analysis-4">Cause analysis</a></li>
            <li><a href="#solution-error-tolerance">Solution: Error tolerance</a></li>
          </ul>
        </li>
        <li><a href="#typical-error-5-the-dynamic-in-generic-is-not-dynamic-at-all">Typical error 5: The dynamic in generic is not dynamic at all</a>
          <ul>
            <li><a href="#sample-code-4">Sample code</a></li>
            <li><a href="#reason-analysis">Reason analysis</a></li>
            <li><a href="#solution-use-listfrom-mapfrom">Solution: use List.from, Map.from</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="typical-error-one-future-that-cannot-be-mastered">Typical error one: Future that cannot be mastered</h2>
<p>Typical error message: <code>NoSuchMethodError: The method 'markNeedsBuild' was called on null.</code></p>
<p>This error is often found in asynchronous task (<a href="https://dart.dev/codelabs/async-await#what-is-a-future">Future</a>) processing, such as a page requesting a web API data and refreshing the Widget State based on the data.</p>
<p>This error occurs when the asynchronous task ends after the page has been popped, but does not check if the State is still <code>mounted</code> and continues to call <code>setState</code>.</p>
<h3 id="sample-code">Sample code</h3>
<p>A very common code to get network data, call <code>requestApi()</code>, wait for Future to get <code>response</code> from it, and then <code>setState</code> to refresh the widget.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">AWidgetState</span> <span class="kd">extends</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">AWidget</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="kd">var</span> <span class="n">data</span><span class="p">;</span>
  <span class="kt">void</span> <span class="n">loadData</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">requestApi</span><span class="p">(...);</span>
    <span class="n">setState</span><span class="p">((){</span>
      <span class="k">this</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cause-analysis">Cause analysis</h3>
<p>The <code>response</code> is an <code>async-await</code> asynchronous task, and it is entirely possible that the <code>AWidgetState</code> is <code>dispose</code> before it returns, when the <code>Element</code> bound to the <code>State</code> is no longer there. So you need to tolerate errors when <code>setState</code>.</p>
<h3 id="solution-check-if-mounted-before-setstate">Solution: Check if <code>mounted</code> before <code>setState</code>.</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">AWidgetState</span> <span class="kd">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="kd">var</span> <span class="n">data</span><span class="p">;</span>
  <span class="kt">void</span> <span class="n">loadData</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">requestApi</span><span class="p">(...);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mounted</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">setState</span><span class="p">((){</span>
        <span class="k">this</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cause-analysis-1">Cause analysis</h3>
<p>The <code>response</code> is an <code>async-await</code> asynchronous task, and it is entirely possible that the <code>AWidgetState</code> is <code>dispose</code> before it returns, when the <code>Element</code> bound to the <code>State</code> is no longer there. So you need to tolerate errors when <code>setState</code>.</p>
<h3 id="solution-check-if-mounted-before-setstate-1">Solution: Check if <code>mounted</code> before <code>setState</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="err">@</span><span class="n">override</span>
<span class="kt">void</span> <span class="n">initState</span><span class="p">(){</span>
  <span class="n">WidgetsBinding</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="n">addPostFrameCallback</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mounted</span><span class="p">)</span> <span class="n">_animationController</span><span class="p">.</span><span class="n">forward</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>AnimationController</code> may <code>dispose</code> along with the State, but the <code>FrameCallback</code> will still be executed, leading to an exception.</p>
<p>Another example is to do something in the callback of the animation listener.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="err">@</span><span class="n">override</span>
<span class="kt">void</span> <span class="n">initState</span><span class="p">(){</span>
  <span class="n">_animationController</span><span class="p">.</span><span class="n">animation</span><span class="p">.</span><span class="n">addListener</span><span class="p">(</span><span class="n">_handleAnimationTick</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">_handleAnimationTick</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mounted</span><span class="p">)</span> <span class="n">updateWidget</span><span class="p">(...);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>It is also possible that the State has been <code>dispose</code> before <code>_handleAnimationTick</code> is called back.</p>
<p>If you don&rsquo;t understand why, please take a closer look at the <code>Event loop</code> and review Dart&rsquo;s thread model.</p>
<h2 id="typical-error-2-navigatorofcontext-is-a-null">Typical error #2: Navigator.of(context) is a null</h2>
<p>Typical error message: <code>NoSuchMethodError: The method 'pop' was called on null.</code></p>
<p>Often occurs in <a href="https://api.flutter.dev/flutter/material/showDialog.html"><code>showDialog</code></a> after processing pop() of dialog.</p>
<h3 id="sample-code-1">Sample code</h3>
<p>Get network data in a method, to better prompt the user, a loading window will pop up first, and then perform other actions based on the data&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="c1">// show loading dialog on request data
</span><span class="c1"></span><span class="n">showDialog</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nl">context:</span> <span class="n">context</span><span class="p">,</span>
  <span class="nl">barrierDismissible:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nl">builder:</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Center</span><span class="p">(</span>
      <span class="nl">child:</span> <span class="n">CircularIndicator</span><span class="p">(),</span>
    <span class="p">);</span>
  <span class="p">},</span>
<span class="p">);</span>
<span class="kd">var</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kd">await</span> <span class="n">requestApi</span><span class="p">(...)).</span><span class="n">data</span><span class="p">;</span>
<span class="c1">// got it, pop dialog
</span><span class="c1"></span><span class="n">Navigator</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">context</span><span class="p">).</span><span class="n">pop</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cause-analysis-2">Cause Analysis.</h3>
<p>The reason for the error is - Android&rsquo;s native <strong>back button</strong>: although the code specifies <code>barrierDismissible: false</code>, the user cannot tap the translucent area to close the popup window, but when the user clicks the <strong>back button</strong>, the Flutter engine code will call <code>NavigationChannel.popRoute()</code> and eventually the loading dialog is turned off, including the page, which in turn causes <code>Navigator.of(context)</code> to return <code>null</code> because the <code>context</code> has been <code>unmounted</code> and cannot be found from an already withered The error occurs because the <code>context</code> has been <code>unmounted</code> and its root cannot be found from a faded leaf.</p>
<p>Also, the <code>context</code> used in the code <code>Navigator.of(context)</code> is not quite correct, it actually belongs to the <code>showDialog</code> caller and not to the dialog, in theory it should use the <code>context</code> passed from the <code>builder</code>, and the root can be found along the wrong trunk, but This is not the case in practice, especially if you have <code>Navigator</code> nested in your app.</p>
<h3 id="solution">Solution</h3>
<p>First, make sure that the <code>context</code> of <code>Navigator.of(context)</code> is the <code>context</code> of the dialog.
Second, you can wrap a <code>WillPopScope</code> around the Dialog Widget outer layer to handle the return key, or check <code>null</code> as a safety precaution in case it is manually closed.</p>
<p>Pass in <code>GlobalKey</code> when <code>showDialog</code>, and use <code>GlobalKey</code> to get the correct <code>context</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="n">GlobalKey</span> <span class="n">key</span> <span class="o">=</span> <span class="n">GlobalKey</span><span class="p">();</span>

<span class="n">showDialog</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nl">context:</span> <span class="n">context</span><span class="p">,</span>
  <span class="nl">barrierDismissible:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nl">builder:</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// Disallow pop by &#39;back&#39; button when barrierDismissible is false
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">WillPopScope</span><span class="p">(</span>
      <span class="nl">onWillPop:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">Future</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="kc">false</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">KeyedSubtree</span><span class="p">(</span>
        <span class="nl">key:</span> <span class="n">key</span><span class="p">,</span>
        <span class="nl">child:</span> <span class="n">Center</span><span class="p">(</span>
          <span class="nl">child:</span> <span class="n">CircularIndicator</span><span class="p">(),</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">);</span>
  <span class="p">},</span>
<span class="p">);</span>
<span class="kd">var</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kd">await</span> <span class="n">requestApi</span><span class="p">(...)).</span><span class="n">data</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">currentContext</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Navigator</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">currentContext</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>A <code>key.currentContext</code> of <code>null</code> means that the dialog has been <code>dispose</code>, i.e. <code>unmounted</code> from the WidgetTree.</p>
<p>In fact, similar <code>XXX.of(context)</code> methods are common in Flutter code, such as <code>MediaQuery.of(context)</code>, <code>Theme.of(context)</code>, <code>DefaultTextStyle.of(context)</code>, <code> DefaultAssetBundle.of(context)</code> and so on, be careful that the <code>context</code> passed in is from the correct node, otherwise you will have a surprise waiting for you.</p>
<p>When writing Flutter code, make sure you have a clear idea of the trunk of <code>context</code> in your head.</p>
<h2 id="typical-mistake-3-schrödingers-position-in-scrollcontroller">Typical mistake #3: Schrödinger&rsquo;s position in ScrollController</h2>
<p>When getting the <code>position</code> or <code>offset</code> of the <code>ScrollController</code> or calling <code>jumpTo()</code> methods, <code>StateError</code> errors often occur.</p>
<p>Error messages: <code>StateError Bad state: Too many elements</code>, <code>StateError Bad state: No element</code></p>
<h3 id="sample-code-2">Sample code</h3>
<p>After a button click, the <code>ScrollController</code> controls the <code>ListView</code> scrolling to the beginning.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">final</span> <span class="n">ScrollController</span> <span class="n">_primaryScrollController</span> <span class="o">=</span> <span class="n">ScrollController</span><span class="p">();</span>
<span class="c1">// 回到开头
</span><span class="c1"></span><span class="kt">void</span> <span class="n">_handleTap</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">_primaryScrollController</span><span class="p">.</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">_primaryScrollController</span><span class="p">.</span><span class="n">jumpTo</span><span class="p">(</span><span class="m">0.0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cause-analysis-3">Cause Analysis</h3>
<p>First look at the source code of <code>ScrollController</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">ScrollController</span> <span class="kd">extends</span> <span class="n">ChangeNotifier</span> <span class="p">{</span>
  <span class="c1">//...
</span><span class="c1"></span>  <span class="err">@</span><span class="n">protected</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">ScrollPosition</span><span class="o">&gt;</span> <span class="kd">get</span> <span class="n">positions</span> <span class="o">=&gt;</span> <span class="n">_positions</span><span class="p">;</span>
  <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ScrollPosition</span><span class="o">&gt;</span> <span class="n">_positions</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ScrollPosition</span><span class="o">&gt;</span><span class="p">[];</span>
  
  <span class="kt">double</span> <span class="kd">get</span> <span class="n">offset</span> <span class="o">=&gt;</span> <span class="n">position</span><span class="p">.</span><span class="n">pixels</span><span class="p">;</span>
  
  <span class="n">ScrollPosition</span> <span class="kd">get</span> <span class="n">position</span> <span class="p">{</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_positions</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">,</span> <span class="s1">&#39;ScrollController not attached to any scroll views.&#39;</span><span class="p">);</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_positions</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="m">1</span><span class="p">,</span> <span class="s1">&#39;ScrollController attached to multiple scroll views.&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">_positions</span><span class="p">.</span><span class="n">single</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">//...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Obviously, the <code>offest</code> of the <code>ScrollController</code> is obtained from the <code>position</code>, which is derived from the variable <code>_positions</code>.</p>
<p>The <code>StateError</code> error is thrown by the <code>_positions.single</code> line.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">//...
</span><span class="c1"></span>  <span class="n">E</span> <span class="kd">get</span> <span class="n">single</span> <span class="p">{</span>
    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">it</span><span class="p">.</span><span class="n">moveNext</span><span class="p">())</span> <span class="k">throw</span> <span class="n">IterableElementError</span><span class="p">.</span><span class="n">noElement</span><span class="p">();</span>
    <span class="n">E</span> <span class="n">result</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">current</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">moveNext</span><span class="p">())</span> <span class="k">throw</span> <span class="n">IterableElementError</span><span class="p">.</span><span class="n">tooMany</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>So the question is, why does this <code>_positions</code> suddenly not have a drop left, and suddenly it gives too much? ˊ_&gt;?</p>
<p>We still have to go back to the source code of <code>ScrollController</code> to find out.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">ScrollController</span> <span class="kd">extends</span> <span class="n">ChangeNotifier</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="kt">void</span> <span class="n">attach</span><span class="p">(</span><span class="n">ScrollPosition</span> <span class="n">position</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">assert</span><span class="p">(</span><span class="o">!</span><span class="n">_positions</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">position</span><span class="p">));</span>
    <span class="n">_positions</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
    <span class="n">position</span><span class="p">.</span><span class="n">addListener</span><span class="p">(</span><span class="n">notifyListeners</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">detach</span><span class="p">(</span><span class="n">ScrollPosition</span> <span class="n">position</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_positions</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">position</span><span class="p">));</span>
    <span class="n">position</span><span class="p">.</span><span class="n">removeListener</span><span class="p">(</span><span class="n">notifyListeners</span><span class="p">);</span>
    <span class="n">_positions</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>Why there is no data (No element).
<code>ScrollController</code> has not <code>attach</code> a <code>position</code> yet. There are two reasons: one may be that it hasn&rsquo;t been <strong>mounted</strong> to the tree (not used by <code>Scrollable</code>); the other is that it has been <code>detach</code>. 2.</li>
<li>Why too many elements.
<code>ScrollController</code> has <code>attach</code> a new one before it has time to <code>detach</code> the old <code>position</code>. The reason for this is most likely that the <code>ScrollController</code> is being used incorrectly and is being followed by multiple <code>Scrollable</code>s at the same time.</li>
</ol>
<h3 id="solution-1">Solution</h3>
<p>For the No element error, just determine if <code>_positions</code> is empty, i.e. <code>hasClients</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">final</span> <span class="n">ScrollController</span> <span class="n">_primaryScrollController</span> <span class="o">=</span> <span class="n">ScrollController</span><span class="p">();</span>
<span class="c1">// 回到开头
</span><span class="c1"></span><span class="kt">void</span> <span class="n">_handleTap</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">_primaryScrollController</span><span class="p">.</span><span class="n">hasClients</span> <span class="o">&amp;&amp;</span> <span class="n">_primaryScrollController</span><span class="p">.</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">_primaryScrollController</span><span class="p">.</span><span class="n">jumpTo</span><span class="p">(</span><span class="m">0.0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>For the too many elements error, make sure that the <code>ScrollController</code> is bound by only one <code>Scrollable</code>, don&rsquo;t let it split, and is properly <code>dispose()</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">WidgetState</span> <span class="kd">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">ScrollController</span> <span class="n">_primaryScrollController</span> <span class="o">=</span> <span class="n">ScrollController</span><span class="p">();</span>

  <span class="err">@</span><span class="n">override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ListView</span><span class="p">.</span><span class="n">builder</span><span class="p">(</span>
      <span class="nl">controller:</span> <span class="n">_primaryScrollController</span><span class="p">,</span>
      <span class="nl">itemCount:</span> <span class="n">_itemCount</span><span class="p">,</span>
      <span class="nl">itemBuilder:</span> <span class="n">_buildItem</span><span class="p">,</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="kd">get</span> <span class="n">_itemCount</span> <span class="o">=&gt;</span> <span class="p">...;</span>
  <span class="n">Widget</span> <span class="n">_buildItem</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">...;</span>

  <span class="err">@</span><span class="n">override</span>
  <span class="kt">void</span> <span class="n">dispose</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
    <span class="n">_primaryScrollController</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="typical-mistake-4-getting-around-null">Typical mistake #4: Getting around null</h2>
<p>The language Dart can be static or dynamic, and the <a href="https://dart.dev/guides/language/sound-dart">type system</a> is unique. Everything can be assigned the value <code>null</code>, which often causes comrades who are used to writing Java code to get dizzy because <code>bool</code>, <code>int</code>, <code>double</code>, which seem to be &ldquo;primitive&rdquo; types, are attached by <code>null</code>.</p>
<p>Typical error message.</p>
<ul>
<li><code>Failed assertion: boolean expression must not be null</code></li>
<li><code>NoSuchMethodError: The method '&gt;' was called on null.</code></li>
<li><code>NoSuchMethodError: The method '+' was called on null.</code></li>
<li><code>NoSuchMethodError: The method '*' was called on null.</code></li>
</ul>
<h3 id="sample-code-3">Sample code</h3>
<p>This error occurs more often when using data mods returned by the server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">StyleItem</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">bool</span> <span class="n">hasNew</span><span class="p">;</span>

  <span class="n">StyleItem</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">json</span><span class="p">)</span><span class="o">:</span>
    <span class="k">this</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
    <span class="k">this</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
    <span class="k">this</span><span class="p">.</span><span class="n">hasNew</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;has_new&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">StyleItem</span> <span class="n">item</span> <span class="o">=</span> <span class="n">StyleItem</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">jsonDecode</span><span class="p">(...));</span>

<span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">StyleItem</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">hasNew</span> <span class="o">&amp;&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Text</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">SizedBox</span><span class="p">.</span><span class="n">shrink</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="cause-analysis-4">Cause analysis</h3>
<p><code>StyleItem.fromJson()</code> is not fault-tolerant to the data and should assume that the values in the map are likely to be <code>null</code>.</p>
<h3 id="solution-error-tolerance">Solution: Error tolerance</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">StyleItem</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">bool</span> <span class="n">hasNew</span><span class="p">;</span>

  <span class="n">StyleItem</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">json</span><span class="p">)</span><span class="o">:</span>
    <span class="k">this</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
    <span class="k">this</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="m">0</span><span class="p">,</span>
    <span class="k">this</span><span class="p">.</span><span class="n">hasNew</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;has_new&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Be sure to get used to Dart&rsquo;s type system, anything can be <code>null</code>, for example, the following code, you can think of several possible errors.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">Test</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">fraction</span><span class="p">(</span><span class="n">Rect</span> <span class="n">boundsA</span><span class="p">,</span> <span class="n">Rect</span> <span class="n">boundsB</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">areaA</span> <span class="o">=</span> <span class="n">boundsA</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">boundsA</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">areaB</span> <span class="o">=</span> <span class="n">boundsB</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">boundsB</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">areaA</span> <span class="o">/</span> <span class="n">areaB</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kt">void</span> <span class="n">requestData</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="kt">void</span> <span class="n">onDone</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">_requestApi</span><span class="p">(</span><span class="n">params</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">onDone</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">));</span>
  <span class="p">}</span>
  
  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">_requestApi</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">...;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As a tip, <code>onDone()</code> can also be <code>null</code>.</p>
<p>Pay special attention when passing data with the native <a href="https://flutter.cn/docs/development/platform-integration/platform-channels"><code>MethodChannel</code></a>, and be careful.</p>
<h2 id="typical-error-5-the-dynamic-in-generic-is-not-dynamic-at-all">Typical error 5: The dynamic in generic is not dynamic at all</h2>
<p>Typical error message.</p>
<ul>
<li><code>type 'List&lt;dynamic&gt;' is not a subtype of type 'List&lt;int&gt;'</code></li>
<li><code>type '_InternalLinkedHashMap&lt;dynamic, dynamic&gt;' is not a subtype of type 'Map&lt;String, String&gt;'</code></li>
</ul>
<p>Often occurs when assigning a value to a List, Map variable.</p>
<h3 id="sample-code-4">Sample code</h3>
<p>This error also occurs more often when using the data mod returned by the server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">Model</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ids</span><span class="p">;</span>
  <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="n">ext</span><span class="p">;</span>

  <span class="n">Model</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">json</span><span class="p">)</span><span class="o">:</span>
    <span class="k">this</span><span class="p">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span>
    <span class="k">this</span><span class="p">.</span><span class="n">ext</span><span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="n">json</span> <span class="o">=</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;{&#34;ids&#34;: [1,2,3], &#34;ext&#34;: {&#34;key&#34;: &#34;value&#34;}}&#34;&#34;&#34;</span><span class="p">);</span>
<span class="n">Model</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Model</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="reason-analysis">Reason analysis</h3>
<p>The generic type of the map converted by <code>jsonDecode()</code> method is <code>Map&lt;String, dynamic&gt;</code>, meaning that value may be of any type (dynamic), and when value is a container type, it is actually <code>List&lt;dynamic&gt;</code> or <code>Map&lt;dynamic, dynamic&gt;</code>, etc.</p>
<p>In Dart&rsquo;s type system, although <code>dynamic</code> can represent all types and can be automatically converted if the data types in fact match (<a href="https://dart.dev/guides/language/sound-dart#runtime-checks">runtime type</a> is equal) when assigning values, the generic <code>dynamic</code> is not automatically convertible in generic types. Think of <code>List&lt;dynamic&gt;</code> and <code>List&lt;int&gt;</code> as two <strong>run-time types</strong>.</p>
<h3 id="solution-use-listfrom-mapfrom">Solution: use List.from, Map.from</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">class Model {
  final List&lt;int&gt; ids;
  final Map&lt;String, String&gt; ext;

  Model.fromJson(Map&lt;String, dynamic&gt; json):
    this.ids = List.from(json[&#39;ids&#39;] ?? const []),
    this.ext= Map.from(json[&#39;ext&#39;] ?? const {});
}
</code></pre></td></tr></table>
</div>
</div><h2 id="summary">Summary</h2>
<p>To sum up, these typical errors are not troublesome, but caused by not understanding or not familiar with Flutter and Dart language, the key is to learn to handle fault tolerance.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/flutter/">flutter</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-02/flutter-raw-image-provider/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Flutter Raw Image Provider</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-02/memcached-meta-commands/">
            <span class="next-text nav-default">Memcached Meta Commands</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
