<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Hash and history routing in the browser - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="When we use front-end rendering like Vue or React, there are usually two types of routing: hash routing and history routing. hash routing: listen to the hash changes in the url and render different content, this kind of routing does not send requests to the server and does not need server-side support. history routing: listens for changes in the path in the url and requires the support of both the" /><meta name="keywords" content="vue, react, Hash History Router" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-02/hash-history-router/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Hash and history routing in the browser" />
<meta property="og:description" content="When we use front-end rendering like Vue or React, there are usually two types of routing: hash routing and history routing. hash routing: listen to the hash changes in the url and render different content, this kind of routing does not send requests to the server and does not need server-side support. history routing: listens for changes in the path in the url and requires the support of both the" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-02/hash-history-router/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-20T15:01:34+08:00" />
<meta property="article:modified_time" content="2022-02-20T15:01:34+08:00" />

<meta itemprop="name" content="Hash and history routing in the browser">
<meta itemprop="description" content="When we use front-end rendering like Vue or React, there are usually two types of routing: hash routing and history routing. hash routing: listen to the hash changes in the url and render different content, this kind of routing does not send requests to the server and does not need server-side support. history routing: listens for changes in the path in the url and requires the support of both the"><meta itemprop="datePublished" content="2022-02-20T15:01:34+08:00" />
<meta itemprop="dateModified" content="2022-02-20T15:01:34+08:00" />
<meta itemprop="wordCount" content="1518">
<meta itemprop="keywords" content="javascript,vue,react," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hash and history routing in the browser"/>
<meta name="twitter:description" content="When we use front-end rendering like Vue or React, there are usually two types of routing: hash routing and history routing. hash routing: listen to the hash changes in the url and render different content, this kind of routing does not send requests to the server and does not need server-side support. history routing: listens for changes in the path in the url and requires the support of both the"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Hash and history routing in the browser</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-20 15:01:34 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1518 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-hash-routing">1. hash routing</a>
          <ul>
            <li><a href="#11-the-process-of-implementation">1.1 The process of implementation</a></li>
            <li><a href="#12-the-way-to-call">1.2 The way to call</a></li>
          </ul>
        </li>
        <li><a href="#2-history-routing">2. history routing</a>
          <ul>
            <li><a href="#21-application-scenarios">2.1 Application scenarios</a></li>
            <li><a href="#22-unable-to-listen-for-route-changes">2.2 Unable to listen for route changes</a></li>
            <li><a href="#23-the-complete-code">2.3 The complete code</a></li>
          </ul>
        </li>
        <li><a href="#3-summary">3. Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When we use front-end rendering like Vue or React, there are usually two types of routing: hash routing and history routing.</p>
<ol>
<li>hash routing: listen to the hash changes in the url and render different content, this kind of routing does not send requests to the server and does not need server-side support.</li>
<li>history routing: listens for changes in the path in the url and requires the support of both the client and the server.</li>
</ol>
<p>Let&rsquo;s implement these two types of routes step by step to understand the underlying implementation principles in depth. We mainly implement the following simple functions.</p>
<ol>
<li>listen to changes in the route and can make actions when the route changes.</li>
<li>the ability to move forward or backward.</li>
<li>can configure routes.</li>
</ol>
<h2 id="1-hash-routing">1. hash routing</h2>
<p>When the hash of a page changes, it will trigger the <code>hashchange</code> event, so we can listen to this event to determine if the route has changed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
    <span class="s1">&#39;hashchange&#39;</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">oldURL</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">oldURL</span><span class="p">;</span> <span class="c1">// 上一个URL
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">newURL</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">newURL</span><span class="p">;</span> <span class="c1">// 当前的URL
</span><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">newURL</span><span class="p">,</span> <span class="nx">oldURL</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kc">false</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="11-the-process-of-implementation">1.1 The process of implementation</h3>
<p>After splitting oldURL and newURL, we can get more detailed hash values. We&rsquo;ll start by creating a HashRouter class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">HashRouter</span> <span class="p">{</span>
    <span class="nx">currentUrl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// 当前的URL
</span><span class="c1"></span>    <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="nx">getHashPath</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The event <code>hashchange</code> is only triggered when the hash changes, and it is not triggered when we first enter the page, so we also need to listen to the <code>load</code> event. Note that the event of the two events is different: the event in the hashchange event has two properties, oldURL and newURL, but the event in the load event does not have these two properties, but we can get the current hash route through location.hash.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">HashRouter</span> <span class="p">{</span>
    <span class="nx">currentUrl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// 当前的URL
</span><span class="c1"></span>    <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">getHashPath</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">refresh</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">curURL</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">oldURL</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">newURL</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">oldURL</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHashPath</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">oldURL</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="nx">curURL</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHashPath</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">newURL</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">curURL</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHashPath</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentUrl</span> <span class="o">=</span> <span class="nx">curURL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Up to this point it has been possible to get the current hash route, but when the route changes, our page should switch, so we need to listen for this change.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">HashRouter</span> <span class="p">{</span>
    <span class="nx">currentUrl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// 当前的URL
</span><span class="c1"></span>    <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="c1">// 暂时省略上面的代码
</span><span class="c1"></span>
    <span class="nx">refresh</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 当hash路由发生变化时，则触发change事件
</span><span class="c1"></span>        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">curURL</span><span class="p">,</span> <span class="nx">oldURL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">on</span><span class="p">(</span><span class="nx">evName</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">evName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">evName</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">evName</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">handler</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashRouter</span><span class="p">();</span>
<span class="nx">rouer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">curUrl</span><span class="p">,</span> <span class="nx">lastUrl</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;当前的hash:&#39;</span><span class="p">,</span> <span class="nx">curUrl</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;上一个hash:&#39;</span><span class="p">,</span> <span class="nx">lastUrl</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="12-the-way-to-call">1.2 The way to call</h3>
<p>By now, we have the basic functionality done. Let&rsquo;s match it with an example to get a better image.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 先定义几个路由
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
        <span class="nx">component</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">Home</span> <span class="o">/&gt;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;about&#39;</span><span class="p">,</span>
        <span class="nx">component</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">About</span> <span class="o">/&gt;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;404&#39;</span><span class="p">,</span>
        <span class="nx">component</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">NotFound404</span> <span class="o">/&gt;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">];</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashRouter</span><span class="p">();</span>
<span class="c1">// 监听change事件
</span><span class="c1"></span><span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">currentUrl</span><span class="p">,</span> <span class="nx">lastUrl</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">route</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="c1">// 匹配路由
</span><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">routes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">routes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentUrl</span> <span class="o">===</span> <span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">route</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// 若没有匹配到，则使用最后一个路由
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">route</span> <span class="o">=</span> <span class="nx">routes</span><span class="p">[</span><span class="nx">routes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="c1">// 渲染当前的组件
</span><span class="c1"></span>    <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">component</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>See [<a href="https://www.xiabingbao.com/demos/20200409/hash-router.html">Sample of hash routing</a>].</p>
<h2 id="2-history-routing">2. history routing</h2>
<p>In history routing, we will definitely use the methods in <code>window.history</code>, the common actions are</p>
<ul>
<li>back(): go back to the previous route.</li>
<li>forward(): advance to the next route, if any.</li>
<li>go(number): go to any route, positive number for forward, negative number for backward.</li>
<li>pushState(obj, title, url): advances to the specified URL without refreshing the page.</li>
<li>replaceState(obj, title, url): replaces the current route with the url, without refreshing the page.</li>
</ul>
<p>When calling these methods, all will just modify the URL of the current page, and the content of the page will not change at all. If an interviewer asks the question &ldquo;how to modify the URL of a page without sending a request&rdquo;, the answer is these 5 methods. then the answer is these 5 methods.</p>
<p>If there is no new updated URL on the server side, a browser refresh will report an error, because a browser refresh will actually send an http web request to the server. So to use history routing, you need the support of the server.</p>
<h3 id="21-application-scenarios">2.1 Application scenarios</h3>
<p>What is the difference between the pushState and replaceState methods and location.href and location.replace methods? What are the application scenarios?</p>
<ol>
<li>location.href and location.replace send a request to the server when switching, while pushState and replace only modify the url, unless a request is initiated.</li>
<li>the feature that only switches the url without sending a request can be used in front-end rendering, for example, the home page is rendered server-side and the secondary page is rendered front-end.</li>
<li>the possibility of adding animations for route switching.</li>
<li>when using a scenario like Jitterbug in the browser, the corresponding URL can be silently modified when the user slides to switch videos, and when the user refreshes the page, it can still stay in the current video.</li>
</ol>
<h3 id="22-unable-to-listen-for-route-changes">2.2 Unable to listen for route changes</h3>
<p>When we use history routing, we must be able to listen for changes to the route. There is a global <code>popstate</code> event, which has a state keyword in its name, but when <code>pushState</code> and <code>replaceState</code> are called, the popstate event is not triggered, only the first 3 methods listed above are triggered. You can click <a href="https://www.xiabingbao.com/demos/20200410/history-pushstate-popstate.html">popState does not trigger popstate event</a> to see it.</p>
<p>In this case, we can use <code>window.dispatchEvent</code> to add an event.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">orig</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">rv</span> <span class="o">=</span> <span class="nx">orig</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">arguments</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">rv</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">(</span><span class="s1">&#39;pushState&#39;</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">(</span><span class="s1">&#39;replaceState&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Then you can add a listener for both methods.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;pushState&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;replaceState&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="23-the-complete-code">2.3 The complete code</h3>
<p>The complete code is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">HistoryRouter</span> <span class="p">{</span>
    <span class="nx">currentUrl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addStateListener</span><span class="p">();</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;popstate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;pushState&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;replaceState&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">addStateListener</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">listener</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">orig</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
            <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">rv</span> <span class="o">=</span> <span class="nx">orig</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">arguments</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
                <span class="nb">window</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">rv</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">};</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">(</span><span class="s1">&#39;pushState&#39;</span><span class="p">);</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">(</span><span class="s1">&#39;replaceState&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">refresh</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentUrl</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#app span&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">on</span><span class="p">(</span><span class="nx">evName</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">evName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">evName</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">evName</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">handler</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HistoryRouter</span><span class="p">();</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">curUrl</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">curUrl</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>The usage is the same as hash routing above, so we won&rsquo;t go into details here. Click to see <a href="https://www.xiabingbao.com/demos/20200410/history-router.html">the application of history routing</a>.</p>
<h2 id="3-summary">3. Summary</h2>
<p>At this point, the principle and implementation of the two routing methods are introduced.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascript/">javascript</a>
          <a href="/tags/vue/">vue</a>
          <a href="/tags/react/">react</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-02/node-multiprocessing/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Multiprocessing and daemons in nodejs</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-02/js-eventloop/">
            <span class="next-text nav-default">The EventLoop mechanism in Js</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
