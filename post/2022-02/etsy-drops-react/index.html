<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Mad about the upgrade, Etsy drops React - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="There is a long-standing debate about whether to use Preact or React, the MIT-licensed open source software that has over 26k stars on GitHub and 1/4 million downloads per week on NPM. And React, an internal project from Facebook, has become one of the mainstream front-end frameworks after being open-sourced in 2013.
Baidu has asked to stop using React / React Native internally for a long time, and Ali has started to pilot Preact in some of its businesses." /><meta name="keywords" content="Etsy Drops React" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-02/etsy-drops-react/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Mad about the upgrade, Etsy drops React" />
<meta property="og:description" content="There is a long-standing debate about whether to use Preact or React, the MIT-licensed open source software that has over 26k stars on GitHub and 1/4 million downloads per week on NPM. And React, an internal project from Facebook, has become one of the mainstream front-end frameworks after being open-sourced in 2013.
Baidu has asked to stop using React / React Native internally for a long time, and Ali has started to pilot Preact in some of its businesses." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-02/etsy-drops-react/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-12T10:53:03+08:00" />
<meta property="article:modified_time" content="2022-02-12T10:53:03+08:00" />

<meta itemprop="name" content="Mad about the upgrade, Etsy drops React">
<meta itemprop="description" content="There is a long-standing debate about whether to use Preact or React, the MIT-licensed open source software that has over 26k stars on GitHub and 1/4 million downloads per week on NPM. And React, an internal project from Facebook, has become one of the mainstream front-end frameworks after being open-sourced in 2013.
Baidu has asked to stop using React / React Native internally for a long time, and Ali has started to pilot Preact in some of its businesses."><meta itemprop="datePublished" content="2022-02-12T10:53:03+08:00" />
<meta itemprop="dateModified" content="2022-02-12T10:53:03+08:00" />
<meta itemprop="wordCount" content="1255">
<meta itemprop="keywords" content="react,preact," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Mad about the upgrade, Etsy drops React"/>
<meta name="twitter:description" content="There is a long-standing debate about whether to use Preact or React, the MIT-licensed open source software that has over 26k stars on GitHub and 1/4 million downloads per week on NPM. And React, an internal project from Facebook, has become one of the mainstream front-end frameworks after being open-sourced in 2013.
Baidu has asked to stop using React / React Native internally for a long time, and Ali has started to pilot Preact in some of its businesses."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Mad about the upgrade, Etsy drops React</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-12 10:53:03 </span>
        <div class="post-category">
            <a href="/categories/news/"> news </a>
            </div>
          <span class="more-meta"> 1255 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#preact-or-react">Preact or React?</a></li>
        <li><a href="#migration-plan">Migration Plan</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>There is a long-standing debate about whether to use Preact or React, the MIT-licensed open source software that has over 26k stars on GitHub and 1/4 million downloads per week on NPM. And React, an internal project from Facebook, has become one of the mainstream front-end frameworks after being open-sourced in 2013.</p>
<p>Baidu has asked to stop using React / React Native internally for a long time, and Ali has started to pilot Preact in some of its businesses. Etsy, an American e-commerce company, has also recently made a choice.</p>
<p>Senior software engineer Ben Sangster announced that Etsy has migrated from React v15.6 to Preact 10. Preact is much smaller and faster than React, and Sangster believes that using Preact will reduce the risks associated with migrating large codebases. Etsy is known to have started using React around 2015.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/12/f262c19aa60f4b8dbbeff12eaaa3fd53.png" alt="sobyte"></p>
<p>Sangster says the migration is seamless, that React v15.6 and Preact can use the exact same client, and that the really important improvement for Etsy developers is that they can start writing a more modern version of React.</p>
<h2 id="preact-or-react">Preact or React?</h2>
<p>Etsy currently has two main product stacks. For buyer-facing pages, Etsy uses a PHP server-based rendering scheme with client-side jQuery/raw JS, and for seller-facing pages, Etsy chooses to use a React-rendered SPA with a little server-based HTML rendering to minimize the amount of data it receives from the same PHP server stack.</p>
<p>In a related blog post, Sangster explains in detail three reasons why Etsy migrated to Preact rather than the latest version of React.</p>
<p>First, using Preact minimizes migration risk. Developers generally prefer the new features of React 16 (e.g., error boundaries, fragments, error stack tracking, custom DOM attributes, hooks in React 16.8), and while the React 16.0 documentation mentions some minor and significant changes, a number of developers have reported migration pains. Michael Greer of Discord said, &ldquo;Not all package errors are as easy to catch, and that&rsquo;s where the real pain is. We ran into a bug that took us 2 days to find the corresponding library, and you might run into the same problem.&rdquo;</p>
<p>While upgrading to React v16 is the safest option for Etsy in terms of long-term compatibility, it comes at a high cost to Etsy. Many of the lifecycle methods have been deprecated and renamed in the new version, so Etsy will have to adjust the names of these deprecated methods in the code runtime module. While Etsy intended to go with Preact, the codemods would still be used, except that Preact would allow them to be migrated first and modified later, and the React upgrade would require the codemods to be part of the upgrade process, making it more difficult to log in and undo.</p>
<p>In addition, Etsy&rsquo;s seller tools use a lot of theseus/Component helper, which is now deprecated, so it faces a lack of lifecycle methods available in React v16. On the other hand, Web Toolkit also uses a lot of deprecated lifecycle methods, so it needs to be refactored and regression tested to complete the migration safely.</p>
<p>Since the FES team&rsquo;s experimental architecture was already explicitly based on Preact and was intentionally sharing the Web Toolkit, the choice to migrate to React made it much more difficult to share code results between Preact and React. While this issue would initially affect only Web Toolkit, it would inevitably interfere with Etsy&rsquo;s ability to detect new versions of future seller tool sub-application architectures (which use the Preact SSR service).</p>
<p>But with the migration to Preact, like React, Etsy will need to complete the upgrade from React.createClass to create-react-class package, and from React. However, Preact&rsquo;s API is compatible with React, which means the team doesn&rsquo;t have to make any changes. With Preact&rsquo;s emphasis on compatibility with React v15 and React v16, migrating to Preact v10.4.2 will be even easier. From a developer tools perspective, there don&rsquo;t seem to be any major barriers to adopting Preact.</p>
<p>Sangster also provides a detailed comparison of the two in terms of compatibility issues with existing libraries, existing tools, and future plans.</p>
<p>Comparison in terms of compatibility issues with existing libraries.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/12/32518a631aae4bcbad8a73c0e768abad.png" alt="sobyte"></p>
<p>Comparison on compatibility issues with existing tools.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/12/cfd9d9425b7b4d0495368bd167ff7e5d.png" alt="sobyte"></p>
<p>Comparison with future planning on compatibility issues.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/12/ac4f89a7f51c455595bf4af79e58f00f.png" alt="sobyte"></p>
<p>Second, Etsy&rsquo;s Front End Systems team is already using Preact, and using Preact consistently in Etsy may make developers' lives easier.</p>
<p>Sangster introduced the new project architecture for the FES team (Etsy&rsquo;s front-end systems team), which is already based on Preact and does not pose compatibility issues. The Preact/React libraries used internally by Etsy have also been unified, making it much less difficult for developers to work with over time. At the same time, supporting/testing tools such as Web Toolkit in React and Preact was bound to add to the workload of the FES team and other colleagues, making it difficult for the team to share tools and architecture across the board. These issues disappeared when Preact became the only standard across Etsy.</p>
<p>Finally, Preact&rsquo;s package size (4KB for Preact v10.4.5) is six times smaller than React&rsquo;s (38.5KB for React v16.13.1 with the addition of react and react-dom). The larger the JavaScript volume, the larger the latency (time to interactive), and the more memory and CPU it consumes.</p>
<p>Sangster does a simple comparison, but note that the numbers below do not include package sizes that all three libraries have - such as prop-types or create-react-class. are all in gzip format.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/12/fe363983da29432ca1734a6622f733ba.png" alt="sobyte"></p>
<p>As you can see, upgrading from v15.6.2 to v16.13.1 saves 5.2 KB of space in gzip format, while upgrading from v15.6.2 to Preact v10.4.5 saves 37 KB of space in gzip format, so using Preact v10.4.5 instead of React v16.13.1 saves 32.5 KB of space in gzip format. So using Preact v10.4.5 instead of React v16.13.1 saves 32.5 KB of space in gzip format.</p>
<p>Sangster emphasized, &ldquo;We have a lot of old &lsquo;orphan&rsquo; code and a lot of old libraries, and upgrading to React 16 caused some API issues (especially with Portals/legacy Context/refs) that required a lot of work to fix. Instead, we migrated to Preact and were able to refactor the code to the most modern thing available without having to do all this synchronized component/library upgrade stuff.&rdquo;</p>
<h2 id="migration-plan">Migration Plan</h2>
<p>Assuming that all libraries are compatible as predicted in the previous section and that there are no unexpected compatibility issues with Preact, the entire migration process for Etsy will look like this.</p>
<ol>
<li>Switch and upgrade to Preact v10.4.5 so that we can switch between Preact and React rendering drivers to verify the migration.</li>
<li>use codemods to migrate to a &ldquo;modern&rdquo; React lifecycle approach (not a hard requirement, as Preact is perfectly capable of supporting two versions of the same API, but we think it&rsquo;s a good long-term goal).</li>
<li>completely remove react-router-redux (this can be done in parallel with the Preact migration).</li>
<li>upgrade react-redux to version 7.2.0 (which may also involve upgrading redux).</li>
<li>upgrade react-router to version 5.2.0 (and possibly 6.x, depending on how stable 5.2.0 is).</li>
</ol>
<p>Currently, Etsy&rsquo;s migration is stuck at the step of removing React.PropType and React.createClass, as the web platform team upgrades the ESM syntax.</p>
<p>The challenge with the whole migration process was that most of the work was complex and even a single line of /upgrade could take a lot of time. Secondly, the major changes on react-router also required Etsy to make intrusive adjustments to the sub-application architecture in the seller&rsquo;s tool to redesign the way loading/routing is done. Removing react-router-redux was also a significant effort, but the tasks are relatively independent and do not affect each other.</p>
<p><strong>See more:</strong></p>
<p><a href="https://github.com/mq2thez/blog/blob/main/upgrade-react-etsy/preact-vs-react.md">https://github.com/mq2thez/blog/blob/main/upgrade-react-etsy/preact-vs-react.md</a></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/react/">react</a>
          <a href="/tags/preact/">preact</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-02/rust-thread-pool/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Implementing a thread pool using Rust</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-02/php-everywhere-wordpress-plugin-bug/">
            <span class="next-text nav-default">WordPress plugin has a high-risk RCE vulnerability, only 50% of sites fixed</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
