<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linux kernel upgrades C language standard - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="According to news on the Linux kernel mailing list, the community recently discussed whether to adopt the modern C language standard for the kernel.
While the Linux kernel is evolving rapidly, it also relies on some very old tools, one of which is that the kernel code is still using the 1989 version of the C language standard - a standard that was written more than 30 years ago before the kernel project was started." /><meta name="keywords" content="Linux Kernel, Modern c" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-02/linux-kernel-to-modern-c/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Linux kernel upgrades C language standard" />
<meta property="og:description" content="According to news on the Linux kernel mailing list, the community recently discussed whether to adopt the modern C language standard for the kernel.
While the Linux kernel is evolving rapidly, it also relies on some very old tools, one of which is that the kernel code is still using the 1989 version of the C language standard - a standard that was written more than 30 years ago before the kernel project was started." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-02/linux-kernel-to-modern-c/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-26T11:33:31+08:00" />
<meta property="article:modified_time" content="2022-02-26T11:33:31+08:00" />

<meta itemprop="name" content="Linux kernel upgrades C language standard">
<meta itemprop="description" content="According to news on the Linux kernel mailing list, the community recently discussed whether to adopt the modern C language standard for the kernel.
While the Linux kernel is evolving rapidly, it also relies on some very old tools, one of which is that the kernel code is still using the 1989 version of the C language standard - a standard that was written more than 30 years ago before the kernel project was started."><meta itemprop="datePublished" content="2022-02-26T11:33:31+08:00" />
<meta itemprop="dateModified" content="2022-02-26T11:33:31+08:00" />
<meta itemprop="wordCount" content="658">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux kernel upgrades C language standard"/>
<meta name="twitter:description" content="According to news on the Linux kernel mailing list, the community recently discussed whether to adopt the modern C language standard for the kernel.
While the Linux kernel is evolving rapidly, it also relies on some very old tools, one of which is that the kernel code is still using the 1989 version of the C language standard - a standard that was written more than 30 years ago before the kernel project was started."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linux kernel upgrades C language standard</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-26 11:33:31 </span>
        <div class="post-category">
            <a href="/categories/news/"> news </a>
            </div>
          <span class="more-meta"> 658 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>According to <a href="https://lwn.net/SubscriberLink/885941/01fdc39df2ecc25f/">news</a> on the Linux kernel mailing list, the community recently discussed whether to <strong>adopt the modern C language standard</strong> for the kernel.</p>
<p>While the Linux kernel is evolving rapidly, it also relies on some very old tools, one of which is that the kernel code is still using the 1989 version of the C language standard - a standard that was written more than 30 years ago before the kernel project was started. As a result of the discussion, this is expected to change in kernel version 5.18.</p>
<p>Jakob Koschel has fixed a predictive execution vulnerability related to kernel chaining tables in a patch <a href="https://lkml.org/lkml/2022/2/17/1032">(Proposal for speculative safe list iterator)</a> submitted to Linus Torvalds.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/02/26/8866caae5a194d939ef1f85f3fbd9b50.png" alt="Proposal for speculative safe list iterator"></p>
<p>The reason for this is that Jakob discovered a problem with the Linux kernel&rsquo;s extensive use of bidirectional double linked   lists <a href="https://elixir.bootlin.com/linux/v5.17-rc5/source/include/linux/types.h#L177">defined by struct list_head</a> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">list_head</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">next</span><span class="p">,</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>Such structures are usually embedded in other structures, and in this way developers can make a linked table using any structure type of interest. In addition to this, the kernel provides <a href="https://elixir.bootlin.com/linux/v5.17-rc5/source/include/linux/list.h">a large number of</a> functions and macros that can be used to traverse and manipulate chained tables. One of these is <a href="https://elixir.bootlin.com/linux/v5.17-rc5/source/scripts/kconfig/list.h#L43">list_for_each_entry()</a>, a macro that masquerades as a control structure. To see how to use this macro, assume that the kernel contains the following structure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">foo</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">fooness</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>The list member can be used to create a two-way chain of foo structures. Assuming we have a structure declaration called foo_list as the head of such a chain, the following code can be used to iterate through this list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">foo</span> <span class="o">*</span><span class="n">iterator</span><span class="p">;</span>

<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_list</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">iterator</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/* Shoul
</span></code></pre></td></tr></table>
</div>
</div><p>The list argument tells the macro the name of the list_head structure in the foo structure. This loop will execute once for each element in the list, with the iterator pointing to that element. This led to a bug in the USB subsystem: the iterator passed to the macro could be used after exiting the macro.</p>
<p>Koschel fixed the problem by rewriting the faulty code to stop using the iterator after the loop.</p>
<p>Linus, however, was <a href="https://lwn.net/ml/linux-kernel/CAHk-=wg1RdFQ6OGb_H4ZJoUwEr-gk11QXeQx63n91m0tvVUdZw@mail.gmail.com/">puzzled</a> by the patch fix and did not see how it related to the predictive execution vulnerability.</p>
<p>Koschel <a href="https://lwn.net/ml/linux-kernel/86C4CE7D-6D93-456B-AA82-F8ADEACA40B7@gmail.com/">further explained</a> this, to which Linus <a href="https://lwn.net/ml/linux-kernel/CAHk-=wiyCH7xeHcmiFJ-YgXUy2Jaj7pnkdKpcovt8fYbVFW3TA@mail.gmail.com/">thought</a> it was just a common bug, but shortly afterwards Linus discovered the root of the problem: the iterator passed to the list traversal macro had to be declared outside of the loop itself.</p>
<p>Subsequently, Linus thought it might be possible to use more straightforward fixes such as <strong>block-level variable declarations</strong>. But C89 doesn&rsquo;t support it, and the C99 standard, released in 1999, does. So it may be time for the Linux kernel to move to the C99 standard.</p>
<p>Linus says that one of the reasons the kernel code has been stuck at C89 is that older versions of the compiler gcc have strange problems that break initialization routines. But now that the minimum version of GCC required by the kernel has been increased to v5.1, those bugs may no longer be relevant.</p>
<p>Arnd Bergmann, another kernel developer who follows architectural compiler issues closely, has proposed a direct upgrade to C11 or even C2x, although he is not sure if C11 will bring anything new to the kernel that will be useful. However, upgrading to C17 or C2x would break support for gcc-5/6/7, so upgrading to C11 would be easier to implement and may not be acceptable to the kernel community if the leap is too large.</p>
<p>Linus <a href="https://lwn.net/ml/linux-kernel/CAHk-=wicJ0VxEmnpb8=TJfkSDytFuf+dvQJj8kFWj0OF2FBZ9w@mail.gmail.com/">favored</a> the idea, and in Bergmann <a href="https://lwn.net/ml/linux-kernel/CAK8P3a2b_RtXkhQ2pwqbZ1zz6QtjaWwD4em_MCF_wGXRwZirKA@mail.gmail.com/">confirmed</a> that it should be possible to do so, Linus announced that the next kernel release v5.18 will try to use the C11 standard. If all goes well, the C language standard used in the next kernel release is expected to be upgraded to C11.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-02/csharp-11-news-features/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">What are the new features in C# 11?</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-02/how-to-install-ubuntu-on-raspberry-pi/">
            <span class="next-text nav-default">How to install Ubuntu on a Raspberry Pi</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
