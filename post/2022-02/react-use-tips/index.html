<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Some tips to help you in react development - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="I have been using react development for 1 year, so I can&amp;rsquo;t say I am very proficient, but in the process of using it, I did understand and summarize some tips that can speed up our subsequent development. 1. some tips in useState When we use react to develop function comppoent, we can&amp;rsquo;t help but see useState everywhere, so what are the pitfalls and things to watch out for in" /><meta name="keywords" content="React, Use Tips" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-02/react-use-tips/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Some tips to help you in react development" />
<meta property="og:description" content="I have been using react development for 1 year, so I can&rsquo;t say I am very proficient, but in the process of using it, I did understand and summarize some tips that can speed up our subsequent development. 1. some tips in useState When we use react to develop function comppoent, we can&rsquo;t help but see useState everywhere, so what are the pitfalls and things to watch out for in" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-02/react-use-tips/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-20T12:58:36+08:00" />
<meta property="article:modified_time" content="2022-02-20T12:58:36+08:00" />

<meta itemprop="name" content="Some tips to help you in react development">
<meta itemprop="description" content="I have been using react development for 1 year, so I can&rsquo;t say I am very proficient, but in the process of using it, I did understand and summarize some tips that can speed up our subsequent development. 1. some tips in useState When we use react to develop function comppoent, we can&rsquo;t help but see useState everywhere, so what are the pitfalls and things to watch out for in"><meta itemprop="datePublished" content="2022-02-20T12:58:36+08:00" />
<meta itemprop="dateModified" content="2022-02-20T12:58:36+08:00" />
<meta itemprop="wordCount" content="1655">
<meta itemprop="keywords" content="react," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Some tips to help you in react development"/>
<meta name="twitter:description" content="I have been using react development for 1 year, so I can&rsquo;t say I am very proficient, but in the process of using it, I did understand and summarize some tips that can speed up our subsequent development. 1. some tips in useState When we use react to develop function comppoent, we can&rsquo;t help but see useState everywhere, so what are the pitfalls and things to watch out for in"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Some tips to help you in react development</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-20 12:58:36 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1655 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-some-tips-in-usestate">1. some tips in useState</a>
          <ul>
            <li><a href="#11-usestate-is-asynchronous">1.1 useState is asynchronous</a></li>
            <li><a href="#12-the-state-in-settimeout-is-always-the-initial-value">1.2 The state in setTimeout is always the initial value</a></li>
          </ul>
        </li>
        <li><a href="#2-the-beauty-of-useref">2. The beauty of useRef</a>
          <ul>
            <li><a href="#21-saving-all-variable-values">2.1 Saving all variable values</a></li>
            <li><a href="#22-saving-multiple-variables-at-the-same-time">2.2 Saving multiple variables at the same time</a></li>
            <li><a href="#23-customizing-the-hook-for-useinterval">2.3 Customizing the hook for useInterval</a></li>
          </ul>
        </li>
        <li><a href="#3-the-magic-of-createportal">3. The magic of createPortal</a></li>
        <li><a href="#4-summary">4. Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>I have been using react development for 1 year, so I can&rsquo;t say I am very proficient, but in the process of using it, I did understand and summarize some tips that can speed up our subsequent development.</p>
<h2 id="1-some-tips-in-usestate">1. some tips in useState</h2>
<p>When we use react to develop function comppoent, we can&rsquo;t help but see <code>useState</code> everywhere, so what are the pitfalls and things to watch out for in useState?</p>
<h3 id="11-usestate-is-asynchronous">1.1 useState is asynchronous</h3>
<p>Some developers who have been using react for a short time often write it like this: after calling the set method to set the value of the state, they immediately go and get the value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">setData</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">func</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">setData</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;蚊子&#39;</span> <span class="p">});</span>
  <span class="nx">func</span><span class="p">();</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></td></tr></table>
</div>
</div><p>However, when using the log output, no change is found. This is because set in useState is an asynchronous operation, while the function func is called synchronously, which causes func() to be executed before set.</p>
<p>So how to solve this asynchronous problem? Here are a few ways to solve it.</p>
<h4 id="111-using-the-useeffect-helper">1.1.1 Using the useEffect helper</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 当满足条件时，执行func()
</span><span class="c1"></span>    <span class="nx">func</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">data</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="112-passing-the-required-data-directly-into-the-func-method">1.1.2 Passing the required data directly into the func method</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;蚊子&#39;</span> <span class="p">};</span>
  <span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">func</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="113-delayed-triggering">1.1.3 Delayed triggering</h4>
<p>A delayed trigger can also solve this problem, but this approach is least recommended. An asynchronous problem may create some other unknown problems if another asynchronous operation with a larger delay is used to underwrite it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">setData</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;蚊子&#39;</span> <span class="p">});</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="12-the-state-in-settimeout-is-always-the-initial-value">1.2 The state in setTimeout is always the initial value</h3>
<p>We want to delay setting some data, for example to make a counter fixed simply by +1, we might write it like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span> <span class="c1">// 注意清除定时器
</span><span class="c1"></span><span class="p">},</span> <span class="p">[]);</span>
</code></pre></td></tr></table>
</div>
</div><p>However, when we run it, we find that the counter just goes from 0 to 1 and then never increases. When we log the callback function in setInterval, we find that the callback function is still executing, but the count is not changing.</p>
<p>This is due to the second parameter <code>dependency</code> of useEffect. In our example above, the dependency is an empty array, which means that after the first initialization, the count never changes internally, so the count will always depend on the initial value at the beginning.</p>
<p>But how can we achieve continuous state manipulation in the timer? Here are a few solutions for you.</p>
<h4 id="121-adding-a-state-to-a-dependency">1.2.1 Adding a state to a dependency</h4>
<p>As we said earlier, because of the dependencies, each read is the initial value. Then we can add <code>count</code> to the dependency.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><p>This will allow the counter to keep increasing.</p>
<p>But this leads to another problem: every time the count changes, <code>clearInterval</code> is executed and then a new timer <code>setInterval</code> is restarted, and setInterval becomes setTimeout, which will be cleaned up after only one setInterval. So here it&rsquo;s actually setTimeout instead.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><p>There is also a simpler and more brutal way of not adding any dependencies, but this way, it causes all state changes to trigger a re-execution of useEffect.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>This approach, without any dependencies, is recommended for states with only one count in the component!</p>
<h4 id="122-using-useref-to-save-the-last-state">1.2.2 Using useRef to save the last state</h4>
<p>We can use the useRef feature to save the value of the state that has just changed, so that the next time we use it, we can get it directly from useRef. useRef values are not constrained by dependencies.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">countRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// 创建一个ref来保存count的值
</span><span class="c1"></span>
<span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">countRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">count</span><span class="p">;</span> <span class="c1">// count发生变化时，将其存储起来
</span><span class="c1"></span><span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">]);</span>

<span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount</span><span class="p">(</span><span class="nx">countRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 每次从countRef.current中获取到最新的值
</span><span class="c1"></span>  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="2-the-beauty-of-useref">2. The beauty of useRef</h2>
<p>We&rsquo;ve just tried out useRef for a little while. Now let&rsquo;s see how it&rsquo;s used.</p>
<h3 id="21-saving-all-variable-values">2.1 Saving all variable values</h3>
<p>useRef can hold all variable values, such as the values in the state above, as well as the timer of the timer, the id of the requestAnimationFrame, and so on. For example, in recursive operations, timer and id are different every time, so when canceling, it&rsquo;s a headache to decide which one to cancel, so we can use useRef to store them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">requestRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// 开始渲染
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">render</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>

  <span class="nx">requestRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="c1">// 取消渲染
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">cancelRender</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">cancelAnimationFrame</span><span class="p">(</span><span class="nx">requestRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-saving-multiple-variables-at-the-same-time">2.2 Saving multiple variables at the same time</h3>
<p>In the above examples, we have saved only one value and then overwritten it with another new value. But what if we want to save multiple values at the same time?</p>
<p>If it&rsquo;s just data, then just initialize the ref to an array and operate as an array.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">listRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">([]);</span>

<span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">listRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></td></tr></table>
</div>
</div><p>But we have a list of dom elements and we want to store all the dom elements?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">domListRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">([]);</span>

<span class="kr">const</span> <span class="nx">getDomList</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">dom</span><span class="o">:</span> <span class="nx">HTMLDivElement</span> <span class="o">|</span> <span class="kc">null</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">dom</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">domListRef</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">dom</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">[]);</span>

<span class="o">&lt;&gt;</span>
  <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">ename</span><span class="p">}</span> <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">getDomList</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;);</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="err">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Pay special attention here, the getDomList method should be wrapped in <code>useCallback</code>, otherwise it will cause the domListRef data to increase every time the state changes!</p>
</blockquote>
<h3 id="23-customizing-the-hook-for-useinterval">2.3 Customizing the hook for useInterval</h3>
<p>We learned about the performance of setTimeout(setInterval) and useRef in useEffect in Sections 1 and 2, and based on these two, we can implement a useTimeout or useInterval ourselves.</p>
<p>The useInterval implementation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">useInterval</span> <span class="o">=</span> <span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">saveCallback</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">();</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 每次callback发生变化时，都将最新的callback保存起来
</span><span class="c1"></span>    <span class="nx">saveCallback</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">tick</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">saveCallback</span><span class="p">.</span><span class="nx">current</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">delay</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">tick</span><span class="p">,</span> <span class="nx">delay</span><span class="p">);</span> <span class="c1">// setInterval只运行ref.current里的方法
</span><span class="c1"></span>      <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">delay</span><span class="p">]);</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>When you perform a set operation on a state in useInterval, you don&rsquo;t have to worry about whether the state will be updated or not.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nx">useInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3-the-magic-of-createportal">3. The magic of createPortal</h2>
<p>When we introduce a component and render it, it will be rendered according to the position it was introduced. However, for some public components, such as popups, toast, hover pendants, etc., we don&rsquo;t want the style of these components to be affected by the style of the parent element (e.g. <code>overflow: hidden</code>, <code>transform</code> (if the parent element has transform style, <code>position: fixed</code> will be downgraded to <code>position: absolute&quot;</code>), <code>z-index</code>, etc.), it is better if she can render to the root directory or other specified directory. What should we do at this point?</p>
<p>We&rsquo;ll use <code>createPortal</code>, the rules of this method are very simple, just 2 parameters:</p>
<ol>
<li>the component to be rendered.</li>
<li>the DOM node to be mounted.</li>
</ol>
<p>The code explains the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createPortal</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">Modal</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">createPortal</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;i-modal&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;i-modal-content&#34;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;,</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
  <span class="p">);</span>
<span class="p">};</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">Modal</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>This <code>&lt;Modal /&gt;</code> component can be referenced anywhere and then rendered to the end of document.body when rendered (similar to the appendChild operation).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Modal</span> <span class="nx">from</span> <span class="s1">&#39;./modal&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Modal</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4-summary">4. Summary</h2>
<p>In fact, there are a lot of tips and tricks in react, so if we are familiar with them, we can quickly build our applications with react.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/react/">react</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-02/try-catch-cant-error/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Exceptions and errors that cannot be caught by try-catch statements in js</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-02/nextjs-no-data/">
            <span class="next-text nav-default">nextjs how not to show data of next_data</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
