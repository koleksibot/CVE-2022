<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linux Firewall FirewallD and iptables - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="CentOS 7.0 has replaced the original firewall iptables with FirewallD, which supports IPv4, IPv6 firewall settings and Ethernet bridging, and has both runtime and permanent configuration options, and is called a dynamically managed firewall, meaning that changes can be applied without restarting the entire firewall. firewalld is installed by default, if not, execute yum install firewalld firewalld-config to install it, where firewalld-config is a GUI tool. netfilter iptables, firewalld, and" /><meta name="keywords" content="linux, Firewall, FirewallD, iptables" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/firewalld/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Linux Firewall FirewallD and iptables" />
<meta property="og:description" content="CentOS 7.0 has replaced the original firewall iptables with FirewallD, which supports IPv4, IPv6 firewall settings and Ethernet bridging, and has both runtime and permanent configuration options, and is called a dynamically managed firewall, meaning that changes can be applied without restarting the entire firewall. firewalld is installed by default, if not, execute yum install firewalld firewalld-config to install it, where firewalld-config is a GUI tool. netfilter iptables, firewalld, and" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/firewalld/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-14T11:50:38+08:00" />
<meta property="article:modified_time" content="2021-11-14T11:50:38+08:00" />

<meta itemprop="name" content="Linux Firewall FirewallD and iptables">
<meta itemprop="description" content="CentOS 7.0 has replaced the original firewall iptables with FirewallD, which supports IPv4, IPv6 firewall settings and Ethernet bridging, and has both runtime and permanent configuration options, and is called a dynamically managed firewall, meaning that changes can be applied without restarting the entire firewall. firewalld is installed by default, if not, execute yum install firewalld firewalld-config to install it, where firewalld-config is a GUI tool. netfilter iptables, firewalld, and"><meta itemprop="datePublished" content="2021-11-14T11:50:38+08:00" />
<meta itemprop="dateModified" content="2021-11-14T11:50:38+08:00" />
<meta itemprop="wordCount" content="6035">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux Firewall FirewallD and iptables"/>
<meta name="twitter:description" content="CentOS 7.0 has replaced the original firewall iptables with FirewallD, which supports IPv4, IPv6 firewall settings and Ethernet bridging, and has both runtime and permanent configuration options, and is called a dynamically managed firewall, meaning that changes can be applied without restarting the entire firewall. firewalld is installed by default, if not, execute yum install firewalld firewalld-config to install it, where firewalld-config is a GUI tool. netfilter iptables, firewalld, and"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linux Firewall FirewallD and iptables</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-14 11:50:38 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 6035 words </span>
          <span class="more-meta"> 13 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#netfilter">netfilter</a></li>
        <li><a href="#iptables">iptables</a></li>
        <li><a href="#firewalld">FirewallD</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>CentOS 7.0 has replaced the original firewall iptables with FirewallD, which supports IPv4, IPv6 firewall settings and Ethernet bridging, and has both runtime and permanent configuration options, and is called a dynamically managed firewall, meaning that changes can be applied without restarting the entire firewall. firewalld is installed by default, if not, execute yum install firewalld firewalld-config to install it, where firewalld-config is a GUI tool.</p>
<h2 id="netfilter">netfilter</h2>
<p>iptables, firewalld, and other software do not have firewall functions, but they manage and maintain rules in user space, but the rules structure and usage are different. engine introduced in the Linux 2.4 kernel. It consists of packet filtering tables that contain the set of rules used by the kernel to control packet filtering. iptables, firewalld, etc. are all convenient tools for modifying filtering table rules in user space.</p>
<p>Linux internal structure can be divided into three parts, from the bottom to the top: hardware-&gt;kernel space-&gt;user space</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/14/70f510e99ab74e5988a67d4eab92b792.png" alt=""></p>
<p>netfilter has a total of 5 control gates at locations where packets must pass through and rules can be read. The inspection rules at these five gateways are placed in five rule chains.</p>
<ul>
<li>PREROUTING packets just after they enter the network interface and before they are routed</li>
<li>INPUT packets flowing from the kernel into user space</li>
<li>FORWARD entering from one network interface and going to another in kernel space Forwarding filtering</li>
<li>OUTPUT packets flow out of user space to kernel space</li>
<li>POSTROUTING after routing, before the packet leaves the network interface</li>
</ul>
<p>Chains are actually checklists containing numerous rules, and each chain contains many rules. When a packet arrives at a chain, the system starts checking from the first rule in the chain to see if the packet satisfies the conditions defined by the rule. If it does, the system processes the packet according to the method defined by the rule; otherwise, it continues to check the next rule, and if the packet does not meet any of the rules in the chain, the system processes the packet according to the chain&rsquo;s pre-defined default policy.</p>
<p>When a packet enters the NIC, it first enters the PREROUTING chain, and the kernel determines whether it needs to be forwarded out based on the packet&rsquo;s destination IP. If the packet is the one coming into the machine, it moves down the graph to the INPUT chain. Once the packet arrives at the INPUT chain, any process will receive it. Programs running on this machine can send packets that go through the OUTPUT chain and then arrive at the POSTROUTING chain output. If the packet is to be forwarded out and the kernel allows it, the packet will move to the right as shown in the figure, go through the FORWARD chain, and then reach the POSTROUTING chain output</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/14/83b3c3f5318d45e4b8e1da8f9656db64.png" alt=""></p>
<p>As you can see, the packets just entering from the network interface have not yet made routing decisions and do not yet know where the data is going, so there is no way to implement data filtering at the import and export, so you need to set forwarding gates, entering user space gates and leaving user space gates in kernel space.</p>
<h2 id="iptables">iptables</h2>
<p>iptablses slices each of the five chains into five different tables according to purpose and usage. This means that each table can be configured with separate rules for certain chains as needed. For example, the mangle table and the filter table can both be configured with rules for INPUT chains, and when packets flow through the INPUT location (into userspace), the rules for the INPUT chains in both tables are used to do filter checks.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/14/6064ba8bf2c145a0a1af7358bbd78b56.png" alt=""></p>
<p>Five tables, each focusing on a different function</p>
<ul>
<li>filter Packet filter function. Only the INPUT, FORWARD, and OUTPUT chains are involved. It is the default table manipulated by the iptables command.</li>
<li>nat address translation function. nat translation involves only three chains PREROUTING, OUTPUT, POSTOUTING. It can be forwarded to allow LAN machines to connect to the Internet</li>
<li>mangle packet modification function. Modification operations can be done on each chain. Modify packet metadata, firewall tagging, etc.</li>
<li>raw fast channel function. For efficiency, highest priority, packets that match the raw table rules will skip some checks.</li>
<li>security Needs to be used in conjunction with selinux. The built-in rules are more complex and are usually turned off.</li>
</ul>
<p>iptables also supports custom rule chains. The custom chain must be associated with a particular chain. Rules can be set in a chain, and packets that meet certain conditions jump to a certain target chain for processing, and then return to the current chain to continue processing subsequent rules after the target chain has finished processing. Because the rules in the chain are checked sequentially from the beginning to the end, the order of the rules is very important. The stricter the rule should be the more forward.</p>
<p><strong>iptablse service management</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">service iptables start<span class="p">|</span>stop<span class="p">|</span>restart<span class="p">|</span>status
service iptables save   //定义的所有内容，在重启时都会失效。调用save命令可以把规则保存到文件/etc/sysconfig/iptables中。
iptables-save           //保存规则
iptables-restore        //加载规则。开机的时候，会自动加载/etc/sysconfig/iptables
iptables-restore &lt; /etc/sysconfig/iptables2     //加载自定义的规则文件

//iptables服务配置文件：   /etc/sysconfig/iptables-config
//iptables规则文件：       /etc/sysconfig/iptables

<span class="nb">echo</span> <span class="s2">&#34;1&#34;</span>&gt;/proc/sys/net/ipv4/ip_forward   //打开iptables转发
</code></pre></td></tr></table>
</div>
</div><p><strong>iptables Command Reference</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">iptables <span class="o">[</span>-t TABLE<span class="o">]</span> COMMAND <span class="o">[</span>CHAIN<span class="o">]</span> <span class="o">[</span>CRETIRIA<span class="o">]</span>...  <span class="o">[</span>-j  ACTION<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>The default table name is FILTER. the serial numbers (RULENUM) used in the command are based on 1.</p>
<p><strong>COMMAND command options</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-A<span class="p">|</span>--append  CHAIN                                 //链尾添加新规则
-D<span class="p">|</span>--delete  CHAIN <span class="o">[</span>RULENUM<span class="o">]</span>                       //删除链中规则，按需序号或内容确定要删除的规则
-I<span class="p">|</span>--insert  CHAIN <span class="o">[</span>RULENUM<span class="o">]</span>                       //在链中插入一条新的规则，默认插在开头
-R<span class="p">|</span>--replace CHAIN  RULENUM                        //替换、修改一条规则，按序号或内容确定
-L<span class="p">|</span>--list   <span class="o">[</span>CHAIN <span class="o">[</span>RULENUM<span class="o">]]</span>                      //列出指定链或所有链中指定规则或所有规则
-S<span class="p">|</span>--list-urles <span class="o">[</span>CHAIN <span class="o">[</span>RULENUM<span class="o">]]</span>                  //显示链中规则
-F<span class="p">|</span>--flush <span class="o">[</span>CHAIN<span class="o">]</span>                                 //清空指定链或所有链中规则
-Z<span class="p">|</span>--zero <span class="o">[</span>CHAIN <span class="o">[</span>RULENUM<span class="o">]]</span>                        //重置指定链或所有链的计数器<span class="o">(</span>匹配的数据包数和流量字节数<span class="o">)</span>
-N<span class="p">|</span>--new-chain CHAIN                               //新建自定义规则链
-X<span class="p">|</span>--delete-cahin <span class="o">[</span>CHAIN<span class="o">]</span>                          //删除指定表中用户自定义的规则链
-E<span class="p">|</span>--rename-chain OLDCHAIN NEWCHAIN                //重命名链，移动任何引用
-P<span class="p">|</span>-policy CHAIN TARGET                            //设置链的默认策略，数据包未匹配任意一条规则就按此策略处理
</code></pre></td></tr></table>
</div>
</div><p><strong>CRETIRIA Conditional Matching</strong></p>
<p>There are basic matching and extended matching, and extended matching is divided into implicit matching and display matching.</p>
<p>Basic match: (you can use ! can negate a subclause, such as -p !tcp)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-p<span class="p">|</span>--proto  PROTO                      //按协议匹配，如tcp、udp、icmp，all表示所有协议。 （/etc/protocols中的协议名）
-s<span class="p">|</span>--source ADDRESS<span class="o">[</span>/mask<span class="o">]</span>...          //按数据包的源地址匹配，可使用IP地址、网络地址、主机名、域名
-d<span class="p">|</span>--destination ADDRESS<span class="o">[</span>/mask<span class="o">]</span>...     //按目标地址匹配，可使用IP地址、网络地址、主机名、域名
-i<span class="p">|</span>--in-interface INPUTNAME<span class="o">[</span> +<span class="o">]</span>        //按入站接口<span class="o">(</span>网卡<span class="o">)</span>名匹配，+用于通配。如 eth0, eth+ 。一般用在INPUT和PREROUTING链
-o<span class="p">|</span>--out-interface OUTPUTNAME<span class="o">[</span>+<span class="o">]</span>       //按出站接口<span class="o">(</span>网卡<span class="o">)</span>名匹配，+用于通配。如 eth0, eth+ 。一般用在OUTPUT和POSTROUTING链
</code></pre></td></tr></table>
</div>
</div><p>Extended match: (e.g.: -p tcp -m tcp -dport 80)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-m<span class="p">|</span>--match MATCHTYPE  EXTENSIONMATCH...    //扩展匹配，可能加载extension
</code></pre></td></tr></table>
</div>
</div><p>Implicit Extended Matching</p>
<p>An extension to -p PROTO, or an additional match condition to -p PROTO, -m PROTO can be omitted, hence the name implicit</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-m tcp   //-p tcp的扩展
　　　　--sport  <span class="o">[</span>!<span class="o">]</span>N<span class="o">[</span>:M<span class="o">]</span>                      //源端口, 服务名、端口、端口范围。
　　　　--dport  <span class="o">[</span>!<span class="o">]</span>N<span class="o">[</span>:M<span class="o">]</span>                      //目标端口，服务名、端口、端口范围
　　　　--tcp-flags CHECKFLAGS FLAGSOFTRUE  //TCP标志位:SYN<span class="o">(</span>同步<span class="o">)</span>,ACK<span class="o">(</span>应答<span class="o">)</span>,RST<span class="o">(</span>重置<span class="o">)</span>,FIN<span class="o">(</span>结束<span class="o">)</span>,URG<span class="o">(</span>紧急<span class="o">)</span>,PSH<span class="o">(</span>强迫推送<span class="o">)</span>。多个标志位逗号分隔。
　　　　　　　　　　　　　　　　　　　　　　　　　//CHECKFLAGS为要检查的标志位，FLAGSOFTRUE为必须为1的标志位（其余的应该为0）
　　　　--syn                               //第一次握手。 等效于 --tcpflags syn,ack,fin,rst syn   四个标志中只有syn为1
-m udp   //-p udp的扩展
　　　　--sport N<span class="o">[</span>-M<span class="o">]</span> 
　　　　--dport N<span class="o">[</span>-M<span class="o">]</span>
-m icmp  //隐含条件为-p icmp
　　　　--icmp-type  N             //8:echo-request  0:echo-reply
</code></pre></td></tr></table>
</div>
</div><p>Show extended matches</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-m state
　　　　--state    //连接状态检测，NEW,ESTABLISHED,RELATED,INVALID
-m multiport 
　　　　--source-ports   PORT<span class="o">[</span>,PORT<span class="o">]</span>...<span class="p">|</span>N:M            //多个源端口，多个端口用逗号分隔，
　　　　--destination-ports PORT<span class="o">[</span>,PORT<span class="o">]</span>...<span class="p">|</span>N:M         //多个目的端口
　　　　--ports     　　　　　　　　　　　　　　　　　　　　 //多个端口，每个包的源端口和目的端口相同才会匹配
-m limit
　　　　--limit   N/UNIT    //速率，如3/minute, 1/s, n/second , n/day
　　　　--limit-burst N     //峰值速率，如100，表示最大不能超过100个数据包
-m connlimit
　　　　--connlimit-above N  //多于n个，前面加!取反
-m iprange
　　　　--src-range IP-IP
　　　　--dst-range IP-IP
-m mac                    
　　　　--mac-source         //mac地址限制，不能用在OUTPUT和POSTROUTING规则链上，因为封包要送到网卡后，才能由网卡驱动程序透过ARP 通讯协议查出目的地的MAC 地址
-m string
　　　　--algo <span class="o">[</span>bm<span class="p">|</span>kmp<span class="o">]</span>      //匹配算法
　　　　--string <span class="s2">&#34;PATTERN&#34;</span>   //匹配字符模式
-m recent
　　　　--name               //设定列表名称，默认为DEFAULT
　　　　--rsource            //源地址
　　　　--rdest              //目的地址
　　　　--set                //添加源地址的包到列表中
　　　　--update             //每次建立连接都更新列表
　　　　--rcheck             //检查地址是否在列表
　　　　--seconds            //指定时间。必须与--rcheck或--update配合使用
　　　　--hitcount           //命中次数。必须和--rcheck或--update配合使用
　　　　--remove             //在列表中删除地址
-m <span class="nb">time</span>
　　　　--timestart h:mm
　　　　--timestop  hh:mm
　　　　--days DAYS          //Mon,Tue,Wed,Thu,Fri,Sat,Sun<span class="p">;</span> 逗号分隔
-m mark
　　　　--mark N            //是否包含标记号N
-m owner 
　　　　--uid-owner <span class="m">500</span>   //用来匹配来自本机的封包，是否为某特定使用者所产生的,可以避免服务器使用root或其它身分将敏感数据传送出
　　　　--gid-owner O     //用来匹配来自本机的封包，是否为某特定使用者群组所产生的
　　　　--pid-owner <span class="m">78</span>    //用来匹配来自本机的封包，是否为某特定进程所产生的
　　　　--sid-owner <span class="m">100</span>   //用来匹配来自本机的封包，是否为某特定连接（Session ID）的响应封包
</code></pre></td></tr></table>
</div>
</div><p><strong>ACTION Target Strategy (TARGET)</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-j<span class="p">|</span>--jump TARGET                //跳转到目标规则，可能加载target extension
-g<span class="p">|</span>--goto  CHAIN                //跳转到指定链，不再返回
ACCEPT             规则验证通过，不再检查当前链的后续规则，直接跳到下一个规则链。
DROP                直接丢弃数据包，不给任何回应。中断过滤。
REJECT             拒绝数据包通过，会返回响应信息。中断过滤。
--reject-with  tcp-reset<span class="p">|</span>port-unreachable<span class="p">|</span>echo-reply
LOG                  在/var/log/messages文件中记录日志，然后将数据包传递给下一条规则。详细位置可查看/etc/syslog.conf配置文件
--log-prefix <span class="s2">&#34;INPUT packets&#34;</span>
ULOG                更广范围的日志记录信息
QUEUE              防火墙将数据包移交到用户空间，通过一个内核模块把包交给本地用户程序。中断过滤。
RETURN            防火墙停止执行当前链中的后续规则，并返回到调用链。主要用在自定义链中。
custom_chain    转向自定义规则链
DNAT                目标地址转换，改变数据包的目标地址。外网访问内网资源，主要用在PREROUTING。完成后跳到下一个规则链
--to-destination ADDRESS<span class="o">[</span>-ADDRESS<span class="o">][</span>:PORT<span class="o">[</span>-PORT<span class="o">]]</span>
SNAT                源地址转换，改变数据包的源地址。内网访问外网资源。主机的IP地址必须是静态的，主要用在POSTROUTING。完成后跳到下一个规则链。
--to-source ADDRESS<span class="o">[</span>-ADDRESS<span class="o">][</span>:PORT<span class="o">[</span>-PORT<span class="o">]]</span>
MASQUERADE   源地址伪装，用于主机IP是ISP动态分配的情况，会从网卡读取主机IP。直接跳到下一个规则链。
--to-ports 1024-31000
REDIRECT        数据包重定向，主要是端口重定向，把包分流。处理完成后继续匹配其他规则。能会用这个功能来迫使站点上的所有Web流量都通过一个Web高速缓存，比如Squid。
--to-ports <span class="m">8080</span>
MARK                 打防火墙标记。继续匹配规则。
--set-mark <span class="m">2</span>
MIRROR           发送包之前交换IP源和目的地址，将数据包返回。中断过滤。
</code></pre></td></tr></table>
</div>
</div><p>Auxiliary options.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-t<span class="p">|</span>--table TABLE     //指定操作的表，默认的表为filter
-n<span class="p">|</span>--numeric         //用数字形式显示地址和端口，显示主机IP地址而不是主机名
-x<span class="p">|</span>--exact           //计数器显示精确值，不做单位换算
-v<span class="p">|</span>--verbose  <span class="o">(</span>x3<span class="o">)</span>   //查看规则列表时，显示更详细的信息
-line-numbers        //查看规则表时，显示在链中的序号
-V<span class="p">|</span>--version 
-h<span class="p">|</span>--help   
<span class="o">[</span>option<span class="o">]</span>  --help     //查看特定选项的帮助，如iptables -p icmp --help

--fragment -f               //match second or further fragments only
--modprobe<span class="o">=</span>&lt;command&gt;        //try to insert modules using this <span class="nb">command</span>
--set-counters PKTS BYTES   //set the counter during insert/append
</code></pre></td></tr></table>
</div>
</div><p><strong>state TCP link status</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">NEW                 第一次握手，要起始一个连接（重设连接或将连接重导向） 
ESTABLISHED   数据包属于某个已经建立的连接。第二次和第三次握手   <span class="o">(</span><span class="nv">ack</span><span class="o">=</span>1<span class="o">)</span>
INVALID           数据包的连接编号（Session ID）无法辨识或编号不正确。如SYN<span class="o">=</span><span class="m">1</span> <span class="nv">ACK</span><span class="o">=</span><span class="m">1</span> <span class="nv">RST</span><span class="o">=</span><span class="m">1</span>   
RELATED          表示该封包是属于某个已经建立的连接，所建立的新连接。如有些服务使用两个相关的端口，如FTP，21和20端口一去一回，FTP数据传输<span class="o">(</span>上传/下载<span class="o">)</span>还会使用特殊的端口只允许NEW和ESTABLISHED进，只允许ESTABLISHED出可以阻止反弹式木马。
</code></pre></td></tr></table>
</div>
</div><p><strong>Examples of use:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">iptables -F           //删除iptables现有规则
iptables -L <span class="o">[</span>-v<span class="o">[</span>vv<span class="o">]</span> -n<span class="o">]</span>   //查看iptables规则
iptables -A INPUT -i eth0 -p tcp --dport <span class="m">80</span> -m state --state NEW,ESTABLISHED -j ACCEPT       //在INPUT链尾添加一条规则
iptables -I INPUT <span class="m">2</span> -i eth0 -p tcp --dport <span class="m">80</span> -m state --state NEW,ESTABLISHED -j ACCEPT     //在INPUT链中插入为第2条规则
iptables -D  INPUT <span class="m">2</span>      //删除INPUT链中第2条规则
iptables -R INPUT <span class="m">3</span> -i eth0 -p tcp --dport <span class="m">80</span> -m state --state NEW,ESTABLISHED -j ACCEPT    //替换修改第三条规则
iptables -P INPUT DROP    //设置INPUT链的默认策略为DROP

//允许远程主机进行SSH连接
iptables -A INPUT -i eth0 -p tcp --dport <span class="m">22</span> -m state --state NEW,ESTABLISHED -j ACCEPT 
iptables -A OUTPUT -o eth0 -p tcp --sport <span class="m">22</span> -m state --state ESTABLISHED -j ACCEPT 

//允许本地主机进行SSH连接
iptables -A OUTPUT -o eth0 -p tcp --dport <span class="m">22</span> -m state --state NEW,ESTABLISHED -j ACCEPT 
iptables -A INTPUT -i eth0 -p tcp --sport <span class="m">22</span> -m state --state ESTABLISHED -j ACCEPT 

//允许HTTP请求
iptables -A INPUT -i eth0 -p tcp --dport <span class="m">80</span> -m state --state NEW,ESTABLISHED -j ACCEPT 
iptables -A OUTPUT -o eth0 -p tcp --sport <span class="m">80</span> -m state --state ESTABLISHED -j ACCEPT 

//限制ping 192.168.146.3主机的数据包数，平均2/s个，最多不能超过3个
iptables -A INPUT -i eth0 -d 192.168.146.3 -p icmp --icmp-type <span class="m">8</span> -m limit --limit 2/second --limit-burst <span class="m">3</span> -j ACCEPT 

//限制SSH连接速率（默认策略是DROP）
iptables -I INPUT <span class="m">1</span> -p tcp --dport <span class="m">22</span> -d 192.168.146.3 -m state --state ESTABLISHED -j ACCEPT  
iptables -I INPUT <span class="m">2</span> -p tcp --dport <span class="m">22</span> -d 192.168.146.3 -m limit --limit 2/minute --limit-burst <span class="m">2</span> -m state --state NEW -j ACCEPT 
 
//防止syn攻击（限制syn的请求速度）
iptables -N syn-flood 
iptables -A INPUT -p tcp --syn -j syn-flood 
iptables -A syn-flood -m limit --limit 1/s --limit-burst <span class="m">4</span> -j RETURN 
iptables -A syn-flood -j DROP 

//防止syn攻击（限制单个ip的最大syn连接数）
iptables –A INPUT –i eth0 –p tcp --syn -m connlimit --connlimit-above <span class="m">15</span> -j DROP 
 
iptables -I INPUT -p tcp -dport <span class="m">22</span> -m connlimit --connlimit-above <span class="m">3</span> -j DROP   //利用recent模块抵御DOS攻击
iptables -I INPUT -p tcp --dport <span class="m">22</span> -m state --state NEW -m recent --set --name SSH   //单个IP最多连接3个会话
Iptables -I INPUT -p tcp --dport <span class="m">22</span> -m state NEW -m recent --update --seconds <span class="m">300</span> --hitcount <span class="m">3</span> --name SSH -j DROP  //只要是新的连接请求，就把它加入到SSH列表中。5分钟内你的尝试次数达到3次，就拒绝提供SSH列表中的这个IP服务。被限制5分钟后即可恢复访问。
 
iptables -I INPUT -p tcp --dport <span class="m">80</span> -m connlimit --connlimit-above <span class="m">30</span> -j DROP    //防止单个IP访问量过大
iptables –A OUTPUT –m state --state NEW –j DROP  //阻止反弹木马
iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/m -j ACCEPT   //防止ping攻击
 
//只允许自己ping别人，不允许别人ping自己
iptables -A OUTPUT -p icmp --icmp-type <span class="m">8</span> -j ACCEPT
iptables -A INPUT -p icmp --icmp-type <span class="m">0</span> -j ACCEPT

//对于127.0.0.1比较特殊，我们需要明确定义它
iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT
iptables -A OUTPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT
 
//SNAT 基于原地址转换。许多内网用户通过一个外网 口上网的情况。将我们内网的地址转换为一个外网的IP，共用外网IP访问外网资源。
iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j SNAT --to-source 172.16.100.1

//当外网地址不是固定的时候。将外网地址换成 MASQUERADE<span class="o">(</span>动态伪装<span class="o">)</span>:它可以实现自动读取外网网卡获取的IP地址。
iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j MASQUERADE

//DNAT 目标地址转换。目标地址转换要做在到达网卡之前进行转换,所以要做在PREROUTING这个位置上
iptables -t nat -A PREROUTING -d 192.168.10.18 -p tcp --dport <span class="m">80</span> -j DNAT --to-destination 172.16.100.2
</code></pre></td></tr></table>
</div>
</div><h2 id="firewalld">FirewallD</h2>
<p>FirewallD is related to iptables.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/14/910d1512e2a94090a72291be2567b4f9.png" alt=""></p>
<p>The underlying firewalld is still based on iptables, but there are still many differences.</p>
<ul>
<li>iptables stores configuration in /etc/sysconfig/iptables, while firewalld stores configuration in various XML files in /usr/lib/firewalld/ and /etc/firewalld/, where the former is the default configuration, please do not modify it. You can edit your own configuration in /etc/firewalld/, and firewalld takes precedence over the configuration in /etc/firewalld/.</li>
<li>With iptables, each individual change means clearing all old rules and reading all new rules from /etc/sysconfig/iptables, yet with firewalld no new rules are created; only the differences in the rules are run. Thus, firewalld can change settings during runtime without losing existing connections.</li>
</ul>
<p><strong>zone concept in firewalld</strong></p>
<p>RHEL7, however, seems to be implemented in the same way as iptables, but unlike mariaDB, which is compatible with MySQL commands, FirewallD cannot resolve firewall rules added by the ip*tables and ebtables command line tools</p>
<p>FirewallD is managed using the concept of zones, one for each NIC, and the configuration files for these zones can be found under /usr/lib/firewalld/zones/, with the default being public.</p>
<ul>
<li>drop Any packets flowing into the network are dropped without any response. Only outgoing network connections are allowed.</li>
<li>block (blocking) Any incoming network connection is rejected and returns an icmp-host-prohibited message for IPv4 or an icmp6-adm-prohibited message for IPv6. Only network connections initialized by this system are allowed.</li>
<li>public In the section that is used to be public. You believe that other computers on the network are untrustworthy and could harm your computer. Allow only selected connections to access.</li>
<li>external is used to enable disguised external networks such as routers. You believe that other computers on the network are untrustworthy and could harm your computer. Allow only selected connections to access.</li>
<li>dmz (quarantine zone) is used to allow computers in the quarantine zone (dmz) to have limited access to the outside network. Only selected connections are accepted.</li>
<li>work is used for working networks. You trust that most of the computers on the network will not affect your computer. Accept only selected connections.</li>
<li>home is used on home networks. You trust that most of the computers in your network will not affect your computer. Only selected connections are accepted.</li>
<li>internal is used on internal networks. You trust that most of the computers in the network will not affect your computer. Only selected connections are accepted.</li>
<li>trusted allows all network connections.</li>
</ul>
<p>Filtering rules in <strong>firewalld</strong></p>
<ul>
<li>source: Filter by source address</li>
<li>interface: Filter by NIC</li>
<li>service: filter by service name</li>
<li>port: filter by port</li>
<li>icmp-block: icmp message filtering, configured by icmp type</li>
<li>masquerade: ip address masquerade</li>
<li>forward-port: port forwarding</li>
<li>rule: custom rule</li>
</ul>
<p>The priority of the filtering rules follows the following order</p>
<ul>
<li>source</li>
<li>interface</li>
<li>conf</li>
</ul>
<p><strong>firewalld common commands</strong></p>
<p>fierwalld can be configured directly by modifying the configuration file, or through the commands of the configuration tool.</p>
<p>First check the value of DefaultZone in /etc/firewalld/firewalld.conf, the default is DefaultZone=public, at this time /etc/firewalld/zones/ directory should have a public.xml file, vi open it to modify to.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;zone&gt;</span>
    <span class="nt">&lt;short&gt;</span>Public<span class="nt">&lt;/short&gt;</span>
    <span class="nt">&lt;description&gt;</span>For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;dhcpv6-client&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;ssh&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;http&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;https&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/zone&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>This means opening ssh (22), http (80), https (443) ports in the public zone, which corresponds to each of the service types defined in the *.xml file under /usr/lib/firewalld/services/, for example, the http.xml file is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;service&gt;</span>
    <span class="nt">&lt;short&gt;</span>WWW (HTTP)<span class="nt">&lt;/short&gt;</span>
    <span class="nt">&lt;description&gt;</span>HTTP is the protocol used to serve Web pages. If you plan to make your Web server publicly available, enable this option. This option is not required for viewing pages locally or developing Web pages.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;port</span> <span class="na">protocol=</span><span class="s">&#34;tcp&#34;</span> <span class="na">port=</span><span class="s">&#34;80&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>So it can also be done directly in public.xml like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;zone&gt;</span>
    <span class="nt">&lt;short&gt;</span>Public<span class="nt">&lt;/short&gt;</span>
    <span class="nt">&lt;description&gt;</span>For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;dhcpv6-client&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;ssh&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;port</span> <span class="na">protocol=</span><span class="s">&#34;tcp&#34;</span> <span class="na">port=</span><span class="s">&#34;80&#34;</span><span class="nt">/&gt;</span> #等效的
    <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">&#34;https&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/zone&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Each time you change the configuration file or more trouble, firewalld can use firewall-config and firewall-cmd for configuration, the former is due to the GUI mode, the latter for the command line tools, some common commands are as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">systemctl start firewalld <span class="c1">#启动</span>
systemctl status firewalld <span class="c1">#或者firewall-cmd –state 查看状态</span>
sytemctl disable firewalld <span class="c1">#停止并禁用开机启动</span>
systemctl <span class="nb">enable</span> firewalld <span class="c1">#设置开机启动</span>
systemctl stop firewalld <span class="c1">#禁用</span>
firewall-cmd –version <span class="c1">#查看版本</span>
firewall-cmd –help#帮助信息
firewall-cmd –get-active-zones#查看区域信息
firewall-cmd –get-zone-of-interface<span class="o">=</span>eth0#查看指定接口所属区域
firewall-cmd –panic-on <span class="c1">#拒绝所有包</span>
firewall-cmd –panic-off#取消拒绝状态
firewall-cmd –query-panic#查看是否拒绝
firewall-cmd –reload <span class="c1">#更新防火墙规则</span>
firewall-cmd –complete-reload <span class="c1">#断开再连接</span>
firewall-cmd –zone<span class="o">=</span>public –add-interface<span class="o">=</span>eth0 <span class="c1">#将接口添加到public区域 ， 默认接口都在public。若加上–permanet则永久生效</span>
firewall-cmd –set-default-zone<span class="o">=</span>public <span class="c1">#设置public为默认接口区域</span>
firewall-cmd –zone<span class="o">=</span>pulic –list-ports <span class="c1">#查看所有打开的端口</span>
firewall-cmd –zone<span class="o">=</span>pulic –add-port<span class="o">=</span>80/tcp <span class="c1">#把tcp 80端口加入到区域</span>
firewall-cmd –zone<span class="o">=</span>public –add-service<span class="o">=</span>http <span class="c1">#把http服务加入到区域</span>
firewall-cmd –zone<span class="o">=</span>public –remove-service<span class="o">=</span>http <span class="c1">#移除http服务</span>
</code></pre></td></tr></table>
</div>
</div><p>Some common parameters of the commands are described as follows</p>
<ul>
<li>-zone=ZONE Specify the zone where the command works, if it is missing, the command works on the default zone.</li>
<li>-permanent with this parameter means that the command only modifies the configuration file and requires reload to take effect; without this parameter, it takes effect immediately in the current running instance, but it will not change the configuration file, and restarting firewalld service will have no effect.</li>
<li>-timeout=seconds indicates the duration of the command effect, which will be removed automatically after expiration, and cannot be used with -permanent at the same time. For example, if a configuration is added for debugging purposes, it will be removed automatically when the time is up, so you don&rsquo;t need to come back and remove it manually. You can also add a specific rule when an exception occurs and automatically remove it after a period of time.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/crontab/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Linux Timed Tasks Crontab</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/gitlab-ci-docker-layer-cache-for-k8s-executor/">
            <span class="next-text nav-default">Gitlab CI&#39;s Docker Cache in Kubernetes</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
