<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>XMPP - Instant Messaging Protocol - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Instant protocols can be divided into private protocols (Tencent QQ) and open protocols (GTalk) according to whether they are public or not. Private IM protocols need to be designed and built from scratch, which is extremely costly in terms of time and financial resources. While open protocols.
 It has been researched and verified by the industry for a long time, and is guaranteed in many aspects such as security, completeness and fault tolerance." /><meta name="keywords" content="Xmpp" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/xmpp/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="XMPP - Instant Messaging Protocol" />
<meta property="og:description" content="Instant protocols can be divided into private protocols (Tencent QQ) and open protocols (GTalk) according to whether they are public or not. Private IM protocols need to be designed and built from scratch, which is extremely costly in terms of time and financial resources. While open protocols.
 It has been researched and verified by the industry for a long time, and is guaranteed in many aspects such as security, completeness and fault tolerance." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/xmpp/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-09T19:05:31+08:00" />
<meta property="article:modified_time" content="2021-11-09T19:05:31+08:00" />

<meta itemprop="name" content="XMPP - Instant Messaging Protocol">
<meta itemprop="description" content="Instant protocols can be divided into private protocols (Tencent QQ) and open protocols (GTalk) according to whether they are public or not. Private IM protocols need to be designed and built from scratch, which is extremely costly in terms of time and financial resources. While open protocols.
 It has been researched and verified by the industry for a long time, and is guaranteed in many aspects such as security, completeness and fault tolerance."><meta itemprop="datePublished" content="2021-11-09T19:05:31+08:00" />
<meta itemprop="dateModified" content="2021-11-09T19:05:31+08:00" />
<meta itemprop="wordCount" content="5868">
<meta itemprop="keywords" content="xmpp," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="XMPP - Instant Messaging Protocol"/>
<meta name="twitter:description" content="Instant protocols can be divided into private protocols (Tencent QQ) and open protocols (GTalk) according to whether they are public or not. Private IM protocols need to be designed and built from scratch, which is extremely costly in terms of time and financial resources. While open protocols.
 It has been researched and verified by the industry for a long time, and is guaranteed in many aspects such as security, completeness and fault tolerance."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">XMPP - Instant Messaging Protocol</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-09 19:05:31 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 5868 words </span>
          <span class="more-meta"> 28 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#xmpp-introduction">XMPP Introduction</a></li>
        <li><a href="#xmpp-architecture">XMPP architecture</a>
          <ul>
            <li><a href="#xmpp-client">XMPP Client</a></li>
            <li><a href="#xmpp-server">XMPP server</a></li>
            <li><a href="#xmpp-gateway">XMPP Gateway</a></li>
          </ul>
        </li>
        <li><a href="#xmpps-protocols">XMPP&rsquo;s Protocols</a>
          <ul>
            <li><a href="#xml-streaming-transport-protocol">XML Streaming Transport Protocol</a></li>
            <li><a href="#xmpp-address-format">XMPP address format</a></li>
            <li><a href="#xmpp-message-format">XMPP Message Format</a></li>
            <li><a href="#components-of-the-xmpp-protocol">Components of the XMPP protocol</a></li>
          </ul>
        </li>
        <li><a href="#xmpp-server-selection">XMPP Server selection</a>
          <ul>
            <li><a href="#xmpp-server-solution">XMPP Server solution</a></li>
            <li><a href="#ejabberd">ejabberd</a></li>
            <li><a href="#openfire">OpenFire</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Instant protocols can be divided into private protocols (Tencent QQ) and open protocols (GTalk) according to whether they are public or not. Private IM protocols need to be designed and built from scratch, which is extremely costly in terms of time and financial resources. While open protocols.</p>
<ul>
<li>It has been researched and verified by the industry for a long time, and is guaranteed in many aspects such as security, completeness and fault tolerance.</li>
<li>Due to its open nature, the industry has a lot of excellent open source IM Server and IM Client, directly based on these open source components for development, you can quickly build a high-quality Chat base service in a relatively short period of time.</li>
<li>Open protocols are generally highly scalable and can be extended and modified to adapt to special application scenarios and needs.</li>
</ul>
<p>Mainstream IM protocols are.</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/XMPP">XMPP</a>(Extensible Messaging and Presence Protocol)</li>
<li><a href="http://en.wikipedia.org/wiki/SIMPLE_(instant_messaging_protocol)">SIMPLE</a>(session initiation protocol for instant messaging and presence leveraging extensions)</li>
<li><a href="http://en.wikipedia.org/wiki/Instant_Messaging_and_Presence_Protocol">IMPP</a>(Instant Messaging and Presence Protocol).</li>
</ul>
<p><strong>IMPP</strong></p>
<p>IMPP mainly defines the necessary protocols and data formats to build an instant messaging system with spatial reception and publishing capabilities. So far, this organization has published three draft RFCs, but there are two main ones: one for the site space and instant messaging model (RFC 2778); and the other for the instant messaging/space protocol requirement conditions (RFC 2779). RFC 2778 is an informative draft that defines the rationale for all PRESENCE and IM services. RFC2779 defines the minimum requirement conditions for IMPP. In addition, this draft defines some terms regarding the PRESENCE service, such as the commands to run, the format of the messages, and how the PRESENCE server notifies the client of changes in the state of the PRESENCE.</p>
<p><strong>SIMPLE</strong></p>
<p>SIMPLE plans to use SIP, a protocol developed for terminals in the IETF, to send presence messages, and SIP is generally considered to be used in establishing voice calls that, once connected, rely on a protocol such as Real Time Protocol (RTP) to actually send the voice. SIMPLE was defined as a way to establish an IM process. SIMPLE gained additional credence in the summer of 2002, and both Microsoft and IBM are currently working on implementing the protocol in their instant messaging systems. The SIMPLE team is committed to process mode operation, which will improve operational efficiency, enable SIP-based mechanisms for conferencing and three-way telephone conversation control, and also take into account the ability to achieve compatibility and improve performance with many new features offered in the future. With the process mode, SIMPLE uses SIP to create a process once and then uses SDP (Process Description Protocol) to actually transfer IM data.</p>
<p><strong>XMPP</strong></p>
<p>XMPP is an Extensible Markup Language (XML) based protocol that is used for instant messaging (IM) as well as online site probing. This protocol may eventually allow Internet users to send instant messages to anyone else on the Internet, even if their operating system and browser are different. It inherits the flexibility to evolve in an XML environment. As a result, XMPP-based applications are super scalable. XMPP can be extended to handle user needs by sending extended messages and to build applications such as content distribution systems and address-based services on top of XMPP. Moreover, XMPP includes a server-side software protocol that enables it to talk to another server, making it easier for developers to build client applications or add functionality to a patchwork system.</p>
<p>There are many more mainstream IM protocols available today, see <a href="https://en.wikipedia.org/wiki/Comparison_of_instant_messaging_protocols">Comparison of instant messaging protocols</a>, which contains many new IM protocols. In particular, some of them with recent release dates are more suitable for the current wireless scenario. Since this paper only needs to introduce XMPP, no detailed introduction will be made here.</p>
<h2 id="xmpp-introduction">XMPP Introduction</h2>
<p>XMPP was formerly known as Jabber, a network instant messaging protocol produced by an open-source organization. The Jabber Software Foundation, established in 2001, was renamed the XMPP Standards Foundation in 2007.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/0ed93c928f564a91ae3ec59e72875aba.png" alt=""></p>
<p>XMPP was originally tailored for instant messaging, but because XML Stanza itself is an XML element, the flexible development of XML-based features that make XMPP applicable to other aspects have been approved by the IETF. XMPP, together with IMPP, PRIM, and SIP, are known as the four mainstream IM protocols.</p>
<ul>
<li>Instant Messaging and Presence Protocol (IMPP)</li>
<li>Presence and Instant Messaging Protocol (PRIM)</li>
<li>Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions (SIP)</li>
<li>Extensible Message Presence Protocol (XMPP)</li>
</ul>
<p>The XMPP and SIP protocols are architectures that help implement the specifications described in the IMPP protocol. However, it is no longer used.</p>
<p>Of these four protocols, XMPP is the most flexible, and is an XML-based protocol that inherits the flexibility to evolve in an XML environment. Therefore, XMPP-based applications are super scalable. XMPP can be extended to handle user needs by sending extended messages and building applications such as content distribution systems and address-based services on top of XMPP. Moreover, XMPP includes a server-side software protocol that enables it to talk to another, making it easier for developers to build client applications or add functionality to a paired system.</p>
<p>XMPP system features</p>
<ul>
<li>XMPP protocol is open, developed by the JSF open source community organization. the XMPP protocol does not belong to any organization or individual, but belongs to the whole community, which fundamentally ensures its openness.</li>
<li>XMPP protocol has good scalability. In XMPP, instant messages and presence information are XML-based structured messages that are exchanged between communicating entities in the form of XML Stanza. XMPP acts as a common transport layer for XML structured data by embedding presence and context-sensitive information into XML structured data so that the data is delivered with great efficiency to the most appropriate resources with great efficiency. XML-based applications are built with good semantic integrity and scalability.</li>
<li>The XMPP protocol is based on a Client/Server architecture, but the XMPP protocol itself has no such limitations. The network architecture is very similar to email, but does not incorporate any specific network architecture and is very broad in scope.</li>
<li>XMPP is very resilient. XMPP can be used for instant messaging applications as well as network management, content contribution, collaboration tools, file sharing, gaming, remote system monitoring, and more.</li>
<li>XMPP uses TLS (Transport Layer Security) protocol as the encryption method for communication channels in both Client-to-Server and Server-to-Server communications to ensure secure communication. Any XMPP server can be independent of the public XMPP network (e.g., in an internal corporate network), and the use of technologies such as SASL and TLS enhances the security of communications. As shown in the figure below.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/396f000c24c64ee8a66fa4fc11ca4571.png" alt=""></p>
<p>XMPP is widely used, and there are many large-scale application cases in China and abroad. Basically, except for chat protocols privatized by commercial companies, XMPP has become the de facto standard IM protocol.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/f0dfe06e056d4d86b4da78fe4fc04f03.png" alt=""></p>
<p>XMPP-based solutions have a large number of <a href="https://xmpp.org/software/">Server-side, Client-side, and class library implementations</a> that can quickly build applications to meet business needs. XMPP&rsquo;s decentralized design has inherent scale-out scalability and also supports server-2-server XMPP&rsquo;s decentralized design is inherently scalable and supports server-2-server communication, allowing connection to other XMPP servers for cross-domain chatting of accounts. In summary, XMPP is the most complete and scalable of the above protocols, with the widest range of applications and the most component support. Therefore, Chat Service chooses XMPP as the IM protocol for Chat Service.</p>
<h2 id="xmpp-architecture">XMPP architecture</h2>
<p>The basic network architecture of XMPP consists of three elements: client, server, and gateway, as shown in the following diagram.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/585b127389b24d7d8a30fa1b08c72d1f.png" alt=""></p>
<ul>
<li>Server: undertakes client information recording, connection management and routing of messages.</li>
<li>Gateway: Takes on the interconnection of heterogeneous instant messaging systems, including (SMS, MSN, ICQ, etc.).</li>
</ul>
<p>The Jabber Identifier (JID) is the account number used by the user to log in, which usually looks like an email address, e.g. <a href="mailto:someone@example.com">someone@example.com</a>, with the first half being the user name and the second half being the XMPP server domain name, with the two fields separated by the @ symbol.</p>
<p>Suppose Lei Li (<a href="mailto:LiLei@A.com">LiLei@A.com</a>) wants to talk to Mei-Mei Han (<a href="mailto:HanMeimei@B.net">HanMeimei@B.net</a>), and both of their accounts are on the servers A.com and B.net, respectively. When Lei Li sends a message, the process is as follows.</p>
<ul>
<li>Lei Li&rsquo;s XMPP client transmits his message to the com XMPP server.</li>
<li>The com XMPP server opens a connection to the net XMPP server.</li>
<li>The net XMPP server transmits the message to Han Mei Mei, and if he is not currently online, stores the message to be sent when he comes online.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/a904c1440f914418b6fe1b6f7b03658d.png" alt=""></p>
<p>Lei Li and Mei Han&rsquo;s XMPP servers are provided by two different operators, and it is very convenient for them to communicate with each other without the need to have an account on the other server or to be a member of the other operator.</p>
<p>XMPP is a typical C/S architecture, rather than a P2P client-to-client architecture like most instant messaging software, meaning that in most cases when two clients communicate, their messages are passed through the server (there are exceptions, such as when two clients transfer files). The main reason for adopting this architecture is to simplify the client side by putting most of the work on the server side, so that the work on the client side is simpler and, when features are added, most of it is done on the server side. the framework structure of the XMPP service is shown in the figure below. three roles are defined in XMPP, XMPP client, XMPP server, and gateway. Communication can occur in both directions between any two of these three. The server takes on both client information logging, connection management, and routing of messages. The gateway takes on the interconnection with heterogeneous instant messaging systems, which can include SMS (text messaging), MSN, ICQ, etc. The basic network form is that a single client connects to a single server via TCP/IP and then transmits XML on top, working on the principle that</p>
<ul>
<li>Node connects to the server</li>
<li>The server authenticates it using a certificate in the local directory system</li>
<li>The node specifies the destination address and lets the server inform the destination status</li>
<li>Servers find, connect and authenticate each other</li>
<li>Nodes interact with each other</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/380040e64e544f5091421cbb198ad1f5.png" alt=""></p>
<h3 id="xmpp-client">XMPP Client</h3>
<p>One of the design criteria for XMPP systems is that they must support simple clients. In fact, the XMPP system architecture has only a few restrictions on clients. The features that an XMPP client must support are.</p>
<ul>
<li>communicating with the XMPP server via TCP sockets</li>
<li>Parsing organized XML message packets</li>
<li>Understanding message data types</li>
</ul>
<p>XMPP shifts the complexity from the client to the server side. XMPP clients communicate with the server via XML on port 5222 of the TCP socket, without the need for direct communication between clients.</p>
<p>The basic XMPP client must implement the following standard protocols (XEP-0211).</p>
<ul>
<li>RFC3920 Core Protocol Core</li>
<li>RFC3921 Instant Messaging and Presence ProtocolInstant Messaging and Presence</li>
<li>XEP-0030 Service Discovery Service Discovery</li>
<li>XEP-0115 Entity Capabilities</li>
</ul>
<h3 id="xmpp-server">XMPP server</h3>
<p>The XMPP server follows two main laws.</p>
<ul>
<li>Listening for client connections and communicating directly with client applications</li>
<li>Communicate with other XMPP servers</li>
</ul>
<p>XMPP open source servers are generally designed to be modular, consisting of various different code packages that handle Session management, communication between users and servers, communication between servers, DNS (Domain Name System) conversion, storage of users' personal information and friend lists, retention of information received by users when they go offline, user registration authentication of user&rsquo;s identity and authority, filtering information and system records according to user&rsquo;s request, etc. In addition, the server can be extended with additional services, such as complete security policies, allowing connection of server components or client selection, gateways to other messaging systems.</p>
<p>The basic XMPP server must implement the following standard protocols</p>
<ul>
<li>RFC3920 Core Protocol Core</li>
<li>RFC3921 Instant Messaging and Presence ProtocolInstant Messaging and Presence</li>
<li>XEP-0030 Service Discovery Service Discovery</li>
</ul>
<h3 id="xmpp-gateway">XMPP Gateway</h3>
<p>You may wonder why a gateway is needed here. In 1996, Mirabilis launched ICQ, the world&rsquo;s first instant messaging system, and in less than 10 years, IM became one of the most popular applications, with MSN, Gtalk, Yahoo Instant Messenger, AIM, Adium, Pidgin and other software springing up, but there was no unified standard between these services. XMPP is designed to achieve interoperability of the whole timely communication service protocols, making IM the third largest service on the Internet after WEB and Email.</p>
<p>The outstanding feature of XMPP is that it can exchange information and user online status with other instant messaging systems. Because of the different protocols, the exchange of information between XMPP and other systems must be achieved through protocol conversion. Several major instant messaging protocols are not publicly available at present, so the XMPP server itself does not implement conversion to other protocols, but its architecture allows the implementation of conversion. The server that implements this special feature is called a gateway in the XMPP architecture. Currently, XMPP implements protocol conversions with AIM, ICQ, IRC, MSN Massager, RSS0.9, and Yahoo Massager. Thanks to the gateway, the XMPP architecture is in fact compatible with all other instant messaging networks, which undoubtedly makes XMPP much more flexible and scalable.</p>
<h2 id="xmpps-protocols">XMPP&rsquo;s Protocols</h2>
<p>Previously, IM-related commands were sent either in binary form (e.g. QQ) or as plain text commands with spaces and parameters plus line feeds (e.g. MSN). The logic of XMPP&rsquo;s instant messaging commands is similar to that of the past, except that the protocol format has been changed to plain text in XML format. This not only makes it easier to parse, but also easier to read, facilitating development and error checking. The core part of XMPP is a stream protocol that sends XML in pieces over the network. This stream protocol is the basis for the delivery of XMPP&rsquo;s instant messaging instructions, and is a very important network infrastructure protocol that can be further exploited. So it can be said that XMPP uses TCP to pass XML streams.</p>
<p>In fact, XMPP is a data transfer protocol very similar to the http protocol, and its process is just like the &ldquo;unpacking-&gt;packing&rdquo; process, the user only needs to understand the type it accepts, and understand the type it returns, then you can make good use of xmpp for data communication.</p>
<h3 id="xml-streaming-transport-protocol">XML Streaming Transport Protocol</h3>
<p>The definition of XMPP&rsquo;s core XML Streaming Protocol allows XMPP to be on a more standardized platform than previous network communication protocols. XMPP&rsquo;s instant messaging extensions are based on the IETF&rsquo;s previous abstraction of instant messaging, and are as complete and advanced as other widely used instant messaging protocols, such as AIM and QQ. The official documentation for XMPP is RFC 392.</p>
<p>A client starts a session with an XMPP server by opening a long TCP connection and then negotiating a stream with the server. Once you and your server have established an XML stream, you and your server can exchange three special XML fragments over the stream, which are called XML stanzas. are the most meaningful basic units in XML, and once you have established an XML stream, you can send countless sections through the stream.</p>
<ul>
<li>During client-to-server communication, the server must allow the client to share a TCP connection to transfer XML stanzas, both from the client to the server and from the server to the client.</li>
<li>During server-to-server communication, the server must use one TCP connection to send XML stanzas to the other side, and another TCP connection (initialized by the other side) to accept XML stanzas from the other side, for a total of two TCP connections.</li>
</ul>
<p>An example of what a so-called XML stream looks like?</p>
<ul>
<li>Client: <code>&lt;?xml version='1.0′? &gt;&lt;stream:stream to='example_com' xmlns='jabber:client' xmlns:stream='http _etherx_jabber_org/streams' version='1.0′&gt;</code></li>
<li>Server: <code>&lt;?xml version='1.0′? &gt;&lt;stream:stream from='example_com' id='someid' xmlns='jabber:client ' xmlns:stream='http_etherx_jabber_org/streams' version='1.0′&gt;</code></li>
<li>&hellip;other communications&hellip;</li>
<li>Client: <code>&lt;message from='juliet_example_com' to='romeo_example_net' xml:lang= 'en'&gt;</code></li>
<li>Client: <code>&lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;</code></li>
<li>Client: <code>&lt;/message&gt;</code></li>
<li>Server: <code>&lt;message from='romeo_example_net' to='juliet_example_com' xml:lang= 'en'&gt;</code></li>
<li>Server: <code>&lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;</code></li>
<li>Server: <code>&lt;/message&gt;</code></li>
<li>Client: <code>&lt;/stream:stream&gt;</code></li>
<li>Server: <code>&lt;/stream:stream&gt;</code></li>
</ul>
<p>In document terms, all the XML text sent by the client or server is concatenated together, from <code>&lt;stream&gt;</code> to <code>&lt;/stream&gt;</code>, to form a complete XML document. One of the <code>stream</code> tags is the so-called <code>XML Stream</code>. The XML elements like <code>&lt;message&gt;...&lt;/message&gt;</code> in between <code>&lt;stream&gt;</code> and <code>&lt;/stream&gt;</code> are the so-called XML Stanza (XML stanza). The intermediate communication process is the client sending XML Stanzas, one after the other. The server sends XML Stanza to the client based on the information sent by the client and the logic of the program. But this process is not one question and answer, and at any time it is possible to send a message from one side to the other. The final stage of communication is <code>&lt;/stream&gt;</code> closing the stream and closing the TCP/IP connection.</p>
<h3 id="xmpp-address-format">XMPP address format</h3>
<p>Since xmpp communication is really on the network, each xmpp entity needs an address, called a JabberID (JID). A legitimate JID consists of a set of aligned elements, including a domain identifier, a node identifier, and a resource identifier. node@domain/resource is the structure most commonly used to identify an instant messaging user, the server to which the user, the server to which the user is connected, and the resource to which the user is connected. The length of each legal part of a JID cannot exceed 1023 bytes.</p>
<ul>
<li>A domain name is a primary ID and is the only required element in a JID. (A pure domain name is also a legal JID). It usually represents the gateway or &ldquo;master&rdquo; server of the network, to which other entities connect to perform xml forwarding and data management functions. However, the entity referenced by a domain name identifier is not always a server, but may also be a server subdomain address.</li>
<li>A node name is an optional second ID that is placed before the domain name and separated by the symbol &ldquo;@&rdquo;. It usually indicates an entity that requests and uses a network service from a server or gateway (such as a client), but may of course indicate other entities (such as a room in a chat room).</li>
<li>The resource name is an optional third ID that is placed after the domain name and separated by a &ldquo;/&rdquo;. The resource name can be followed or followed by node@domain. It usually indicates a specific session connection, or an object attached to an entity related to a node ID entity.</li>
</ul>
<h3 id="xmpp-message-format">XMPP Message Format</h3>
<p>Two basic concepts are defined in RFC 3920 XMPP Core, XML Stream and XML Stanza. XML Stream is a container for data exchange between two nodes, which defines the top-level XML node; XML Stanza defines the specific semantic units of entity messages, and 3 top-level messages are defined in XMPP: Message, Presence and IQ.</p>
<p><strong><code>&lt;Message&gt;</code></strong></p>
<p>Message is a basic push message method that does not require a response. It is mainly used in applications like IM, groupChat, alert and notification.</p>
<p>The main attributes are as follows.</p>
<ul>
<li>type attribute, which has 5 main types.
<ul>
<li>normal: This message type is delivered immediately or stored offline by the server and is handled by the client as a separate message outside of any chat or group chat conversation. This type is the default value. Similar to email, the main feature is that it does not require a response.</li>
<li>chat: The chat message type is usually sent as a burst message within a relatively short period of time during a &ldquo;chat session&rdquo;. The instant messaging client displays these messages in a one-to-one conversation interface. It is similar to the live chat with friends in qq, and the main feature is real-time communication.</li>
<li>groupchat: The XMPP server typically routes messages of route type groupchat to a specialized component or module that has multiple chat rooms, and this component generates an outbound message to everyone in the room. Similar to a group chat in a chat room.</li>
<li>headline: headline messages are usually not stored offline because they are temporary. In addition, XMPP servers often pass headline type messages to all online devices associated with the account (at least with a non-negative priority value). Used to send alerts and notifications.</li>
<li>error: messages of type error are sent out in response to a previously sent message to indicate that an error was sent in connection with the previous message (the recipient was not present, the message could not be sent at this time, etc.). If an error is made in sending a message, the entity that finds the error will use this category to notify the sender that an error has occurred.</li>
</ul>
</li>
<li>to attribute: identifies the recipient of the message.</li>
<li>from attribute: The name or label of the sender. To prevent address leaks, this address is usually filled in by the sender&rsquo;s server, not the sender.</li>
<li>payload: This element contains the information to be submitted to the target user. For example, body, subject, thread</li>
</ul>
<p>The message structure is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;message</span> <span class="na">from=</span><span class="s">&#34;abc@jabber.org/contact&#34;</span> <span class="na">to=</span><span class="s">&#34;def@jabber.org/contact&#34;</span> <span class="na">type=</span><span class="s">&#34;chat&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;body&gt;</span>hello<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/message&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Adding a status to a chat without knowing the person you are chatting with can lead to the misconception that the other person is offline or doesn&rsquo;t want to talk to people, which inevitably makes people lose something in their minds. For example, if you are chatting with your girlfriend and you ask, &ldquo;Honey, what did you do today?&rdquo;, your girlfriend is excited and she has a lot to tell you, but because she takes too long to type you think she doesn&rsquo;t love you &hellip;. Well, such a chat is not very sadistic &hellip;. Then, there is still a way, you need to get the chat status notice in your IM system, define the chat status notice [XEP-0085]</p>
<p>Chat status.</p>
<ul>
<li>Starting: The person started a conversation, but you are not yet involved</li>
<li>Active: you are participating in a conversation, you are not currently organizing your messages, but are following</li>
<li>Composing: person is organizing a message</li>
<li>Paused: started organizing a message, but for some reason stopped organizing it</li>
<li>Inactive: Not participating in this conversation for some time</li>
<li>Gone: participation in this conversation has ended</li>
</ul>
<p>Example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;message</span> <span class="na">from=</span><span class="s">&#34;abc@jabber.org/contact&#34;</span> <span class="na">to=</span><span class="s">&#34;def@jabber.org/contact&#34;</span> <span class="na">type=</span><span class="s">&#34;chat&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;body&gt;</span>hello<span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;starting</span> <span class="na">xmlns=</span><span class="s">&#34;http://jabber.org/protocol/chatstates&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/message&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong><code>&lt;Presence&gt;</code></strong></p>
<p>presence is used to indicate the user&rsquo;s state, e.g., online, away, dnd (do not disturb), etc. When changing its own state, a Presence element is inserted in the stream&rsquo;s context to indicate its own state. To receive a PRESENCE message, you must go through an authorization process called PRESENCE subscription.</p>
<p>Attributes.</p>
<ul>
<li>type attribute, not required. There are the following categories
<ul>
<li>subscribe: subscribe to the state of other users</li>
<li>probe: request to get the status of other users</li>
<li>unavailable: unavailable, offline (offline) state</li>
</ul>
</li>
<li>to attribute: identifies the recipient of the message.</li>
<li>from attribute: the name or marker of the sender.</li>
<li>load (payload).</li>
<li>show.
<ul>
<li>chat: in chat</li>
<li>away: temporarily away</li>
<li>xa: eXtend Away, leave for a long time</li>
<li>dnd: do not disturb</li>
</ul>
</li>
<li>status: freely formatted, readable text. Also called rich presence or extended presence, often used to indicate the user&rsquo;s current mood, activity, songs they are listening to, videos they are watching, chat rooms they are in, web pages they are visiting, games they are playing, and so on.</li>
<li>priority: range -128 to 127. high priority resource can accept messages sent to bare JID, low priority resource cannot. A resource with a negative priority cannot receive messages sent to bare JID.</li>
</ul>
<p>The message structure is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;presence</span> <span class="na">from=</span><span class="s">&#34;abc@jabber.org/contact&#34;</span> <span class="na">to=</span><span class="s">&#34;def@jabber.org/contact&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;status&gt;</span>online<span class="nt">&lt;/status&gt;</span>
<span class="nt">&lt;/presence&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong><code>&lt;IQ&gt;(Info / Query)</code></strong></p>
<p>A request/response mechanism where from one entity from sends a request, another entity accepts the request and responds. For example, the client inserts an element in the context of the stream, requests a list of its friends from the Server, and the Server returns one, containing the result of the request.</p>
<p>The main attribute is type. the entity sending the IQ section must always receive a reply (usually generated by the destination recipient or the recipient&rsquo;s server). Requests and replies are tracked by using the id attribute, which is generated by the requesting entity and is included in the responding entity.</p>
<ul>
<li>Get : Request entity information, such as a request to register an account (similar to HTTP GET).</li>
<li>Set : The requesting entity provides some information or makes a request (similar to HTTP POST or PUT).</li>
<li>Result : The responding entity returns the result of a get operation (e.g. an entity must provide information to register an account) or acknowledges a set request (similar to an HTTP 200 status code).</li>
<li>Error: The responding entity or an intermediate entity, such as an XMPP server, notifies the requesting entity that it cannot process the get or set request (e.g., because the request is not in the correct format, the requesting entity is not authorized to perform the operation, etc.). The numeric error codes used earlier in HTTP have been replaced by XML elements with extensible error conditions.</li>
</ul>
<p>The message structure is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;iq</span> <span class="na">from=</span><span class="s">&#34;abc@jabber.org/contact&#34;</span> <span class="na">id=</span><span class="s">“id11”</span> <span class="na">type=</span><span class="s">“result”</span><span class="nt">&gt;&lt;/iq&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>This brings us to one of XMPP&rsquo;s much touted drawbacks: 70% of network traffic is consumed at the XMPP protocol layer due to the use of XML. Based on this <a href="https://github.com/dakk/uazapp-im/blob/master/emesene/e3/whatsapp/api/funxmpp.py">WhatsApp</a> has improved the XMPP protocol on this basis.</p>
<h3 id="components-of-the-xmpp-protocol">Components of the XMPP protocol</h3>
<p>Major XMPP protocol templates and XMPP extensions that are widely used today.</p>
<ul>
<li>RFC 3920 XMPP: Core. Defines the network architecture of applications in the framework of the XMPP protocol, introduces XML Stream (XML stream) and XML Stanza (XML section), and specifies the XML tags used by the XMPP protocol in the communication process. The use of XML tags is fundamentally necessary for the openness and extensibility of the protocol. In addition, in terms of the security of communication, the TLS secure transport mechanism and SASL authentication mechanism are introduced into the kernel to provide a seamless connection with XMPP, laying the foundation for the security and reliability of the protocol. core document also specifies the definition and handling of errors, the specification of the use of XML, the definition of JID (Jabber Identifier), the naming conventions, and so on. So this is a document that all XMPP protocol-based applications must support.</li>
<li>RFC 3921: After a user successfully logs in to the server, he/she publishes updates to his/her online buddy management, sends live chat messages, and other services. RFC 3921 also defines blocking policies, which are defined as multiple blocking methods. It can be said that RFC3921 is a full complement to RFC3920. Combined, the two documents form a basic instant messaging protocol platform on which a wide variety of applications can be developed.</li>
<li>XEP-0030 Service Search. A powerful protocol for determining the characteristics supported by other entities in an XMPP network.</li>
<li>XEP-0115 Entity Performance. a customization of XEP-0030 through instant attendance that allows real-time changes to the alternate advertisement feature.</li>
<li>XEP-0045 Multi-Person Chat. A set of protocols defining participation and management of multi-user chat rooms, similar to Internet&rsquo;s Relay Chat, with a high level of security.</li>
<li>XEP-0096 File Transfer. Defines the transfer of files from one XMPP entity to another.</li>
<li>XEP-0124 HTTP Binding. Binds XMPP to HTTP instead of TCP and is mainly used for devices that are not able to persistently maintain a TCP connection to the server.</li>
<li>XEP-0166 Jingle. specifies the overall architecture for negotiating multimedia communications.</li>
<li>XEP-0167 Jingle Audio Content Description Format. defines the voice transport process from one XMPP entity to another.</li>
<li>XEP-0176 Jingle ICE (Interactive Connectivity Establishment) Transport. ICE transport mechanism, the document solves the problem of how to allow entities protected by firewalls or NAT (Network Address Translation) to establish connections. XEP-0177 Jingle ICE (Interactive Connectivity Establishment) Transport.</li>
<li>XEP-0177 Jingle Raw UDP Transport. pure UDP transport mechanism, which describes how to establish connections without firewalls and on the same network.</li>
<li>XEP-0180 Jingle Video Content Description Format. defines the process of transferring video from one XMPP entity to another.</li>
<li>XEP-0181 Jingle DTMF (Dual Tone Multi-Frequency).</li>
<li>XEP-0183 Jingle Telepathy Transport Method.</li>
</ul>
<h2 id="xmpp-server-selection">XMPP Server selection</h2>
<h3 id="xmpp-server-solution">XMPP Server solution</h3>
<p>XMPP Server has numerous implementation options.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/5a89076f5dc842559eb9570ac9cda3ab.png" alt=""></p>
<p>Among them, the more mature and widely used are ejabberd, jabberd 2.x, Openfire, Tigase.</p>
<ul>
<li><strong>Jabberd 2.x</strong> was implemented in C. However, there were problems with database transaction abuse, memory leaks, inconsistent non-blocking design, and most importantly, the server had not been maintained for a long time; therefore, chesspark switched to ejabberd after three years of using jabberd 2.x. Not coincidentally, org also switched to ejabberd in In 2010, org also phased out Jabberd and switched to using
<strong>Openfire</strong> and Tigase are both JAVA-based solutions. But Openfire single-computer concurrency is very limited, the cluster solution is immature, the code is old and lack of timely updates, so it is not suitable for use in production environments. Tigase, however, is a complex cluster solution with limited single-node capacity.</li>
</ul>
<p>From the programming language point of view, the mainstream XMPP Server is mainly JAVA and Erlang. JAVA has the advantage of a complete class library and easy recruitment. Relatively elegant clustering scheme and higher concurrency performance. In the absence of language bias, ejabberd is generally used in the early stages of development, e.g. <a href="http://www.zhihu.com/question/19788134">MiChat</a>.</p>
<p>From various <a href="http://en.wikipedia.org/wiki/Comparison_of_XMPP_server_software">features supported by XMPP Server</a>, ejabberd is the server with the best support and most comprehensive implementation of the XMPP protocol.</p>
<p>From the open source protocol, Tigase uses the AGPL open source protocol, so as long as there are code modifications, the code must be open source. Openfire uses the Apache open source protocol, and the code can be closed source after modification. ejabberd uses the GPL v2 open source protocol, so if the service is only provided on the server side without secondary distribution of the code, the code can also be &ldquo;closed source&rdquo; after modification. closed source&quot;.</p>
<p>Taking all these factors into account, Chat Service uses ejabberd as the initial XMPP Server.</p>
<h3 id="ejabberd">ejabberd</h3>
<ul>
<li>ejabberd is a free and open source instant messaging server written in the <a href="http://www.erlang.org/">Erlang/OTP</a> language</li>
<li>ejabberd is cross-platform, distributed, fault-tolerant, and based on open standards for real-time communication systems</li>
<li>ejabberd is designed to be rock-solid and is a feature-rich XMPP server</li>
<li>ejabberd is suitable for both small and very large deployments, regardless of whether they require scalability</li>
</ul>
<p>Key Features.</p>
<ul>
<li>Cross-platform: ejabberd can run on Microsoft Windows and Unix-derived systems such as Linux, FreeBSD and</li>
<li>Distributed: You can run ejabberd on a cluster of machines, all serving the same or a number of Jabbe domains. When you need more capacity, you can simply add an inexpensive node to your cluster. So, you don&rsquo;t need to buy an expensive high-end machine to support tens of thousands of concurrent users.</li>
<li>Fault tolerance: You can deploy an ejabberd cluster so that all the necessary information for a functioning service will be replicated to all nodes. This means that if one of the nodes crashes, the others will continue to run without interruption. Alternatively, nodes can be added or replaced &lsquo;without downtime&rsquo;.</li>
<li>Easy to manage: ejabberd is built on open source so you don&rsquo;t need to install an external service database, an external web server, and so on because everything is already included and available out of the box. Other administrative benefits include:
<ul>
<li>Extensive documentation</li>
<li>Easy installer for Linux, Mac OS X, and Windows systems</li>
<li>Web management</li>
<li>Shared roster groups</li>
<li>Command line management tools</li>
<li>Externally-integratable authentication mechanism</li>
<li>Ability to send anonymous messages</li>
</ul>
</li>
<li>Internationalization: ejabberd leads internationalization. Ideal for globalization. Related features include:
<ul>
<li>Translation into 25 languages</li>
<li>Support for <a href="http://www.ietf.org/rfc/rfc3490.txt">IDNA</a></li>
</ul>
</li>
<li>Open standards: ejabberd is an open source Jabber server that fully supports XMPP standards.
<ul>
<li>Fully compatible</li>
<li>XML-based protocols</li>
<li>Many supported protocols</li>
</ul>
</li>
</ul>
<p>Additional features.</p>
<ul>
<li>
<p>Modularity</p>
<ul>
<li>Fit in only the modules you want</li>
<li>Extend in your own custom modules</li>
</ul>
</li>
<li>
<p>Security</p>
<ul>
<li>SASL support for c2s and s2s connections</li>
<li>STARTTLS support for s2s connections</li>
<li>Web management with secure access via HTTPS</li>
</ul>
</li>
<li>
<p>Database</p>
<ul>
<li>Rapidly deployable internal database (Mnesia)</li>
<li>Native MySQL support</li>
<li>Native PostgreSQL support</li>
<li>ODBC data storage support</li>
<li>Support for Microsoft SQL Server</li>
</ul>
</li>
<li>
<p>Validation</p>
<ul>
<li>Internal validation</li>
<li>PAM, LDAP</li>
<li>External validation scripts</li>
</ul>
</li>
<li>
<p>Other</p>
<ul>
<li>Virtual hosting support</li>
<li>XML stream compression (<a href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>)</li>
<li>Statistics (<a href="http://xmpp.org/extensions/xep-0039.html">XEP-0039</a>)</li>
<li>Support for IPv6 c2s and s2s connections</li>
<li>Multi-user chat module with support for clustering and HTML logging</li>
<li>User directory based on user vCards</li>
<li><a href="http://xmpp.org/extensions/xep-0060.html">Publish-Subscribe</a> component with support for <a href="http://xmpp.org/extensions/xep-0163.html">PubSub-based personal events</a></li>
<li>Support for web client: <a href="http://xmpp.org/extensions/xep-0025.html">HTTP Polling</a> and <a href="http://xmpp.org/extensions/xep-0206.html">HTTP Binding (BOSH)</a> services</li>
<li>IRC Gateway</li>
<li>Component support: interfaces with external networks after installing specific gateways, such as AIM, ICQ and</li>
</ul>
<h3 id="openfire">OpenFire</h3>
</li>
</ul>
<p>To understand Openfire, we must first understand the XMPP protocol, because Openfire is written in Java, based on the XMPP protocol, open source real-time collaboration server. openfire has cross-platform capabilities, Openfire and the client is using the C/S architecture, a server is responsible for providing services to clients connected to it. Openfire clients are spark, pidgin, Miranda IM, iChat, etc. If users develop their own clients, they can use the open source Client-side API-Smack, which follows the GPL. If developers need to add new services, they can develop their own plug-ins and install them to the server to provide services, such as finding contacts service is provided in the form of plug-ins.</p>
<p>OpenFire is developed in Java based on the XMPP (Jabber) protocol , open source real-time collaboration (RTC) server . smack is written in Java XMPP client code base , is the core of spark , open source community always has a lot of interesting things , these three together is a complete XMPP IM implementation .</p>
<ul>
<li>OpenFire &ndash; server-side</li>
<li>Spark - the client side</li>
<li>Smack - an implementation of the XMPP transport protocol</li>
</ul>
<p>All three are based on the Java language implementation, where XMPP is a protocol, the protocol is required to implement, Smack plays such a role.</p>
<p>OpenFire is a server-side implementation of IM based on the XMPP protocol. Although when two users are connected, they can send messages in a peer-to-peer manner, the user still needs to connect to the server to get some connection information and communication information, so the server side is a must.</p>
<p>Spark provides a basic implementation on the client side and proposes a good plug-in architecture, which can&rsquo;t be a boon for developers. I highly recommend implementing your newly added functionality based on the plug-in approach, rather than changing its source code, which will benefit your project architecture and minimize the impact of the original project.</p>
<p>Smack is a Java implementation of the XMPP protocol that provides a set of extensible APIs, but there are times when you have to use your own custom XML file content sent to implement your own functionality</p>
<p>The relationship between the three.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/09/40024532f9d3425e93ea5c935d729ec6.png" alt=""></p>
<p>From the above diagram, we can see that both Client side and Server side can be extended by way of plug-ins, and Smack is the medium for both to pass data.</p>
<p><strong>Openfire Server Capacity</strong></p>
<p>A single Openfire server should have no problem supporting more than 3K capacity, but more needs to be tested. The open source version does not support Clustering, but we can use Openfire + Connection Manager to expand the server capacity. Some users have tested that an Openfire server with 8G memory can support up to 300,000 users if the Connection Manager is configured. We can calculate the approximate capacity of Openfire + Connection Manager server. Assuming one Connection Manager and Openfire each occupy 20 connections, each Openfire server can support 5000 connections and each Connection Manager can support 3000 connections, if we configure 4 Connection Managers, then we can calculate If we configure 4 Connection Managers, we can calculate the capacity of Openfire server: 1<em>5000-4</em>20+4<em>3000-4</em>20 = 16840. We did a test, running Openfire 3.7.0 on a virtual machine, we can login 2W users at the same time, after adding Clustering, only 1W6.</p>
<p>Reference links.</p>
<ul>
<li><a href="https://xmpp.org/about/technology-overview/">An Overview of XMPP</a></li>
<li><a href="https://github.com/ortuman/jackal">jackal: An XMPP server written in Go.</a></li>
<li><a href="https://github.com/tinode/chat">https://github.com/tinode/chat</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/xmpp/">xmpp</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/windows-intellij-idea-maven/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Windows &#43; IntelliJ IDEA &#43; Maven environment configuration</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/mongodb-windows/">
            <span class="next-text nav-default">MongoDB Installation and Use in Windows</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
