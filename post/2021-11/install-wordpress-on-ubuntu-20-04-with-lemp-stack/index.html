<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Ubuntu Server 20.04 WordPress environment installation and configuration - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="The blog was previously deployed on Ali cloud and was about to expire, so I migrated the server to Tencent cloud for the Double 11 event. At the same time, we intend to change the operating system for deployment, and replace the original CentOS 7.4 with Ubuntu 20.04 LTS. The rest of the environment is basically the same, still using Nginx &#43; MariaDB &#43; phpMyAdmin &#43; Let&amp;rsquo;s Encrypt as before," /><meta name="keywords" content="Wordpress, Ubuntu" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/install-wordpress-on-ubuntu-20-04-with-lemp-stack/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Ubuntu Server 20.04 WordPress environment installation and configuration" />
<meta property="og:description" content="The blog was previously deployed on Ali cloud and was about to expire, so I migrated the server to Tencent cloud for the Double 11 event. At the same time, we intend to change the operating system for deployment, and replace the original CentOS 7.4 with Ubuntu 20.04 LTS. The rest of the environment is basically the same, still using Nginx &#43; MariaDB &#43; phpMyAdmin &#43; Let&rsquo;s Encrypt as before," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/install-wordpress-on-ubuntu-20-04-with-lemp-stack/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-02T22:28:03+08:00" />
<meta property="article:modified_time" content="2021-11-02T22:28:03+08:00" />

<meta itemprop="name" content="Ubuntu Server 20.04 WordPress environment installation and configuration">
<meta itemprop="description" content="The blog was previously deployed on Ali cloud and was about to expire, so I migrated the server to Tencent cloud for the Double 11 event. At the same time, we intend to change the operating system for deployment, and replace the original CentOS 7.4 with Ubuntu 20.04 LTS. The rest of the environment is basically the same, still using Nginx &#43; MariaDB &#43; phpMyAdmin &#43; Let&rsquo;s Encrypt as before,"><meta itemprop="datePublished" content="2021-11-02T22:28:03+08:00" />
<meta itemprop="dateModified" content="2021-11-02T22:28:03+08:00" />
<meta itemprop="wordCount" content="1809">
<meta itemprop="keywords" content="wordpress,ubuntu," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ubuntu Server 20.04 WordPress environment installation and configuration"/>
<meta name="twitter:description" content="The blog was previously deployed on Ali cloud and was about to expire, so I migrated the server to Tencent cloud for the Double 11 event. At the same time, we intend to change the operating system for deployment, and replace the original CentOS 7.4 with Ubuntu 20.04 LTS. The rest of the environment is basically the same, still using Nginx &#43; MariaDB &#43; phpMyAdmin &#43; Let&rsquo;s Encrypt as before,"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Ubuntu Server 20.04 WordPress environment installation and configuration</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-02 22:28:03 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1809 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#pre-installation-equipment">Pre-installation equipment</a></li>
        <li><a href="#install-nginx">Install Nginx</a></li>
        <li><a href="#install-php-74">Install PHP 7.4</a></li>
        <li><a href="#install-mariadb">Install MariaDB</a></li>
        <li><a href="#installing-phpmyadmin">Installing phpMyAdmin</a></li>
        <li><a href="#deploy-wordpress">Deploy Wordpress</a></li>
        <li><a href="#install-lets-encrypt">Install Let&rsquo;s Encrypt</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>The blog was previously deployed on Ali cloud and was about to expire, so I migrated the server to Tencent cloud for the Double 11 event. At the same time, we intend to change the operating system for deployment, and replace the original CentOS 7.4 with Ubuntu 20.04 LTS.</p>
<p>The rest of the environment is basically the same, still using Nginx + MariaDB + phpMyAdmin + Let&rsquo;s Encrypt as before, but since CentOS and Ubuntu use different package management tools, there are some differences in the installation. There are still some differences in the installation.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/02/ab6cc67b0752482798d4fbffd20cde82.png" alt=""></p>
<h2 id="pre-installation-equipment">Pre-installation equipment</h2>
<p>1、Check and confirm the system version</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo lsb_release -a
</code></pre></td></tr></table>
</div>
</div><p>2、Modify the software source</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup
sudo nano /etc/apt/sources.list
</code></pre></td></tr></table>
</div>
</div><p>Tencent Cloud has already helped to modify the software source, so there is no need to make changes here.</p>
<p>3、Update the system</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt update
sudo apt upgrade
</code></pre></td></tr></table>
</div>
</div><h2 id="install-nginx">Install Nginx</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">sudo</span> <span class="s">apt</span> <span class="s">install</span> <span class="s">nginx</span>

<span class="c1"># 查看服务是否已经启动
</span><span class="c1"></span><span class="s">systemctl</span> <span class="s">status</span> <span class="s">nginx</span>
<span class="c1"># 添加开机启动
</span><span class="c1"></span><span class="s">sudo</span> <span class="s">systemctl</span> <span class="s">enable</span> <span class="s">nginx</span>

<span class="s">sudo</span> <span class="s">systemctl</span> <span class="s">stop</span> <span class="s">nginx</span>
<span class="s">sudo</span> <span class="s">systemctl</span> <span class="s">start</span> <span class="s">nginx</span>
<span class="s">sudo</span> <span class="s">systemctl</span> <span class="s">restart</span> <span class="s">nginx</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Open firewall</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 打开OpenSSH的端口</span>
sudo ufw allow OpenSSH
<span class="c1"># 打开 Nginx的端口</span>
sudo ufw allow <span class="s1">&#39;Nginx Full&#39;</span>
<span class="c1"># 开启防火墙</span>
sudo ufw <span class="nb">enable</span>
<span class="c1"># 查看ufw状态</span>
sudo ufw status
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">ubuntu@VM-0-7-ubuntu:~$ sudo ufw <span class="nb">enable</span>
Command may disrupt existing ssh connections. Proceed with operation <span class="o">(</span>y<span class="p">|</span>n<span class="o">)</span>? y
Firewall is active and enabled on system startup
ubuntu@VM-0-7-ubuntu:~$ sudo ufw status
Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere                  
Nginx Full                 ALLOW       Anywhere                  
OpenSSH <span class="o">(</span>v6<span class="o">)</span>               ALLOW       Anywhere <span class="o">(</span>v6<span class="o">)</span>             
Nginx Full <span class="o">(</span>v6<span class="o">)</span>            ALLOW       Anywhere <span class="o">(</span>v6<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="install-php-74">Install PHP 7.4</h2>
<p>Determine the PHP version in the software source.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">apt search --names-only ^php
</code></pre></td></tr></table>
</div>
</div><p>As you can see the current version is PHP 7.4, if you want to install the latest 7.4 in Ubuntu 18.04 you need to install the additional source.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Install PHP 7.4 on Ubuntu 18.04</span>
sudo apt-get update
sudo apt -y install software-properties-common
sudo add-apt-repository ppa:ondrej/php
sudo apt-get update
</code></pre></td></tr></table>
</div>
</div><p>Install PHP programs and common modules/extensions</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt install php7.4
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">ubuntu@VM-0-7-ubuntu:~$ sudo apt install php7.4
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  apache2 apache2-bin apache2-data apache2-utils libapache2-mod-php7.4 libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libjansson4 liblua5.2-0 php-common php7.4-cli php7.4-common php7.4-json php7.4-opcache
  php7.4-readline ssl-cert
Suggested packages:
  apache2-doc apache2-suexec-pristine <span class="p">|</span> apache2-suexec-custom www-browser php-pear openssl-blacklist
The following NEW packages will be installed:
  apache2 apache2-bin apache2-data apache2-utils libapache2-mod-php7.4 libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libjansson4 liblua5.2-0 php-common php7.4 php7.4-cli php7.4-common php7.4-json php7.4-opcache
  php7.4-readline ssl-cert
<span class="m">0</span> upgraded, <span class="m">19</span> newly installed, <span class="m">0</span> to remove and <span class="m">0</span> not upgraded.
Need to get 5,881 kB of archives.
After this operation, 26.0 MB of additional disk space will be used.
Do you want to <span class="k">continue</span>? <span class="o">[</span>Y/n<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Here you can see that in addition to the installation of PHP will also install some other module components, here also installed apache, because the server uses Nginx, so do not need Apache.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 禁用Apache</span>
sudo systemctl disable --now apache2
</code></pre></td></tr></table>
</div>
</div><p><strong>Installation of PHP components and modules</strong></p>
<p>Install the components as follows</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt install php7.4-extension_name
</code></pre></td></tr></table>
</div>
</div><p>Commonly used components are organized here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt install php7.4-fpm php7.4-cli php7.4-common php7.4-json php7.4-opcache php7.4-readline php7.4-dev php7.4-mysql php7.4-sqlite3 php7.4-xml php7.4-xmlrpc php7.4-curl php7.4-gd php7.4-imagick php7.4-imap php7.4-soap php7.4-mbstring php7.4-zip php7.4-ssh2 php7.4-intl php7.4-zip
</code></pre></td></tr></table>
</div>
</div><p><strong>Modify PHP configuration file</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo nano /etc/php/7.4/fpm/php.ini
</code></pre></td></tr></table>
</div>
</div><p>The main modification of the security risk will improve performance.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">cgi.fix_pathinfo=0
upload_max_filesize = 32M 
post_max_size = 48M 
memory_limit = 256M 
max_execution_time = 600 
max_input_vars = 3000 
max_input_time = 1000
</code></pre></td></tr></table>
</div>
</div><p>Restart php-fpm after the changes are made and let the configuration take effect:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo systemctl restart php7.4-fpm
</code></pre></td></tr></table>
</div>
</div><p><strong>Modify Nginx configuration to test if PHP is installed successfully</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo nano /etc/nginx/sites-available/default
</code></pre></td></tr></table>
</div>
</div><p>Remove the comments under the following lines of code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="c1"># pass PHP scripts to FastCGI server
</span><span class="c1">#
</span><span class="c1"></span><span class="k">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
        <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
<span class="c1">#
</span><span class="c1">#       # With php-fpm (or other unix sockets):
</span><span class="c1"></span>        <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php/php7.4-fpm.sock</span><span class="p">;</span>
<span class="c1">#       # With php-cgi (or other tcp sockets):
</span><span class="c1">#       fastcgi_pass 127.0.0.1:9000;
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Reload the Nginx configuration file to allow the configuration to take effect:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">sudo</span> <span class="s">nginx</span> <span class="s">-t</span>
<span class="s">sudo</span> <span class="s">systemctl</span> <span class="s">reload</span> <span class="s">nginx</span>
</code></pre></td></tr></table>
</div>
</div><p>Create the PHP file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">sudo</span> <span class="nx">nano</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span><span class="nx">info</span><span class="o">.</span><span class="nx">php</span>
</code></pre></td></tr></table>
</div>
</div><p>file content.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nx">phpinfo</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p>Save the file and open: http://your_server_ip/info.php to see if the PHP information page can be opened normally.</p>
<p>Note: It is recommended to delete the info.php file after viewing, otherwise there may be security risks.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo rm /var/www/html/info.php
</code></pre></td></tr></table>
</div>
</div><h2 id="install-mariadb">Install MariaDB</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt install mariadb-server mariadb-client
sudo systemctl status mariadb
sudo systemctl stop mariadb
sudo systemctl start mariadb
sudo systemctl <span class="nb">enable</span> mariadb
<span class="c1"># 初始化设置：</span>
sudo mysql_secure_installation
</code></pre></td></tr></table>
</div>
</div><h2 id="installing-phpmyadmin">Installing phpMyAdmin</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt install phpmyadmin
</code></pre></td></tr></table>
</div>
</div><p>The installer will ask you to select the web server that should be automatically configured to run phpMyAdmin. There is no option to select Nginx, press ESC here to exit.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/02/7009ce08e2a0484aa738eaeedc4e83e5.png" alt=""></p>
<p>Next, the installer will ask if you want to use the dbconfig-common tool to set up the database. Select Yes, then press Enter.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/02/807c69e9e8174f96bc2903a84de830de.png" alt=""></p>
<p>Enter the phpMyAdmin password to register in the database, select OK, and press Enter.</p>
<p><strong>Configuring Nginx</strong></p>
<p>Make the phpMyAdmin program files accessible to Nginx: /usr/share/phpmyadmin,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo ln -s  /usr/share/phpmyadmin /var/www/html/phpmyadmin
sudo chmod <span class="m">775</span> -R /usr/share/phpmyadmin/
sudo chown root:www-data -R /usr/share/phpmyadmin/
</code></pre></td></tr></table>
</div>
</div><p>Modify the /etc/nginx/sites-available/default file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo nano /etc/nginx/sites-available/default
</code></pre></td></tr></table>
</div>
</div><p>Add index.php to the default file</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/02/10b94f262c3a4ff58ef908279c9f726e.png" alt=""></p>
<p>Then restart sudo systemctl restart nginx. You can access it via <code>http://your_server_ip/phpmyadmin/</code> after it finishes.</p>
<p>The login account is phpmyadmin and the password is the one you just set. After logging in aggressively, you find that you do not have permission to create new tables, etc.</p>
<p>After logging out and changing the root account to log in, I found that I could not log in because by default the root account uses the auth_socket plugin for authentication.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo mysql -u root
</code></pre></td></tr></table>
</div>
</div><p>Solution 1: Change the login of root account</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span><span class="w"> </span><span class="k">user</span><span class="p">,</span><span class="n">plugin</span><span class="p">,</span><span class="k">host</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mysql</span><span class="p">.</span><span class="k">user</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;******&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">EXIT</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Solution 2: Add an administrator account:.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;dbadmin&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">EXIT</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Just log in to phpmyadmin with the root account or a new administrator account when you are done.</p>
<p><strong>phpMyAdmin Security Settings</strong></p>
<p>Installing phpMyAdmin directly on the server may have some security risks. The solution is to mask the directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> /var/www/html/
sudo mv phpmyadmin nothingtosee
</code></pre></td></tr></table>
</div>
</div><p>The directory name here can be set by yourself. The purpose is to prevent others from guessing the phpMyAdmin path for attacks.</p>
<p>Add Nginx authentication to hide the phpMyAdmin login screen.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 生成密码加密后值</span>
openssl passwd nginx_password
<span class="c1"># 输出值</span>
tpr9W.ydSHL7M

<span class="c1"># 创建密码文件</span>
sudo nano /etc/nginx/pma_pass

<span class="c1"># 密码文件内容：</span>
sammy:tpr9W.ydSHL7M
</code></pre></td></tr></table>
</div>
</div><p>The colon is preceded by the username for the next login, followed by the encrypted password you just generated.</p>
<p>Modify the Nginx configuration unseen by adding the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
    <span class="kn">.</span> <span class="s">.</span> <span class="s">.</span>
        <span class="s">location</span> <span class="s">/nothingtosee</span> <span class="p">{</span>
                <span class="kn">auth_basic</span> <span class="s">&#34;Admin</span> <span class="s">Login&#34;</span><span class="p">;</span>
                <span class="kn">auth_basic_user_file</span> <span class="s">/etc/nginx/pma_pass</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="kn">.</span> <span class="s">.</span> <span class="s">.</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo nginx -t
sudo systemctl reload nginx
</code></pre></td></tr></table>
</div>
</div><p>The modified address is: <code>https://server_domain_or_IP/nothingtosee</code> and requires Nginx authentication before entering.</p>
<h2 id="deploy-wordpress">Deploy Wordpress</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 安装上传下载工具</span>
sudo apt install lrzsz
<span class="c1"># 上传打包网站文件后修改目录权限</span>

sudo chown -R www-data:www-data /srv/www/www.biaodianfu.com/
sudo chmod -R <span class="m">755</span> /srv/www/www.biaodianfu.com/
sudo find /srv/www/www.biaodianfu.com/ -type d -exec chmod <span class="m">755</span> <span class="o">{}</span> <span class="se">\;</span>

<span class="c1"># 配置文件</span>
sudo nano /etc/nginx/sites-enabled/www.biaodianfu.com
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>

    <span class="kn">server_name</span>  <span class="s">biaodianfu.com</span> <span class="s">www.biaodianfu.com</span><span class="p">;</span>
    <span class="kn">root</span>   <span class="s">/srv/www/www.biaodianfu.com/</span><span class="p">;</span>
    <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>
    <span class="kn">charset</span> <span class="s">utf-8</span><span class="p">;</span>

    <span class="kn">add_header</span> <span class="s">X-Frame-Options</span> <span class="s">DENY</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">X-Content-Type-Options</span> <span class="s">nosniff</span><span class="p">;</span>

    <span class="c1"># include snippets/well-known;
</span><span class="c1"></span>
    <span class="kn">access_log</span> <span class="s">/var/log/nginx/www.biaodianfu.com.access.log</span><span class="p">;</span>
    <span class="kn">error_log</span> <span class="s">/var/log/nginx/www.biaodianfu.com.error.log</span><span class="p">;</span>

    <span class="kn">client_max_body_size</span> <span class="s">100M</span><span class="p">;</span>

    <span class="kn">autoindex</span> <span class="no">off</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.php?</span><span class="nv">$args</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span> <span class="sr">.php$</span> <span class="p">{</span>
         <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
         <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php/php7.4-fpm.sock</span><span class="p">;</span>
         <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
         <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
         <span class="kn">fastcgi_read_timeout</span> <span class="s">300s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
        <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="install-lets-encrypt">Install Let&rsquo;s Encrypt</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt install certbot

sudo mkdir -p /var/lib/letsencrypt/.well-known
sudo chgrp www-data /var/lib/letsencrypt
sudo chmod g+s /var/lib/letsencrypt
sudo nano /etc/nginx/snippets/well-known
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">location ^~ /.well-known/acme-challenge/ <span class="o">{</span>
    allow all<span class="p">;</span>
    root /var/lib/letsencrypt/<span class="p">;</span>
    default_type <span class="s2">&#34;text/plain&#34;</span><span class="p">;</span>
    try_files <span class="nv">$uri</span> <span class="o">=</span>404<span class="p">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Apply for a certificate</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo certbot certonly --agree-tos --email username@email.com --webroot -w /var/lib/letsencrypt/ -d www.biaodianfu.com
sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem <span class="m">2048</span>
</code></pre></td></tr></table>
</div>
</div><p>Adjusting the Nginx configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">server <span class="o">{</span>
    listen 80<span class="p">;</span>
    listen <span class="o">[</span>::<span class="o">]</span>:80<span class="p">;</span>

    server_name  biaodianfu.com www.biaodianfu.com<span class="p">;</span>
    include snippets/well-known<span class="p">;</span>
    <span class="k">return</span> <span class="m">301</span> https://<span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="o">}</span>

server <span class="o">{</span>
    listen <span class="m">443</span> ssl http2<span class="p">;</span>
    listen <span class="o">[</span>::<span class="o">]</span>:443 ssl http2<span class="p">;</span>

    server_name  biaodianfu.com www.biaodianfu.com<span class="p">;</span>
    root   /srv/www/www.biaodianfu.com/<span class="p">;</span>
    index index.html index.htm index.php<span class="p">;</span>
    charset utf-8<span class="p">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="nv">$host</span> !<span class="o">=</span> <span class="s2">&#34;www.biaodianfu.com&#34;</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="m">301</span> https://www.biaodianfu.com<span class="nv">$request_uri</span><span class="p">;</span>
       <span class="o">}</span>

    add_header X-Frame-Options DENY<span class="p">;</span>
    add_header X-Content-Type-Options nosniff<span class="p">;</span>

    include snippets/well-known<span class="p">;</span>
    ssl_certificate /etc/letsencrypt/live/www.biaodianfu.com/fullchain.pem<span class="p">;</span>
    ssl_certificate_key /etc/letsencrypt/live/www.biaodianfu.com/privkey.pem<span class="p">;</span>

    ssl_session_timeout 1d<span class="p">;</span>
    ssl_session_cache shared:SSL:50m<span class="p">;</span>
    ssl_session_tickets off<span class="p">;</span>

    ssl_trusted_certificate /etc/letsencrypt/live/www.biaodianfu.com/chain.pem<span class="p">;</span>
    ssl_dhparam /etc/ssl/certs/dhparam.pem<span class="p">;</span>

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3<span class="p">;</span>
    ssl_ciphers <span class="s1">&#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&#39;</span><span class="p">;</span>
    ssl_prefer_server_ciphers on<span class="p">;</span>
    ssl_stapling on<span class="p">;</span>
    ssl_stapling_verify on<span class="p">;</span>
    resolver 223.5.5.5 223.6.6.6 <span class="nv">valid</span><span class="o">=</span>300s<span class="p">;</span>
    resolver_timeout 30s<span class="p">;</span>
    
    <span class="c1"># HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)</span>
    add_header Strict-Transport-Security max-age<span class="o">=</span>15768000<span class="p">;</span>

    access_log /var/log/nginx/www.biaodianfu.com.access.log<span class="p">;</span>
    error_log /var/log/nginx/www.biaodianfu.com.error.log<span class="p">;</span>


    client_max_body_size 100M<span class="p">;</span>

    autoindex off<span class="p">;</span>

    location / <span class="o">{</span>
        try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ /index.php?<span class="nv">$args</span><span class="p">;</span>
    <span class="o">}</span>

    location ~ .php$ <span class="o">{</span>
         include snippets/fastcgi-php.conf<span class="p">;</span>
         fastcgi_pass unix:/var/run/php/php7.4-fpm.sock<span class="p">;</span>
         fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
         include fastcgi_params<span class="p">;</span>
         fastcgi_read_timeout 300s<span class="p">;</span>
    <span class="o">}</span>


    <span class="nv">location</span> <span class="o">=</span> /favicon.ico <span class="o">{</span>
        log_not_found off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Automatic renewal of certificates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo crontab -e
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="m">30</span> <span class="m">2</span> * */2 * /usr/bin/certbot renew --quiet --renew-hook <span class="s2">&#34;nginx -s reload&#34;</span> &gt;&gt; /var/log/letsencrypt/renew.log
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/wordpress/">wordpress</a>
          <a href="/tags/ubuntu/">ubuntu</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/session-cookie-localstorage-sessionstorage/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Session, Cookie, LocalStorage and SessionStorage</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/gogs-gitea/">
            <span class="next-text nav-default">Private Git server build: Gogs/Gitea</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
