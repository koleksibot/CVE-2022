<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Why Linux and macOS don&#39;t need defragmentation - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="I believe that many software engineers today use Linux or macOS systems, and unlike Windows, we hardly see the concept of disk defragmentation. From personal experience, the author has not defragmented a disk in macOS for the past seven or eight years, and you won&amp;rsquo;t find any related operations in today&amp;rsquo;s disk tools, only the diskutil command to set whether a disk is defragmented on or off.
Windows operating systems may need to defragment their disks every once in a while, and there are two reasons behind this problem: one is that Windows uses a very simple file system called FAT, which is designed in such a way that the same files may be scattered in different locations on the disk, and the other is that solid state drives were not popular in the ancient times and mechanical hard drives have poor random read and write performance." /><meta name="keywords" content="linux, mac" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/whys-the-design-linux-macos-fragmentation/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Why Linux and macOS don&#39;t need defragmentation" />
<meta property="og:description" content="I believe that many software engineers today use Linux or macOS systems, and unlike Windows, we hardly see the concept of disk defragmentation. From personal experience, the author has not defragmented a disk in macOS for the past seven or eight years, and you won&rsquo;t find any related operations in today&rsquo;s disk tools, only the diskutil command to set whether a disk is defragmented on or off.
Windows operating systems may need to defragment their disks every once in a while, and there are two reasons behind this problem: one is that Windows uses a very simple file system called FAT, which is designed in such a way that the same files may be scattered in different locations on the disk, and the other is that solid state drives were not popular in the ancient times and mechanical hard drives have poor random read and write performance." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/whys-the-design-linux-macos-fragmentation/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-25T18:55:06+08:00" />
<meta property="article:modified_time" content="2021-11-25T18:55:06+08:00" />

<meta itemprop="name" content="Why Linux and macOS don&#39;t need defragmentation">
<meta itemprop="description" content="I believe that many software engineers today use Linux or macOS systems, and unlike Windows, we hardly see the concept of disk defragmentation. From personal experience, the author has not defragmented a disk in macOS for the past seven or eight years, and you won&rsquo;t find any related operations in today&rsquo;s disk tools, only the diskutil command to set whether a disk is defragmented on or off.
Windows operating systems may need to defragment their disks every once in a while, and there are two reasons behind this problem: one is that Windows uses a very simple file system called FAT, which is designed in such a way that the same files may be scattered in different locations on the disk, and the other is that solid state drives were not popular in the ancient times and mechanical hard drives have poor random read and write performance."><meta itemprop="datePublished" content="2021-11-25T18:55:06+08:00" />
<meta itemprop="dateModified" content="2021-11-25T18:55:06+08:00" />
<meta itemprop="wordCount" content="1048">
<meta itemprop="keywords" content="linux,mac," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why Linux and macOS don&#39;t need defragmentation"/>
<meta name="twitter:description" content="I believe that many software engineers today use Linux or macOS systems, and unlike Windows, we hardly see the concept of disk defragmentation. From personal experience, the author has not defragmented a disk in macOS for the past seven or eight years, and you won&rsquo;t find any related operations in today&rsquo;s disk tools, only the diskutil command to set whether a disk is defragmented on or off.
Windows operating systems may need to defragment their disks every once in a while, and there are two reasons behind this problem: one is that Windows uses a very simple file system called FAT, which is designed in such a way that the same files may be scattered in different locations on the disk, and the other is that solid state drives were not popular in the ancient times and mechanical hard drives have poor random read and write performance."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Why Linux and macOS don&#39;t need defragmentation</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-25 18:55:06 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1048 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#file-systems">File systems</a></li>
        <li><a href="#solid-state-drives">Solid State Drives</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>I believe that many software engineers today use Linux or macOS systems, and unlike Windows, we hardly see the concept of disk defragmentation. From personal experience, the author has not defragmented a disk in macOS for the past seven or eight years, and you won&rsquo;t find any related operations in today&rsquo;s disk tools, only the diskutil command to set whether a disk is defragmented on or off.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/25/ef784182977f4df3afb90ba1a0f96b37.png" alt=""></p>
<p>Windows operating systems may need to defragment their disks every once in a while, and there are two reasons behind this problem: one is that Windows uses a very simple file system called FAT, which is designed in such a way that the same files may be scattered in different locations on the disk, and the other is that solid state drives were not popular in the ancient times and mechanical hard drives have poor random read and write performance.</p>
<p>Linux and macOS systems do not need defragmentation for the opposite reasons that Windows needs defragmentation.</p>
<ul>
<li>Linux and macOS use file systems that either reduce the probability of fragmentation or implement automatic defragmentation features.</li>
<li>Solid-state drives have different characteristics than mechanical drives, and defragmentation may not only not significantly help improve read and write performance, but also be detrimental to the life of the hardware.</li>
</ul>
<h2 id="file-systems">File systems</h2>
<p>Linux generally uses Ext2, Ext3 and Ext4 file systems, with most Linux distributions today opting for Ext4. Unlike Windows, which stores multiple files consecutively, Linux scatters files to different parts of the disk, leaving some space between files to ensure that they are not fragmented when modified or updated.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/25/1d9b57cf7ba749dcb2a3390b7bf9bd89.png" alt=""></p>
<p>Most of today&rsquo;s macOS uses the APFS file system, which is Apple&rsquo;s file system optimized specifically for devices such as solid-state drives. The earlier HFS and HFS+ both used a block-based (Extent) design, where each block contains a serial number and a contiguous segment of storage space, and this allocation looks for several contiguous blocks in the file system to provide the space needed.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/25/87a29a8e99764fffa5962ee8b78fb391.png" alt=""></p>
<p>Both Linux and macOS have block-based file systems, and the disk space allocation is relatively reasonable, so there are no fragmented disks on Windows systems.</p>
<p>In addition to file systems designed to avoid fragmentation, both Linux and macOS also introduce a delayed space allocation strategy, where they delay disk writes as much as possible through buffers, which not only reduces the probability of swiping the disk, but also increases the probability of files being written to adjacent blocks, however, this mechanism is not without side effects, and more data may be lost in case of a system power failure or crash.</p>
<p>If fragmentation does occur on the disk, the Linux and macOS file systems will attempt to move the fragmented files without the need for additional defragmentation tools, which provides a much better user experience than manually triggering time-consuming defragmentation. macOS' HFS+ system also supports real-time defragmentation, which is triggered when the following conditions are met.</p>
<ul>
<li>files less than 20 MB.</li>
<li>the file is stored on more than 8 blocks.</li>
<li>the file has not been updated in the last minute.</li>
<li>the system has been booted for three minutes.</li>
</ul>
<p>In most cases, the percentage of disk fragmentation in these operating systems is very low and fragmentation starts only when the disk is running low on space, so at that point we actually need a bigger disk or a newer computer, not to defragment the disk.</p>
<h2 id="solid-state-drives">Solid State Drives</h2>
<p>Solid state drives have actually been a storage medium for three decades, but they have not been popular in data centers and personal computers because they have been very expensive in the past. Even today, the price of mechanical disks has a significant advantage over solid state drives.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/25/27d2ff68bfda4bae9d6bd2fec7d9b901.png" alt=""></p>
<p>New storage media brings new features and performance, as we introduced in a previous article, because of the mechanical structure of a mechanical hard drive, its random I/O and sequential I/O performance can differ by hundreds of times, defragmentation can merge data scattered on the disk into one place, and the reduction in the number of random I/O will naturally improve the performance of reading and writing files.</p>
<p>Although there is a difference in performance between sequential I/O and random I/O on SSDs, the difference may be between a dozen and dozens of times, and the random I/O latency of SSDs is tens or even thousands of times better than that of mechanical disks, and the benefits of defragmentation on SSDs are more limited by now.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/25/ba3a18f3a39a4fb79ad9e557ddea8099.png" alt=""></p>
<p>Although solid state drives as electronic components have better performance, solid state drives have a limit on the number of cycles of erasure, also known as P/E. Its lifespan is relatively limited compared to mechanical drives. If a 512 GB solid state drive is erased 1000 times, each time the data is written will consume a lifetime, and the drive will be scrapped after the number of erases reaches 1000, defragmentation is actually the active movement of data on the drive, which naturally affects the life of the hardware.</p>
<h2 id="summary">Summary</h2>
<p>There is a very interesting phenomenon in software engineering, hardware and infrastructure engineers are desperately trying to optimize the performance of the system, but the application layer engineers often do not care about the small differences in performance, and this is also the result of the difference in job responsibilities, different positions determine the different focus.</p>
<p>The evolution and innovation of hardware deeply affects the design of upper-level software, and it is extremely difficult to design a universal system that does not take into account the characteristics of the underlying hardware when designing a file system, so it is impossible to take full advantage of the performance provided by the hardware and get the desired results. Here is a brief summary of two reasons why Linux and macOS do not need defragmentation.</p>
<ul>
<li>The block allocation-based design of the file system makes the probability of fragmentation on the disk very low, and the delayed allocation and automatic defragmentation policy frees the OS user from the need to consider disk defragmentation in most cases.</li>
<li>The random read and write performance of SSDs is far better than that of mechanical drives, and while there are performance differences between random and sequential read and write, they are not as great as those of mechanical drives, and frequent defragmentation can affect the life of SSDs.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          <a href="/tags/mac/">mac</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/heterogeneous-computing/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">CPU and GPU - The Evolution and Development of Heterogeneous Computing</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/linux-swap/">
            <span class="next-text nav-default">Linux installation of swap swap partition size setting</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
