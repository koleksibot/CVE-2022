<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Apply effects to photos using the CameraX Extensions API - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Android CameraX is designed to help you simplify the development of camera applications. As development of CameraX continues, camera app developers have shown us their passion and enthusiasm, and many great ideas have been incorporated into the current API, such as the laudable CameraX Extensions API. Recently we have taken input from the developer community and refactored the extensions, and now there is a new ExtensionsManager, you can use these" /><meta name="keywords" content="android, Camerax Extensions" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/camerax-extensions-api/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Apply effects to photos using the CameraX Extensions API" />
<meta property="og:description" content="Android CameraX is designed to help you simplify the development of camera applications. As development of CameraX continues, camera app developers have shown us their passion and enthusiasm, and many great ideas have been incorporated into the current API, such as the laudable CameraX Extensions API. Recently we have taken input from the developer community and refactored the extensions, and now there is a new ExtensionsManager, you can use these" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/camerax-extensions-api/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-01T13:49:26+08:00" />
<meta property="article:modified_time" content="2021-11-01T13:49:26+08:00" />

<meta itemprop="name" content="Apply effects to photos using the CameraX Extensions API">
<meta itemprop="description" content="Android CameraX is designed to help you simplify the development of camera applications. As development of CameraX continues, camera app developers have shown us their passion and enthusiasm, and many great ideas have been incorporated into the current API, such as the laudable CameraX Extensions API. Recently we have taken input from the developer community and refactored the extensions, and now there is a new ExtensionsManager, you can use these"><meta itemprop="datePublished" content="2021-11-01T13:49:26+08:00" />
<meta itemprop="dateModified" content="2021-11-01T13:49:26+08:00" />
<meta itemprop="wordCount" content="1427">
<meta itemprop="keywords" content="android," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Apply effects to photos using the CameraX Extensions API"/>
<meta name="twitter:description" content="Android CameraX is designed to help you simplify the development of camera applications. As development of CameraX continues, camera app developers have shown us their passion and enthusiasm, and many great ideas have been incorporated into the current API, such as the laudable CameraX Extensions API. Recently we have taken input from the developer community and refactored the extensions, and now there is a new ExtensionsManager, you can use these"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Apply effects to photos using the CameraX Extensions API</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-01 13:49:26 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1427 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#camerax-extensions">CameraX Extensions</a></li>
        <li><a href="#what-camerax-extensions-covers">What CameraX Extensions covers</a></li>
        <li><a href="#example-of-bokeh-mode">Example of BOKEH mode</a></li>
        <li><a href="#hdr-mode-example">HDR mode example</a></li>
        <li><a href="#night-pattern-example">NIGHT pattern example</a></li>
        <li><a href="#extensions-api">Extensions API</a></li>
        <li><a href="#get-the-extensionsmanager-instance">Get the ExtensionsManager instance</a></li>
        <li><a href="#check-extended-mode-availability">Check extended mode availability</a></li>
        <li><a href="#get-the-extended-cameraselector-enabled">Get the extended CameraSelector enabled</a></li>
        <li><a href="#call-bindtolifecycle-with-the-extended-cameraselector-enabled">Call bindToLifecycle() with the extended CameraSelector enabled</a></li>
        <li><a href="#sample-code-using-extensions-api">Sample code using Extensions API</a></li>
        <li><a href="#extensions-api-dependency-on-core-modules">Extensions API dependency on core modules</a></li>
        <li><a href="#devices-that-support-expansion">Devices that support expansion</a></li>
        <li><a href="#remove-old-extensions-api">Remove old Extensions API</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://android-developers.googleblog.com/2019/05/whats-new-with-android-jetpack.html">Android CameraX</a> is designed to help you simplify the development of camera applications. As development of CameraX continues, camera app developers have shown us their passion and enthusiasm, and many great ideas have been incorporated into the current API, such as the laudable CameraX Extensions API. Recently we have taken input from the developer community and refactored the extensions, and now there is a new <a href="https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager">ExtensionsManager</a>, you can use these extensions with just two lines of code! This article will describe how to use the Extensions API in your application.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/01/99b375b217cb43159898f175e0438010.png" alt=""></p>
<h2 id="camerax-extensions">CameraX Extensions</h2>
<p>Android devices come with powerful cameras, and manufacturers have put a lot of effort into incorporating many cutting-edge functional features or special effects into these camera devices. In the past, these powerful features were only available from the device&rsquo;s native camera app. Now, with the CameraX Extensions API, third-party developers can access these powerful camera features through a common, simple interface.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/01/a667810faec7451e90aeebde22e483b4.png" alt=""></p>
<h2 id="what-camerax-extensions-covers">What CameraX Extensions covers</h2>
<p>Version 1.0.0 of CameraX Extensions includes some of the most common built-in camera effects:</p>
<ul>
<li><strong>BOKEH (out-of-focus imaging)</strong> : Make foreground people sharper when taking photos in portrait mode.</li>
<li><strong>HDR (High Dynamic Range)</strong> : Take photos with different Auto Exposure (AE) configurations to get the best results.</li>
<li><strong>NIGHT</strong> : Capture the best still images in low-light conditions (usually at night).</li>
<li><strong>FACE RETOUCH</strong> : Retouch face skin tones, contours, etc. when shooting still images.</li>
<li><strong>AUTO (Auto)</strong> : Automatically adjusts the final image according to the surrounding scenery.</li>
</ul>
<p>Let&rsquo;s take a look at a couple of photos taken on an Android phone with the effects provided by the CameraX Extensions API enabled and disabled when taking photos.</p>
<h2 id="example-of-bokeh-mode">Example of BOKEH mode</h2>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/01/ac7804f528904afda607aa1ee8a12566.png" alt=""></p>
<p>△ Fig. 1: The BOKEH effect is enabled for the photo on the right.</p>
<h2 id="hdr-mode-example">HDR mode example</h2>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/01/e50602ad499342b1b716f5844189a69f.png" alt=""></p>
<p>△ Figure 2: The right photo is enabled with HDR effect.</p>
<h2 id="night-pattern-example">NIGHT pattern example</h2>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/01/89d26f90fc3d4e5d97bb363b27fed0d2.png" alt=""></p>
<p>△ Figure 3: The NIGHT special effect is enabled for the right photo.</p>
<p>The visual difference is obvious. You can use the CameraX Extensions API to implement these image effects in your own applications.</p>
<p>Now let&rsquo;s see how to integrate CameraX&rsquo;s API into your application.</p>
<h2 id="extensions-api">Extensions API</h2>
<p>In an existing CameraX application, you can first add CameraX Extensions by introducing the <code>camera-extensions</code> Jetpack library:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gradle" data-lang="gradle"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// 与 Extensions 库版本号相匹配的 CameraX 核心库
</span><span class="c1"></span>    <span class="n">implementation</span> <span class="s1">&#39;androidx.camera:camera-core:1.1.0-alpha08&#39;</span>
    <span class="n">implementation</span> <span class="s1">&#39;androidx.camera:camera-camera2:1.1.0-alpha08&#39;</span>
    <span class="n">implementation</span> <span class="s1">&#39;androidx.camera:camera-lifecycle:1.1.0-alpha08&#39;</span>

    <span class="c1">// CameraX Extensions 库
</span><span class="c1"></span>    <span class="n">implementation</span> <span class="s1">&#39;androidx.camera:camera-extensions:1.0.0-alpha28&#39;</span>

    <span class="c1">// 其他依赖项
</span><span class="c1"></span>    <span class="n">implementation</span><span class="o">(</span><span class="s1">&#39;androidx.concurrent:concurrent-futures-ktx:1.1.0&#39;</span><span class="o">)</span>
        <span class="err">…</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Next, integrate Extensions by following these steps. 1:</p>
<ol>
<li>Get the [ExtensionsManager](<a href="https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager">https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager</a></li>
</ol>
<p>) instance.
2. check if the target device supports the required extension mode.
3. get an extension-enabled CameraSelector.
4. Call <a href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider#bindToLifecycle(androidx.lifecycle.LifecycleOwner,%20androidx.camera.core.CameraSelector,%20androidx.camera.core.UseCase...)">bindToLifecycle</a> with the extension-enabled CameraSelector.</p>
<h2 id="get-the-extensionsmanager-instance">Get the ExtensionsManager instance</h2>
<p>The first step is to get an instance of <a href="https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager">ExtensionsManager</a> using the <a href="https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager#getInstance(android.content.Context)">getInstance(Context)</a> API of the extension library. This API returns a ListenableFuture, which we can use in the Kotlin pending function to get the result using await() to avoid blocking the main thread. (Note: Using await() on ListenableFuture requires the introduction of the androidx.concurrent:concurrent-futures-ktx: 1.1.0 dependency).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 创建扩展管理器（使用 Jetpack Concurrent 库）
</span><span class="c1"></span><span class="n">val</span> <span class="n">extensionsManager</span> <span class="o">=</span>  <span class="n">ExtensionsManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">await</span><span class="o">()</span>
</code></pre></td></tr></table>
</div>
</div><p>With ExtensionsManager, you can determine whether a device supports a particular extension mode and get a <code>CameraSelector</code> for it with extensions enabled. Please note the following points:</p>
<ul>
<li>ExtensionsManager is a process-wide global resource: only one instance of ExtensionsManager exists in a process.</li>
<li>ExtensionsManager always exists: CameraX provides a valid instance of ExtensionsManager regardless of whether the underlying device supports extensions or not.</li>
</ul>
<h2 id="check-extended-mode-availability">Check extended mode availability</h2>
<p>With the ExtensionsManager, use the <a href="https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager#isExtensionAvailable(androidx.camera.core.CameraProvider,%20androidx.camera.core.CameraSelector,%20int)">isExtensionAvailable(CameraProvider, CameraSelector, int)</a> function to check the availability of the extension: If any camera filtered by CameraSelector exists on the device that supports the queried extension, then true is returned, otherwise false is returned.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 获取相机设备来检查是否支持扩展
</span><span class="c1"></span><span class="n">val</span> <span class="n">cameraSelector</span> <span class="o">=</span> <span class="n">CameraSelector</span><span class="o">.</span><span class="na">DEFAULT_BACK_CAMERA</span>

<span class="c1">// 检查是否支持 BOKEH
</span><span class="c1"></span> <span class="k">if</span> <span class="o">(</span><span class="n">extensionsManager</span><span class="o">.</span><span class="na">isExtensionAvailable</span><span class="o">(</span>
    <span class="n">cameraProvider</span><span class="o">,</span>
    <span class="n">cameraSelector</span><span class="o">,</span>
    <span class="n">ExtensionMode</span><span class="o">.</span><span class="na">BOKEH</span>
   <span class="o">))</span> <span class="o">{</span>
   <span class="o">...</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="get-the-extended-cameraselector-enabled">Get the extended CameraSelector enabled</h2>
<p>Once you have confirmed that the device supports this extension mode, you can use the <a href="https://developer.android.google.cn/reference/androidx/camera/extensions/ExtensionsManager#getExtensionEnabledCameraSelector(androidx.camera.core.CameraProvider,%20androidx.camera.core.CameraSelector,%20int)">getExtensionEnabledCameraSelector(CameraProvider, CameraSelector, int)</a> function to get an extension-enabled CameraSelector. This function returns the extension-enabled CameraSelector, which contains all the details about the specified extension mode.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">val</span> <span class="n">bokehCameraSelector</span> <span class="o">=</span> <span class="n">extensionsManager</span>
                          <span class="o">.</span><span class="na">getExtensionEnabledCameraSelector</span><span class="o">(</span>
                              <span class="n">cameraProvider</span><span class="o">,</span> <span class="n">cameraSelector</span><span class="o">,</span> <span class="n">ExtensionMode</span><span class="o">.</span><span class="na">BOKEH</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="call-bindtolifecycle-with-the-extended-cameraselector-enabled">Call bindToLifecycle() with the extended CameraSelector enabled</h2>
<p>The last step is to use <a href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider#bindToLifecycle(androidx.lifecycle.LifecycleOwner,%20androidx.camera.core.CameraSelector,%20androidx.camera.core.UseCase...)">bindToLifecycle()</a> to bind your use case to an extended <code>CameraSelector</code>. Use the extended <code>CameraSelector</code> as you would a normal CameraSelector, for example with <a href="https://developer.android.google.cn/reference/androidx/camera/core/CameraSelector#DEFAULT_BACK_CAMERA">DEFAULT_BACK_CAMERA</a> or <a href="https://developer.android.google.cn/reference/androidx/camera/core/CameraSelector#DEFAULT_FRONT_CAMERA">DEFAULT_FRONT_CAMERA</a>. When using the CameraSelector binding use case with extensions enabled, CameraX enables the specified extension mode directly on the camera. For example, when bound to Preview, the extended effect is applied to the preview or to the image captured by the bound ImageCapture.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 将开启了 BOKEH 的相机选择器绑定到用例上
</span><span class="c1"></span><span class="n">val</span> <span class="n">imageCapture</span> <span class="o">=</span> <span class="n">ImageCapture</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>
<span class="n">val</span> <span class="n">preview</span> <span class="o">=</span> <span class="n">Preview</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>
<span class="n">cameraProvider</span><span class="o">.</span><span class="na">bindToLifecycle</span><span class="o">(</span>
                <span class="n">lifecycleOwner</span><span class="o">,</span>
                <span class="n">bokehCameraSelector</span><span class="o">,</span>
                <span class="n">imageCapture</span><span class="o">,</span>
                <span class="n">preview</span>
            <span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="sample-code-using-extensions-api">Sample code using Extensions API</h2>
<p>The full code of the Extensions API example is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">fun</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">lifecycleScope</span><span class="o">.</span><span class="na">launch</span> <span class="o">{</span>
        <span class="c1">// 创建 cameraProvider
</span><span class="c1"></span>        <span class="n">val</span> <span class="n">cameraProvider</span> <span class="o">=</span> <span class="n">ProcessCameraProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">await</span><span class="o">()</span> 

        <span class="c1">// 创建 extensionsManager（使用 Jetpack Concurrent 库）
</span><span class="c1"></span>        <span class="n">val</span> <span class="n">extensionsManager</span> <span class="o">=</span> 
                <span class="n">ExtensionsManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">await</span><span class="o">()</span>

        <span class="c1">// 获取相机设备来检查是否支持扩展        
</span><span class="c1"></span>        <span class="n">val</span> <span class="n">cameraSelector</span> <span class="o">=</span> <span class="n">CameraSelector</span><span class="o">.</span><span class="na">DEFAULT_BACK_CAMERA</span>

        <span class="c1">// 检查是否支持 BOKEH
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">extensionsManager</span><span class="o">.</span><span class="na">isExtensionAvailable</span><span class="o">(</span>
                <span class="n">cameraProvider</span><span class="o">,</span>
                <span class="n">cameraSelector</span><span class="o">,</span>
                <span class="n">ExtensionMode</span><span class="o">.</span><span class="na">BOKEH</span>
            <span class="o">))</span> <span class="o">{</span>
            <span class="c1">// 在启用不同扩展模式之前解除所有用例的绑定
</span><span class="c1"></span>            <span class="n">cameraProvider</span><span class="o">.</span><span class="na">unbindAll</span><span class="o">()</span>

            <span class="c1">// 获取启用了 BOKEH 的相机选择器
</span><span class="c1"></span>            <span class="n">val</span> <span class="n">bokehCameraSelector</span> <span class="o">=</span> <span class="n">extensionsManager</span>
                    <span class="o">.</span><span class="na">getExtensionEnabledCameraSelector</span><span class="o">(</span>
                <span class="n">cameraProvider</span><span class="o">,</span>
                <span class="n">cameraSelector</span><span class="o">,</span>
                <span class="n">ExtensionMode</span><span class="o">.</span><span class="na">BOKEH</span>
            <span class="o">)</span>

            <span class="c1">// 将开启了 BOKEH 的相机选择器绑定到用例上
</span><span class="c1"></span>            <span class="n">val</span> <span class="n">imageCapture</span> <span class="o">=</span> <span class="n">ImageCapture</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>
            <span class="n">val</span> <span class="n">preview</span> <span class="o">=</span> <span class="n">Preview</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>
            <span class="n">cameraProvider</span><span class="o">.</span><span class="na">bindToLifecycle</span><span class="o">(</span>
                <span class="n">lifecycleOwner</span><span class="o">,</span>
                <span class="n">bokehCameraSelector</span><span class="o">,</span>
                <span class="n">imageCapture</span><span class="o">,</span>
                <span class="n">preview</span>
            <span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="extensions-api-dependency-on-core-modules">Extensions API dependency on core modules</h2>
<p>The CameraX Extensions API is implemented in the <code>camera-extensions</code> library and it relies on the CameraX core modules ( <code>core, camera2 and lifecycle</code>). When using CameraX Extensions, be sure to use the version from the <a href="https://developer.android.google.cn/jetpack/androidx/releases/camera">same distribution</a> as the CameraX core module you are using. For example, to use <code>camera-extensions:1.0.0-alpha28</code>, you must include the 1.0.0-alpha08 versions of <code>camera-lifecycle</code>, <code>camera-core</code> and <code>camera-camera2</code> in your application&rsquo;s dependency list, as they were released on released in the same package on August 18, 2021.</p>
<h2 id="devices-that-support-expansion">Devices that support expansion</h2>
<p>In order to be able to use the CameraX Extensions API, device manufacturers need to implement the <a href="https://source.android.com/devices/camera/camerax-vendor-extensions">CameraX Vendor Extensions Interface</a>. You can find a partial list of devices that support the CameraX Extensions API on the <a href="https://developer.android.google.cn/training/camerax/devices">CameraX Devices page</a>. Please note that this is not an exhaustive list. If your device is listed, but the availability check returns false, you may need to update your device to the latest ROM version from the manufacturer.</p>
<p>In addition to the list of devices that support extensions, starting with Android 12, you can also determine if your device supports CameraX Extensions by checking the Android property <code>ro.camerax.extensions.enabled</code>.</p>
<h2 id="remove-old-extensions-api">Remove old Extensions API</h2>
<p>An older version of the Extensions API released in August 2019 is now deprecated. This older version of the Extensions API provides extender classes that require extension-related configuration to be applied to each Preview and ImageCapture use case. The old extender design could cause developers to forget to enable extension mode on Preview or ImageCapture and could lead to unintended behavior.</p>
<p>The new CameraX Extensions library was introduced in 1.0.0-alpha26. The newer Extensions API makes it easier to use by switching the extension binding from the use case to the target camera. Please be sure to migrate to take advantage of the new Extensions API.</p>
<p>A special thanks to the amazing Android camera developers and device manufacturers who helped implement the CameraX Extensions API! If you&rsquo;d like to stay up to date on CameraX developments, please join the <a href="https://groups.google.com/a/android.com/g/camerax-developers">Android CameraX Discussion Group</a>.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/android/">android</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/python-excel/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python reads and writes Excel tables</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/buildpack-vs-dockerfile/">
            <span class="next-text nav-default">Building images without Dockerfile: BuildPack vs Dockerfile</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
