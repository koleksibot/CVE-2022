<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Why CPU access to hard disk is slow - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Mechanical Hard Disk Drives (HDD) and Solid State Drives (SSD) are the two most common types of hard drives used as external storage for computers, and it takes a long time for the CPU to access the data they store, as shown in the table below, where it takes 1,500 times longer to access a random 4KB of data in an SSD than it does to access the main memory, and 100,000 times longer to seek a mechanical disk than it does to access the main memory." /><meta name="keywords" content="cpu, Disk" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/whys-the-design-cpu-and-disk/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Why CPU access to hard disk is slow" />
<meta property="og:description" content="Mechanical Hard Disk Drives (HDD) and Solid State Drives (SSD) are the two most common types of hard drives used as external storage for computers, and it takes a long time for the CPU to access the data they store, as shown in the table below, where it takes 1,500 times longer to access a random 4KB of data in an SSD than it does to access the main memory, and 100,000 times longer to seek a mechanical disk than it does to access the main memory." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/whys-the-design-cpu-and-disk/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-30T21:35:44+08:00" />
<meta property="article:modified_time" content="2021-11-30T21:35:44+08:00" />

<meta itemprop="name" content="Why CPU access to hard disk is slow">
<meta itemprop="description" content="Mechanical Hard Disk Drives (HDD) and Solid State Drives (SSD) are the two most common types of hard drives used as external storage for computers, and it takes a long time for the CPU to access the data they store, as shown in the table below, where it takes 1,500 times longer to access a random 4KB of data in an SSD than it does to access the main memory, and 100,000 times longer to seek a mechanical disk than it does to access the main memory."><meta itemprop="datePublished" content="2021-11-30T21:35:44+08:00" />
<meta itemprop="dateModified" content="2021-11-30T21:35:44+08:00" />
<meta itemprop="wordCount" content="1565">
<meta itemprop="keywords" content="cpu," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why CPU access to hard disk is slow"/>
<meta name="twitter:description" content="Mechanical Hard Disk Drives (HDD) and Solid State Drives (SSD) are the two most common types of hard drives used as external storage for computers, and it takes a long time for the CPU to access the data they store, as shown in the table below, where it takes 1,500 times longer to access a random 4KB of data in an SSD than it does to access the main memory, and 100,000 times longer to seek a mechanical disk than it does to access the main memory."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Why CPU access to hard disk is slow</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-30 21:35:44 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1565 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#io-operations">I/O operations</a></li>
        <li><a href="#mechanical-hard-disk-drive">Mechanical Hard Disk Drive</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Mechanical Hard Disk Drives (HDD) and Solid State Drives (SSD) are the two most common types of hard drives used as external storage for computers, and it takes a long time for the CPU to access the data they store, as shown in the table below, where it takes 1,500 times longer to access a random 4KB of data in an SSD than it does to access the main memory, and 100,000 times longer to seek a mechanical disk than it does to access the main memory.</p>
<table>
<thead>
<tr>
<th>Work</th>
<th>Latency</th>
</tr>
</thead>
<tbody>
<tr>
<td>L1 cache reference</td>
<td>0.5 ns</td>
</tr>
<tr>
<td>Branch mispredict</td>
<td>5 ns</td>
</tr>
<tr>
<td>L2 cache reference</td>
<td>7 ns</td>
</tr>
<tr>
<td>Mutex lock/unlock</td>
<td>25 ns</td>
</tr>
<tr>
<td>Main memory reference</td>
<td>100 ns</td>
</tr>
<tr>
<td>Compress 1K bytes with Zippy</td>
<td>3,000 ns</td>
</tr>
<tr>
<td>Send 1K bytes over 1 Gbps network</td>
<td>10,000 ns</td>
</tr>
<tr>
<td>Read 4K randomly from SSD*</td>
<td>150,000 ns</td>
</tr>
<tr>
<td>Read 1 MB sequentially from memory</td>
<td>250,000 ns</td>
</tr>
<tr>
<td>Round trip within same datacenter</td>
<td>500,000 ns</td>
</tr>
<tr>
<td>Read 1 MB sequentially from SSD*</td>
<td>1,000,000 ns</td>
</tr>
<tr>
<td>Disk seek</td>
<td>10,000,000 ns</td>
</tr>
<tr>
<td>Read 1 MB sequentially from disk</td>
<td>20,000,000 ns</td>
</tr>
<tr>
<td>Send packet CA-&gt;Netherlands-&gt;CA</td>
<td>150,000,000 ns</td>
</tr>
</tbody>
</table>
<p>Although the disk seek time is only 10ms, it seems like a very long time to the CPU, and when we scale the above times up equally, we can visualize the performance difference. If the CPU takes 1 second to access the L1 cache, it takes 3 minutes to access the main memory, 3.4 days to read random data from the SSD, 2 months for disk seek, and possibly over a year for network transfers.</p>
<p>In computer architecture, the hard disk is a common input and output device, and the operating system does not necessarily need a hard disk to boot; it can be booted from either a hard disk, a network device, or an external device, so a hard disk is not necessary for the computer to run.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/30/7d7f5e50821c4170a1b7c23eeb14ac52.png" alt=""></p>
<p>As an external input and output device, compared to CPU cache and memory, the extremely slow read and write speed of the hard disk makes sense, however, the difference in speed of thousands or even hundreds of thousands of times is really hard to imagine or accept, in this article, we will analyze why the CPU access to the hard disk is very slow: * The CPU access to hard disk data is a complex process.</p>
<ul>
<li>CPU access to hard disk data is a complex process, it will first read the data from the disk into memory through I/O operations and then access the data in memory.</li>
<li>mechanical hard disks rely on mechanical structures in accessing data in the disk, which require moving the mechanical arms in the disk.</li>
</ul>
<h2 id="io-operations">I/O operations</h2>
<p>A CPU that wants to access data in the disk must first read the data in the disk into memory through I/O operations and then access the data stored in memory. Computers contain three common types of I/O operations - Programmed I/O, Interrupt-driven I/O, and Direct Memory Access - which we will describe in turn.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/30/46e751b0c4ad47ae9592c2f90a16e500.png" alt=""></p>
<p>If we want to output <code>Hello World</code> on the screen, the CPU will write a new character to the I/O device each time, and after writing, it will poll the device&rsquo;s status and wait for it to finish its work and write a new character. This approach is simple, but it takes up all the CPU resources, which can cause a serious waste of computing resources in some complex systems.</p>
<p><em>Interrupt-driven I/O</em> is a more efficient way to perform I/O operations. In programmed I/O, the CPU actively obtains the state of the device and waits for it to become idle, but with interrupt-driven I/O, the device initiates an interrupt to suspend the current process and save the context when it becomes idle, and the OS executes the I/O device&rsquo;s interrupt handler.</p>
<ul>
<li>If the current does not contain the character to be printed, stop the interrupt handler and resume the suspended process.</li>
<li>If the current contains the character to be printed, copies the next character to the device and resumes the paused process.</li>
</ul>
<p>Using interrupt-driven I/O allows the CPU to handle other tasks when the device is busy, maximizing CPU utilization and eliminating the waste of precious computing resources. Compared to programmed I/O, interrupt-driven I/O gives a portion of the work to the I/O device, so it can improve resource utilization.</p>
<p><em>Direct memory access</em> uses the DMA controller to perform I/O operations, and interrupt-driven I/O requires an OS interrupt to be triggered for each character, which consumes a certain amount of CPU time. When we use the DMA controller, the CPU reads all the data in the buffer to the DMA controller at once, and the DMA controller takes care of writing the data to the I/O device by character.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/30/42e13ef4fa40416f9697a7f5a2ed28a9.png" alt=""></p>
<p>While the DMA controller frees up the CPU and reduces the number of interrupts, its execution speed is slow compared to the CPU, and if the DMA controller cannot drive I/O devices fast enough, the CPU may wait for the DMA controller to trigger an interrupt, in which case interrupt-driven I/O or programmed I/O can provide faster access.</p>
<p>By default, we use the DMA controller to perform I/O tasks, but programmed I/O and interrupt-driven I/O are not unacceptable options. When the CPU often has to wait for the DMA controller to perform I/O tasks, using interrupt-driven I/O or even polled programmed I/O can result in higher throughput, however, either way, I/O is a more time-consuming and complex operation in the program.</p>
<h2 id="mechanical-hard-disk-drive">Mechanical Hard Disk Drive</h2>
<p>A mechanical hard disk drive (Hard Disk Drive, HDD) is an electronic-based, non-volatile mechanical data storage device that uses magnetic memory to store and find data on the disk, and in the process of reading and writing data, the head attached to the mechanical arm of the drive reads and writes bits on the surface of the disk.</p>
<p>It is because the disk has a relatively complex mechanical structure, so the disk takes a lot of time to read and write, and the read and write performance of the database is basically dependent on the performance of the disk, if we query a random piece of data in a database using a mechanical hard disk, this may trigger random I/O on the disk, however the cost required to read the data from the disk into memory is very large, ordinary disks (non-SSD) need to load data through these processes of queuing, seeking, spinning and transfer, which takes about 10ms.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/30/a7a9d8ff36cc40d9a4918603c0deac3d.png" alt=""></p>
<p>We can use the order of 10ms to estimate the time taken by random I/O when estimating database queries, what we want to say here is that random I/O can have a very big impact on database query performance, while sequential reading of data from disk can reach 40MB/s, the performance gap between the two is several orders of magnitude, so we should also try to reduce the number of random I/O in order to improve performance.</p>
<p>A solid state drive (SSD) is a computer storage device that uses flash memory as persistent memory. Unlike mechanical hard drives, SSDs do not contain any mechanical structure, and we use them to read or store data without using any mechanical structure, because everything is done by circuitry, so SSDs can read and write much faster than HDDs.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/30/934b37bb4c0b4a99807b0dff1a92b282.png" alt=""></p>
<p>Both mechanical hard drives and SSDs have been decreasing in price since their inception. Mechanical hard drives are the primary external storage used in data centers today, and most general purpose commercial servers use mechanical hard drives as their primary external storage, but because SSDs can read and write at speeds tens of times faster than mechanical hard drives, more and more servers, especially databases, are using SSDs as external storage. However, as an external storage device with a mechanical structure, it is very mature and has a large capacity, but it is susceptible to external interference when subjected to vibration.</p>
<h2 id="summary">Summary</h2>
<p>The hard drive is an external storage device on the computer that can store a large amount of data persistently, however, the CPU cannot access the data in the hard drive directly, when the computer starts up the operating system will load the data in the hard drive into memory for the CPU to access, but if the data that the CPU wants to access is not in memory, then we need to spend thousands or even hundreds of thousands of times more time to read the data, which is mainly caused by two reasons.</p>
<ul>
<li>the CPU needs to access data in external storage through I/O operations, and several methods - programmed I/O, interrupt-driven I/O, and DMA - all introduce additional overhead and take up more CPU time.</li>
<li>Mechanical hard drives access the data stored in them through mechanical structures, and each random I/O of the drive requires several processes of queuing, seeking, spinning and transferring data, consuming about 10ms of time.</li>
</ul>
<p>As we mentioned in the article, hard disks are not a necessary hardware device for computer operation, computers can load the data needed for booting into memory from any external storage device such as disks, CDs, etc. and boot normally, but hard disks are already the most common external storage device today. At the end of the day, let&rsquo;s look at some of the more open-ended related issues, and interested readers can think carefully about the following questions.</p>
<ul>
<li>Must data written to a hard drive be stored persistently and not lost?</li>
<li>Why is data in memory cleared after a power failure and reboot?</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cpu/">cpu</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/whys-the-design-database-foreign-key/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Why databases should not use foreign keys</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/papers-kvell/">
            <span class="next-text nav-default">NVMe Solid State Drives with Keystone Storage KVell - SOSP &#39;19</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
