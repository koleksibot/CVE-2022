<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Why early Windows needs defragmentation - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="I remember a dozen years ago when I was still using the early Windows system, every time the system would become very laggy, then you need to open the system provides the following disk defragmentation program, when the defragmentation is complete will feel the system becomes slightly smoother some.
In the file system, defragmentation is the process of reducing fragmentation in the file system, which rearranges the contents of the same files on the disk in order and uses compression algorithms to remove gaps between files, somewhat similar to the tag compression algorithm in garbage collection." /><meta name="keywords" content="windows, Defragmentation" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/whys-the-design-windows-defragmentation/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Why early Windows needs defragmentation" />
<meta property="og:description" content="I remember a dozen years ago when I was still using the early Windows system, every time the system would become very laggy, then you need to open the system provides the following disk defragmentation program, when the defragmentation is complete will feel the system becomes slightly smoother some.
In the file system, defragmentation is the process of reducing fragmentation in the file system, which rearranges the contents of the same files on the disk in order and uses compression algorithms to remove gaps between files, somewhat similar to the tag compression algorithm in garbage collection." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/whys-the-design-windows-defragmentation/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-26T15:38:21+08:00" />
<meta property="article:modified_time" content="2021-11-26T15:38:21+08:00" />

<meta itemprop="name" content="Why early Windows needs defragmentation">
<meta itemprop="description" content="I remember a dozen years ago when I was still using the early Windows system, every time the system would become very laggy, then you need to open the system provides the following disk defragmentation program, when the defragmentation is complete will feel the system becomes slightly smoother some.
In the file system, defragmentation is the process of reducing fragmentation in the file system, which rearranges the contents of the same files on the disk in order and uses compression algorithms to remove gaps between files, somewhat similar to the tag compression algorithm in garbage collection."><meta itemprop="datePublished" content="2021-11-26T15:38:21+08:00" />
<meta itemprop="dateModified" content="2021-11-26T15:38:21+08:00" />
<meta itemprop="wordCount" content="1114">
<meta itemprop="keywords" content="windows," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why early Windows needs defragmentation"/>
<meta name="twitter:description" content="I remember a dozen years ago when I was still using the early Windows system, every time the system would become very laggy, then you need to open the system provides the following disk defragmentation program, when the defragmentation is complete will feel the system becomes slightly smoother some.
In the file system, defragmentation is the process of reducing fragmentation in the file system, which rearranges the contents of the same files on the disk in order and uses compression algorithms to remove gaps between files, somewhat similar to the tag compression algorithm in garbage collection."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Why early Windows needs defragmentation</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-26 15:38:21 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1114 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#file-system">File system</a></li>
        <li><a href="#mechanical-hard-disk-drive">Mechanical Hard Disk Drive</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>I remember a dozen years ago when I was still using the early Windows system, every time the system would become very laggy, then you need to open the system provides the following disk defragmentation program, when the defragmentation is complete will feel the system becomes slightly smoother some.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/26/46c06154ff724edd8f7050baf4c6b309.png" alt=""></p>
<p>In the file system, defragmentation is the process of reducing fragmentation in the file system, which rearranges the contents of the same files on the disk in order and uses compression algorithms to remove gaps between files, somewhat similar to the tag compression algorithm in garbage collection.</p>
<p>The author has not used Windows for many years, and has been using macOS since college for seven or eight years now. I don&rsquo;t know if Windows still needs disk defragmentation today, but there is no similar tool on either Linux or macOS <a href="https://draveness.me/whys-the-design-windows-defragmentation/#fn:3">3</a>, which makes the author want to to look into the reasons behind this. In summary, there are two main reasons why operating systems need defragmentation.</p>
<ul>
<li>the design of the file system makes many fragments appear after the resources are released.</li>
<li>random read and write performance of mechanical hard drives is several orders of magnitude worse than sequential read and write.</li>
</ul>
<h2 id="file-system">File system</h2>
<p>Windows in the olden days used a very simple file system - the File Allocation Table - the design of which was the root cause of disk fragmentation, but before we analyze it, let&rsquo;s introduce the history of the file system here.</p>
<p>FAT was the first file system designed in 1977 for floppy disks, a very old storage medium, and today&rsquo;s computers have largely removed the floppy disk drive, which had very little storage space at that time, and each time a file was written it would start from scratch to find the available space and would not check the size of the available space.</p>
<p>Soon after the file system was used, Microsoft chose to extend the FAT file system to support more space in the DOS and Windows 9x series as mechanical hard disk drives (Hard Disk Driver, HDD) began to become cheaper and more widely used, and disk-sensitive applications such as databases quickly became very popular.</p>
<p>Although fragmentation could occur with each data write, this was acceptable at the time because floppy disks had less storage space, but as storage media became more spacious, we needed to introduce random writes to improve efficiency, and FATs that supported random writes were also simple file systems.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/26/9962e3587e0b469d81959d924be36a28.png" alt=""></p>
<p>As you can see above, if we are writing multiple files A, B and C to a new hard drive, these files will be stored sequentially in the FAT file system without any fragmentation between them. However, if at this point we decide to delete one of the B files and write a larger file D to the file system, a more interesting situation arises.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/26/c5661e2cad7846388e5e5472f23f7bc1.png" alt=""></p>
<p>The FAT file system finds two free spots on the disk left after deleting B and writes part of the D file to them, and then finds another free spot after the C file and writes all the remaining contents of the D file to it. The result is that the D file is scattered all over the drive, triggering multiple random reads when the user reads the D file.</p>
<p>FAT is a very simple, primitive file system that is poorly designed and implemented from today&rsquo;s point of view. Not only does it not check the size of free space each time a file is written, causing file fragmentation, but it also does not include fragmentation management features and requires the user to manually trigger disk defragmentation over time, which is actually a very poor design and user experience.</p>
<h2 id="mechanical-hard-disk-drive">Mechanical Hard Disk Drive</h2>
<p>Mechanical hard disk drive (Hard Disk Drive, HDD) is an electronic-based, non-volatile mechanical data storage device, which uses magnetic memory to store and find data on the disk, in the process of reading and writing data, the head attached to the mechanical arm of the hard disk will read and write bits of the disk surface.</p>
<p>It is because the disk has a complex mechanical structure, so the disk takes a lot of time to read and write, and the read and write performance of the database is basically dependent on the performance of the disk, if we use a mechanical hard disk in the database to query a random piece of data, this may trigger random I/O of the disk, however, the cost required to read the data from the disk to memory is very large, ordinary disks (non-SSD) need to load data through the process of queuing, seeking, spinning and transfer, which takes about 10ms</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/26/d2c113f982464be1a5b5145abeb1b0de.png" alt=""></p>
<p>When we read a file on disk, if the contents of the file are scattered in different locations on the disk, it may be necessary to perform several random I/Os to get the entire contents of the file, which is a significant additional overhead for a mechanically structured disk. If the contents of the file will be stored in the same location, then only one random I/O needs to be performed when reading the file, and all subsequent reads can use sequential I/O at a speed of about 40 MB/s, which can significantly reduce the read time of the file.</p>
<p>Fragmented files cause more serious performance problems on mechanical drives, and ideally we would like the disk to reach its upper limit of read/write bandwidth; however, in practice, frequent random I/Os allow the disk to spend most of its time seeking and spinning, preventing it from working at full capacity. An SSD with an electronic architecture can better tolerate a fragmented file system than a mechanical drive, and defragmentation can instead affect its lifespan.</p>
<h2 id="summary">Summary</h2>
<p>I believe that many engineers in the industry before entering the Windows system, the early Windows is the desktop system is almost the only choice, the author of today&rsquo;s topic has a relatively special feelings, in the study of operating systems before the file system has never thought about this issue, until the word fragmentation of the file system let themselves think of more than a decade ago, this kind of clarity The feeling of clarity is still rarely experienced today. Let&rsquo;s briefly summarize the two reasons why early Windows needed defragmentation.</p>
<ul>
<li>Early Windows systems used a simple FAT file system, which was subject to frequent write and delete operations that resulted in large files being scattered all over the disk.</li>
<li>mechanical hard drives were the dominant devices of their time more than a decade ago, although the mechanical construction of hard drives meant that randomly reading and writing to locations on the disk required physical seek and rotation, causing the process to be extremely slow.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/windows/">windows</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/papers-firecracker/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Serverless and Lightweight Virtualization Firecracker - NSDI &#39;20</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/heterogeneous-computing/">
            <span class="next-text nav-default">CPU and GPU - The Evolution and Development of Heterogeneous Computing</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
