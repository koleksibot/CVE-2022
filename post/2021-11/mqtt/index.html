<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Instant Messaging Protocol - MQTT - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Introduction to MQTT MQTT (Message Queuing Telemetry Transport) is an instant messaging protocol developed by IBM. It is designed with lightness, openness, simplicity, and specification in mind, and is therefore easy to implement. These features make it a good choice for many scenarios, including constrained environments such as machine-to-machine communication (M2M) and Internet of Things environments (IoT) that require very small code packages or very expensive network bandwidth.
The MQTT protocol is a protocol designed for the communication of a large number of remote sensors and control devices with limited computing power and operating on low-bandwidth, unreliable networks, and has several key features, as follows." /><meta name="keywords" content="mqtt" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/mqtt/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Instant Messaging Protocol - MQTT" />
<meta property="og:description" content="Introduction to MQTT MQTT (Message Queuing Telemetry Transport) is an instant messaging protocol developed by IBM. It is designed with lightness, openness, simplicity, and specification in mind, and is therefore easy to implement. These features make it a good choice for many scenarios, including constrained environments such as machine-to-machine communication (M2M) and Internet of Things environments (IoT) that require very small code packages or very expensive network bandwidth.
The MQTT protocol is a protocol designed for the communication of a large number of remote sensors and control devices with limited computing power and operating on low-bandwidth, unreliable networks, and has several key features, as follows." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/mqtt/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-10T20:47:04+08:00" />
<meta property="article:modified_time" content="2021-11-10T20:47:04+08:00" />

<meta itemprop="name" content="Instant Messaging Protocol - MQTT">
<meta itemprop="description" content="Introduction to MQTT MQTT (Message Queuing Telemetry Transport) is an instant messaging protocol developed by IBM. It is designed with lightness, openness, simplicity, and specification in mind, and is therefore easy to implement. These features make it a good choice for many scenarios, including constrained environments such as machine-to-machine communication (M2M) and Internet of Things environments (IoT) that require very small code packages or very expensive network bandwidth.
The MQTT protocol is a protocol designed for the communication of a large number of remote sensors and control devices with limited computing power and operating on low-bandwidth, unreliable networks, and has several key features, as follows."><meta itemprop="datePublished" content="2021-11-10T20:47:04+08:00" />
<meta itemprop="dateModified" content="2021-11-10T20:47:04+08:00" />
<meta itemprop="wordCount" content="1202">
<meta itemprop="keywords" content="mqtt," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Instant Messaging Protocol - MQTT"/>
<meta name="twitter:description" content="Introduction to MQTT MQTT (Message Queuing Telemetry Transport) is an instant messaging protocol developed by IBM. It is designed with lightness, openness, simplicity, and specification in mind, and is therefore easy to implement. These features make it a good choice for many scenarios, including constrained environments such as machine-to-machine communication (M2M) and Internet of Things environments (IoT) that require very small code packages or very expensive network bandwidth.
The MQTT protocol is a protocol designed for the communication of a large number of remote sensors and control devices with limited computing power and operating on low-bandwidth, unreliable networks, and has several key features, as follows."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Instant Messaging Protocol - MQTT</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-10 20:47:04 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1202 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction-to-mqtt">Introduction to MQTT</a>
          <ul>
            <li><a href="#background-of-mqtt-development">Background of MQTT development</a></li>
            <li><a href="#history-of-mqtt">History of MQTT</a></li>
          </ul>
        </li>
        <li><a href="#mqtt-protocol">MQTT protocol</a></li>
        <li><a href="#using-mqtt">Using MQTT</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="introduction-to-mqtt">Introduction to MQTT</h2>
<p>MQTT (Message Queuing Telemetry Transport) is an instant messaging protocol developed by IBM. It is designed with lightness, openness, simplicity, and specification in mind, and is therefore easy to implement. These features make it a good choice for many scenarios, including constrained environments such as machine-to-machine communication (M2M) and Internet of Things environments (IoT) that require very small code packages or very expensive network bandwidth.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/10/38c2641314f74390a5502b4ba3898444.png" alt=""></p>
<p>The MQTT protocol is a protocol designed for the communication of a large number of remote sensors and control devices with limited computing power and operating on low-bandwidth, unreliable networks, and has several key features, as follows.</p>
<ul>
<li>Use Publish/Subscribe messaging model to provide one-to-many message distribution and decouple applications</li>
<li>Messaging with load content masking</li>
<li>Use TCP/IP to provide network connectivity</li>
<li>There are three message publishing service qualities
<ul>
<li>&ldquo;At most once&rdquo;, message distribution is completely dependent on the underlying TCP/IP network. Message loss or duplication can occur. This level can be used in the following cases, environmental sensor data, where it does not matter if a read record is lost once, because a second send will occur shortly afterwards.</li>
<li>&ldquo;At least once&rdquo; to ensure that the message arrives, but message duplication may occur.</li>
<li>&ldquo;Only once&rdquo; to ensure that the message arrives once. This level can be used in the following cases, where message duplication or loss can lead to incorrect results in a billing system</li>
</ul>
</li>
<li>Small transmissions with minimal overhead (fixed-length headers are 2 bytes) and minimal protocol switching to reduce network traffic</li>
<li>Mechanisms for notifying interested parties of abnormal client outages using Last Will and Testament features</li>
</ul>
<p>Simply put, the MQTT protocol is a lightweight instant messaging protocol. Because it is used in environments where the hardware and network are not so good, it does not require too much equipment to adapt to difficult environments. It also has to ensure the quality of message delivery, so there are three release quality modes (QoS)</p>
<p>It is natively conditioned on the application layer protocol based on TCP/IP to shield the specific data interaction format of message transmission. That is, do not care how the underlying layer is transmitted, what format is used for data transmission in the field of the Internet of Things (IoT, Internet of Things) will have a big development in the future.</p>
<h3 id="background-of-mqtt-development">Background of MQTT development</h3>
<p>Data transmission in IoT will face many problems, such as how to ensure that data is transmitted without problems when the network is unstable, how to ensure that data is not sent repeatedly, and how to reconnect when the connection is disconnected. In general, IoT access will face challenges in the following areas.</p>
<ul>
<li>Devices, sensors. IoT access has high requirements for terminal collection and control devices, and the transformation of terminals and the cost of network expenses are also relatively high. In addition, its energy consumption requirements for terminals are also relatively high.</li>
<li>Network. The existing network transmission loans are uneven and the transmission network is unstable.</li>
<li>Server. The access capability of multiple clients in the case of high concurrency and the message processing capability.</li>
</ul>
<h3 id="history-of-mqtt">History of MQTT</h3>
<p>In IoT, open source and open standards are essential elements. the history of MQTT development is roughly as follows.</p>
<ul>
<li>In 1999, IBM and partners co-invented the MQTT protocol.</li>
<li>In 2004, <a href="http://mqtt.org/">org</a> opened the forum for broad participation.</li>
<li>In 2011, IBM established the Eclipse open source project <a href="https://eclipse.org/paho/">Paho</a> and contributed code. Eclipse Paho is a Java implementation of MQTT.</li>
<li>In 2013, the OASIS MQTT Technical Specification Committee was formed.</li>
<li>In 2014, MQTT officially became the recommended IoT transport protocol standard.</li>
</ul>
<h2 id="mqtt-protocol">MQTT protocol</h2>
<p>Currently MQTT is used by everyone for mobile push, such as FacebookMessenger, and is suitable for mobile application devices because of its small size, power saving, low protocol overhead and ability to efficiently deliver messages to one and multiple recipients. The protocol is simple, with a minimum header of 2 bytes. Compared to XMPP, MQTT is more lightweight and consumes less bandwidth by the user. The overall protocol can be split into: fixed header + variable header + message body</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/10/705a5d4ebfb045578180432ddff47a30.png" alt=""></p>
<ul>
<li>The first byte is used to specify information about the message body.</li>
<li>The second byte is used to transmit the data we need to transmit.</li>
<li><a href="http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html#msg-format">See the protocol msg-format section for more details</a></li>
</ul>
<p><strong>MessageType(0 and 15 reserved, 4 bytes in total)</strong></p>
<ul>
<li>&ldquo;MQTT_CONNECT&rdquo;=&gt;1,//request for connection</li>
<li>&ldquo;MQTT_CONNACK&rdquo;=&gt;2,//Request for answer</li>
<li>&ldquo;MQTT_PUBLISH&rdquo;=&gt;3,//publish message</li>
<li>&ldquo;MQTT_PUBACK&rdquo;=&gt;4,//Publish answer</li>
<li>&ldquo;MQTT_PUBREC&rdquo;=&gt;5,//publish has been received, guaranteed to pass 1</li>
<li>&ldquo;MQTT_PUBREL&rdquo;=&gt;6,//released, guaranteed to pass 2</li>
<li>&ldquo;MQTT_PUBCOMP&rdquo;=&gt;7,//Release completed, pass 3 guaranteed</li>
<li>&ldquo;MQTT_SUBSCRIBE&rdquo;=&gt;8,//subscription request</li>
<li>&ldquo;MQTT_SUBACK&rdquo;=&gt;9,//subscription answer</li>
<li>&ldquo;MQTT_UNSUBSCRIBE&rdquo;=&gt;10,//unsubscribe</li>
<li>&ldquo;MQTT_UNSUBACK&rdquo;=&gt;11,//unsubscribe to answer</li>
<li>&ldquo;MQTT_PINGREQ&rdquo;=&gt;12,//ping request</li>
<li>&ldquo;MQTT_PINGRESP&rdquo;=&gt;13,//ping response</li>
<li>&ldquo;MQTT_DISCONNECT&rdquo;=&gt;14/disconnect</li>
</ul>
<p><strong>DUP flag</strong></p>
<p>Used to ensure reliable message transmission, if set to 1, the MessageId is added to the following variable header, and requires a reply confirmation to ensure that the message transmission is complete, but can not be used to detect duplicate messages sent.</p>
<p><strong>Qos</strong></p>
<p>Mainly used for PUBLISH (publish state) messages, to ensure the number of times the message is delivered.</p>
<ul>
<li>00 means at most once i.e. &lt;=1</li>
<li>01 means at least once i.e. &gt;=1</li>
<li>10 means once, i.e. == 1</li>
<li>11 is reserved and followed by</li>
</ul>
<p><strong>Retain</strong></p>
<p>Mainly used for PUBLISH (publish state) messages, indicating that the server wants to keep this push and push this message to it if a new subscriber appears. If not set then push to the currently subscribed is released.</p>
<p><strong>Fixed header byte 2</strong></p>
<p>is used to save the total size of the next variable header + message body. But it can not be saved directly, and is also scalable, the mechanism is the first 7 bits are used to save the length, the latter part is used for identification.</p>
<p>I gave an example, that is, if the size of the back of the calculation for 0 &lt; length &lt;= 127, normal preservation; if it is 127 &lt; length &lt; 16383, it is necessary to save two bytes, the first byte of the largest one position 1, that is, unfinished. Then the second byte continues to store.</p>
<p>Take 130, the first byte to store 10000011, the second byte to store 000000001, that is, 0x83, 0x01, the two bytes together to see, the second byte weight from 2 of 8 times to start. The same can be added to the third byte, up to the fourth byte. Therefore, the MQTT protocol can achieve up to 268 435 455 (0xFF, 0xFF, 0xFF, 0x7F) nearly 256M of data. It is possible to stretch and shrink.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/10/1e088a83f53a4014bc27626cebdd5bc3.png" alt=""></p>
<h2 id="using-mqtt">Using MQTT</h2>
<p>The architecture of the MQTT protocol is illustrated with an example. Let&rsquo;s say there is 1 temperature sensor (1 Machine), 2 small displays (2 Machines) and the display has to show the temperature value of the temperature sensor. Details of the detailed specification are available via <a href="http://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html">MQTT V3.1 Protocol Specification</a>.</p>
<p>The display needs to first subscribe to a topic called temperature via the MQTT protocol.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/10/6273d2054fd54274ae378e9527d65f7a.png" alt=""></p>
<p>When the temperature sensor publishes (publishes) the temperature data, the display can receive it.</p>
<p>There are 2 other main roles in the protocol.</p>
<ul>
<li>client, the client side</li>
<li>broker, the server side</li>
</ul>
<p>They are connected via the TCP/IP protocol. Because MQTT is a protocol, it cannot be used directly, as if it were the HTTP protocol. You need to find a library or server that implements this protocol to run it.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/mqtt/">mqtt</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/install-manjaro-linux/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Manjaro Linux installation and use</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/the-state-of-go-sync-2021/">
            <span class="next-text nav-default">Go Concurrent Programming Year in Review (2021)</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
