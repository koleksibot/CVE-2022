<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>PMML, JAVA calls Python algorithm model - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Most of the company&amp;rsquo;s applications are developed in JAVA, so it is very difficult to use Python models, but after searching online, we can convert the generated models into PMML files and call them directly in JAVA. PMML Introduction Predictive Model Markup Language (PMML) is an XML-based format standard for storing models proposed by Dr. Robert Lee Grossman. PMML provides a way for different data analysis software or programming languages" /><meta name="keywords" content="java, python, Pmml" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/pmml/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="PMML, JAVA calls Python algorithm model" />
<meta property="og:description" content="Most of the company&rsquo;s applications are developed in JAVA, so it is very difficult to use Python models, but after searching online, we can convert the generated models into PMML files and call them directly in JAVA. PMML Introduction Predictive Model Markup Language (PMML) is an XML-based format standard for storing models proposed by Dr. Robert Lee Grossman. PMML provides a way for different data analysis software or programming languages" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/pmml/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-11T18:51:47+08:00" />
<meta property="article:modified_time" content="2021-11-11T18:51:47+08:00" />

<meta itemprop="name" content="PMML, JAVA calls Python algorithm model">
<meta itemprop="description" content="Most of the company&rsquo;s applications are developed in JAVA, so it is very difficult to use Python models, but after searching online, we can convert the generated models into PMML files and call them directly in JAVA. PMML Introduction Predictive Model Markup Language (PMML) is an XML-based format standard for storing models proposed by Dr. Robert Lee Grossman. PMML provides a way for different data analysis software or programming languages"><meta itemprop="datePublished" content="2021-11-11T18:51:47+08:00" />
<meta itemprop="dateModified" content="2021-11-11T18:51:47+08:00" />
<meta itemprop="wordCount" content="1723">
<meta itemprop="keywords" content="java,python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PMML, JAVA calls Python algorithm model"/>
<meta name="twitter:description" content="Most of the company&rsquo;s applications are developed in JAVA, so it is very difficult to use Python models, but after searching online, we can convert the generated models into PMML files and call them directly in JAVA. PMML Introduction Predictive Model Markup Language (PMML) is an XML-based format standard for storing models proposed by Dr. Robert Lee Grossman. PMML provides a way for different data analysis software or programming languages"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">PMML, JAVA calls Python algorithm model</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-11 18:51:47 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1723 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#pmml-introduction">PMML Introduction</a>
          <ul>
            <li><a href="#role-of-pmml">Role of PMML</a></li>
            <li><a href="#benefits-of-pmml">Benefits of PMML</a></li>
            <li><a href="#disadvantages-of-pmml">Disadvantages of PMML</a></li>
          </ul>
        </li>
        <li><a href="#use-of-pmml">Use of PMML</a></li>
        <li><a href="#pmml-toolset">PMML toolset</a>
          <ul>
            <li><a href="#model-conversion-library-to-generate-pmml-files">Model conversion library to generate PMML files</a></li>
            <li><a href="#model-evaluation-library-read-pmml">Model evaluation library, read PMML</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Most of the company&rsquo;s applications are developed in JAVA, so it is very difficult to use Python models, but after searching online, we can convert the generated models into PMML files and call them directly in JAVA.</p>
<h2 id="pmml-introduction">PMML Introduction</h2>
<p>Predictive Model Markup Language (PMML) is an XML-based format standard for storing models proposed by Dr. Robert Lee Grossman. PMML provides a way for different data analysis software or programming languages to easily share predictive models. It supports common models, such as logistic regression and feedforward neural networks.</p>
<p>PMML is a platform- and environment-independent model representation language, and is the current de facto standard for representing machine learning models. From PMML 1.1, released in 2001, to the latest 4.4 in 2019, the PMML standard has been extended from the original 6 models to 17 models and provides Mining Models to combine multiple models. As an open and mature standard, PMML is developed and maintained by the Data Mining Group (DMG), a data mining organization, and has been widely used after more than a decade of development, with more than 30 vendors and open source projects (including SAS, IBM SPSS, KNIME, RapidMiner and other mainstream vendors) supporting and applying PMML in their data mining analysis products. support and apply PMML in their data mining analysis products.</p>
<h3 id="role-of-pmml">Role of PMML</h3>
<p>The go-live process of a machine learning mainly includes: analysis, feature engineering, model training, tuning, and go-live. Among them, the convenience of PMML is mainly reflected in the process of model go-live.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/11/503855b14e5d4a5283cb65486bdf28ad.png" alt=""></p>
<p>Model go-live is the process of effectively applying a trained model to a production environment. In general, there is a huge gap between the production environment and the environment used by data analysts.</p>
<p>For example, online DMPs are based on Hadoop, with Spark + MR as the computational framework, while offline people model mainly with R, sklearn libraries in Python, and partially with keras. translation process that is prone to errors and misrepresentations. In addition, engineering staff with a very deep understanding of the model structure is required. For example, migrating LR in R to Java requires engineering staff to write a JAVA class bare bones based on the parameters of the trained model.</p>
<p>The simplest LR, for example, is a data representation of a weight vector, and an activation function after multiplying the weight vector and the parameter vector. But a more complex model requires an engineer with a very deep understanding of the model structure to write the class strictly according to the computational logic of the model.</p>
<p>With PMML, it is easy to share models from application A to B to C, and to bring them online quickly after training is complete (simply by replacing the model files). The current practice is that offline analysts, after training a version of the model using R, etc., export it as PMML and simply replace that PMML file online.</p>
<p>PMML contains data pre-processing and data post-processing (i.e. processing of model prediction results) and the prediction model itself, see the following figure.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/11/11/290fa57efc034b799302c3ec83925654.png" alt=""></p>
<p>The structure of the PMML file follows the common steps used to build predictive models.</p>
<ul>
<li>Text header: contains basic information about the PMML document, such as the copyright information of the model, the description of the model, and information about the software used to generate the document (e.g., the name and version of the software). The header file will also contain the generation time of this PMML file.</li>
<li>Data dictionary: contains all the field names that may be used by the model. It also defines the types of the fields, which can be continuous, categorical, ordinal. and the type of field value, such as String, Double.</li>
<li>Data mining schema: Data mining schema, can be seen as a gatekeeper of the model. All data entering the model must go through the data mining schema. Each model contains and only contains one data mining schema for listing the data used by that model. Data mining schemas contain information that is different for a particular model, as opposed to the data dictionary where the definitions are stable and do not change as the model changes. The main purpose of a data mining schema is to list the data needed to use the model. The data mining schema also defines the usage of each field (activation, append, target) and the strategy for null values, illegal data.</li>
<li>Data transformation: The data transformation operation can be used to pre-process the data before it enters the model. PMML defines the following simple data transformation operations: normalization, discretization, value mapping, custom functions, aggregation.</li>
<li>Model: contains the definition and structural information of the model.</li>
<li>Output: defines the model output. For a classification task, the output can include the predicted classes and the probabilities associated with all possible classes.</li>
<li>Goal: defines the post-processing step applied to the model output. For a regression task, this step supports the transformation of the output into scores (predicted outcomes) that one can easily understand.</li>
<li>Model Interpretation: defines the performance metrics obtained when passing test data to the model (as opposed to training data). These metrics include field correlations, confusion matrices, gain plots, and receiver operating characteristic (ROC) plots.</li>
<li>Model validation: An example set containing the input data records and the expected model output is defined. This is a very important step because the model needs to pass the matching test when moving it between applications. This ensures that, when presented with the same inputs, the new system can generate the same outputs as the old system. If this is actually the case, a model will be considered validated and ready to be used in practice.</li>
</ul>
<h3 id="benefits-of-pmml">Benefits of PMML</h3>
<ul>
<li>Platform-independence. PMML allows the model deployment environment to be detached from the development environment, enabling cross-platform deployment, which is the biggest advantage of PMML that distinguishes it from other model deployment methods. For example, a model built in Python can be deployed in a Java production environment after exporting PMML.</li>
<li>Interoperability. This is the biggest advantage of the standard protocol, which implements that PMML-compatible prediction programs can read standard PMML models exported by other applications.</li>
<li>Broad supportability. Support has been obtained from over 30 vendors and open source projects, and many heavyweight popular open source data mining models can be converted to PMML through multiple open source libraries already available.</li>
<li>PMML models are XML-based text files that can be opened and viewed with any text editor, making them more secure and reliable than binary serialized files.</li>
</ul>
<h3 id="disadvantages-of-pmml">Disadvantages of PMML</h3>
<ul>
<li>Not all data pre-processing and post-processing operations are supported. Although PMML has supported almost all standard data processing methods, it lacks effective support for some user-defined operations, which are difficult to put into PMML.</li>
<li>Limited model type support. In particular, it lacks support for deep learning models. PMML will add support for deep models in the next version 0. Currently Nyoka can support deep models such as Keras, but the generated model is an extended PMML model.</li>
<li>PMML is a loose specification standard, some vendors generate PMML that may not quite match the Schema defined by the standard, and the PMML specification allows vendors to add their own extensions, all of which create some barriers to using these models.</li>
</ul>
<h2 id="use-of-pmml">Use of PMML</h2>
<p>Using LightGBM as an example.</p>
<p><strong>Export the generated model to txt format</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>

<span class="n">iris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;xml/iris.csv&#34;</span><span class="p">)</span>
<span class="n">d_x</span> <span class="o">=</span> <span class="n">iris_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">d_y</span> <span class="o">=</span> <span class="n">iris_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span>
    <span class="n">boosting_type</span><span class="o">=</span><span class="s1">&#39;gbdt&#39;</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s2">&#34;multiclass&#34;</span><span class="p">,</span> <span class="n">nthread</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span><span class="mi">3</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">d_x</span><span class="p">,</span><span class="n">d_y</span><span class="p">,</span><span class="n">feature_name</span><span class="o">=</span><span class="n">iris_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">booster_</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="s2">&#34;xml/lightgbm.txt&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Convert the txt model to pmml format using the tool</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">converter</span><span class="o">-</span><span class="n">executable</span><span class="o">-</span><span class="mf">1.2</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="n">jar</span>  <span class="o">--</span><span class="n">lgbm</span><span class="o">-</span><span class="nb">input</span> <span class="n">lightgbm</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">pmml</span><span class="o">-</span><span class="n">output</span> <span class="n">lightgbm</span><span class="o">.</span><span class="n">pmml</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>called directly in JAVA code</strong></p>
<p>Note, you need to introduce the following rack package before calling: <a href="https://github.com/jpmml/jpmml-evaluator">https://github.com/jpmml/jpmml-evaluator</a>, sample code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.pmmldemo.test</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.dmg.pmml.FieldName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.dmg.pmml.PMML</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jpmml.evaluator.Evaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jpmml.evaluator.FieldValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jpmml.evaluator.InputField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jpmml.evaluator.ModelEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jpmml.evaluator.ModelEvaluatorFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jpmml.evaluator.TargetField</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PMMLPrediction</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span>  <span class="n">pathxml</span><span class="o">=</span><span class="s">&#34;lightgbm.pmml&#34;</span><span class="o">;</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span>  <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;();</span>
        <span class="c1">//拼装模型参数
</span><span class="c1"></span>        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;sepal_length&#34;</span><span class="o">,</span> <span class="n">5</span><span class="o">.</span><span class="na">1</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;sepal_width&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">.</span><span class="na">5</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;petal_length&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">.</span><span class="na">4</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;petal_width&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">.</span><span class="na">2</span><span class="o">);</span>    
        <span class="n">predictLrHeart</span><span class="o">(</span><span class="n">map</span><span class="o">,</span> <span class="n">pathxml</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">predictLrHeart</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">irismap</span><span class="o">,</span><span class="n">String</span>  <span class="n">pathxml</span><span class="o">)</span><span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
 
        <span class="n">PMML</span> <span class="n">pmml</span><span class="o">;</span>
        <span class="c1">// 模型导入
</span><span class="c1"></span>        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">pathxml</span><span class="o">);</span>
        <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">pmml</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">jpmml</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">PMMLUtil</span><span class="o">.</span><span class="na">unmarshal</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
 
            <span class="n">ModelEvaluatorFactory</span> <span class="n">modelEvaluatorFactory</span> <span class="o">=</span> <span class="n">ModelEvaluatorFactory</span>
                    <span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
            <span class="n">ModelEvaluator</span><span class="o">&lt;?&gt;</span> <span class="n">modelEvaluator</span> <span class="o">=</span> <span class="n">modelEvaluatorFactory</span>
                    <span class="o">.</span><span class="na">newModelEvaluator</span><span class="o">(</span><span class="n">pmml</span><span class="o">);</span>
            <span class="n">Evaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="o">(</span><span class="n">Evaluator</span><span class="o">)</span> <span class="n">modelEvaluator</span><span class="o">;</span>
 
            <span class="n">List</span><span class="o">&lt;</span><span class="n">InputField</span><span class="o">&gt;</span> <span class="n">inputFields</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">getInputFields</span><span class="o">();</span>
            <span class="c1">// 过模型的原始特征，从画像中获取数据，作为模型输入
</span><span class="c1"></span>            <span class="n">Map</span><span class="o">&lt;</span><span class="n">FieldName</span><span class="o">,</span> <span class="n">FieldValue</span><span class="o">&gt;</span> <span class="n">arguments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">InputField</span> <span class="n">inputField</span> <span class="o">:</span> <span class="n">inputFields</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">FieldName</span> <span class="n">inputFieldName</span> <span class="o">=</span> <span class="n">inputField</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">Object</span> <span class="n">rawValue</span> <span class="o">=</span> <span class="n">irismap</span>
                        <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">inputFieldName</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
                <span class="n">FieldValue</span> <span class="n">inputFieldValue</span> <span class="o">=</span> <span class="n">inputField</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">rawValue</span><span class="o">);</span>
                <span class="n">arguments</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">inputFieldName</span><span class="o">,</span> <span class="n">inputFieldValue</span><span class="o">);</span>
            <span class="o">}</span>
 
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">FieldName</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">arguments</span><span class="o">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">TargetField</span><span class="o">&gt;</span> <span class="n">targetFields</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">getTargetFields</span><span class="o">();</span>
            <span class="c1">//对于分类问题等有多个输出。
</span><span class="c1"></span>            <span class="k">for</span> <span class="o">(</span><span class="n">TargetField</span> <span class="n">targetField</span> <span class="o">:</span> <span class="n">targetFields</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">FieldName</span> <span class="n">targetFieldName</span> <span class="o">=</span> <span class="n">targetField</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">Object</span> <span class="n">targetFieldValue</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">targetFieldName</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;target: &#34;</span> <span class="o">+</span> <span class="n">targetFieldName</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span>
                        <span class="o">+</span> <span class="s">&#34; value: &#34;</span> <span class="o">+</span> <span class="n">targetFieldValue</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="pmml-toolset">PMML toolset</h2>
<h3 id="model-conversion-library-to-generate-pmml-files">Model conversion library to generate PMML files</h3>
<p>Python models.</p>
<ul>
<li><a href="https://github.com/SoftwareAG/nyoka">Nyoka</a>, which supports Scikit-Learn, LightGBM, XGBoost, Statsmodels, and Keras.</li>
<li><a href="https://github.com/jpmml/jpmml-xgboost">JPMML series</a>, such as <a href="https://github.com/jpmml/sklearn2pmml">JPMML-SkLearn</a>, [JPMML-XGBoost](https: //github.com/jpmml/jpmml-xgboost), <a href="https://github.com/jpmml/jpmml-lightgbm">JPMML-LightGBM</a>, etc., which provide command line programs to export models to PMML.</li>
</ul>
<p>R models.</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/pmml/index.html">R pmml package</a></li>
<li><a href="https://github.com/jpmml/r2pmml">r2pmml</a></li>
<li><a href="https://github.com/jpmml/jpmml-r">JPMML-R</a></li>
</ul>
<p>Spark.</p>
<ul>
<li><a href="https://github.com/jpmml/jpmml-sparkml">JPMML-SparkML</a></li>
</ul>
<h3 id="model-evaluation-library-read-pmml">Model evaluation library, read PMML</h3>
<p>Java.</p>
<ul>
<li><a href="https://github.com/jpmml/jpmml-evaluator">JPMML-Evaluator</a>, a pure Java PMML prediction library, the open source protocol is AGPL V3.</li>
<li><a href="https://github.com/autodeployai/pmml4s">PMML4S</a>, developed in Scala, easy to use in Scala and Java, simple and good interface, open source protocol is the commonly used loose protocol Apache 2.</li>
</ul>
<p>Python:</p>
<ul>
<li><a href="https://github.com/autodeployai/pypmml">PyPMML</a>, Python library calls PMML, PyPMML is a Python interface wrapped by PMML4S.</li>
</ul>
<p>Spark.</p>
<ul>
<li><a href="https://github.com/jpmml/jpmml-evaluator-spark">JPMML-Evaluator-Spark</a></li>
<li><a href="https://github.com/autodeployai/pmml4s-spark">PMML4S-Spark</a></li>
</ul>
<p>PySpark:</p>
<ul>
<li><a href="https://github.com/autodeployai/pypmml-spark">PyPMML-Spark</a></li>
</ul>
<p>REST API:</p>
<ul>
<li><a href="https://github.com/autodeployai/ai-serving">AI-Serving</a>, both REST API and gRPC API for PMML models, open source protocol Apache 2.</li>
<li><a href="https://github.com/openscoring/openscoring">Openscoring</a>, providing REST API, open source protocol AGPL V3.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/java/">java</a>
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/python-collections/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python Module: Container DatatypesCollections</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/cygwin-mingw-msys/">
            <span class="next-text nav-default">Cygwin/MinGW/MSys/WSL differences and links</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
