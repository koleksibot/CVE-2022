<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Describing Kubernetes Applications Using Programming Languages - cdk8s - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="cdk8s is a new framework released by AWS Labs written in TypeScript that allows us to define resource lists for Kubernetes using a number of object-oriented programming languages. cdk8s also ends up generating native Kubernetes YAML files, so we can use cdk8s to define running Kubernetes application resources from anywhere. Introduction The concept of constructs is provided in cdk8s, and they are abstractions of Kubernetes resource objects (Deployment, Service, Ingress," /><meta name="keywords" content="k8s, cdk8s" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-11/use-cdk8s-define-k8s-apps/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Describing Kubernetes Applications Using Programming Languages - cdk8s" />
<meta property="og:description" content="cdk8s is a new framework released by AWS Labs written in TypeScript that allows us to define resource lists for Kubernetes using a number of object-oriented programming languages. cdk8s also ends up generating native Kubernetes YAML files, so we can use cdk8s to define running Kubernetes application resources from anywhere. Introduction The concept of constructs is provided in cdk8s, and they are abstractions of Kubernetes resource objects (Deployment, Service, Ingress," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-11/use-cdk8s-define-k8s-apps/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-21T20:08:53+08:00" />
<meta property="article:modified_time" content="2021-11-21T20:08:53+08:00" />

<meta itemprop="name" content="Describing Kubernetes Applications Using Programming Languages - cdk8s">
<meta itemprop="description" content="cdk8s is a new framework released by AWS Labs written in TypeScript that allows us to define resource lists for Kubernetes using a number of object-oriented programming languages. cdk8s also ends up generating native Kubernetes YAML files, so we can use cdk8s to define running Kubernetes application resources from anywhere. Introduction The concept of constructs is provided in cdk8s, and they are abstractions of Kubernetes resource objects (Deployment, Service, Ingress,"><meta itemprop="datePublished" content="2021-11-21T20:08:53+08:00" />
<meta itemprop="dateModified" content="2021-11-21T20:08:53+08:00" />
<meta itemprop="wordCount" content="1720">
<meta itemprop="keywords" content="k8s," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Describing Kubernetes Applications Using Programming Languages - cdk8s"/>
<meta name="twitter:description" content="cdk8s is a new framework released by AWS Labs written in TypeScript that allows us to define resource lists for Kubernetes using a number of object-oriented programming languages. cdk8s also ends up generating native Kubernetes YAML files, so we can use cdk8s to define running Kubernetes application resources from anywhere. Introduction The concept of constructs is provided in cdk8s, and they are abstractions of Kubernetes resource objects (Deployment, Service, Ingress,"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Describing Kubernetes Applications Using Programming Languages - cdk8s</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-21 20:08:53 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1720 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#use">Use</a></li>
        <li><a href="#comparison">Comparison</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://github.com/awslabs/cdk8s">cdk8s</a> is a new framework released by AWS Labs written in TypeScript that allows us to define resource lists for Kubernetes using a number of object-oriented programming languages. cdk8s also ends up generating native Kubernetes YAML files, so we can use cdk8s to define running Kubernetes application resources from anywhere.</p>
<h2 id="introduction">Introduction</h2>
<p>The concept of constructs is provided in cdk8s, and they are abstractions of Kubernetes resource objects (Deployment, Service, Ingress, etc.). A defined Kubernetes application is a structure tree, with an App structure at the root of the tree. Within the application, we can define any number of charts (charts, similar to the Helm Chart template), each of which is merged into a separate Kubernetes resource manifest file, and the charts are composed of any number of constructs in turn, culminating in a Kubernetes resource objects.</p>
<p>Note, however, that cdk8s only defines the Kubernetes application and does not install the application into the cluster. When you execute an application with cdk8s, it merges all the charts defined in the application into the dist directory, and then we can use <code>kubectl apply -f dist/chart.k8syaml</code> or other GitOps tools to install these charts into the Kubernetes cluster.</p>
<h2 id="use">Use</h2>
<p>Currently cdk8s supports the use of both TypeScript and Python programming languages to define Kubernetes applications. Here we take the more familiar Python as an example to illustrate the basic use of cdk8s.</p>
<p>cdk8s has a relatively lightweight CLI tool that contains a number of useful commands. We can start by installing the cdk8s CLI globally, which can be done in two ways.</p>
<ul>
<li>For Mac systems, the installation can be done directly using the Homebrew tool.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ brew install cdk8s
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Alternatively, you can use the npm tool to install (which relies on Node.js).</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ npm install -g cdk8s-cli
</code></pre></td></tr></table>
</div>
</div><p>Once the installation is complete we can create a cdk8s application using the <code>cdk8s</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ mkdir hello <span class="o">&amp;&amp;</span> <span class="nb">cd</span> hello
<span class="c1"># cdk8s init TYPE - TYPE 表示项目类型：python-app 或者 typescript-app</span>
$ cdk8s init python-app   
Initializing a project from the python-app template
Pipfile.lock not found, creating…
Locking <span class="o">[</span>dev-packages<span class="o">]</span> dependencies…
Locking <span class="o">[</span>packages<span class="o">]</span> dependencies…
Updated Pipfile.lock <span class="o">(</span>a65489<span class="o">)</span>!
Installing dependencies from Pipfile.lock <span class="o">(</span>a65489<span class="o">)</span>…
  🐍   ▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉ 0/0 — 00:00:00
To activate this project<span class="s1">&#39;s virtualenv, run the following:
</span><span class="s1"> $ pipenv shell
</span><span class="s1">Installing cdk8s~=0.19.0…
</span><span class="s1">Requirement already satisfied: cdk8s~=0.19.0 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (0.19.0)
</span><span class="s1">Requirement already satisfied: constructs&lt;3.0.0,&gt;=2.0.1 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from cdk8s~=0.19.0) (2.0.1)
</span><span class="s1">Requirement already satisfied: publication&gt;=0.0.3 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from cdk8s~=0.19.0) (0.0.3)
</span><span class="s1">Requirement already satisfied: jsii~=1.1.0 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from cdk8s~=0.19.0) (1.1.1)
</span><span class="s1">Requirement already satisfied: cattrs&gt;=1.0.0 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from jsii~=1.1.0-&gt;cdk8s~=0.19.0) (1.0.0)
</span><span class="s1">Requirement already satisfied: typing-extensions&gt;=3.6.4 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from jsii~=1.1.0-&gt;cdk8s~=0.19.0) (3.7.4.2)
</span><span class="s1">Requirement already satisfied: python-dateutil in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from jsii~=1.1.0-&gt;cdk8s~=0.19.0) (2.8.1)
</span><span class="s1">Requirement already satisfied: attrs&gt;=18.2 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from jsii~=1.1.0-&gt;cdk8s~=0.19.0) (19.3.0)
</span><span class="s1">Requirement already satisfied: six&gt;=1.5 in /Users/ych/.virtualenvs/hello-ndJXVB8W/lib/python3.7/site-packages (from python-dateutil-&gt;jsii~=1.1.0-&gt;cdk8s~=0.19.0) (1.14.0)
</span><span class="s1">
</span><span class="s1">Adding cdk8s~=0.19.0 to Pipfile&#39;</span>s <span class="o">[</span>packages<span class="o">]</span>…
Pipfile.lock <span class="o">(</span>a65489<span class="o">)</span> out of date, updating to <span class="o">(</span>eea701<span class="o">)</span>…
Locking <span class="o">[</span>dev-packages<span class="o">]</span> dependencies…
Locking <span class="o">[</span>packages<span class="o">]</span> dependencies…
Updated Pipfile.lock <span class="o">(</span>eea701<span class="o">)</span>!
Installing dependencies from Pipfile.lock <span class="o">(</span>eea701<span class="o">)</span>…
  🐍   ▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉ 9/9 — 00:00:02
To activate this project<span class="err">&#39;</span>s virtualenv, run the following:
 $ pipenv <span class="nv">shell</span>
<span class="o">========================================================================================================</span>

 Your cdk8s Python project is ready!

   cat <span class="nb">help</span>      Prints this message
   cdk8s synth   Synthesize k8s manifests to dist/
   cdk8s import  Imports k8s API objects to <span class="s2">&#34;imports/k8s&#34;</span>

  Deploy:
   kubectl apply -f dist/*.k8s.yaml

<span class="o">========================================================================================================</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>During the initialization process, I found that I needed a higher Node version, I&rsquo;m using v13.5.0 here, and I also needed a global proxy because I needed to get some K8S API objects during the initialization process.</p>
</blockquote>
<p>Once initialization is complete we can look at the basic structure of the project.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">$ tree .
.
├── Pipfile
├── Pipfile.lock
├── cdk8s.yaml
├── dist
│   └── hello.k8s.yaml
├── help
├── imports
│   └── k8s
│       ├── __init__.py
│       ├── _jsii
│       │   ├── __init__.py
│       │   └── k8s@0.0.0.jsii.tgz
│       └── py.typed
└── main.py

4 directories, 10 files
</code></pre></td></tr></table>
</div>
</div><p>Now we can open the <code>main.py</code> file, which looks like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">constructs</span> <span class="kn">import</span> <span class="n">Construct</span>
<span class="kn">from</span> <span class="nn">cdk8s</span> <span class="kn">import</span> <span class="n">App</span><span class="p">,</span> <span class="n">Chart</span>


<span class="k">class</span> <span class="nc">MyChart</span><span class="p">(</span><span class="n">Chart</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">Construct</span><span class="p">,</span> <span class="n">ns</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>

        <span class="c1"># define resources here</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">App</span><span class="p">()</span>
<span class="n">MyChart</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&#34;hello&#34;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">synth</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>The above code shows that the application is composed in the form of a structure tree, where a structure is an abstract composable unit. The project we initialized above using the <code>cdk8s init</code> command defines a single empty chart.</p>
<p>When we run <code>cdk8s synth</code>, a Kubernetes resource list will be composed for each Chart in the application and written to the dist directory. We can test this with the command shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ cdk8s synth
dist/hello.k8s.yaml
$ cat dist/hello.k8s.yaml
$ <span class="c1"># 空内容</span>
</code></pre></td></tr></table>
</div>
</div><p>Next, we define some Kubernetes API objects in the diagram. Similar to charts and apps, Kubernetes API objects are represented as structures in cdk8s. These structures can be imported into the project using the <code>cdk8s import</code> command, and then we can find them in the project directory under the <code>imports/k8s</code> module.</p>
<p>When we initialize the project with cdk8s, we have actually performed the <code>cdk8s import</code> operation, so we can see some information under the <code>imports</code> directory, which we can commit to source to manage, or we can go and generate it during the build process.</p>
<p>Let&rsquo;s define a simple Kubernetes application with Deployment and Service resource objects by modifying the <code>main.py</code> code to look like this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">constructs</span> <span class="kn">import</span> <span class="n">Construct</span>
<span class="kn">from</span> <span class="nn">cdk8s</span> <span class="kn">import</span> <span class="n">App</span><span class="p">,</span> <span class="n">Chart</span>

<span class="kn">from</span> <span class="nn">imports</span> <span class="kn">import</span> <span class="n">k8s</span>  <span class="c1"># 导入由 cdk8s import 命令生成的特定 k8s 版本的资源对象</span>


<span class="k">class</span> <span class="nc">MyChart</span><span class="p">(</span><span class="n">Chart</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">scope</span><span class="p">:</span> <span class="n">Construct</span><span class="p">,</span>  <span class="c1"># 我们的app实例</span>
            <span class="n">ns</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># 需要注意的是这里并不是 k8s 的 namespace，只是我们资源的一个前缀而已</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>

        <span class="c1"># 定义一些变量</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;app&#34;</span><span class="p">:</span> <span class="s2">&#34;hello-k8s&#34;</span><span class="p">}</span>
        
        <span class="c1"># 定义带有一个容器两个副本的Deployment资源对象</span>
        <span class="n">k8s</span><span class="o">.</span><span class="n">Deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;deployment&#39;</span><span class="p">,</span>
                        <span class="n">spec</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">DeploymentSpec</span><span class="p">(</span>
                            <span class="n">replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">selector</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">LabelSelector</span><span class="p">(</span><span class="n">match_labels</span><span class="o">=</span><span class="n">label</span><span class="p">),</span>
                            <span class="n">template</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">PodTemplateSpec</span><span class="p">(</span>
                                <span class="n">metadata</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">ObjectMeta</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">label</span><span class="p">),</span>
                                <span class="n">spec</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">PodSpec</span><span class="p">(</span><span class="n">containers</span><span class="o">=</span><span class="p">[</span>
                                    <span class="n">k8s</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
                                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello-k8s&#39;</span><span class="p">,</span>
                                        <span class="n">image</span><span class="o">=</span><span class="s1">&#39;paulbouwer/hello-kubernetes:1.7&#39;</span><span class="p">,</span>
                                        <span class="n">ports</span><span class="o">=</span><span class="p">[</span><span class="n">k8s</span><span class="o">.</span><span class="n">ContainerPort</span><span class="p">(</span><span class="n">container_port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)]</span>
                                    <span class="p">)</span>
                                <span class="p">])</span>
                            <span class="p">)</span>
                        <span class="p">))</span>
        <span class="c1"># 定义一个关联上述 Pod 的 Service 对象</span>
        <span class="n">k8s</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;service&#39;</span><span class="p">,</span> 
                    <span class="n">spec</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">ServiceSpec</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;NodePort&#39;</span><span class="p">,</span>
                        <span class="n">ports</span><span class="o">=</span><span class="p">[</span><span class="n">k8s</span><span class="o">.</span><span class="n">ServicePort</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">target_port</span><span class="o">=</span><span class="n">k8s</span><span class="o">.</span><span class="n">IntOrString</span><span class="o">.</span><span class="n">from_number</span><span class="p">(</span><span class="mi">8080</span><span class="p">))],</span>
                        <span class="n">selector</span><span class="o">=</span><span class="n">label</span>
                        <span class="p">)</span>
                    <span class="p">)</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">App</span><span class="p">()</span>  <span class="c1"># 创建一个 App 实例</span>
<span class="n">MyChart</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&#34;hello&#34;</span><span class="p">)</span> 

<span class="n">app</span><span class="o">.</span><span class="n">synth</span><span class="p">()</span>  <span class="c1"># 该方法负责生成生成k8s资源清单文件</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we execute the <code>cdk8s synth</code> command, which will generate a list of resources in the dist directory as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ cdk8s synth
dist/hello.k8s.yaml
$ cat dist/hello.k8s.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: hello-deployment-c51e9e6b
spec:
  replicas: <span class="m">2</span>
  selector:
    matchLabels:
      app: hello-k8s
  template:
    metadata:
      labels:
        app: hello-k8s
    spec:
      containers:
        - image: paulbouwer/hello-kubernetes:1.7
          name: hello-k8s
          ports:
            - containerPort: <span class="m">8080</span>
---
apiVersion: v1
kind: Service
metadata:
  name: hello-service-9878228b
spec:
  ports:
    - port: <span class="m">80</span>
      targetPort: <span class="m">8080</span>
  selector:
    app: hello-k8s
  type: NodePort
</code></pre></td></tr></table>
</div>
</div><p>Once the resource list has been generated, we can use the kubectl command to install the application directly:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl apply -f dist/hello.k8s.yaml
deployment.apps/hello-deployment-c51e9e6b created
service/hello-service-9878228b created
</code></pre></td></tr></table>
</div>
</div><p>At this point we are done defining a simple Kubernetes application using cdk8s.</p>
<h2 id="comparison">Comparison</h2>
<p>Some readers may feel that cdk8s has little advantage over tools like Helm or kustomize, and that these tools do not require us to write the actual code, but use the template language directly, which is true for current use, but when the application is particularly complex, we will also feel the limitations of tools like Helm, after all After all, it is more engineering to describe the application in a programming language, and there is more logic to implement. And I think the combination of cdk8s and DevOps has the advantage of allowing developers to take over Ops tasks, and as the infrastructure becomes more fluid and complex, the need for a more engineered deployment process for applications is clearly growing. However, the cdk8s project is still in its early days and is not recommended for production environments, but this idea of using a programming language to describe the application is still very interesting.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://cdk8s.io/">https://cdk8s.io/</a></li>
<li><a href="https://cdk8s.io/getting-started/python">https://cdk8s.io/getting-started/python</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/k8s/">k8s</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-11/use-nodelocal-dns-cache/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Using NodeLocal DNSCache in a Kubernetes Cluster</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-11/docker-jupyterhub/">
            <span class="next-text nav-default">Docker installation of multi-user version of JupyterHub</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
