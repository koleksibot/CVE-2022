<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Browser Gzip Compression - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="The zilb library and file compression in Node.js Three compression algorithms supported by zlib: gzip, deflate, and brotli. Basic usage examples. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import zlib from &amp;#39;zlib&amp;#39;; function zip(str, encoding = &amp;#39;gzip&amp;#39;) { str = typeof str === &amp;#39;string&amp;#39; ?" /><meta name="keywords" content="Browser, Gzip" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-09/browser-gzip-compression/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Browser Gzip Compression" />
<meta property="og:description" content="The zilb library and file compression in Node.js Three compression algorithms supported by zlib: gzip, deflate, and brotli. Basic usage examples. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import zlib from &#39;zlib&#39;; function zip(str, encoding = &#39;gzip&#39;) { str = typeof str === &#39;string&#39; ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-09/browser-gzip-compression/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-09-21T13:28:10+08:00" />
<meta property="article:modified_time" content="2021-09-21T13:28:10+08:00" />

<meta itemprop="name" content="Browser Gzip Compression">
<meta itemprop="description" content="The zilb library and file compression in Node.js Three compression algorithms supported by zlib: gzip, deflate, and brotli. Basic usage examples. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import zlib from &#39;zlib&#39;; function zip(str, encoding = &#39;gzip&#39;) { str = typeof str === &#39;string&#39; ?"><meta itemprop="datePublished" content="2021-09-21T13:28:10+08:00" />
<meta itemprop="dateModified" content="2021-09-21T13:28:10+08:00" />
<meta itemprop="wordCount" content="996">
<meta itemprop="keywords" content="gzip,browser," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Browser Gzip Compression"/>
<meta name="twitter:description" content="The zilb library and file compression in Node.js Three compression algorithms supported by zlib: gzip, deflate, and brotli. Basic usage examples. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import zlib from &#39;zlib&#39;; function zip(str, encoding = &#39;gzip&#39;) { str = typeof str === &#39;string&#39; ?"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Browser Gzip Compression</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-09-21 13:28:10 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 996 words </span>
          <span class="more-meta"> 2 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#the-zilb-library-and-file-compression-in-nodejs">The zilb library and file compression in Node.js</a></li>
        <li><a href="#implementing-zip-compression-in-the-browser-using-the-third-party-library-pako">Implementing zip compression in the browser using the third-party library pako</a></li>
        <li><a href="#compressing-and-decompressing-folders-using-compressing">Compressing and decompressing folders using compressing</a></li>
        <li><a href="#implementing-zip-file-compression-in-the-browser-using-jszip">Implementing zip file compression in the browser using JSZip</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="the-zilb-library-and-file-compression-in-nodejs">The zilb library and file compression in Node.js</h2>
<p>Three compression algorithms supported by zlib: <code>gzip</code>, <code>deflate</code>, and <code>brotli</code>. Basic usage examples.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">zlib</span> <span class="nx">from</span> <span class="s1">&#39;zlib&#39;</span><span class="p">;</span>
 
<span class="kd">function</span> <span class="nx">zip</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">encoding</span> <span class="o">=</span> <span class="s1">&#39;gzip&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">str</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">?</span> <span class="nx">str</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
 
  <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;deflate&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">zlib</span><span class="p">.</span><span class="nx">deflateSync</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;brotli&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">zlib</span><span class="p">.</span><span class="nx">brotliCompressSync</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">zlib</span><span class="p">.</span><span class="nx">gzipSync</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kd">function</span> <span class="nx">upzip</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">encoding</span> <span class="o">=</span> <span class="s1">&#39;gzip&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">buffer</span> <span class="k">instanceof</span> <span class="nx">Buffer</span> <span class="o">?</span> <span class="nx">buffer</span> <span class="o">:</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;gzip&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// const buf = zlib.gunzipSync(buffer);
</span><span class="c1"></span>      <span class="nx">zlib</span><span class="p">.</span><span class="nx">gunzip</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">buffer</span><span class="o">:</span> <span class="nx">error</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">buf</span> <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;deflate&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// const buf = zlib.inflateSync(buffer);
</span><span class="c1"></span>      <span class="nx">zlib</span><span class="p">.</span><span class="nx">inflate</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">buffer</span><span class="o">:</span> <span class="nx">error</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">buf</span> <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;brotli&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// const buf = zlib.brotliDecompressSync(buffer);
</span><span class="c1"></span>      <span class="nx">zlib</span><span class="p">.</span><span class="nx">brotliDecompress</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">buffer</span><span class="o">:</span> <span class="nx">error</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">buf</span> <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above is a simple implementation of three different compression algorithms, <code>gzip</code>, <code>deflate</code> and <code>brotli</code>. How efficient is their compression? Let&rsquo;s write a script to simply test.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">genRandomStrs</span><span class="p">(</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">range</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">range</span><span class="p">)</span> <span class="o">+</span> <span class="mi">32</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kr">async</span> <span class="kd">function</span> <span class="nx">zlibTest</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">charsRange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">];</span>
  <span class="kr">const</span> <span class="nx">testDataLens</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">];</span> <span class="c1">// 1_000_000
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">algorithmList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span> <span class="s1">&#39;deflate&#39;</span><span class="p">,</span> <span class="s1">&#39;brotli&#39;</span><span class="p">];</span>
  <span class="kr">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="p">{};</span>
 
  <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">range</span> <span class="k">of</span> <span class="nx">charsRange</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">stats</span><span class="p">[</span><span class="sb">`charsRange-`</span> <span class="o">+</span> <span class="nx">range</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
 
      <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">len</span> <span class="k">of</span> <span class="nx">testDataLens</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">testStr</span> <span class="o">=</span> <span class="nx">genRandomStrs</span><span class="p">(</span><span class="nx">len</span><span class="p">,</span> <span class="nx">range</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span> <span class="nx">item</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">size</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">len</span><span class="p">);</span>
 
        <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">algo</span> <span class="k">of</span> <span class="nx">algorithmList</span><span class="p">)</span> <span class="p">{</span>
          <span class="kr">const</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">zip</span><span class="p">(</span><span class="nx">testStr</span><span class="p">,</span> <span class="nx">algo</span><span class="p">);</span>
          <span class="kr">const</span> <span class="nx">cLen</span> <span class="o">=</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span>
          <span class="kr">const</span> <span class="nx">rate</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">cLen</span> <span class="o">/</span> <span class="nx">len</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">[</span><span class="nx">algo</span><span class="p">])</span> <span class="nx">item</span><span class="p">[</span><span class="nx">algo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="nx">item</span><span class="p">[</span><span class="nx">algo</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">rate</span><span class="p">);</span>
          <span class="c1">// const d = await upzip(buf, algo);
</span><span class="c1"></span>        <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stats</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="nx">zlibTest</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/09/21/14ca8f3e03ea4f8bb0e24d77d75d938c.png" alt=""></p>
<p>It can be seen that.</p>
<ul>
<li>The compression efficiency is in the order of: <code>brotli</code> &gt; <code>deflate</code> &gt; <code>gzip</code> when the character range is small (high repetition)</li>
<li>Under the same conditions, the larger the text (more repetitive characters), the higher the compression rate</li>
<li>The compression efficiency is basically the same for larger text ranges.</li>
</ul>
<p>Simply put, the more repetitive strings, the higher the compressibility. If conditions allow, <code>brotli</code> is the appropriate choice, but gzip has better general support in various scenarios.</p>
<h2 id="implementing-zip-compression-in-the-browser-using-the-third-party-library-pako">Implementing zip compression in the browser using the third-party library pako</h2>
<p>A <code>zlib</code> implementation library that supports use in the browser, claiming to be faster than the <code>zlib</code> libraries that come with Node.JS 12 and 14.</p>
<p>Here is an example of a browser-side implementation of text zip, unzip compression.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">pako</span> <span class="nx">from</span> <span class="s1">&#39;pako&#39;</span><span class="p">;</span>
<span class="c1">// 也可以通过在页面中直接加载 CDN 的脚本测试
</span><span class="c1">// &lt;script src=&#34;https://cdn.staticfile.org/pako/1.0.10/pako.min.js&#34;&gt;&lt;/script&gt;
</span><span class="c1"></span> 
<span class="kd">function</span> <span class="nx">gzip</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">str</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">str</span> <span class="o">!==</span> <span class="nx">str</span><span class="p">)</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringfiy</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
 
  <span class="c1">// 返回值为 utf16 编码，浏览器中对该编码字符串的读写可能会出现异常
</span><span class="c1"></span>  <span class="c1">// 这里也可以用 pako.zip，它是对 pako.deflate 的一个包装方法
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">compressed</span>  <span class="o">=</span> <span class="nx">pako</span><span class="p">.</span><span class="nx">deflate</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="p">{</span><span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">});</span>
  <span class="c1">// 转换为 base64 编码
</span><span class="c1"></span>  <span class="nx">constt</span> <span class="nx">strBase64</span> <span class="o">=</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">compressed</span><span class="p">);</span>
 
  <span class="k">return</span> <span class="nx">strBase64</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kd">function</span> <span class="nx">unGzip</span><span class="p">(</span><span class="nx">strBase64</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 也可以用 pako.ungzip，它们执行的是相同的方法逻辑
</span><span class="c1"></span>  <span class="k">return</span> <span class="nx">pako</span><span class="p">.</span><span class="nx">inflate</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">strBase64</span><span class="p">),</span> <span class="p">{</span><span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>More details can be found in their official documentation: <a href="http://nodeca.github.io/pako/">http://nodeca.github.io/pako/</a></p>
<h2 id="compressing-and-decompressing-folders-using-compressing">Compressing and decompressing folders using compressing</h2>
<p>The above analyzes the <code>zlib</code> based file compression scheme. For folder compression, it involves file traversal of directories and subdirectories and archiving of all files, which requires more details to be handled. We can simply implement the requirements with the help of a third-party toolkit.</p>
<p><code>compressing</code> is a relatively popular Node.js compression and decompression toolkit that provides an easy-to-use API. The following are examples.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">compressing</span> <span class="nx">from</span> <span class="s1">&#39;compressing&#39;</span><span class="p">;</span>
 
<span class="c1">// zip 压缩一个目录
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">zip</span><span class="p">.</span><span class="nx">compressDir</span><span class="p">(</span><span class="s1">&#39;./lzwme-test&#39;</span><span class="p">,</span> <span class="s1">&#39;lzwme-test.zip&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
<span class="c1">// zip 解压
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">zip</span><span class="p">.</span><span class="nx">uncompress</span><span class="p">(</span><span class="s1">&#39;lzwme-test.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;./lzwme-test&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
 
<span class="c1">// tar 目录归档
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">tar</span><span class="p">.</span><span class="nx">compressDir</span><span class="p">(</span><span class="s1">&#39;./lzwme-test&#39;</span><span class="p">,</span> <span class="s1">&#39;lzwme-test.tar&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
<span class="c1">// tar 归档解压
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">tar</span><span class="p">.</span><span class="nx">uncompress</span><span class="p">(</span><span class="s1">&#39;lzwme-test.tar&#39;</span><span class="p">,</span> <span class="s1">&#39;./lzwme-test&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
 
<span class="c1">// gzip 压缩
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">gzip</span><span class="p">.</span><span class="nx">compressFile</span><span class="p">(</span><span class="s1">&#39;./lzwme-test.tar&#39;</span><span class="p">,</span> <span class="s1">&#39;lzwme-test.tar.gz&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
<span class="c1">// gzip 解压
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">gzip</span><span class="p">.</span><span class="nx">uncompress</span><span class="p">(</span><span class="s1">&#39;lzwme-test.tar.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;./lzwme-test&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
 
<span class="c1">// tgz 压缩与解压（先 tar 对文件夹归档，再 gzip 对 tar 文件压缩）
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">tgz</span><span class="p">.</span><span class="nx">compressDir</span><span class="p">(</span><span class="s1">&#39;./lzwme-test&#39;</span><span class="p">,</span> <span class="s1">&#39;lzwme-test.tar.gz&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
<span class="c1">// tgz 解压
</span><span class="c1"></span><span class="nx">compressing</span><span class="p">.</span><span class="nx">tgz</span><span class="p">.</span><span class="nx">uncompress</span><span class="p">(</span><span class="s1">&#39;lzwme-test.tar.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;./lzwme-test&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="implementing-zip-file-compression-in-the-browser-using-jszip">Implementing zip file compression in the browser using JSZip</h2>
<p>JSZip supports zip compression and download of files on the browser-only side. The API is also easy to understand. It also supports use under Node.js.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">JSZip</span> <span class="nx">from</span> <span class="s1">&#39;jszip&#39;</span><span class="p">;</span>
 
<span class="kr">const</span> <span class="nx">zip</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JSZip</span><span class="p">();</span>
<span class="nx">zip</span><span class="p">.</span><span class="nx">file</span><span class="p">(</span><span class="s2">&#34;Hello.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;Hello World\n&#34;</span><span class="p">);</span>
 
<span class="kr">const</span> <span class="nx">img</span> <span class="o">=</span> <span class="nx">zip</span><span class="p">.</span><span class="nx">folder</span><span class="p">(</span><span class="s2">&#34;images&#34;</span><span class="p">);</span>
<span class="nx">img</span><span class="p">.</span><span class="nx">file</span><span class="p">(</span><span class="s2">&#34;smile.gif&#34;</span><span class="p">,</span> <span class="nx">imgData</span><span class="p">,</span> <span class="p">{</span><span class="nx">base64</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
 
<span class="nx">zip</span><span class="p">.</span><span class="nx">generateAsync</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="s2">&#34;blob&#34;</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// see FileSaver.js
</span><span class="c1"></span>    <span class="nx">saveAs</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s2">&#34;example.zip&#34;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>For more detailed usage, please refer to its official example: <a href="https://stuk.github.io/jszip/documentation/examples.html">https://stuk.github.io/jszip/documentation/examples.html</a></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/gzip/">gzip</a>
          <a href="/tags/browser/">browser</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-09/update-to-webpack5/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Project upgrade to webpack5 Practices and Summary</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-09/react17-document-addeventlistener/">
            <span class="next-text nav-default">Analysis and handling of document.addEventListener exceptions after upgrading React16 to React17</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
