<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Ways to send STMP-based emails with MS Exchange using node.js - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article describes how node.js can send emails based on the STMP protocol and the MS Exchange Web Service (EWS) protocol. All reference code in this article is coded in TypeScript examples. STMP protocol-based approach to sending emails with node.js When it comes to sending emails using node.js, the famous Nodemailer module is basically mentioned as the first choice for sending emails using the STMP method. There are many articles" /><meta name="keywords" content="nodejs, smtp, email" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-09/nodejs-stmp-exchange-email-send/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Ways to send STMP-based emails with MS Exchange using node.js" />
<meta property="og:description" content="This article describes how node.js can send emails based on the STMP protocol and the MS Exchange Web Service (EWS) protocol. All reference code in this article is coded in TypeScript examples. STMP protocol-based approach to sending emails with node.js When it comes to sending emails using node.js, the famous Nodemailer module is basically mentioned as the first choice for sending emails using the STMP method. There are many articles" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-09/nodejs-stmp-exchange-email-send/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-09-22T16:25:24+08:00" />
<meta property="article:modified_time" content="2021-09-22T16:25:24+08:00" />

<meta itemprop="name" content="Ways to send STMP-based emails with MS Exchange using node.js">
<meta itemprop="description" content="This article describes how node.js can send emails based on the STMP protocol and the MS Exchange Web Service (EWS) protocol. All reference code in this article is coded in TypeScript examples. STMP protocol-based approach to sending emails with node.js When it comes to sending emails using node.js, the famous Nodemailer module is basically mentioned as the first choice for sending emails using the STMP method. There are many articles"><meta itemprop="datePublished" content="2021-09-22T16:25:24+08:00" />
<meta itemprop="dateModified" content="2021-09-22T16:25:24+08:00" />
<meta itemprop="wordCount" content="1825">
<meta itemprop="keywords" content="nodejs,smtp,email," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ways to send STMP-based emails with MS Exchange using node.js"/>
<meta name="twitter:description" content="This article describes how node.js can send emails based on the STMP protocol and the MS Exchange Web Service (EWS) protocol. All reference code in this article is coded in TypeScript examples. STMP protocol-based approach to sending emails with node.js When it comes to sending emails using node.js, the famous Nodemailer module is basically mentioned as the first choice for sending emails using the STMP method. There are many articles"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Ways to send STMP-based emails with MS Exchange using node.js</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-09-22 16:25:24 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1825 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#stmp-protocol-based-approach-to-sending-emails-with-nodejs">STMP protocol-based approach to sending emails with node.js</a></li>
        <li><a href="#ms-exchange-mail-server-based-nodejs-method-for-sending-emails">MS Exchange mail server based node.js method for sending emails</a>
          <ul>
            <li><a href="#sending-ms-exchange-emails-with-node-ews">Sending MS Exchange emails with node-ews</a></li>
            <li><a href="#sending-ms-exchange-emails-using-ews-javascript-api">Sending MS Exchange emails using ews-javascript-api</a></li>
          </ul>
        </li>
        <li><a href="#extended-reference">Extended Reference</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>This article describes how node.js can send emails based on the <code>STMP</code> protocol and the <code>MS Exchange Web Service (EWS)</code> protocol. All reference code in this article is coded in TypeScript examples.</p>
<h2 id="stmp-protocol-based-approach-to-sending-emails-with-nodejs">STMP protocol-based approach to sending emails with node.js</h2>
<p>When it comes to sending emails using node.js, the famous <code>Nodemailer</code> module is basically mentioned as the first choice for sending emails using the <code>STMP</code> method.
There are many articles on sending STMP protocol emails based on <code>NodeMailer</code>, and the official documentation is quite detailed, so here is just the sample code for comparison.</p>
<p>Wrapping a <code>sendMail</code> mail delivery method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="cm">/**
</span><span class="cm"> * 使用 Nodemailer 发送 STMP 邮件
</span><span class="cm"> * @param {Object} opts 邮件发送配置
</span><span class="cm"> * @param {Object} smtpCfg smtp 服务器配置
</span><span class="cm"> */</span>
<span class="kr">async</span> <span class="kd">function</span> <span class="nx">sendMail</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">smtpCfg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">resultInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">code</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="o">:</span> <span class="kc">null</span> <span class="p">};</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">smtpCfg</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;未配置邮件发送信息&#39;</span><span class="p">;</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1009</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">resultInfo</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="c1">// 创建一个邮件对象
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">mailOpts</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="c1">// 发件人
</span><span class="c1"></span>      <span class="nx">from</span><span class="o">:</span> <span class="sb">`Notify &lt;</span><span class="si">${</span><span class="nx">smtpCfg</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">user</span><span class="si">}</span><span class="sb">&gt;`</span><span class="p">,</span>
      <span class="c1">// 主题
</span><span class="c1"></span>      <span class="nx">subject</span><span class="o">:</span> <span class="s1">&#39;Notify&#39;</span><span class="p">,</span>
      <span class="c1">// text: opts.content,
</span><span class="c1"></span>      <span class="c1">// html: opts.content,
</span><span class="c1"></span>      <span class="c1">// 附件内容
</span><span class="c1"></span>      <span class="c1">// /*attachments: [{
</span><span class="c1"></span>      <span class="c1">//       filename: &#39;data1.json&#39;,
</span><span class="c1"></span>      <span class="c1">//       path: path.resolve(__dirname, &#39;data1.json&#39;)
</span><span class="c1"></span>      <span class="c1">//   }, {
</span><span class="c1"></span>      <span class="c1">//       filename: &#39;pic01.jpg&#39;,
</span><span class="c1"></span>      <span class="c1">//       path: path.resolve(__dirname, &#39;pic01.jpg&#39;)
</span><span class="c1"></span>      <span class="c1">//   }, {
</span><span class="c1"></span>      <span class="c1">//       filename: &#39;test.txt&#39;,
</span><span class="c1"></span>      <span class="c1">//       path: path.resolve(__dirname, &#39;test.txt&#39;)
</span><span class="c1"></span>      <span class="c1">//   }],*/
</span><span class="c1"></span>    <span class="p">},</span>
    <span class="nx">opts</span>
  <span class="p">);</span>
 
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">)</span> <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">))</span> <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
  <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">m</span> <span class="p">=&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="nx">m</span><span class="p">).</span><span class="nx">trim</span><span class="p">()).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">m</span> <span class="p">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">));</span>
 
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;未配置邮件接收者&#39;</span><span class="p">;</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1010</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">resultInfo</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="kr">const</span> <span class="nx">mailToList</span> <span class="o">=</span> <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">transporter</span> <span class="o">=</span> <span class="nx">nodemailer</span><span class="p">.</span><span class="nx">createTransport</span><span class="p">(</span><span class="nx">smtpCfg</span><span class="p">);</span>
 
  <span class="c1">// to 列表分开发送
</span><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">to</span> <span class="k">of</span> <span class="nx">mailToList</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">to</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">info</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">transporter</span><span class="p">.</span><span class="nx">sendMail</span><span class="p">(</span><span class="nx">mailOpts</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;mail sent to:&#39;</span><span class="p">,</span> <span class="nx">mailOpts</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span> <span class="s1">&#39; response:&#39;</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">info</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1001</span><span class="p">;</span>
      <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
 
  <span class="k">return</span> <span class="nx">resultInfo</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>To send a message using the <code>sendMail</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">subject</span><span class="o">:</span> <span class="s1">&#39;subject for test&#39;</span><span class="p">,</span>
    <span class="cm">/** HTML 格式邮件正文内容 */</span>
    <span class="nx">html</span><span class="o">:</span> <span class="sb">`email content for test: &lt;a href=&#34;https://lzw.me&#34;&gt;https://lzw.me&lt;/a&gt;`</span><span class="p">,</span>
    <span class="cm">/** TEXT 文本格式邮件正文内容 */</span>
    <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;xxx@lzw.me&#39;</span><span class="p">,</span>
    <span class="c1">// 附件列表
</span><span class="c1"></span>    <span class="c1">// attachments: [],
</span><span class="c1"></span><span class="p">};</span>
<span class="kr">const</span> <span class="nx">smtpConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;smtp.qq.com&#39;</span><span class="p">,</span> <span class="c1">//QQ: smtp.qq.com; 网易: smtp.163.com
</span><span class="c1"></span>    <span class="nx">port</span><span class="o">:</span> <span class="mi">465</span><span class="p">,</span> <span class="c1">//端口号。QQ邮箱  465，网易邮箱 25
</span><span class="c1"></span>    <span class="nx">secure</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">auth</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;xxx@qq.com&#39;</span><span class="p">,</span> <span class="c1">//邮箱账号
</span><span class="c1"></span>      <span class="nx">pass</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">//邮箱的授权码
</span><span class="c1"></span>    <span class="p">},</span>
<span class="p">};</span>
<span class="nx">sendMail</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">smtpConfig</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ms-exchange-mail-server-based-nodejs-method-for-sending-emails">MS Exchange mail server based node.js method for sending emails</h2>
<p>For mail services built with Microsoft&rsquo;s <code>Microsoft Exchange Server</code>, <code>Nodemailer</code> cannot do anything about it. The <code>Exchange Web Service (EWS)</code> provides an interface to Exchange resources and is documented in detail in the official Microsoft documentation. Popular third-party libraries for Exchange mail services are <code>node-ews</code> and <code>ews-javascript-api</code>.</p>
<h3 id="sending-ms-exchange-emails-with-node-ews">Sending MS Exchange emails with node-ews</h3>
<p>The following is an example of using the node-ews module to send emails using the Exchange mail service.</p>
<h4 id="wrapping-a-method-for-sending-emails-based-on-node-ews">Wrapping a method for sending emails based on node-ews</h4>
<p>Wrapping a <code>sendMailByNodeEws</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">EWS</span> <span class="nx">from</span> <span class="s1">&#39;node-ews&#39;</span><span class="p">;</span>
 
<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">IEwsSendOptions</span> <span class="p">{</span>
    <span class="nx">auth</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">user</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
        <span class="nx">pass</span><span class="o">?:</span> <span class="nx">string</span><span class="p">;</span>
        <span class="cm">/** 密码加密后的秘钥(NTLMAuth.nt_password)。为字符串时，应为 hex 编码结果 */</span>
        <span class="nx">nt_password</span><span class="o">?:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">Buffer</span><span class="p">;</span>
        <span class="cm">/** 密码加密后的秘钥(NTLMAuth.lm_password)。为字符串时，应为 hex 编码结果 */</span>
        <span class="nx">lm_password</span><span class="o">?:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">Buffer</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="cm">/** Exchange 地址 */</span>
    <span class="nx">host</span><span class="o">?:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="cm">/** 邮件主题 */</span>
    <span class="nx">subject</span><span class="o">?:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="cm">/** HTML 格式邮件正文内容 */</span>
    <span class="nx">html</span><span class="o">?:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="cm">/** TEXT 文本格式邮件正文内容(优先级低于 html 参数) */</span>
    <span class="nx">text</span><span class="o">?:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nx">to</span><span class="o">?:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="cm">/**
</span><span class="cm"> * 使用 Exchange(EWS) 发送邮件
</span><span class="cm"> */</span>
<span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">sendMailByNodeEws</span><span class="p">(</span><span class="nx">options</span><span class="o">:</span> <span class="nx">IEwsSendOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resultInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">code</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="o">:</span> <span class="kc">null</span> <span class="p">};</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1001</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Options can not be null&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1002</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Options.auth{user,pass} can not be null&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">user</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">pass</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">lm_password</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1003</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Options.auth.user or Options.auth.password can not be null&#39;</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="k">return</span> <span class="nx">resultInfo</span><span class="p">;</span>
 
    <span class="kr">const</span> <span class="nx">ewsConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">username</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span>
        <span class="nx">password</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">pass</span><span class="p">,</span>
        <span class="nx">nt_password</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">nt_password</span><span class="p">,</span>
        <span class="nx">lm_password</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">lm_password</span><span class="p">,</span>
        <span class="nx">host</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
        <span class="c1">// auth: &#39;basic&#39;,
</span><span class="c1"></span>    <span class="p">};</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">nt_password</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">nt_password</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">nt_password</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">nt_password</span><span class="p">,</span> <span class="s1">&#39;hex&#39;</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">lm_password</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">lm_password</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">lm_password</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">ewsConfig</span><span class="p">.</span><span class="nx">lm_password</span><span class="p">,</span> <span class="s1">&#39;hex&#39;</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">ewsConfig</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ewsConfig</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="k">delete</span> <span class="nx">ewsConfig</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">});</span>
 
    <span class="c1">// initialize node-ews
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">ews</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EWS</span><span class="p">(</span><span class="nx">ewsConfig</span><span class="p">);</span>
    <span class="c1">// define ews api function
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">ewsFunction</span> <span class="o">=</span> <span class="s1">&#39;CreateItem&#39;</span><span class="p">;</span>
    <span class="c1">// define ews api function args
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">ewsArgs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">MessageDisposition</span><span class="o">:</span> <span class="s1">&#39;SendAndSaveCopy&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">SavedItemFolderId</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">DistinguishedFolderId</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">Id</span><span class="o">:</span> <span class="s1">&#39;sentitems&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="nx">Items</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">Message</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">ItemClass</span><span class="o">:</span> <span class="s1">&#39;IPM.Note&#39;</span><span class="p">,</span>
                <span class="nx">Subject</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">subject</span><span class="p">,</span>
                <span class="nx">Body</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">BodyType</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">html</span> <span class="o">?</span> <span class="s1">&#39;HTML&#39;</span> <span class="o">:</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="nx">$value</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">html</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="nx">ToRecipients</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">Mailbox</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">EmailAddress</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="nx">IsRead</span><span class="o">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">};</span>
 
    <span class="k">try</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">ews</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">ewsFunction</span><span class="p">,</span> <span class="nx">ewsArgs</span><span class="p">);</span>
        <span class="c1">// console.log(&#39;mail sent to:&#39;, options.to, &#39; response:&#39;, result);
</span><span class="c1"></span>        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">ResponseMessages</span><span class="p">.</span><span class="nx">MessageText</span><span class="p">)</span> <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">ResponseMessages</span><span class="p">.</span><span class="nx">MessageText</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="mi">1001</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="nx">resultInfo</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>To send a message using the <code>sendMailByNodeEws</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">sendMailByNodeEws</span><span class="p">({</span>
       <span class="nx">auth</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;abc@xxx.com&#39;</span><span class="p">,</span>
        <span class="nx">pass</span><span class="o">:</span> <span class="s1">&#39;123456&#39;</span><span class="p">,</span>
        <span class="cm">/** 密码加密后的秘钥(NTLMAuth.nt_password)。为字符串时，应为 hex 编码结果 */</span>
        <span class="nx">nt_password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="cm">/** 密码加密后的秘钥(NTLMAuth.lm_password)。为字符串时，应为 hex 编码结果 */</span>
        <span class="nx">lm_password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="cm">/** Exchange 地址 */</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;https://ews.xxx.com&#39;</span><span class="p">,</span>
    <span class="cm">/** 邮件主题 */</span>
    <span class="nx">subject</span><span class="o">:</span> <span class="s1">&#39;subject for test&#39;</span><span class="p">,</span>
    <span class="cm">/** HTML 格式邮件正文内容 */</span>
    <span class="nx">html</span><span class="o">:</span> <span class="sb">`email content for test: &lt;a href=&#34;https://lzw.me&#34;&gt;https://lzw.me&lt;/a&gt;`</span><span class="p">,</span>
    <span class="cm">/** TEXT 文本格式邮件正文内容(优先级低于 html 参数) */</span>
    <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;xxx@lzw.me&#39;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="ntlmauth-based-authentication-configuration-method">NTLMAuth-based authentication configuration method</h4>
<p>We can leave the pass field empty and configure the <code>nt_password</code> and <code>lm_password</code> fields to use the <code>NTLMAuth</code> authentication mode. These two fields are generated based on pass plaintext, and their nodejs generation can be done with the <code>httpntlm</code> module, as described below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ntlm</span> <span class="nx">as</span> <span class="nx">NTLMAuth</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;httpntlm&#39;</span><span class="p">;</span>
 
<span class="cm">/** 将输入的邮箱账号密码转换为 NTLMAuth 秘钥(hex)格式并输出 */</span>
<span class="kr">const</span> <span class="nx">getHashedPwd</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">passwordPlainText</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
 
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">passwordPlainText</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;USEAGE: \n\tnode get-hashed-pwd.js [password]&#39;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="kr">const</span> <span class="nx">nt_password</span> <span class="o">=</span> <span class="nx">NTLMAuth</span><span class="p">.</span><span class="nx">create_NT_hashed_password</span><span class="p">(</span><span class="nx">passwordPlainText</span><span class="p">.</span><span class="nx">trim</span><span class="p">());</span>
  <span class="kr">const</span> <span class="nx">lm_password</span> <span class="o">=</span> <span class="nx">NTLMAuth</span><span class="p">.</span><span class="nx">create_LM_hashed_password</span><span class="p">(</span><span class="nx">passwordPlainText</span><span class="p">.</span><span class="nx">trim</span><span class="p">());</span>
 
  <span class="c1">// console.log(&#39;\n password:&#39;, passwordPlainText);
</span><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">` nt_password:`</span><span class="p">,</span> <span class="nx">nt_password</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">));</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">` lm_password:`</span><span class="p">,</span> <span class="nx">lm_password</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">));</span>
 
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">nt_password</span><span class="p">,</span>
    <span class="nx">lm_password</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>
 
<span class="nx">getHashedPwd</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="sending-ms-exchange-emails-using-ews-javascript-api">Sending MS Exchange emails using ews-javascript-api</h3>
<p>Based on the <code>ews-javascript-api</code> way of sending emails, there is a relevant example in its official wiki, but I failed in the testing process, specifically because I could not get the server authentication, but also failed to check the specific reasons, so the following code is only for reference.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="cm">/**
</span><span class="cm"> * 使用 `ews-javascript-api` 发送(MS Exchange)邮件
</span><span class="cm"> */</span>
<span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">sendMailByEwsJApi</span><span class="p">(</span><span class="nx">options</span><span class="o">:</span> <span class="nx">IEwsSendOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resultInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">code</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="o">:</span> <span class="kc">null</span> <span class="p">};</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1001</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Options can not be null&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1002</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Options.auth{user,pass} can not be null&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">user</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">pass</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">lm_password</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1003</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Options.auth.user or Options.auth.password can not be null&#39;</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="kr">const</span> <span class="nx">ews</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ews-javascript-api&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">exch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ews</span><span class="p">.</span><span class="nx">ExchangeService</span><span class="p">(</span><span class="nx">ews</span><span class="p">.</span><span class="nx">ExchangeVersion</span><span class="p">.</span><span class="nx">Exchange2010</span><span class="p">);</span>
    <span class="nx">exch</span><span class="p">.</span><span class="nx">Credentials</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ews</span><span class="p">.</span><span class="nx">WebCredentials</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">pass</span><span class="p">);</span>
    <span class="nx">exch</span><span class="p">.</span><span class="nx">Url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ews</span><span class="p">.</span><span class="nx">Uri</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">host</span><span class="p">);</span>
    <span class="nx">ews</span><span class="p">.</span><span class="nx">EwsLogging</span><span class="p">.</span><span class="nx">DebugLogEnabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// false to turnoff debugging.
</span><span class="c1"></span> 
    <span class="kr">const</span> <span class="nx">msgattach</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ews</span><span class="p">.</span><span class="nx">EmailMessage</span><span class="p">(</span><span class="nx">exch</span><span class="p">);</span>
    <span class="nx">msgattach</span><span class="p">.</span><span class="nx">Subject</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">subject</span><span class="p">;</span>
    <span class="nx">msgattach</span><span class="p">.</span><span class="nx">Body</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ews</span><span class="p">.</span><span class="nx">MessageBody</span><span class="p">(</span><span class="nx">ews</span><span class="p">.</span><span class="nx">BodyType</span><span class="p">.</span><span class="nx">HTML</span><span class="p">,</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">html</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">text</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">to</span><span class="p">))</span> <span class="nx">options</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">to</span><span class="p">];</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">to</span> <span class="p">=&gt;</span> <span class="nx">msgattach</span><span class="p">.</span><span class="nx">ToRecipients</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">to</span><span class="p">));</span>
    <span class="c1">// msgattach.Importance = ews.Importance.High;
</span><span class="c1"></span> 
    <span class="c1">// 发送附件
</span><span class="c1"></span>    <span class="c1">// msgattach.Attachments.AddFileAttachment(&#39;filename to attach.txt&#39;, &#39;c29tZSB0ZXh0&#39;);
</span><span class="c1"></span> 
    <span class="k">try</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">msgattach</span><span class="p">.</span><span class="nx">SendAndSaveCopy</span><span class="p">();</span> <span class="c1">// .Send();
</span><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DONE!&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="mi">1001</span><span class="p">;</span>
        <span class="nx">resultInfo</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">resultInfo</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="extended-reference">Extended Reference</h2>
<ul>
<li><a href="https://nodemailer.com/about/">https://nodemailer.com/about/</a></li>
<li><a href="https://github.com/CumberlandGroup/node-ews">https://github.com/CumberlandGroup/node-ews</a></li>
<li><a href="https://github.com/gautamsi/ews-javascript-api/wiki/Send-Attachment">https://github.com/gautamsi/ews-javascript-api/wiki/Send-Attachment</a></li>
<li><a href="https://github.com/lzwme/node-exchange-mailer">https://github.com/lzwme/node-exchange-mailer</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/nodejs/">nodejs</a>
          <a href="/tags/smtp/">smtp</a>
          <a href="/tags/email/">email</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-09/migrate-from-oh-my-zsh-to-prezto/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Migrate From Oh My Zsh to Prezto</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-09/electron-crash-sentry/">
            <span class="next-text nav-default">Electron self-compiled application crash debugging analysis method</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
