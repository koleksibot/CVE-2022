<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>System information gathering and performance monitoring in Electron applications - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="When analyzing problems with Electron applications, relevant system operation information is sometimes essential, so naturally there is a need for system base information collection and operation performance monitoring. The native capabilities in Electron are based on Node.js, so most of the system data collection for Electron applications is based on the capabilities provided by Node.js. In Node.js applications, various system-related information can be obtained mainly through the process and os" /><meta name="keywords" content="Electron, nodejs, monitoring" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-09/electron-app-sysinfo-stats/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="System information gathering and performance monitoring in Electron applications" />
<meta property="og:description" content="When analyzing problems with Electron applications, relevant system operation information is sometimes essential, so naturally there is a need for system base information collection and operation performance monitoring. The native capabilities in Electron are based on Node.js, so most of the system data collection for Electron applications is based on the capabilities provided by Node.js. In Node.js applications, various system-related information can be obtained mainly through the process and os" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-09/electron-app-sysinfo-stats/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-09-22T15:58:03+08:00" />
<meta property="article:modified_time" content="2021-09-22T15:58:03+08:00" />

<meta itemprop="name" content="System information gathering and performance monitoring in Electron applications">
<meta itemprop="description" content="When analyzing problems with Electron applications, relevant system operation information is sometimes essential, so naturally there is a need for system base information collection and operation performance monitoring. The native capabilities in Electron are based on Node.js, so most of the system data collection for Electron applications is based on the capabilities provided by Node.js. In Node.js applications, various system-related information can be obtained mainly through the process and os"><meta itemprop="datePublished" content="2021-09-22T15:58:03+08:00" />
<meta itemprop="dateModified" content="2021-09-22T15:58:03+08:00" />
<meta itemprop="wordCount" content="2908">
<meta itemprop="keywords" content="electron,nodejs," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="System information gathering and performance monitoring in Electron applications"/>
<meta name="twitter:description" content="When analyzing problems with Electron applications, relevant system operation information is sometimes essential, so naturally there is a need for system base information collection and operation performance monitoring. The native capabilities in Electron are based on Node.js, so most of the system data collection for Electron applications is based on the capabilities provided by Node.js. In Node.js applications, various system-related information can be obtained mainly through the process and os"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">System information gathering and performance monitoring in Electron applications</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-09-22 15:58:03 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 2908 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#information-provided-by-the-process-module-in-nodejs">Information provided by the process module in Node.js</a></li>
        <li><a href="#information-about-the-process-module-extension-in-electron">Information about the process module extension in Electron</a></li>
        <li><a href="#statistical-methods-of-information-provided-by-electron">Statistical methods of information provided by electron</a></li>
        <li><a href="#information-provided-by-the-os-module-in-nodejs">Information provided by the os module in Node.js</a></li>
        <li><a href="#data-collection-and-analysis">Data collection and analysis</a></li>
        <li><a href="#nodejs-system-information-statistics-implementation-code-reference">Node.js system information statistics implementation code reference</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When analyzing problems with Electron applications, relevant system operation information is sometimes essential, so naturally there is a need for system base information collection and operation performance monitoring.</p>
<p>The native capabilities in Electron are based on Node.js, so most of the system data collection for Electron applications is based on the capabilities provided by Node.js. In Node.js applications, various system-related information can be obtained mainly through the <code>process</code> and <code>os</code> modules, which can be divided into static basic information and dynamically changing runtime information.</p>
<p>The following is a brief introduction to the information that may be used for statistical analysis of data.</p>
<h2 id="information-provided-by-the-process-module-in-nodejs">Information provided by the process module in Node.js</h2>
<ul>
<li><code>process.pid</code> The PID of the current process</li>
<li><code>process.ppid</code> The PID of the current process&rsquo;s parent process</li>
<li><code>process.platform</code> Returns a string identifying the OS platform on which the Node.js process is running</li>
<li><code>process.cwd()</code> Returns the current working directory of the application process</li>
<li><code>process.arch</code> The CPU architecture of the operating system on which the Node.js binary was compiled.</li>
<li><code>process.argv</code> Returns the array containing the command line arguments passed in when starting the Node.js process.</li>
<li><code>process.versions</code> returns the version information for Node.js and its dependencies</li>
<li><code>process.env</code> The environment variable for the application runtime environment.</li>
<li><a href="http://nodejs.cn/api/process.html#process_process_cpuusage_previousvalue">process.cpuUsage([previousValue])</a> in object with attributes user and system Returns the user and system CPU time usage of the current process in microseconds</li>
<li><a href="http://nodejs.cn/api/process.html#process_process_memoryusage">process.memoryUsage()</a> Returns an object describing the memory usage (in bytes) of the Node.js process
<ul>
<li><code>.heapTotal</code> and <code>.heapUsed</code> refer to the memory usage of V8.</li>
<li><code>.external</code> refers to the memory usage of C++ objects bound to JavaScript objects managed by V8.</li>
<li><code>.rss</code> resident set size, which is the amount of space occupied by the process in the main memory device (i.e., a subset of the total allocated memory), including all C++ and JavaScript objects and code.</li>
<li><code>.arrayBuffers</code> is the memory allocated for ArrayBuffer and SharedArrayBuffer, including all Node.js Buffer. This is also included in the external value. This value may be 0 when Node.js is used as an embedded library, as ArrayBuffer allocations may not be tracked in this case.</li>
</ul>
</li>
<li><a href="http://nodejs.cn/api/process.html#process_process_resourceusage">process.resourceUsage()</a> Returns the resource usage of the current process
<ul>
<li><a href="mailto:Node.js@12.6">Node.js@12.6</a>+ / <a href="mailto:Electron@7.x">Electron@7.x</a>+ only</li>
</ul>
</li>
<li><a href="http://nodejs.cn/api/process.html#process_process_uptime">process.uptime()</a> Returns the number of seconds the current <code>Node.js</code> process has been running</li>
</ul>
<h2 id="information-about-the-process-module-extension-in-electron">Information about the process module extension in Electron</h2>
<ul>
<li><code>process.resourcesPath</code> The path to the resource directory. You can count the location where the application was installed or started running</li>
<li><code>process.type</code> The type of the current process. Can be: <code>browser</code>, <code>renderer</code>, <code>worker</code></li>
<li><a href="https://www.electronjs.org/docs/api/process#processgetcpuusage">process.getCPUUsage()</a> Returns the CPU usage of the current process.</li>
<li><a href="https://www.electronjs.org/docs/api/process#processgetheapstatistics">process.getHeapStatistics()</a> Returns an object containing V8 heap statistics. All data values are in <code>KB</code> units</li>
<li><a href="https://www.electronjs.org/docs/api/process#processgetsystemmemoryinfo">process.getSystemMemoryInfo()</a> Returns an object that provides memory usage statistics for the entire system. The statistics are in <code>KB</code></li>
<li><a href="https://www.electronjs.org/docs/api/process#processgetprocessmemoryinfo">process.getProcessMemoryInfo()</a> Returns an object that provides memory usage statistics for the current process. The statistics are in <code>KB</code></li>
<li><a href="https://www.electronjs.org/docs/api/process#processgetblinkmemoryinfo">process.getBlinkMemoryInfo()</a>
<ul>
<li>Returns an object with Blink memory information. Can be used to debug rendering/DOM related memory issues. All values are in KB</li>
<li>Method added in <code>Electron@7+</code> version</li>
</ul>
</li>
</ul>
<h2 id="statistical-methods-of-information-provided-by-electron">Statistical methods of information provided by electron</h2>
<ul>
<li><a href="https://www.electronjs.org/docs/api/app#appgetappmetrics">electron.app.getAppMetrics()</a>
<ul>
<li>Returns <a href="https://www.electronjs.org/docs/api/structures/process-metric">ProcessMetric[]</a>: an array of ProcessMetric objects containing memory and CPU usage statistics for all processes associated with the application.</li>
<li>New <code>memory</code> field added only to <code>electron@7+</code>, contains memory usage statistics for all sub-processes</li>
</ul>
</li>
<li><a href="https://www.electronjs.org/docs/api/screen#screengetalldisplays">electron.screen.getAllDisplays()</a> returns an array of windows Display[], representing the currently available display windows .</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/09/22/13151afb5b0347e8b5870860770b7cc2.png" alt=""></p>
<h2 id="information-provided-by-the-os-module-in-nodejs">Information provided by the os module in Node.js</h2>
<ul>
<li><code>os.platform()</code> String identifier for the operating system platform, same as <code>process.platform</code></li>
<li><code>os.hostname()</code> hostname</li>
<li><code>os.homedir()</code> user home directory</li>
<li><code>os.type()</code> operating system kernel name</li>
<li><code>os.endianness()</code> Returns a string identifying the byte order of the CPU for which the Node.js binaries were compiled. Big Ending Order <code>BE</code>, Little Ending Order <code>LE</code>.</li>
<li><a href="http://nodejs.cn/api/os.html#os_os_cpus">os.cpus()</a> Returns an array of objects containing information about each logical CPU kernel.</li>
<li><code>os.uptime()</code> Returns the system uptime in seconds. Same as <code>process.uptime()</code></li>
<li><code>os.totalmem()</code> Total amount of memory. Same as <code>process.getSystemMemoryInfo().total</code></li>
<li><code>os.freemem()</code> The size of free memory. Same as <code>process.getSystemMemoryInfo().free</code></li>
<li><code>os.loadavg()</code> Average load for 1, 5 and 15 minutes. windows is always 0</li>
<li><code>os.release()</code> Returns the version number of the operating system as a string</li>
<li><code>os.tmpdir()</code> Returns the default directory of the operating system&rsquo;s temporary files as a string.</li>
<li><a href="http://nodejs.cn/api/os.html#os_os_networkinterfaces">os.networkInterfaces()</a> NIC information for the assigned URL</li>
<li><a href="http://nodejs.cn/api/os.html#os_os_userinfo_options">os.userInfo([options])</a> Returns information about the currently active user</li>
</ul>
<h2 id="data-collection-and-analysis">Data collection and analysis</h2>
<p>Based on the capabilities provided by the above APIs, combined with practical experience in actual testing, we have come up with some experiences summarized below.</p>
<p>Data classification. We can classify the information collected by statistics into static basic information and dynamic information. Static basic information, i.e. data that does not change, can be counted and recorded only once during initialization. Static information can be used to analyze the state of specific application operating environment. Dynamic information is the data that may change every time it is acquired. The performance analysis of the application is mainly based on the regular monitoring and collection of dynamic information.</p>
<p>Data formatting. The raw data collected is not intuitive enough to be used for data statistics, but some pre-formatting is required for direct display. Mainly including time consumption, memory size, CPU utilization three types of data, design the corresponding formatting auxiliary functions, after obtaining data for pre-processing can be. See the code examples below for details.</p>
<p>The APIs provide a lot of data. In the data collection and analysis based on application performance, the data that are dynamically monitored are mainly the CPU usage and memory usage of each process. Most of the data can be collected in the main process.</p>
<p>For the dynamically changing data, it needs to be collected at intervals according to certain strategies, and then it can be exported to the targeted analysis platform to draw the dynamically changing curves for observation and analysis.</p>
<h2 id="nodejs-system-information-statistics-implementation-code-reference">Node.js system information statistics implementation code reference</h2>
<p>The above information collection and analysis, a simple implementation of SysInfoStats statistics class for the regular collection of system information. The specific code reference is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">os</span> <span class="nx">from</span> <span class="s1">&#39;os&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">screen</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
 
<span class="cm">/** 将秒转换为日期 */</span>
<span class="kd">function</span> <span class="nx">formatSeconds</span><span class="p">(</span><span class="nx">seconds</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">seconds</span> <span class="o">=</span> <span class="nx">seconds</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="kr">const</span> <span class="nx">day</span> <span class="o">=</span> <span class="p">(</span><span class="nx">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">hours</span> <span class="o">=</span> <span class="p">((</span><span class="nx">seconds</span> <span class="o">-</span> <span class="nx">day</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="p">((</span><span class="nx">seconds</span> <span class="o">-</span> <span class="nx">day</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">-</span> <span class="nx">hours</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">second</span> <span class="o">=</span> <span class="nx">seconds</span> <span class="o">%</span> <span class="mi">60</span><span class="p">;</span>
 
    <span class="k">return</span> <span class="p">[</span><span class="nx">day</span><span class="p">,</span> <span class="nx">hours</span><span class="p">,</span> <span class="nx">minutes</span><span class="p">,</span> <span class="nx">second</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="nx">d</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kd">function</span> <span class="nx">formatMem</span><span class="p">(</span><span class="nx">mem</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mem</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">mem</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">)).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;G&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mem</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">mem</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;M&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mem</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">mem</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;KB&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">mem</span> <span class="o">+</span> <span class="s1">&#39;B&#39;</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kd">function</span> <span class="nx">formatMemForObject</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">unit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">keyof</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">as</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="err">/keyof&gt;&lt;keyof T, string&gt; ;</span>
 
    <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">k</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">d</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">formatMem</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="o">*</span> <span class="nx">unit</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kr">class</span> <span class="nx">SysInfoStats</span> <span class="p">{</span>
    <span class="cm">/** 基础信息，不会变化的 */</span>
    <span class="kr">public</span> <span class="nx">baseInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="cm">/** 当前进程的 PID */</span>
        <span class="nx">pid</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span><span class="p">,</span>
        <span class="cm">/** 当前进程的父进程的 PID */</span>
        <span class="nx">ppid</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">ppid</span><span class="p">,</span>
        <span class="cm">/** 程序启动位置 */</span>
        <span class="nx">cwd</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span>
        <span class="cm">/** 主机名 */</span>
        <span class="nx">hostname</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">(),</span>
        <span class="cm">/** 用户主目录 */</span>
        <span class="nx">homedir</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">homedir</span><span class="p">(),</span>
        <span class="cm">/** 系统架构 */</span>
        <span class="nx">arch</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">arch</span><span class="p">,</span>
        <span class="cm">/** 系统平台 Win32 */</span>
        <span class="nx">platform</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">||</span> <span class="nx">os</span><span class="p">.</span><span class="nx">platform</span><span class="p">(),</span>
        <span class="cm">/** 操作系统内核名 Windows_NT */</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">type</span><span class="p">(),</span>
        <span class="cm">/** 系统版本号 */</span>
        <span class="nx">release</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">release</span><span class="p">(),</span>
        <span class="cm">/** electron 相关的版本信息 */</span>
        <span class="nx">versions</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">versions</span><span class="p">,</span>
        <span class="cm">/** 字节序 */</span>
        <span class="nx">endianness</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">endianness</span><span class="p">(),</span>
        <span class="cm">/** 网卡信息 */</span>
        <span class="nx">get</span> <span class="nx">networkInterfaces</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">os</span><span class="p">.</span><span class="nx">networkInterfaces</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="cm">/** 显示器信息 **/</span>
        <span class="nx">get</span> <span class="nx">allDisplays</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">screen</span><span class="p">.</span><span class="nx">getAllDisplays</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="cm">/** 命令行参数 */</span>
        <span class="nx">argv</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">,</span>
        <span class="cm">/** 环境变量 */</span>
        <span class="nx">env</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="cm">/** 实时动态变更的信息 */</span>
    <span class="kr">public</span> <span class="nx">dynamicInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// /** 内存总量，同 sysMemoryInfo.total */
</span><span class="c1"></span>        <span class="c1">// totalmem: os.totalmem(),
</span><span class="c1"></span>        <span class="c1">// /** 空闲内存，同 sysMemoryInfo.free */
</span><span class="c1"></span>        <span class="c1">// freemem: os.freemem(),
</span><span class="c1"></span>        <span class="cm">/** 系统的正常运行时间（以秒为单位） */</span>
        <span class="nx">get</span> <span class="nx">uptime</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">uptime</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="cm">/** 1、5 和 15 分钟的平均负载。windows 始终为 0 */</span>
        <span class="nx">get</span> <span class="nx">loadavg</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">os</span><span class="p">.</span><span class="nx">loadavg</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="cm">/** memory usage statistics about the current process */</span>
        <span class="nx">processMemoryInfo</span><span class="o">:</span> <span class="kc">null</span> <span class="nx">as</span> <span class="nx">Electron</span><span class="p">.</span><span class="nx">ProcessMemoryInfo</span><span class="p">,</span>
        <span class="cm">/** memory usage statistics about the entire system. */</span>
        <span class="nx">get</span> <span class="nx">sysMemoryInfo</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">formatMemForObject</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">getSystemMemoryInfo</span><span class="p">(),</span> <span class="mi">1024</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="cm">/** V8 heap statistics. KB */</span>
        <span class="nx">get</span> <span class="nx">heapStatistics</span><span class="p">()</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">getHeapStatistics</span><span class="p">();</span>
            <span class="k">return</span> <span class="nx">formatMemForObject</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="cm">/** 内存使用量（以字节为单位） */</span>
        <span class="nx">get</span> <span class="nx">memoryUsage</span><span class="p">()</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">memoryUsage</span><span class="p">();</span>
            <span class="k">return</span> <span class="nx">formatMemForObject</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="cm">/** cpu 使用率 */</span>
        <span class="nx">get</span> <span class="nx">getCPUUsage</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">getCPUUsage</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="cm">/** 各子进程 cpu 占用率 */</span>
        <span class="nx">getAppMetrics</span><span class="p">()</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">appMetrics</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getAppMetrics</span><span class="p">();</span>
            <span class="k">return</span> <span class="nx">appMetrics</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">pid</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pid</span><span class="p">,</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
                    <span class="nx">percentCPUUsage</span><span class="o">:</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">percentCPUUsage</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span>
                    <span class="c1">// electron@7+ 才有 item.memory 信息
</span><span class="c1"></span>                    <span class="c1">// memory: formatMemForObject(item.memory, 1024),
</span><span class="c1"></span>                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="cm">/** cpu 信息 */</span>
        <span class="nx">get</span> <span class="nx">cpus</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">os</span><span class="p">.</span><span class="nx">cpus</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="cm">/** 资源占用情况 -- electron@7.x+ 才有 */</span>
        <span class="c1">// get resourceUsage() {
</span><span class="c1"></span>        <span class="c1">//    return process.resourceUsage();
</span><span class="c1"></span>        <span class="c1">// },
</span><span class="c1"></span>    <span class="p">};</span>
 
    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">statsBase</span><span class="p">();</span>
        <span class="c1">// this.statsDynamic();
</span><span class="c1"></span>        <span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="cm">/** 打印并写入日志 */</span>
    <span class="kr">private</span> <span class="nx">printLog</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[sysstats]&#39;</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kr">private</span> <span class="nx">intervalTimer</span><span class="o">:</span> <span class="nx">NodeJS</span><span class="p">.</span><span class="nx">Timeout</span><span class="p">;</span>
    <span class="cm">/**
</span><span class="cm">     * 执行定时统计
</span><span class="cm">     * @param intervalTime 定时器时间，默认为 5 分钟。小于 1000 表示停止
</span><span class="cm">     */</span>
    <span class="kr">public</span> <span class="nx">interval</span><span class="p">(</span><span class="nx">intervalTime</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">intervalTimer</span><span class="p">);</span>
 
        <span class="kr">const</span> <span class="nx">cInterval</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">((</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span> <span class="nx">as</span> <span class="nx">HippoEnv</span><span class="p">).</span><span class="nx">HIPPO_SYSSTATS_INTERVAL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cInterval</span><span class="p">)</span> <span class="nx">intervalTime</span> <span class="o">=</span> <span class="nx">cInterval</span><span class="p">;</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="nx">intervalTime</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">intervalTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">statsDynamic</span><span class="p">(),</span> <span class="nx">intervalTime</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="cm">/** 基本信息收集与打印 */</span>
    <span class="kr">public</span> <span class="nx">statsBase</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">msgList</span><span class="o">:</span> <span class="nx">string</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">baseInfo</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
 
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`\ncwd: </span><span class="si">${</span><span class="nx">baseInfo</span><span class="p">.</span><span class="nx">cwd</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="c1">// msgList.push(`Node.js 版本：${baseInfo.versions.node}`);
</span><span class="c1"></span>        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`cpu架构：</span><span class="si">${</span><span class="nx">baseInfo</span><span class="p">.</span><span class="nx">arch</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
 
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;操作系统内核：&#39;</span> <span class="o">+</span> <span class="nx">baseInfo</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;平台：&#39;</span> <span class="o">+</span> <span class="nx">baseInfo</span><span class="p">.</span><span class="nx">platform</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;主机名：&#39;</span> <span class="o">+</span> <span class="nx">baseInfo</span><span class="p">.</span><span class="nx">hostname</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;主目录：&#39;</span> <span class="o">+</span> <span class="nx">baseInfo</span><span class="p">.</span><span class="nx">homedir</span><span class="p">);</span>
 
        <span class="kr">const</span> <span class="nx">networkInterfaces</span> <span class="o">=</span> <span class="nx">baseInfo</span><span class="p">.</span><span class="nx">networkInterfaces</span><span class="p">;</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;*****网卡信息*******&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">networkInterfaces</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">networkInterfaces</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">:`</span><span class="p">);</span>
            <span class="nx">list</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`[</span><span class="si">${</span><span class="nx">idx</span><span class="si">}</span><span class="sb">][</span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="nx">cidr</span><span class="si">}</span><span class="sb">]:`</span><span class="p">);</span>
                <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`IP: </span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`NETMASK: </span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="nx">netmask</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`MAC: </span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="nx">mac</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`family: </span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="nx">family</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
                <span class="c1">// msgList.push(`远程访问：${obj.internal ? &#39;否&#39; : &#39;是&#39;}\n`);
</span><span class="c1"></span>            <span class="p">});</span>
        <span class="p">}</span>
 
        <span class="k">this</span><span class="p">.</span><span class="nx">printLog</span><span class="p">(</span><span class="s1">&#39;[base][overview]&#39;</span><span class="p">,</span> <span class="nx">msgList</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">printLog</span><span class="p">(</span><span class="s1">&#39;[base][json]\n&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseInfo</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseInfo</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/**
</span><span class="cm">     * 实时系统信息收集与打印
</span><span class="cm">     * @param printBase 是否打印固定不变的基础信息。构造函数内默认执行过一次，默认 false
</span><span class="cm">     * @returns
</span><span class="cm">     */</span>
    <span class="kr">public</span> <span class="kr">async</span> <span class="nx">statsDynamic</span><span class="p">(</span><span class="nx">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">printBase</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">printBase</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">statsBase</span><span class="p">();</span>
 
        <span class="kr">const</span> <span class="nx">sysInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dynamicInfo</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">msgList</span><span class="o">:</span> <span class="nx">string</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
 
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;\n运行时长：&#39;</span> <span class="o">+</span> <span class="nx">formatSeconds</span><span class="p">(</span><span class="nx">sysInfo</span><span class="p">.</span><span class="nx">uptime</span><span class="p">));</span>
 
        <span class="c1">// const sysMemoryInfo = sysInfo.sysMemoryInfo;
</span><span class="c1"></span>        <span class="c1">// msgList.push(&#39;内存大小：&#39; + sysMemoryInfo.total);
</span><span class="c1"></span>        <span class="c1">// msgList.push(&#39;空闲内存：&#39; + formatMem(sysMemoryInfo.free));
</span><span class="c1"></span> 
        <span class="c1">// electron@7+ 才有
</span><span class="c1"></span>        <span class="c1">// msgList.push(&#39;userCPUTime：&#39; + formatSeconds(sysInfo.resourceUsage.userCPUTime / (1000 * 1000)));
</span><span class="c1"></span>        <span class="c1">// msgList.push(&#39;systemCPUTime：&#39; + formatSeconds(sysInfo.resourceUsage.systemCPUTime / (1000 * 1000)));
</span><span class="c1"></span> 
        <span class="c1">// 内存用量
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">memoryUsage</span> <span class="o">=</span> <span class="nx">sysInfo</span><span class="p">.</span><span class="nx">memoryUsage</span><span class="p">;</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;*****memoryUsage*******&#39;</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`V8 内存总量:\t </span><span class="si">${</span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nx">heapTotal</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`V8 使用量:\t </span><span class="si">${</span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nx">heapUsed</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`C++对象内存:\t </span><span class="si">${</span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nx">external</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`主内存设备占用:\t </span><span class="si">${</span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nx">rss</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
 
        <span class="c1">// cpu
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">cpus</span> <span class="o">=</span> <span class="nx">sysInfo</span><span class="p">.</span><span class="nx">cpus</span><span class="p">;</span>
        <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;*****cpu信息*******&#39;</span><span class="p">);</span>
        <span class="nx">cpus</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cpu</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">_arr</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">times</span> <span class="o">=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nx">times</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">useageRate</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">times</span><span class="p">.</span><span class="nx">idle</span> <span class="o">/</span> <span class="p">(</span><span class="nx">times</span><span class="p">.</span><span class="nx">idle</span> <span class="o">+</span> <span class="nx">times</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="nx">times</span><span class="p">.</span><span class="nx">nice</span> <span class="o">+</span> <span class="nx">times</span><span class="p">.</span><span class="nx">sys</span> <span class="o">+</span> <span class="nx">times</span><span class="p">.</span><span class="nx">irq</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="sb">%`</span><span class="p">;</span>
            <span class="nx">msgList</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="sb">`cpu-</span><span class="si">${</span><span class="nx">idx</span><span class="si">}</span><span class="sb">：`</span><span class="p">,</span> <span class="sb">`使用率：</span><span class="si">${</span><span class="nx">useageRate</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="sb">`型号：</span><span class="si">${</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">model</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="sb">`频率：</span><span class="si">${</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">speed</span><span class="si">}</span><span class="sb">MHz`</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">));</span>
        <span class="p">});</span>
 
        <span class="nx">sysInfo</span><span class="p">.</span><span class="nx">processMemoryInfo</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProcessMemoryInfo</span><span class="p">();</span>
 
        <span class="k">this</span><span class="p">.</span><span class="nx">printLog</span><span class="p">(</span><span class="s1">&#39;[dynamicInfo][overview]&#39;</span> <span class="o">+</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">msgList</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">printLog</span><span class="p">(</span><span class="s1">&#39;[dynamicInfo][json]\n&#39;</span><span class="p">,</span> <span class="nx">sysInfo</span><span class="p">);</span>
 
        <span class="k">return</span> <span class="nx">msgList</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/** 获取当前进程的内存占用信息 */</span>
    <span class="kr">public</span> <span class="kr">async</span> <span class="nx">getProcessMemoryInfo</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">processMemoryInfo</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">process</span><span class="p">.</span><span class="nx">getProcessMemoryInfo</span><span class="p">();</span>
 
        <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">processMemoryInfo</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">k</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">processMemoryInfo</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">formatMem</span><span class="p">(</span><span class="nx">processMemoryInfo</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">dynamicInfo</span><span class="p">.</span><span class="nx">processMemoryInfo</span> <span class="o">=</span> <span class="nx">processMemoryInfo</span><span class="p">;</span>
 
        <span class="k">return</span> <span class="nx">processMemoryInfo</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/** 获取 ip 和 mac 地址（可远程访问的） */</span>
    <span class="kr">public</span> <span class="nx">getIPAndMac</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[]</span> <span class="nx">as</span> <span class="p">{</span> <span class="nx">ip</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span> <span class="nx">mac</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span> <span class="nx">family</span><span class="o">:</span> <span class="s2">&#34;IPv4&#34;</span> <span class="o">|</span> <span class="s2">&#34;IPv6&#34;</span> <span class="p">}[];</span>
 
        <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">baseInfo</span><span class="p">.</span><span class="nx">networkInterfaces</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseInfo</span><span class="p">.</span><span class="nx">networkInterfaces</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="nx">item</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">internal</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">ip</span><span class="o">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="nx">mac</span><span class="o">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">mac</span><span class="p">,</span> <span class="nx">family</span><span class="o">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">family</span> <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>
 
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/09/22/fe07ae3ce2ca4d5eae78c0f3dd0a3e82.png" alt=""></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/electron/">electron</a>
          <a href="/tags/nodejs/">nodejs</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-09/webpack-strip-use-strict/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">webpack build results remove use strict mode</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-09/react-17-find-react-element-by-dom/">
            <span class="next-text nav-default">Get React component examples based on DOM nodes in React 17</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
