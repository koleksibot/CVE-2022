<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Vim Macro Quick Start - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Vim provides a macro recording feature that allows you to record a series of actions and then repeat them. This feature is relatively cold, but also very powerful. Just because the operation is complicated, few people learn and rarely use. But I think the idea of macros is very simple, the reason why I think it is complex is not particularly good real-world cases to reflect its value. I came across a more suitable scenario for the use of macros when I was modifying the Sniper framework today." /><meta name="keywords" content="vim, Macro, Quick Start" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/vim-macro-quick-start/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Vim Macro Quick Start" />
<meta property="og:description" content="Vim provides a macro recording feature that allows you to record a series of actions and then repeat them. This feature is relatively cold, but also very powerful. Just because the operation is complicated, few people learn and rarely use. But I think the idea of macros is very simple, the reason why I think it is complex is not particularly good real-world cases to reflect its value. I came across a more suitable scenario for the use of macros when I was modifying the Sniper framework today." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/vim-macro-quick-start/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-05T11:51:13+08:00" />
<meta property="article:modified_time" content="2022-01-05T11:51:13+08:00" />

<meta itemprop="name" content="Vim Macro Quick Start">
<meta itemprop="description" content="Vim provides a macro recording feature that allows you to record a series of actions and then repeat them. This feature is relatively cold, but also very powerful. Just because the operation is complicated, few people learn and rarely use. But I think the idea of macros is very simple, the reason why I think it is complex is not particularly good real-world cases to reflect its value. I came across a more suitable scenario for the use of macros when I was modifying the Sniper framework today."><meta itemprop="datePublished" content="2022-01-05T11:51:13+08:00" />
<meta itemprop="dateModified" content="2022-01-05T11:51:13+08:00" />
<meta itemprop="wordCount" content="1328">
<meta itemprop="keywords" content="vim," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vim Macro Quick Start"/>
<meta name="twitter:description" content="Vim provides a macro recording feature that allows you to record a series of actions and then repeat them. This feature is relatively cold, but also very powerful. Just because the operation is complicated, few people learn and rarely use. But I think the idea of macros is very simple, the reason why I think it is complex is not particularly good real-world cases to reflect its value. I came across a more suitable scenario for the use of macros when I was modifying the Sniper framework today."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Vim Macro Quick Start</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-05 11:51:13 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1328 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>Vim provides a macro recording feature that allows you to record a series of actions and then repeat them. This feature is relatively cold, but also very powerful. Just because the operation is complicated, few people learn and rarely use. But I think the idea of macros is very simple, the reason why I think it is complex is not particularly good real-world cases to reflect its value. I came across a more suitable scenario for the use of macros when I was modifying the Sniper framework today. Now I&rsquo;m going to share it with my friends who are learning and using Vim. In addition to macros, this article also shows you the comprehensive use of functions such as copy and paste, in-line lookup, temporary insertion mode, registers, etc. It is especially suitable for beginners and intermediate Vim enthusiasts.</p>
<p>The Sniper framework entails wrapping the viper library and providing a set of tool functions. These functions are simple calls to the corresponding functions of the viper object, with exactly the same function signatures. I used the tagbar in Vim to view the code structure and copied the viper to be wrapped from the tagbar at once as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"> <span class="o">+</span><span class="nf">GetBool</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">bool</span>
   <span class="o">+</span><span class="nf">GetDuration</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
   <span class="o">+</span><span class="nf">GetFloat64</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">float64</span>
   <span class="o">+</span><span class="nf">GetInt</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">int</span>
   <span class="o">+</span><span class="nf">GetInt32</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">int32</span>
   <span class="o">+</span><span class="nf">GetInt64</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">int64</span>
   <span class="o">+</span><span class="nf">GetIntSlice</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="p">[]</span><span class="kt">int</span>
   <span class="o">+</span><span class="nf">GetSizeInBytes</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">uint</span>
   <span class="o">+</span><span class="nf">GetString</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">string</span>
   <span class="o">+</span><span class="nf">GetStringMap</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
   <span class="o">+</span><span class="nf">GetStringMapString</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
   <span class="o">+</span><span class="nf">GetStringMapStringSlice</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span>
   <span class="o">+</span><span class="nf">GetStringSlice</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="p">[]</span><span class="kt">string</span>
   <span class="o">+</span><span class="nf">GetTime</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
   <span class="o">+</span><span class="nf">GetUint</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">uint</span>
   <span class="o">+</span><span class="nf">GetUint32</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">uint32</span>
   <span class="o">+</span><span class="nf">GetUint64</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">uint64</span>
</code></pre></td></tr></table>
</div>
</div><p>Now I need to modify <code>+GetBool(key string) : bool</code> to look like the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetBool</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">File</span><span class="p">(</span><span class="nx">defaultName</span><span class="p">).</span><span class="nf">GetBool</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The key thing here is that the content of the body corresponds to the name of the previous function (e.g. <code>GetBool</code> here). The whole replacement logic is exactly the same, but each line has a different content to deal with. This situation is particularly suitable for handling with macros. I&rsquo;ll analyze how to do it below.</p>
<p>First, start recording and press <code>qa</code>. Here <code>a</code> means the register number, which can be taken as <code>a-z</code> and will be used when the macro is repeated. After pressing <code>qa</code>, all the next operations will be recorded.</p>
<p>First press <code>0</code> to jump to the start of the current line (<code>^</code> can only jump to the first non-blank character) This step is very critical and will be revealed in the later part ðŸ˜„.</p>
<p>Then press <code>cf+</code>, through the line to find <code>f+</code> selected from the beginning to <code>+</code> this area, <code>c</code> means clear the selected area and enter the insertion mode. After pressing <code>+</code>, you will see that <code>+</code> and the preceding blank are deleted, at this point type <code>func</code> and go back to normal mode. By now, we have changed the beginning part. At this point the cursor stops at the space after <code>func</code>.</p>
<p>Next we add the function body. Since we need to use the current function name in the function body, we will copy it to the clipboard first. Press <code>w</code> to jump to the beginning of the function name, and then press <code>ciw</code> to copy the entire word, with the i indicating that it does not contain the word. The boundary of the word can be a space or some other punctuation mark, like <code>(</code> here. After you press it, <code>GetBool</code> will be saved to the clipboard.</p>
<p>Before appending the function body, we also need to remove the colon in the middle. First move the cursor to the colon, press <code>f:</code>, and then press <code>&quot;_dw</code>. Note that you press <code>&quot;_</code> first and then <code>dw</code> to remove the colon. By default, Vim will save the current deletion to the clipboard, so if you press it directly, it will overwrite the function name you just saved. And here <code>&quot;_</code> means black hole register, which means pressing <code>&quot;_</code> tells Vim not to save the deleted content (colon) this time.</p>
<p>Finally, we press <code>A</code> directly for <code>$a</code>, which actually jumps to the end of the line first and enters insert mode (note the difference between <code>a</code> and <code>i</code>). At this point you can type <code>{ return Func(defaultName).</code> . At this point it takes a bit of hacking. Next we need to enter the current function name. The easiest way to do this is to go back to normal mode, press <code>p</code> to paste, and then press <code>A</code> to continue typing. But that&rsquo;s a bit too verbose.</p>
<p>The essential need here is to <strong>paste content from the clipboard in insert mode</strong> . There are two ways of thinking about this.</p>
<p>The first is to insert the contents of the specified register directly. By default, Vim will store the copied content in the register numbered <code>&quot;</code> (you read that right, it&rsquo;s in quotes). So to paste the copied content in insert mode you can press <code>CTRL-r Shift&quot;</code>. This way can be used for any register, not limited to copy and paste, so you should learn to use it. However, considering that the registers themselves are not commonly used, this method is not recommended.</p>
<p>Another way is to use the so-called <strong>Insert Normal</strong> mode, which we may call temporary normal mode. Pressing <code>CTRL-o</code> in insert mode allows normal mode, and you press any shortcut key in normal mode. But you can only press it once, and Vim will automatically switch back to insert mode after performing the corresponding operation. If you need to copy, you can press <code>CTRL-op</code> and then continue typing <code>}</code> to finish all the changes.</p>
<p>The <code>Insert Normal</code> mode works very well here. For example, if you want to quickly move to the beginning of a line when inserting code, you can press <code>CTRL-o^</code>, and if you find that you have written the wrong word halfway through and want to retype it, you can press <code>CTRL-ocw</code>, etc. We recommend you to master it.</p>
<p>Finally, return to normal mode and press <code>q</code> to end the macro recording. Here, the preparation work is finished. Now repeat the operation we recorded.</p>
<p>Press <code>j</code> to move to the next line. Since the cursor is at the end of the previous line, it is still at the current end after moving. That&rsquo;s why I need to press <code>0</code> first to jump to the beginning of the line while the macro is recording. Then press <code>@a</code> to execute the macro record saved in register <code>a</code>. You&rsquo;ll see that <code>+GetDuration(key string) : time.Duration</code> is instantly changed to.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetDuration</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">File</span><span class="p">(</span><span class="nx">defaultName</span><span class="p">).</span><span class="nf">GetDuration</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Pressing <code>j@a</code> repeatedly will modify each line in turn. If you find pressing <code>@a</code> a bit cumbersome, you can also press <code>@@</code> after the first run, where the second <code>@</code> indicates the last register used, which is <code>a</code>.</p>
<p>Finally, we can see what is stored in register <code>a</code> by executing <code>:echo @a</code> and the result is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="mi">0</span><span class="nx">cf</span><span class="o">+</span><span class="kd">func</span> <span class="p">^[</span><span class="nx">wyiwf</span><span class="p">:</span><span class="err">&#34;</span><span class="nx">_dwA</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">File</span><span class="p">(</span><span class="nx">defaultName</span><span class="p">).^</span><span class="nf">Op</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">}^[</span>
</code></pre></td></tr></table>
</div>
</div><p>Here <code>^[</code> means <code>esc</code>, and you can check these contents against the previous article, which are actually all the keys we have pressed between pressing <code>qa</code> and <code>q</code>!</p>
<p>Executing a macro once is an atomic operation, no matter how much content is modified. That means you can press <code>u</code> to undo the changes, or you can press <code>CTRL-r</code> again to undo them in reverse.</p>
<p>In fact, Vim also automatically records macros that record the most recent <strong>modification operation</strong>. For example, you can delete a line by pressing <code>dd</code> and this will be automatically recorded by Vim. You don&rsquo;t need to specify a register to repeat this macro, you can just press <code>.</code> . You can try it.</p>
<p>That&rsquo;s all there is to this article. Although macros are a bit complicated and not very common, they are very powerful and simple to implement, so we recommend that all Vim users master them.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/vim/">vim</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/no-change-lib-in-go-1.18/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Rob opposes changes to the Go 1.18 generic standard library</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/systemd-socket-activation/">
            <span class="next-text nav-default">Use systemd to listen to the service port</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
