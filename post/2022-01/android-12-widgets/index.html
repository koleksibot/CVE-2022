<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Building more modern app widgets in Android 12 - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Widgets have been an important part of Android since 2008 and are an important aspect of customising the home screen. You can think of a widget as an &amp;lsquo;at-a-glance&amp;rsquo; view of the app, giving the user a glimpse of the app&amp;rsquo;s data and core functionality without having to open the app from the home screen. But the AppWidget API has remained largely unchanged since the launch of Android, with only" /><meta name="keywords" content="Android 12, Widget" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/android-12-widgets/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Building more modern app widgets in Android 12" />
<meta property="og:description" content="Widgets have been an important part of Android since 2008 and are an important aspect of customising the home screen. You can think of a widget as an &lsquo;at-a-glance&rsquo; view of the app, giving the user a glimpse of the app&rsquo;s data and core functionality without having to open the app from the home screen. But the AppWidget API has remained largely unchanged since the launch of Android, with only" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/android-12-widgets/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-13T10:08:30+08:00" />
<meta property="article:modified_time" content="2022-01-13T10:08:30+08:00" />

<meta itemprop="name" content="Building more modern app widgets in Android 12">
<meta itemprop="description" content="Widgets have been an important part of Android since 2008 and are an important aspect of customising the home screen. You can think of a widget as an &lsquo;at-a-glance&rsquo; view of the app, giving the user a glimpse of the app&rsquo;s data and core functionality without having to open the app from the home screen. But the AppWidget API has remained largely unchanged since the launch of Android, with only"><meta itemprop="datePublished" content="2022-01-13T10:08:30+08:00" />
<meta itemprop="dateModified" content="2022-01-13T10:08:30+08:00" />
<meta itemprop="wordCount" content="2326">
<meta itemprop="keywords" content="android," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building more modern app widgets in Android 12"/>
<meta name="twitter:description" content="Widgets have been an important part of Android since 2008 and are an important aspect of customising the home screen. You can think of a widget as an &lsquo;at-a-glance&rsquo; view of the app, giving the user a glimpse of the app&rsquo;s data and core functionality without having to open the app from the home screen. But the AppWidget API has remained largely unchanged since the launch of Android, with only"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Building more modern app widgets in Android 12</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-13 10:08:30 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2326 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#how-widgets-work">How Widgets work</a></li>
        <li><a href="#apis">APIs</a></li>
        <li><a href="#glance">Glance</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/bff1056271424163b992d17de13be6e5.png" alt="android"></p>
<p>Widgets have been an important part of Android since 2008 and are an important aspect of customising the home screen. You can think of a widget as an &lsquo;at-a-glance&rsquo; view of the app, giving the user a glimpse of the app&rsquo;s data and core functionality without having to open the app from the home screen. But the AppWidget API has remained largely unchanged since the launch of Android, with only one version of Android from 2012 to 2021 containing an update to the AppWidget API. With the introduction of Android 12, there have been some much needed updates to the Widget API.</p>
<p>In this article we&rsquo;ll take a look at what updates to the Widget API are available in Android 12 and what great tools are available to make developing app widgets even better. If you prefer to see this in a video, please <a href="https://www.bilibili.com/video/BV1Ra411z7dN/">click here</a>.</p>
<h2 id="how-widgets-work">How Widgets work</h2>
<p>A widget runs in a remote process called AppWidgetHost, such as the Home Screen Launcher, and because of this, it has some restrictions on its operation. Let&rsquo;s take a look at how widgets work.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/b2510c173bd642d2a2331bb8b640bea8.png" alt="widgets"></p>
<p>On the front end, the application first registers the AppWidgetProvider to define the widget behaviour and the AppWidgetProviderInfo to define the metadata. AndroidManifest then references this information, allowing the OS to read the metadata via AndroidManifest, such as the initial layout and default size of the widget, and providing a preview of the widget, followed by the provider using a linked account to update the layout and make updates to the widget. It is important to note here that there are a limited number of builds applied to the widget, so the OS updates the widget via a broadcast event from the recipient (which contains the update information). This also means that the widget is updated periodically by receiving information from the application.</p>
<h2 id="apis">APIs</h2>
<p>The launch of Android 12 brought a lot of updates to the AppWidget API, this article will not cover all of them, but will focus on a few APIs that are very useful for widget building.</p>
<p><strong>Implementing rounded corners</strong></p>
<p>Many key interface elements are now rounded in Android 12. To make AppWidgets look consistent with other system components, Android 12 introduces <a href="https://developer.android.google.cn/reference/android/R.dimen?hl=zh-cn#system_app_widget_background_radius">system_app_widget_background_radius</a> and <a href="https://developer.android.google.cn/reference/android/R.dimen?hl=zh-cn#system_app_widget_inner_radius">system_app_widget_inner_radius</a> two new system parameters to implement rounded corners, the former to set the radius of the widget&rsquo;s rounded corners and the latter to set the radius of the widget&rsquo;s inner view. The latter sets the radius of the rounded corners of the widget&rsquo;s inner view. To use these parameters, it is sufficient to define a drawable object with the system parameter corner set, as shown in the code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">// res/drawable/app_widget_background.xml
<span class="nt">&lt;shape</span> <span class="na">android:shape=</span><span class="s">&#34;rectangle&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;corners</span> <span class="na">android:radius=</span><span class="s">&#34;@android:dimen/system_app_widget_background_radius&#34;</span><span class="nt">&gt;</span>
    …
<span class="nt">&lt;/shape&gt;</span>

// res/drawable/app_widget_inner_view_background.xml
<span class="nt">&lt;shape</span> <span class="na">android:shape=</span><span class="s">&#34;rectangle&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;corners</span> <span class="na">android:radius=</span><span class="s">&#34;@android:dimen/system_app_widget_inner_radius&#34;</span><span class="nt">&gt;</span>
    …
<span class="nt">&lt;/shape&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>The drawable object is then applied to the widget&rsquo;s external container, which applies the rounded corner radius provided by the system parameters to the widget&rsquo;s background. Similarly, the drawable object of the internal view is applied to the layout representing the widget&rsquo;s internal container, as shown in the code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">// res/layout/widget_layout.xml
<span class="nt">&lt;LinearLayout</span>
    <span class="na">android:background=</span><span class="s">&#34;@drawable/app_widget_background&#34;</span>
<span class="err">…</span><span class="nt">&gt;</span>
    <span class="nt">&lt;LinearLayout</span>
        <span class="na">android:background=</span><span class="s">&#34;@drawable/app_widget_inner_view_background&#34;</span>
    <span class="err">…</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/LinearLayout&gt;</span>
<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/cceeb5be13884c098e59e2c315199e90.png" alt="image"></p>
<p>△ Left: widget rounded corners; right: inner view rounded corners</p>
<p>From the effect we can see that the radius of the rounded corners of the widget&rsquo;s current inner container is smaller than that of the outer container, which is how the new parameter is used.</p>
<p><strong>Dynamic colours</strong></p>
<p>As we previously announced at Google I/O, starting with Android 12, widgets can use device theme colours for buttons, backgrounds and other components, including light and dark themes. This allows for smoother transitions and consistency from widget to widget.</p>
<p>We&rsquo;ve added a dynamic colour API so you can get and use the theme background, colour and other parameters provided on the Pixel device system directly to keep the widget in line with the home screen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">// res/layout/widget_layout.xml
<span class="nt">&lt;LinearLayout</span>
    <span class="na">android:theme=</span><span class="s">&#34;@android:style/Theme.DeviceDefault.DayNight&#34;</span>
    <span class="na">android:background=</span><span class="s">&#34;?android:attr/colorBackground&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ImageView</span>
        <span class="na">android:tint=</span><span class="s">&#34;?android:attr/colorAccent&#34;</span> <span class="nt">/&gt;</span>
    …
<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>You can see that when the theme properties are set, the widget takes the primary colour directly from the system wallpaper and applies it to the dark and light theme backgrounds.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/cfe6c1d2f21b469bae0b4d5fc53d16c9.gif" alt="image"></p>
<p><strong>Responsive Layout</strong></p>
<p>Android 12 introduces a new API for responsive layout, which automatically switches to a different layout as the widget is resized. As shown in the image below, the user can drag to change the size of the widget at will, and the widget will dynamically update the content to be displayed depending on the size.</p>
<p><img src="https://devrel.andfun.cn/devrel/posts/2022/01/cqZ5M8.gif" alt="image"></p>
<p>So how do you make a widget dynamically update its display as its size changes? We define three different parameters, the minimum supported width and height, and the corresponding RemoteView within this size range, and the system will automatically adjust the widget to the actual size.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">val</span> <span class="n">viewMapping</span><span class="o">:</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">SizeF</span><span class="o">,</span> <span class="n">RemoteViews</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">mapof</span><span class="o">(</span>
    <span class="n">SizeF</span><span class="o">(</span><span class="n">180</span><span class="o">.</span><span class="na">0f</span><span class="o">,</span> <span class="n">110</span><span class="o">.</span><span class="na">0f</span><span class="o">)</span> <span class="n">to</span> <span class="nf">RemoteViews</span><span class="o">(</span>
        <span class="n">context</span><span class="o">.</span> <span class="n">packageName</span><span class="o">,</span>
        <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">widget_small</span>
    <span class="o">),</span>
    <span class="n">SizeF</span> <span class="o">(</span><span class="n">270</span><span class="o">.</span><span class="na">0f</span><span class="o">,</span> <span class="n">110</span><span class="o">.</span><span class="na">0f</span><span class="o">)</span> <span class="n">to</span> <span class="nf">RemoteViews</span><span class="o">(</span>
        <span class="n">context</span><span class="o">.</span><span class="na">packageName</span><span class="o">,</span>
        <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">widget_medium</span>
    <span class="o">),</span>
    <span class="n">SizeF</span><span class="o">(</span><span class="n">270</span><span class="o">.</span><span class="na">0f</span><span class="o">,</span> <span class="n">280</span><span class="o">.</span><span class="na">0f</span><span class="o">)</span> <span class="n">to</span> <span class="nf">RemoteViews</span><span class="o">(</span>
        <span class="n">context</span><span class="o">.</span><span class="na">packageName</span><span class="o">,</span>
        <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">widget_large</span>
    <span class="o">)</span>
<span class="o">)</span>
<span class="n">appWidgetManager</span><span class="o">.</span><span class="na">updateAppWidget</span><span class="o">(</span><span class="n">appWidgetId</span><span class="o">,</span> <span class="n">RemoteViews</span><span class="o">(</span><span class="n">viewMapping</span><span class="o">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Android 12 also provides new <code>targetCellWidth</code> and <code>targetCellHeight</code> properties, which specify the default larger cell size when the widget is placed on the home screen. Prior to Android 12, you could use the <code>minWidget</code> and <code>minHeight</code> properties, which specified the default widget size in dp, and we recommend specifying both properties for backwards compatibility. If your widget is resizable then you can also use the minResizeWidget/Height and maxResizeWidget/Height properties provided by Android 12 to limit the resizable range of the widget.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;appwidget-provider</span>
    <span class="na">android:targetCellWidth=</span><span class="s">&#34;3&#34;</span>
    <span class="err">android:</span> <span class="na">targetCellHeight=</span><span class="s">&#34;2&#34;</span>
    <span class="na">android:minWidth=</span><span class="s">&#34;140dp&#34;</span>
    <span class="na">android:minHeight=</span><span class="s">&#34;110dp&#34;</span>
    <span class="na">android:maxResizeWidth=</span><span class="s">&#34;570dp&#34;</span>
    <span class="na">android:maxResizeHeight=</span><span class="s">&#34;450dp&#34;</span>
    <span class="na">android:minResizeWidth=</span><span class="s">&#34;140dp&#34;</span>
    <span class="na">android:minResizeHeight=</span><span class="s">&#34;110dp&#34;</span>
    <span class="err">…</span><span class="nt">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Widget selector</strong></p>
<p>Android 12 has also improved the experience of using the Widget selector by introducing two new properties, the first being description, which provides a descriptive description of what the Widget selector does, and the other being previewLayout, which specifies the The other is previewLayout, which specifies the XML layout to be displayed in the widget selector. In fact before Android 12 it was possible to use the previewImage property to specify static resources to achieve a similar effect, but the previewLayout is more precise and convenient in comparison. In addition, as these previews are built at runtime, they can also be dynamically adapted to the device&rsquo;s theme.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;appwidget-provider</span>
    <span class="na">android:description=</span>
        <span class="s">&#34;@string/app_widget_weather_description&#34;</span>
    <span class="na">android:previewLayout=</span>
        <span class="s">&#34;@layout/widget_weather_forecast_small&#34;</span>
<span class="err">…</span>
<span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/8fb7a9fbf32f44ce9836edd8c28f7622.png" alt="image"></p>
<p>△ description attribute</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/b384fdf93eea40319f947ecf13a16a9a.png" alt="image"></p>
<p>△ previewLayout property</p>
<p>Many of the new APIs introduced in Android 12 have been introduced so far, and it is likely that we will soon see more and more apps using the new APIs to build a more modern widget experience.</p>
<h2 id="glance">Glance</h2>
<p>To build great widgets, in addition to the more modern APIs available today, we need more modern and better tools to help us, and Glance is one such great tool that has been added to the Jetpack family. This means that you can use Glance to build interfaces in composable and convert them to remote views for display in widgets, as well as using the new Android 12 API mentioned earlier and making them as backwards compatible as possible. Glance will also take care of some of the widget lifecycle and other common operations, which sounds very convenient.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/a403bc68d5884fde9181c28d258406ea.png" alt="image"></p>
<p>△ Glance structure diagram</p>
<p>Next we cover how to build a widget using Glance, first you still need to declare the AppWidget as before and link it to the receiver in AndroidManifest, of course we use the GlanceAppWidgetReceiver provided by Glance here and the GlanceAppWidget, Glance will handle most of the work for you, you just need to override the Content method in MyAppWidget to provide the AppWidget content. Instead of using XML syntax when defining content, Compose syntax is used and the content to be displayed will be converted to a remote view for display in the AppWidget.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyAppWidget</span><span class="o">:</span> <span class="n">GlanceAppWidget</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Composable</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">Content</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 在这里创建 AppWidget
</span><span class="c1"></span>        <span class="n">Column</span><span class="o">(</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="o">.</span><span class="na">expandHeight</span><span class="o">().</span><span class="na">expandWidth</span><span class="o">(),</span>
            <span class="n">verticalAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">Top</span><span class="o">,</span>
            <span class="n">horizontalAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">CenterHorizontally</span>
        <span class="o">)</span> <span class="o">{</span>
            <span class="n">Text</span><span class="o">(</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#34;Where to&#34;</span><span class="o">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="o">.</span><span class="na">padding</span><span class="o">(</span><span class="n">12</span><span class="o">.</span><span class="na">dp</span><span class="o">))</span>
            <span class="n">userDestinations</span><span class="o">()</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="kd">class</span> <span class="nc">MyAppWidgetReceiver</span><span class="o">:</span> <span class="n">GlanceAppWidgetReceiver</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 告知 MyAppWidgetReceiver 该使用哪个 GlanceAppWidget
</span><span class="c1"></span>    <span class="n">override</span> <span class="n">val</span> <span class="n">glanceAppWidget</span><span class="o">:</span> <span class="n">GlanceAppWidget</span> <span class="o">=</span> <span class="n">MyAppWidget</span><span class="o">()</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>One thing to understand is that although Glance uses the Compose Runtime and Compose syntax, it is still a standalone framework and it is not possible to reuse components defined in the Jetpack Compose UI due to the limitations of building on the remote side. However, if you are already familiar with Jetpack Compose, then Glance will be very easy to understand.</p>
<p>Also, because Glance uses the user event API to handle interactions, it will be easier for us to handle interactions with users. If you know how widgets work you will know that widgets work on different processes, which makes it difficult to handle even simple user events, as not being in the same process means you don&rsquo;t own the widget and have to handle events via process callbacks.</p>
<p>Glance abstracts away this complexity by defining a clickable modifier for the composable object you need to support handling user click events, Glance abstracts away all the injected behaviour and the user clicks on the composanle to call back the defined action. We have also defined some common actions, such as how to launch an Activity, by calling launchActivity and passing in the Activity target class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Button</span><span class="o">(</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&#34;Home&#34;</span><span class="o">,</span>
    <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="o">.</span><span class="na">clickable</span><span class="o">(</span><span class="n">launchActivity</span><span class="o">&lt;</span><span class="n">NavigationActivity</span><span class="o">&gt;)</span>
<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>For example, we may want to update the geolocation and refresh the widget whenever the user clicks this button, as shown in the code below, Glance will handle some of the work that needs to be injected for you behind the scenes and process the click through the broadcast receiver, ultimately calling the code for the action you defined. Please note, however, that if this is a more time consuming operation such as a network request or database access, please use the WorkManager API.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Button</span><span class="o">(</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&#34;My Location&#34;</span><span class="o">,</span>
    <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="o">.</span><span class="na">clickable</span><span class="o">(</span><span class="n">customAction</span><span class="o">&lt;</span><span class="n">UpdateLocationAction</span><span class="o">&gt;)</span>
<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>As we mentioned earlier, you can use resizable widgets, but dealing with different responsive layouts is no easy task, and Glance has tried to make this a little easier by defining three different SizeMode options.</p>
<p>SizeMode.Single is the default option, which specifies that the content of the widget we define here will not change as the available size changes, meaning that the minimum supported size we define on the widget metadata will only be called once via the Content method, and if the available size of the widget changes, for example if the user resizes the If the available size of the widget changes, for example if the user resizes the widget, the content will not be refreshed. This is because the Content method is only called once and the content is not refreshed when the size changes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyAppWidget</span><span class="o">:</span> <span class="n">GlanceAppWidget</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">override</span> <span class="n">val</span> <span class="n">sizeMode</span> <span class="o">=</span> <span class="n">SizeMode</span><span class="o">.</span><span class="na">Single</span>
 
    <span class="nd">@Composable</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">Content</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">val</span> <span class="n">size</span> <span class="o">=</span> <span class="n">LocalSize</span><span class="o">.</span><span class="na">current</span>
        <span class="c1">//…
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/5f5745de32824d6fb242b88d059cd476.gif" alt="image"></p>
<p>△ Diagram of SizeMode.Single option</p>
<p>The SizeMode.Exact option can be used if the content is refreshed each time the size changes. This option will recreate the widget interface and call the Content method again each time the user resizes the widget, as well as providing the maximum size available so that we can change the interface if there is enough space, such as adding additional buttons etc. In the image below, the internal output of the widget changes whenever the size of the widget changes, as the widget interface is recreated each time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyAppWidget</span><span class="o">:</span> <span class="n">GlanceAppWidget</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">override</span> <span class="n">val</span> <span class="n">sizeMode</span> <span class="o">=</span> <span class="n">SizeMode</span><span class="o">.</span><span class="na">Exact</span>
 
    <span class="nd">@Composable</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">Content</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">val</span> <span class="n">size</span> <span class="o">=</span> <span class="n">LocalSize</span><span class="o">.</span><span class="na">current</span>
        <span class="c1">//…
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/75e1fdf362a144dc918a57b6d0b9ccc0.gif" alt="image"></p>
<p>△ SizeMode.Exact option diagram</p>
<p>Although the SizeMode.Exact option seems to work perfectly, the need to recreate the interface each time may cause the user to have some performance issues with the interface transitions when resizing, so we can use the SizeMode.Responsive option. For example, here we have mapped some sizes to certain shapes and Glance will call the Content method defined for each Size whenever an AppWidget is created or updated, each time mapping to a specific size and storing it in memory, allowing the system to select the most appropriate size based on the available sizes when the user resizes the widget, without having to recreate it. The interface provides smoother transitions and better performance. As the diagram below illustrates, when a widget size is changed, its internal output will only change if it matches the pre-defined size range, and it should be noted that the interface is not recreated at this point.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/13/64d4d1ddc4304262b552b89293b31307.gif" alt="image"></p>
<p>△ Diagram of SizeMode.Responsive option</p>
<p>Similarly, we can also define more diverse styles in the Content() method to allow the widget to display more unique content at different sizes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyAppWidget</span><span class="o">:</span> <span class="n">GlanceAppWidget</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">companion</span> <span class="n">object</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">val</span> <span class="n">SMALL_SQUARE</span> <span class="o">=</span> <span class="n">DpSize</span> <span class="o">(</span><span class="n">100</span><span class="o">.</span><span class="na">dp</span><span class="o">,</span> <span class="n">160</span><span class="o">.</span> <span class="n">dp</span><span class="o">)</span>
        <span class="kd">private</span> <span class="n">val</span> <span class="n">HORIZONTAL_RECTANGLE</span> <span class="o">=</span> <span class="n">DpSize</span> <span class="o">(</span><span class="n">250</span><span class="o">.</span><span class="na">dp</span><span class="o">,</span> <span class="n">100</span><span class="o">.</span><span class="na">dp</span><span class="o">)</span>
        <span class="kd">private</span> <span class="n">val</span> <span class="n">BIG_SQUARE</span> <span class="o">=</span> <span class="n">DpSize</span> <span class="o">(</span><span class="n">250</span><span class="o">.</span><span class="na">dp</span><span class="o">,</span> <span class="n">250</span><span class="o">.</span><span class="na">dp</span><span class="o">)</span>
    <span class="o">}</span>
 
    <span class="n">override</span> <span class="n">val</span> <span class="n">sizeMode</span> <span class="o">=</span> <span class="n">SizeMode</span><span class="o">.</span><span class="na">Responsive</span><span class="o">(</span>
        <span class="n">SMALL_SQUARE</span><span class="o">,</span> <span class="n">HORIZONTAL_RECTANGLE</span><span class="o">,</span> <span class="n">BIG_SQUARE</span>
    <span class="o">)</span>
 
    <span class="nd">@Composable</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">Content</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">val</span> <span class="n">size</span> <span class="o">=</span> <span class="n">LocalSize</span><span class="o">.</span><span class="na">current</span>
        <span class="c1">//…
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In addition to the above, there is much more to explore, such as support for widget state management and out-of-the-box Material You themed backgrounds.</p>
<p>For more information, please check out the Android developer website: <a href="https://developer.android.google.cn/guide/topics/appwidgets/overview">App Widget Overview</a>, we&rsquo;re looking forward to you trying out the new APIs we have to offer and seeing the widgets you build and your feedback.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/android/">android</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/svelte-communication/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">6 methods of communication between Svelte components</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/memory-cgroup/">
            <span class="next-text nav-default">Analysis and resolution of memory cgroup leaks</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
