<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Using graphql in ts  - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Scenarios graphql provides consistent api architecture metadata on the front and back ends, while speeding up the performance of web-backend interactions through request merging and on-demand fetching.
Use with ts Basic idea
 scan all gql strings in the code get the graphql strings in the code and generate type definitions use these type definitions  Steps to use  Here is a demonstration using github api@v4
 Get the back-end metadata" /><meta name="keywords" content="typescript, graphql" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/ts-graphql/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Using graphql in ts " />
<meta property="og:description" content="Scenarios graphql provides consistent api architecture metadata on the front and back ends, while speeding up the performance of web-backend interactions through request merging and on-demand fetching.
Use with ts Basic idea
 scan all gql strings in the code get the graphql strings in the code and generate type definitions use these type definitions  Steps to use  Here is a demonstration using github api@v4
 Get the back-end metadata" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/ts-graphql/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-16T20:43:07+08:00" />
<meta property="article:modified_time" content="2022-01-16T20:43:07+08:00" />

<meta itemprop="name" content="Using graphql in ts ">
<meta itemprop="description" content="Scenarios graphql provides consistent api architecture metadata on the front and back ends, while speeding up the performance of web-backend interactions through request merging and on-demand fetching.
Use with ts Basic idea
 scan all gql strings in the code get the graphql strings in the code and generate type definitions use these type definitions  Steps to use  Here is a demonstration using github api@v4
 Get the back-end metadata"><meta itemprop="datePublished" content="2022-01-16T20:43:07+08:00" />
<meta itemprop="dateModified" content="2022-01-16T20:43:07+08:00" />
<meta itemprop="wordCount" content="787">
<meta itemprop="keywords" content="typescript,graphql," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using graphql in ts "/>
<meta name="twitter:description" content="Scenarios graphql provides consistent api architecture metadata on the front and back ends, while speeding up the performance of web-backend interactions through request merging and on-demand fetching.
Use with ts Basic idea
 scan all gql strings in the code get the graphql strings in the code and generate type definitions use these type definitions  Steps to use  Here is a demonstration using github api@v4
 Get the back-end metadata"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Using graphql in ts </h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-16 20:43:07 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 787 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#scenarios">Scenarios</a></li>
        <li><a href="#use-with-ts">Use with ts</a></li>
        <li><a href="#steps-to-use">Steps to use</a></li>
        <li><a href="#jetbrains-ide-support">Jetbrains IDE support</a></li>
        <li><a href="#vscode-support">VSCode support</a></li>
        <li><a href="#integration-into-viterollup">Integration into vite/rollup</a></li>
        <li><a href="#install-the-chrome-plugin">Install the chrome plugin</a></li>
        <li><a href="#reference">Reference</a></li>
        <li><a href="#other-options">Other options?</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="scenarios">Scenarios</h2>
<p>graphql provides consistent api architecture metadata on the front and back ends, while speeding up the performance of web-backend interactions through request merging and on-demand fetching.</p>
<h2 id="use-with-ts">Use with ts</h2>
<p>Basic idea</p>
<ol>
<li>scan all <code>gql</code> strings in the code</li>
<li>get the <code>graphql</code> strings in the code and generate type definitions</li>
<li>use these type definitions</li>
</ol>
<h2 id="steps-to-use">Steps to use</h2>
<blockquote>
<p>Here is a demonstration using github api@v4</p>
</blockquote>
<p>Get the back-end metadata</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">curl https://docs.github.com/public/schema.docs.graphql &gt; schema.graphql
</code></pre></td></tr></table>
</div>
</div><p>Install the base sdk</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pnpm i @apollo/client graphql
</code></pre></td></tr></table>
</div>
</div><p>Install code generator related dependencies</p>
<ul>
<li><code>@graphql-codegen/cli</code> base cli</li>
<li><code>@graphql-codegen/typescript</code> ts plugins</li>
<li><code>@graphql-codegen/typescript-operations</code> ts operation generation plugin</li>
<li><code>@graphql-codegen/near-operation-file-preset</code> ts preset configuration</li>
</ul>
<p>Create configuration <em>codegen.yml</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">overwrite</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;schema.graphql&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">generates</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">./src/graphql.gql.ts</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">plugins</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">typescript</span><span class="w">
</span><span class="w">  </span><span class="nt">./</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">documents</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;src/**/*.ts&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;!src/**/*.gql.ts&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">preset</span><span class="p">:</span><span class="w"> </span><span class="l">near-operation-file</span><span class="w">
</span><span class="w">    </span><span class="nt">presetConfig</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">baseTypesPath</span><span class="p">:</span><span class="w"> </span><span class="l">./src/graphql.gql.ts</span><span class="w">
</span><span class="w">      </span><span class="nt">extension</span><span class="p">:</span><span class="w"> </span><span class="l">.gql.ts</span><span class="w">
</span><span class="w">    </span><span class="nt">plugins</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">typescript-operations</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Add some graphql variables to the code</p>
<blockquote>
<p>tip: In non-react projects, please import all non-react content from <code>@apollo/client/core</code>.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="p">{</span> <span class="nx">gql</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@apollo/client&#34;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">findRepoStar</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span><span class="sb">  query findRepoStar($name: String!, $owner: String!) {
</span><span class="sb">    repository(name: $name, owner: $owner) {
</span><span class="sb">      name
</span><span class="sb">      stargazerCount
</span><span class="sb">    }
</span><span class="sb">  }
</span><span class="sb">`</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">findRepo</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span><span class="sb">  query findRepo($name: String!, $owner: String!) {
</span><span class="sb">    repository(name: $name, owner: $owner) {
</span><span class="sb">      name
</span><span class="sb">    }
</span><span class="sb">  }
</span><span class="sb">`</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Using cli to generate type definitions</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pnpm graphql-codegen --config codegen.yml
</code></pre></td></tr></table>
</div>
</div><p>The generated results are roughly as follows, basically the parameters and result types</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">Types</span> <span class="nx">from</span> <span class="s2">&#34;../graphql.gql&#34;</span><span class="p">;</span>

<span class="kr">export</span> <span class="nx">type</span> <span class="nx">FindRepoStarQueryVariables</span> <span class="o">=</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">Exact</span><span class="o">&lt;</span><span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">Scalars</span><span class="p">[</span><span class="s2">&#34;String&#34;</span><span class="p">];</span>
  <span class="nx">owner</span><span class="o">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">Scalars</span><span class="p">[</span><span class="s2">&#34;String&#34;</span><span class="p">];</span>
<span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kr">export</span> <span class="nx">type</span> <span class="nx">FindRepoStarQuery</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">__typename</span><span class="o">?:</span> <span class="s2">&#34;Query&#34;</span><span class="p">;</span>
  <span class="nx">repository</span><span class="o">?:</span>
    <span class="o">|</span> <span class="p">{</span> <span class="nx">__typename</span><span class="o">?:</span> <span class="s2">&#34;Repository&#34;</span><span class="p">;</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span> <span class="nx">stargazerCount</span><span class="o">:</span> <span class="nx">number</span> <span class="p">}</span>
    <span class="o">|</span> <span class="kc">null</span>
    <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="nx">type</span> <span class="nx">FindRepoQueryVariables</span> <span class="o">=</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">Exact</span><span class="o">&lt;</span><span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">Scalars</span><span class="p">[</span><span class="s2">&#34;String&#34;</span><span class="p">];</span>
  <span class="nx">owner</span><span class="o">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">Scalars</span><span class="p">[</span><span class="s2">&#34;String&#34;</span><span class="p">];</span>
<span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kr">export</span> <span class="nx">type</span> <span class="nx">FindRepoQuery</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">__typename</span><span class="o">?:</span> <span class="s2">&#34;Query&#34;</span><span class="p">;</span>
  <span class="nx">repository</span><span class="o">?:</span> <span class="p">{</span> <span class="nx">__typename</span><span class="o">?:</span> <span class="s2">&#34;Repository&#34;</span><span class="p">;</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">string</span> <span class="p">}</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>We can use it like this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="o">&lt;</span><span class="nx">FindRepoStarQuery</span><span class="p">,</span> <span class="nx">FindRepoStarQueryVariables</span><span class="o">&gt;</span><span class="p">({</span>
  <span class="nx">query</span><span class="o">:</span> <span class="nx">findRepoStar</span><span class="p">,</span>
  <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;liuli-tools&#34;</span><span class="p">,</span>
    <span class="nx">owner</span><span class="o">:</span> <span class="s2">&#34;rxliuli&#34;</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;res: &#34;</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="jetbrains-ide-support">Jetbrains IDE support</h2>
<ol>
<li>
<p>install the plugin <a href="https://plugins.jetbrains.com/plugin/8097">JS GraphQL</a></p>
</li>
<li>
<p>create graphql base configuration file <em>.graphqlconfig</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
<span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;github GraphQL Schema&#34;</span><span class="p">,</span>
<span class="nt">&#34;schemaPath&#34;</span><span class="p">:</span> <span class="s2">&#34;schema.graphql&#34;</span><span class="p">,</span>
<span class="nt">&#34;extensions&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;endpoints&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;Default GraphQL Endpoint&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.github.com/graphql&#34;</span><span class="p">,</span>
        <span class="nt">&#34;headers&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;user-agent&#34;</span><span class="p">:</span> <span class="s2">&#34;JS GraphQL&#34;</span><span class="p">,</span>
        <span class="nt">&#34;Authorization&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer ${env:GITHUB_TOKEN}&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;introspect&#34;</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Final effect</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/16/138a5d2e2a3f41d8bbc439ec7b709e99.png" alt="image"></p>
</li>
</ol>
<h2 id="vscode-support">VSCode support</h2>
<ol>
<li>
<p>install the plugin <a href="https://marketplace.visualstudio.com/items?itemName=apollographql.vscode-apollo">Apollo GraphQL</a></p>
</li>
<li>
<p>add configuration <em>apollo.config.js</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">client</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">service</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;github GraphQL Schema&#34;</span><span class="p">,</span>
    <span class="nx">localSchemaFile</span><span class="o">:</span> <span class="s2">&#34;./schema.graphql&#34;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">},</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Final effect</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/16/058da2ef5d494b02887bc649902c5d11.png" alt="image"></p>
</li>
</ol>
<h2 id="integration-into-viterollup">Integration into vite/rollup</h2>
<p>The reason why autogeneration should be integrated as a vite plugin was previously explained in <a href="https://blog.rxliuli.com/p/3e5d207024444d3e9f8395c1302d6201">Is it necessary to integrate the cli tool into the build tool</a>.</p>
<blockquote>
<p><a href="https://github.com/danielwaltz/vite-plugin-graphql-codegen">vite-plugin-graphql-codegen</a> The monitoring mode is actually buggy, so maintain a rollup plugin yourself</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Plugin</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;vite&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">CodegenContext</span><span class="p">,</span> <span class="nx">generate</span><span class="p">,</span> <span class="nx">loadContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;@graphql-codegen/cli&#34;</span><span class="p">;</span>

<span class="kr">async</span> <span class="kd">function</span> <span class="nx">codegen</span><span class="p">(</span><span class="nx">watch</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">codegenContext</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">loadContext</span><span class="p">();</span>
  <span class="nx">codegenContext</span><span class="p">.</span><span class="nx">updateConfig</span><span class="p">({</span> <span class="nx">watch</span> <span class="p">});</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">await</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">codegenContext</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Something went wrong.&#34;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">graphQLCodegen</span><span class="p">()</span><span class="o">:</span> <span class="nx">Plugin</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">codegenContext</span><span class="o">:</span> <span class="nx">CodegenContext</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;rollup-plugin-graphql-codegen&#34;</span><span class="p">,</span>
    <span class="kr">async</span> <span class="nx">buildStart</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// noinspection ES6MissingAwait
</span><span class="c1"></span>      <span class="nx">codegen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">watchMode</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Here you can actually use <code>worker_threads</code> to try to accelerate multiple threads.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Plugin</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;vite&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">generate</span><span class="p">,</span> <span class="nx">loadContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;@graphql-codegen/cli&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">isMainThread</span><span class="p">,</span> <span class="nx">parentPort</span><span class="p">,</span> <span class="nx">Worker</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;worker_threads&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">expose</span><span class="p">,</span> <span class="nx">wrap</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;comlink&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">nodeEndpoint</span> <span class="nx">from</span> <span class="s2">&#34;comlink/dist/umd/node-adapter&#34;</span><span class="p">;</span>

<span class="kr">async</span> <span class="kd">function</span> <span class="nx">codegen</span><span class="p">(</span><span class="nx">watch</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">codegenContext</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">loadContext</span><span class="p">();</span>
  <span class="nx">codegenContext</span><span class="p">.</span><span class="nx">updateConfig</span><span class="p">({</span> <span class="nx">watch</span> <span class="p">});</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">await</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">codegenContext</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Something went wrong.&#34;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isMainThread</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">expose</span><span class="p">(</span><span class="nx">codegen</span><span class="p">,</span> <span class="nx">nodeEndpoint</span><span class="p">(</span><span class="nx">parentPort</span><span class="o">!</span><span class="p">));</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">graphQLCodegen</span><span class="p">()</span><span class="o">:</span> <span class="nx">Plugin</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;rollup-plugin-graphql-codegen&#34;</span><span class="p">,</span>
    <span class="kr">async</span> <span class="nx">buildStart</span><span class="p">()</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="nx">__filename</span><span class="p">);</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">codegenWorker</span> <span class="o">=</span> <span class="nx">wrap</span><span class="o">&lt;</span><span class="p">(</span><span class="nx">watch</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="o">&gt;</span><span class="p">(</span>
          <span class="nx">nodeEndpoint</span><span class="p">(</span><span class="nx">worker</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="c1">// noinspection ES6MissingAwait
</span><span class="c1"></span>        <span class="nx">codegenWorker</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">watchMode</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="nx">worker</span><span class="p">.</span><span class="nx">unref</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Posted to <a href="https://www.npmjs.com/package/@liuli-util/rollup-plugin-graphql-codegen">@liuli-util/rollup-plugin-graphql-codegen</a></p>
</blockquote>
<h2 id="install-the-chrome-plugin">Install the chrome plugin</h2>
<blockquote>
<p><a href="https://chrome.google.com/webstore/detail/ndlbedplllcgconngcnfmkadhokfaaln/">GraphQL Network Inspector</a></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/16/38e922e2d4ea42dfa2935760faf507de.png" alt="image"></p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.apollographql.com/docs/react/get-started/">@apollo/client</a></li>
<li><a href="https://jimkyndemeyer.github.io/js-graphql-intellij-plugin/">jetbrains ide using graphql</a></li>
<li><a href="https://www.graphql-code-generator.com/">graphql code generator</a></li>
</ul>
<h2 id="other-options">Other options?</h2>
<ul>
<li>Use the rollup plugin <code>@rollup/plugin-graphql</code> to treat <code>.graphql</code> files directly as importable es modules - the main issue is to deal with compatibility of related tools, mainly jest/eslint.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/typescript/">typescript</a>
          <a href="/tags/graphql/">graphql</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/youtube-dl-uberspace-sue/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">youtube dl official web hosting platform sued by three major record labels</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/monorepo/">
            <span class="next-text nav-default">Directly point to the source code when referencing dependencies in monorepo</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
