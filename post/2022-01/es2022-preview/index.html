<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>ECMAScript 2022 Preview: 10 Proposals for Stage 4 in 2021 - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="In 2021, a number of proposals entered Stage 4 of TC39. In the TC39 process, each proposal starts at Stage 0, and moving to Stage 4 means that the proposal has been signed off by the ECMAScript editors and has become a de facto standard feature. This article lists the 10 proposals that will enter Stage 4 in 2021 and will be incorporated into ECMAScript 2022. Class Fields Declares the" /><meta name="keywords" content="ECMAScript, 2022, Preview" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/es2022-preview/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="ECMAScript 2022 Preview: 10 Proposals for Stage 4 in 2021" />
<meta property="og:description" content="In 2021, a number of proposals entered Stage 4 of TC39. In the TC39 process, each proposal starts at Stage 0, and moving to Stage 4 means that the proposal has been signed off by the ECMAScript editors and has become a de facto standard feature. This article lists the 10 proposals that will enter Stage 4 in 2021 and will be incorporated into ECMAScript 2022. Class Fields Declares the" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/es2022-preview/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-14T09:31:05+08:00" />
<meta property="article:modified_time" content="2022-01-14T09:31:05+08:00" />

<meta itemprop="name" content="ECMAScript 2022 Preview: 10 Proposals for Stage 4 in 2021">
<meta itemprop="description" content="In 2021, a number of proposals entered Stage 4 of TC39. In the TC39 process, each proposal starts at Stage 0, and moving to Stage 4 means that the proposal has been signed off by the ECMAScript editors and has become a de facto standard feature. This article lists the 10 proposals that will enter Stage 4 in 2021 and will be incorporated into ECMAScript 2022. Class Fields Declares the"><meta itemprop="datePublished" content="2022-01-14T09:31:05+08:00" />
<meta itemprop="dateModified" content="2022-01-14T09:31:05+08:00" />
<meta itemprop="wordCount" content="1699">
<meta itemprop="keywords" content="ecmascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ECMAScript 2022 Preview: 10 Proposals for Stage 4 in 2021"/>
<meta name="twitter:description" content="In 2021, a number of proposals entered Stage 4 of TC39. In the TC39 process, each proposal starts at Stage 0, and moving to Stage 4 means that the proposal has been signed off by the ECMAScript editors and has become a de facto standard feature. This article lists the 10 proposals that will enter Stage 4 in 2021 and will be incorporated into ECMAScript 2022. Class Fields Declares the"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">ECMAScript 2022 Preview: 10 Proposals for Stage 4 in 2021</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-14 09:31:05 </span>
        <div class="post-category">
            <a href="/categories/news/"> news </a>
            </div>
          <span class="more-meta"> 1699 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#class-fields">Class Fields</a></li>
        <li><a href="#private-fields-methods">Private Fields, Methods</a></li>
        <li><a href="#public-static-class-fields">Public Static Class Fields</a></li>
        <li><a href="#public-static-class-fields-1">Public Static Class Fields</a></li>
        <li><a href="#private-fields-in-operator">Private Fields In Operator</a></li>
        <li><a href="#class-static-initialization-blocks">Class Static Initialization Blocks</a></li>
        <li><a href="#relative-indexing-at-method">Relative indexing .at() method</a></li>
        <li><a href="#objecthasown">Object.hasOwn</a></li>
        <li><a href="#error-cause">Error Cause</a></li>
        <li><a href="#regexp-match-indices-d-flag">RegExp Match Indices (&rsquo;d' Flag)</a></li>
        <li><a href="#top-level">Top-Level</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>In 2021, a number of proposals entered Stage 4 of TC39. In the TC39 process, each proposal starts at Stage 0, and moving to Stage 4 means that the proposal has been signed off by the ECMAScript editors and has become a de facto standard feature.</p>
<p>This article lists the 10 proposals that will enter Stage 4 in 2021 and will be incorporated into ECMAScript 2022.</p>
<h2 id="class-fields">Class Fields</h2>
<p>Declares the fields of a class.</p>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-class-fields">https://github.com/tc39/proposal-class-fields</a></p>
</blockquote>
<p>Until now, in the ES specification, class fields were defined and initialised in the class constructor. However, in the new proposal, class fields can be defined and initialised at the top level of the class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Post</span> <span class="p">{</span>
 <span class="nx">title</span><span class="p">;</span>
 <span class="nx">content</span><span class="p">;</span>
 <span class="nx">shares</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The proposal adds the features described in the following table to the ECMAScript Class (existing features in green).</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/14/016c27943f9048f38b8e1f6aa24ae6c8.png" alt="esfeatures"></p>
<p>The features included in the proposal are currently available in Chrome 74, Node 12, Safari Technology Preview 117, TypeScript 3.8, Babel 7.0+ and many more environments. However, it should be noted that because TypeScript, for example, had its own Class field implementation before the proposal officially entered Stage 4, the specific details of the semantics will differ from the preceding ECMAScript standard.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Base</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">initProps</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">initProps</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;xxx&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">class</span> <span class="nx">Derived</span> <span class="kr">extends</span> <span class="nx">Base</span> <span class="p">{</span>
  <span class="nx">age</span><span class="o">:</span> <span class="nx">number</span><span class="p">;</span>

  <span class="nx">initProps</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">.</span><span class="nx">initProps</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Derived</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="private-fields-methods">Private Fields, Methods</h2>
<p>This proposal is part of the Class Fields family of proposals, which use the <code>#</code> prefix to define private methods and fields of a class.</p>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-private-methods">https://github.com/tc39/proposal-private-methods</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Example</span> <span class="p">{</span>
  <span class="err">#</span><span class="nx">value</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="err">#</span><span class="nx">calc</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">value</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">print</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">calc</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Example</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="err">#</span><span class="nx">value</span><span class="p">);</span>    <span class="c1">// SyntaxError
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="err">#</span><span class="nx">calc</span><span class="p">());</span>   <span class="c1">// SyntaxError
</span><span class="c1"></span><span class="nx">object</span><span class="p">.</span><span class="nx">print</span><span class="p">();</span>                <span class="c1">// 50
</span></code></pre></td></tr></table>
</div>
</div><h2 id="public-static-class-fields">Public Static Class Fields</h2>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-static-class-features">https://github.com/tc39/proposal-static-class-features</a></p>
</blockquote>
<p>Building on the previous class fields and private methods proposal, this proposal adds the features of <code>Static public fields', </code>Static private methods' and `Static private fields' to JavaScript classes. The</p>
<h2 id="public-static-class-fields-1">Public Static Class Fields</h2>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-static-class-features">https://github.com/tc39/proposal-static-class-features</a></p>
</blockquote>
<p>Building on the previous proposals for fields and private methods for classes, this proposal adds Static public fields, Static private methods and Static private fields features to JavaScript classes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// without static class fields:
</span><span class="c1"></span><span class="kr">class</span> <span class="nx">Customer</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
<span class="nx">Customer</span><span class="p">.</span><span class="nx">idCounter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// with static class fields:
</span><span class="c1"></span><span class="kr">class</span> <span class="nx">Customer</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">idCounter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="private-fields-in-operator">Private Fields In Operator</h2>
<p>Detects if private fields exist.</p>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-private-fields-in-in">https://github.com/tc39/proposal-private-fields-in-in</a></p>
</blockquote>
<p>Since attempting to access a private field that does not exist on an object raises an exception, there is a need to be able to check whether an object has a given private field.</p>
<p>This proposal provides the use of the <code>in</code> operator to determine whether the <code>field</code> introduced in the Class Private Fields proposal, which was formally introduced in Stage 4 recently, exists in an object. As opposed to directly accessing a private field by <code>try { obj.#foo } catch { /* #foo not existing in obj */ }</code> to determine whether an object has a corresponding <code>field</code> installed, Private-In can distinguish between an access error and the absence of a real <code>field</code>, which would not be distinguished by try-catch in the following scenarios whether it is an access exception or whether the <code>field</code> really does not exist.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">C</span> <span class="p">{</span>
  <span class="nx">get</span> <span class="err">#</span><span class="nx">getter</span><span class="p">()</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;gotcha&#39;</span><span class="p">);</span> <span class="p">}</span>
  
  <span class="kr">static</span> <span class="nx">isC</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span> 
      <span class="nx">obj</span><span class="p">.</span><span class="err">#</span><span class="nx">getter</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>And the semantics of the <code>in</code> operator, which is similar to that of a normal field, determines whether a <code>#field</code> exists on an object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">C</span> <span class="p">{</span>
  <span class="err">#</span><span class="nx">brand</span><span class="p">;</span>

  <span class="err">#</span><span class="nx">method</span><span class="p">()</span> <span class="p">{}</span>

  <span class="nx">get</span> <span class="err">#</span><span class="nx">getter</span><span class="p">()</span> <span class="p">{}</span>

  <span class="kr">static</span> <span class="nx">isC</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="err">#</span><span class="nx">brand</span> <span class="k">in</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="err">#</span><span class="nx">method</span> <span class="k">in</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="err">#</span><span class="nx">getter</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="class-static-initialization-blocks">Class Static Initialization Blocks</h2>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-class-static-block">https://github.com/tc39/proposal-class-static-block</a></p>
</blockquote>
<p>Class Static Initialization Blocks provide a way of evaluating static initialization blocks during class declaration/definition, giving access to Class Private Fields.</p>
<p>Since the advent of Class Private Fields, there has been a constant flow of new practices and needs for class syntax. A similar capability for static initialisation blocks exists in languages such as Java, Static Initialization Blocks.</p>
<p>The initialization blocks defined in the proposal can acquire scope within the class, just like the methods of the class, and imply access to the <code># fields</code> of the class. With this definition, we can implement the Friend class in JavaScript.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Example</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">propertyA</span><span class="p">;</span>
  <span class="kr">static</span> <span class="err">#</span><span class="nx">propertyB</span><span class="p">;</span> <span class="c1">// private
</span><span class="c1"></span>
  <span class="kr">static</span> <span class="p">{</span> <span class="c1">// static initializer block
</span><span class="c1"></span>    <span class="k">try</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;example.json&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">propertyA</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">someProperty</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">propertyB</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">anotherProperty</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">propertyA</span> <span class="o">=</span> <span class="s1">&#39;default1&#39;</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">propertyB</span> <span class="o">=</span> <span class="s1">&#39;default2&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">print</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Example</span><span class="p">.</span><span class="nx">propertyA</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Example</span><span class="p">.</span><span class="err">#</span><span class="nx">propertyB</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Example</span><span class="p">.</span><span class="nx">print</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="relative-indexing-at-method">Relative indexing .at() method</h2>
<p>New .at() method on all built-in indexable data.</p>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-relative-indexing-method">https://github.com/tc39/proposal-relative-indexing-method</a></p>
</blockquote>
<p>This proposal provides a way to fetch elements from the beginning (forward indexing) or end (reverse indexing) of a string (or array) without using temporary variables.</p>
<p>In many cases, negative indexing of arrays like in Python is very useful. For example, in Python we can access the last element of an array via <code>arr[-1]</code> instead of the current JavaScript method of <code>arr[arr.length-1]</code>. Here the negative number is used as a reverse index from the starting element (i.e. <code>arr[0]</code>).</p>
<p>But the problem in JavaScript now is that the syntax <code>[]</code> is not just used in arrays (and certainly not in Python), and it is not just used as an index in arrays. Referring to a value by index, as in <code>arr[1]</code>, is in fact a reference to the <code>&quot;1&quot;</code> property of the object. So <code>arr[-1]</code> is already perfectly usable in today&rsquo;s JavaScript engines, except that it may not mean what we want it to mean: it refers to the <code>&quot;-1&quot;</code> property of the target object, rather than being an inverted index.</p>
<p>This proposal provides a generic solution, allowing access to any reverse-indexed, or forward-indexed, element via the <code>.at</code> method on any indexable type (<strong>Array, String, and TypedArray</strong>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 数组
</span><span class="c1"></span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nx">at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// =&gt; 5
</span><span class="c1"></span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nx">at</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// =&gt; 4
</span><span class="c1"></span>
<span class="c1">// 字符串
</span><span class="c1"></span><span class="s1">&#39;abcdefghi&#39;</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// =&gt; i
</span><span class="c1"></span><span class="s1">&#39;abcdefghi&#39;</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// =&gt; h
</span></code></pre></td></tr></table>
</div>
</div><h2 id="objecthasown">Object.hasOwn</h2>
<blockquote>
<p>Proposal link: [https://github.com/tc39/proposal-accessible-object-hasownproperty](<a href="https://github.com/tc39/proposal-accessible-object-">https://github.com/tc39/proposal-accessible-object-</a> hasownproperty)</p>
</blockquote>
<p>In short, the proposal is to use <code>Object.hasOwn</code> instead of <code>Object.prototype.hasOwnProperty.call</code>, a cleaner and more reliable way to check if a property is set directly on an object.</p>
<h2 id="error-cause">Error Cause</h2>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-error-cause">https://github.com/tc39/proposal-error-cause</a></p>
</blockquote>
<p>Error Cause is a proposal by Alibaba and is claimed to be the first Chinese TC39 proposal to make it to Stage 4.</p>
<p>This proposal adds a new attribute <code>cause</code> to the Error constructor in JavaScript, which allows developers to attach an error cause to a thrown error to clearly pass error context information across multiple call stacks. Specifically, the proposal adds an optional parameter options to the Error Constructor, which sets cause and accepts any JavaScript value (JavaScript can throw any value, such as undefined or a string), which is assigned to the newly created <code>error.cause</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;//unintelligible-url-a&#39;</span><span class="p">)</span> <span class="c1">// 抛出一个 low level 错误
</span><span class="c1"></span>      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Download raw resource failed&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cause</span><span class="o">:</span> <span class="nx">err</span> <span class="p">})</span> <span class="c1">// 将 low level 错误包装成一个 high level、易懂的错误
</span><span class="c1"></span>    <span class="p">})</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Caused by&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">cause</span><span class="p">)</span>
  <span class="c1">// Error: Download raw resource failed
</span><span class="c1"></span>  <span class="c1">// Caused by TypeError: Failed to fetch
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="regexp-match-indices-d-flag">RegExp Match Indices (&rsquo;d' Flag)</h2>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-regexp-match-indices">https://github.com/tc39/proposal-regexp-match-indices</a></p>
</blockquote>
<p>The return value of the <code>RegExp.prototype.exec</code> method in the current ECMAScript already provides the index in the regular expression for the text of the matching Capture Group and the corresponding Capture Group. However, in some cases we don&rsquo;t just want to match text, we need to get the start and end position of the text being matched in the output text, for example, we need this information to provide syntax highlighting in development environments such as VS Code. Therefore, the <a href="https://github.com/tc39/proposal-regexp-match-indices">RegExp Match Indices (&rsquo;d' Flag)</a> proposal expects to add the <code> indices</code> property to describe this positional information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&#34;Let&#39;s match one:1.&#34;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="err">/match\s(?&lt;word&gt;\w+):(?&lt;digit&gt;\d)/gd;</span>

<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">match</span> <span class="k">of</span> <span class="nx">text</span><span class="p">.</span><span class="nx">matchAll</span><span class="p">(</span><span class="nx">regexp</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above code would output the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="s1">&#39;match one:1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;one&#39;</span><span class="p">,</span>
  <span class="s1">&#39;1&#39;</span><span class="p">,</span>
  <span class="nx">index</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
  <span class="nx">input</span><span class="o">:</span> <span class="s2">&#34;Let&#39;s match one:1.&#34;</span><span class="p">,</span>
  <span class="nx">groups</span><span class="o">:</span> <span class="p">{</span> <span class="nx">word</span><span class="o">:</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="nx">digit</span><span class="o">:</span> <span class="s1">&#39;1&#39;</span> <span class="p">},</span>
  <span class="nx">indices</span><span class="o">:</span> <span class="p">{</span>
    <span class="mi">0</span><span class="o">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">17</span><span class="p">],</span>
    <span class="mi">1</span><span class="o">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">],</span>
    <span class="mi">2</span><span class="o">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">],</span>
    <span class="nx">groups</span><span class="o">:</span> <span class="p">{</span> 
      <span class="nx">digit</span><span class="o">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">],</span>
      <span class="nx">word</span><span class="o">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="top-level">Top-Level</h2>
<blockquote>
<p>Proposal link: <a href="https://github.com/tc39/proposal-top-level-await">https://github.com/tc39/proposal-top-level-await</a></p>
</blockquote>
<p>ECMAScript 2017 introduces Async functions and the <code>await</code> keyword, a feature that greatly simplifies the use of Promise. However, <code>await</code> can only be used inside Async functions.</p>
<p>The new proposal <a href="https://github.com/tc39/proposal-top-level-await">Top-Level</a> <code>await</code> allows <code>await</code> to be used outside of Async functions (e.g. CLI scripts, as well as dynamic import and data loading). This proposal treats ES Modules as large Async functions, so that these ES Modules can wait for resources to be loaded, so that other modules importing these modules will have to wait for resources to be loaded before they can start executing their own code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// load-attribute.mjs 
</span><span class="c1">// with top-level await
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="kr">await</span> <span class="p">(</span><span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;https://some.url&#34;</span><span class="p">)).</span><span class="nx">text</span><span class="p">();</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">attribute</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">someAttribute</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// main.mjs 
</span><span class="c1">// loaded after load-attribute.mjs is fully loaded
</span><span class="c1">// and its exports are available
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">attribute</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;./load-attribute.mjs&#34;</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">attribute</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/ecmascript/">ecmascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/linux-process-stuck/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">What should I do if my Linux process is stuck?</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/promise-async-await/">
            <span class="next-text nav-default">Promise or Async/Await?</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
