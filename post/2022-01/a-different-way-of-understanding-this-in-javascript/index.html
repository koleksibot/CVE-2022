<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Explaining &#34;this&#34; in JavaScript from a new perspective - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article attempts to explain how the this keyword works in JavaScript from a new perspective: we assume that arrow functions are real functions, and that ordinary functions are just a special language construct. I think this explanation makes this better understood, so try it out. 1. Two kinds of functions This article focuses on two different kinds of functions. Normal functions: function () {} The arrow function: () =&amp;gt;" /><meta name="keywords" content="javascript" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/a-different-way-of-understanding-this-in-javascript/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Explaining &#34;this&#34; in JavaScript from a new perspective" />
<meta property="og:description" content="This article attempts to explain how the this keyword works in JavaScript from a new perspective: we assume that arrow functions are real functions, and that ordinary functions are just a special language construct. I think this explanation makes this better understood, so try it out. 1. Two kinds of functions This article focuses on two different kinds of functions. Normal functions: function () {} The arrow function: () =&gt;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/a-different-way-of-understanding-this-in-javascript/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-17T09:35:33+08:00" />
<meta property="article:modified_time" content="2022-01-17T09:35:33+08:00" />

<meta itemprop="name" content="Explaining &#34;this&#34; in JavaScript from a new perspective">
<meta itemprop="description" content="This article attempts to explain how the this keyword works in JavaScript from a new perspective: we assume that arrow functions are real functions, and that ordinary functions are just a special language construct. I think this explanation makes this better understood, so try it out. 1. Two kinds of functions This article focuses on two different kinds of functions. Normal functions: function () {} The arrow function: () =&gt;"><meta itemprop="datePublished" content="2022-01-17T09:35:33+08:00" />
<meta itemprop="dateModified" content="2022-01-17T09:35:33+08:00" />
<meta itemprop="wordCount" content="1334">
<meta itemprop="keywords" content="javascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Explaining &#34;this&#34; in JavaScript from a new perspective"/>
<meta name="twitter:description" content="This article attempts to explain how the this keyword works in JavaScript from a new perspective: we assume that arrow functions are real functions, and that ordinary functions are just a special language construct. I think this explanation makes this better understood, so try it out. 1. Two kinds of functions This article focuses on two different kinds of functions. Normal functions: function () {} The arrow function: () =&gt;"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Explaining &#34;this&#34; in JavaScript from a new perspective</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-17 09:35:33 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1334 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-two-kinds-of-functions">1. Two kinds of functions</a>
          <ul>
            <li><a href="#11-common-functions">1.1 Common functions</a></li>
            <li><a href="#12-arrow-functions">1.2 Arrow functions</a></li>
            <li><a href="#13-common-functions-as-methods">1.3 Common functions as methods</a></li>
          </ul>
        </li>
        <li><a href="#2-common-errors">2. Common errors</a>
          <ul>
            <li><a href="#21-error-accessing-this-in-a-callback-function-in-the-case-of-a-promise">2.1 Error: accessing this in a callback function (in the case of a Promise)</a></li>
            <li><a href="#22-error-accessing-this-in-a-callback-function-in-the-case-of-map">2.2 Error: Accessing this in a callback function (in the case of <code>.map</code>)</a></li>
            <li><a href="#23-error-using-methods-as-callbacks">2.3 Error: Using methods as callbacks</a></li>
          </ul>
        </li>
        <li><a href="#3-guidelines-to-prevent-errors">3. Guidelines to prevent errors</a>
          <ul>
            <li><a href="#31-dont-use-this-as-an-argument">3.1 Don&rsquo;t use this as an argument</a></li>
          </ul>
        </li>
        <li><a href="#4-read-more">4. Read more</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>This article attempts to explain how the this keyword works in JavaScript from a new perspective: we assume that arrow functions are real functions, and that ordinary functions are just a special language construct. I think this explanation makes <code>this</code> better understood, so try it out.</p>
<h2 id="1-two-kinds-of-functions">1. Two kinds of functions</h2>
<p>This article focuses on two different kinds of functions.</p>
<ul>
<li>Normal functions: <code>function () {}</code></li>
<li>The arrow function: <code>() =&gt; {}</code></li>
</ul>
<h3 id="11-common-functions">1.1 Common functions</h3>
<p>We define a normal function like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Every normal function implies a this when it is called, which means that in strict mode, the following two expressions are equivalent</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="nx">add</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>This will be overridden (shadowed) if nested in a normal function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">outer</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">inner</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// undefined
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// &#39;outer&#39;
</span><span class="c1"></span>    <span class="nx">inner</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">outer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>This inside inner() is different from this inside outer(). inner() has its own this. Let&rsquo;s assume that this is the variable declared on display, then the code would look like this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">outer</span><span class="p">(</span><span class="nx">_this</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">inner</span><span class="p">(</span><span class="nx">_this</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_this</span><span class="p">);</span> <span class="c1">// undefined
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_this</span><span class="p">);</span> <span class="c1">// &#39;outer&#39;
</span><span class="c1"></span>    <span class="nx">inner</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">outer</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>inner() overrides this in outer(), a rule that also applies to nested scopes</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">_this</span> <span class="o">=</span> <span class="s1">&#39;outer&#39;</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_this</span><span class="p">);</span> <span class="c1">// &#39;outer&#39;
</span><span class="c1"></span><span class="p">{</span>
    <span class="kr">const</span> <span class="nx">_this</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_this</span><span class="p">);</span> <span class="c1">// undefined
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Since ordinary functions always have an implicit argument to this, it might be more appropriate to call these functions &ldquo;methods&rdquo;.</p>
<h3 id="12-arrow-functions">1.2 Arrow functions</h3>
<p>We define an arrow function like this (I have used a block to define it so that it looks more like a normal function)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>If you nest an arrow function inside a normal function, this will not be overridden</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">outer</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">inner</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// &#39;outer&#39;
</span><span class="c1"></span>    <span class="p">};</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// &#39;outer&#39;
</span><span class="c1"></span>    <span class="nx">inner</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">outer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Given this characteristic of arrow functions, I would call them &ldquo;real functions&rdquo;. Arrow functions are more similar to functions in most other programming languages than to normal functions. It is worth noting that the value of this in an arrow function is not even affected by .call() or anything else. this only depends on the scope in which the arrow function was created. For example</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">ordinary</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arrow</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;goodbye&#39;</span><span class="p">));</span> <span class="c1">// &#39;hello&#39;
</span><span class="c1"></span><span class="p">}</span>
<span class="nx">ordinary</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="13-common-functions-as-methods">1.3 Common functions as methods</h3>
<p>If an ordinary function is a property of an object, then this function is a method</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">prop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>One way to access an object&rsquo;s properties is through the dot (.) operator. This operator has two different modes.</p>
<ul>
<li>Get or set a property: <code>obj.prop</code></li>
<li>Calling the method: <code>obj.prop(x, y)</code> The latter is equivalent to.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">obj</span><span class="p">.</span><span class="nx">prop</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, when a normal function is called, it always carries an implied this. There is also a simpler way of defining special syntax in JavaScript</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">prop</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="2-common-errors">2. Common errors</h2>
<p>We analyse the following common errors with the help of the previous points.</p>
<h3 id="21-error-accessing-this-in-a-callback-function-in-the-case-of-a-promise">2.1 Error: accessing this in a callback function (in the case of a Promise)</h3>
<p>In the code example below, which consists of a Promise, the log &ldquo;Done&rdquo; is hit when the asynchronous function cleanupAsync() finishes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 在某个类或对象字面量中:
</span><span class="c1"></span><span class="nx">performCleanup</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cleanupAsync</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logStatus</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">);</span> <span class="c1">// (A)
</span><span class="c1"></span>    <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The code executes to line (A) of <code>this.logStatus()</code> with an error. The error is that the this of this line is different from the this of <code>.performCleanup()</code>. The callback function&rsquo;s own this overrides the outer this, meaning that we are using a normal function where we should be using an arrow function. The code works fine after switching to the arrow function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 在某个类或对象字面量中:
</span><span class="c1"></span><span class="nx">performCleanup</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cleanupAsync</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logStatus</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-error-accessing-this-in-a-callback-function-in-the-case-of-map">2.2 Error: Accessing this in a callback function (in the case of <code>.map</code>)</h3>
<p>Similarly, the following code will error on line (A). The reason for this is that the callback function overrides the this of the <code>.prefixNames()</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 在某个类或对象字面量中:
</span><span class="c1"></span><span class="nx">prefixNames</span><span class="p">(</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">names</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">company</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span> <span class="c1">// (A)
</span><span class="c1"></span>    <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Again, just replace with the arrow function</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 在某个类或对象字面量中:
</span><span class="c1"></span><span class="nx">prefixNames</span><span class="p">(</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">names</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
        <span class="nx">name</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">company</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="23-error-using-methods-as-callbacks">2.3 Error: Using methods as callbacks</h3>
<p>Suppose you have the following UI component code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">UiComponent</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>

        <span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">);</span>
        <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">);</span> <span class="c1">// (A)
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="nx">handleClick</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Clicked &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// (B)
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In line (A), the UiComponent sets up the response function for the click event. Unfortunately, however, an exception is thrown when the event does fire</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">TypeError: Cannot read property &#39;name&#39; of undefined
</code></pre></td></tr></table>
</div>
</div><p>What is the reason for this? In line (A), we are using the normal property access syntax, where . is not a special method call syntax. What this means is that the function present in handleClick is set as the response function, which is roughly equivalent to the following code</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">;</span>
<span class="nx">handler</span><span class="p">();</span><span class="c1">// 等价于: handler.call(undefined);
</span></code></pre></td></tr></table>
</div>
</div><p>This causes an error in line (B) <code>this.name</code>. So how do we fix this? The problem here is that the dot operator doesn&rsquo;t simply read the property and call the function when it makes the method call. We need to manually fill in the missing piece with .bind() after we get the method and assign a value to this, as shown in line (A)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">UiComponent</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>

        <span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">);</span>
        <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
            <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="c1">// (A)
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="nx">handleClick</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Clicked &#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This will fix the this problem. The value of this does not change when the function is called.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">returnThis</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">bound</span> <span class="o">=</span> <span class="nx">returnThis</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
<span class="nx">bound</span><span class="p">();</span> <span class="c1">// &#39;hello&#39;
</span><span class="c1"></span><span class="nx">bound</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span> <span class="c1">// &#39;hello&#39;
</span></code></pre></td></tr></table>
</div>
</div><h2 id="3-guidelines-to-prevent-errors">3. Guidelines to prevent errors</h2>
<p>The easiest way is to avoid using normal functions and just use method definitions or arrow functions. But I still like the syntax of function definitions. Function lifting (hoisting) can be useful in some cases. If you avoid using this in a normal function you can also prevent errors. There is an <a href="https://eslint.org/docs/rules/no-invalid-this">ESLint rule</a> that can help you ensure this.</p>
<h3 id="31-dont-use-this-as-an-argument">3.1 Don&rsquo;t use this as an argument</h3>
<p>Some APIs like to pass some parameter-like information through this. I don&rsquo;t really like this approach. It makes it impossible to use arrow functions and goes against the guidelines mentioned earlier.</p>
<p>As an example, in the following code, beforeEach() passes an API object through this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addMatchers</span><span class="p">({</span> <span class="c1">// 访问 API 对象
</span><span class="c1"></span>        <span class="nx">toBeInRange</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
            <span class="err">···</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>This function should be changed to</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">beforeEach</span><span class="p">(</span><span class="nx">api</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">api</span><span class="p">.</span><span class="nx">addMatchers</span><span class="p">({</span>
        <span class="nx">toBeInRange</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ···
</span><span class="c1"></span>        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4-read-more">4. Read more</h2>
<ul>
<li>Blog post &ldquo;<a href="http://2ality.com/2014/05/this.html">JavaScript’s this: how it works, where it can trip you up</a>&rdquo;</li>
<li>Chapter &ldquo;<a href="http://exploringjs.com/es6/ch_callables.html">Callable entities in ECMAScript 6</a>&rdquo; in &ldquo;Exploring ES6&rdquo;</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascript/">javascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/new-features-of-browser-and-js/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Some new features in browsers and JavaScript</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/freebsd-2024/">
            <span class="next-text nav-default">What about the technology of FreeBSD in 2024?</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
