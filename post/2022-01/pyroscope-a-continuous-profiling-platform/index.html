<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>pyroscope: an easy-to-use platform for continuous profiling - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Developers often need to track performance bottlenecks in applications in production environments and try to identify the root cause of the bottlenecks. To do this, they typically gather this information through logs. Unfortunately, this approach can be time-consuming and does not provide sufficiently detailed information about the underlying problem.
A modern and more advanced approach is to apply and use profiling techniques and tools that highlight the slowest application code and methods that consume most of the resources (such as CPU and memory)." /><meta name="keywords" content="pyroscope" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/pyroscope-a-continuous-profiling-platform/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="pyroscope: an easy-to-use platform for continuous profiling" />
<meta property="og:description" content="Developers often need to track performance bottlenecks in applications in production environments and try to identify the root cause of the bottlenecks. To do this, they typically gather this information through logs. Unfortunately, this approach can be time-consuming and does not provide sufficiently detailed information about the underlying problem.
A modern and more advanced approach is to apply and use profiling techniques and tools that highlight the slowest application code and methods that consume most of the resources (such as CPU and memory)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/pyroscope-a-continuous-profiling-platform/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-29T16:16:06+08:00" />
<meta property="article:modified_time" content="2022-01-29T16:16:06+08:00" />

<meta itemprop="name" content="pyroscope: an easy-to-use platform for continuous profiling">
<meta itemprop="description" content="Developers often need to track performance bottlenecks in applications in production environments and try to identify the root cause of the bottlenecks. To do this, they typically gather this information through logs. Unfortunately, this approach can be time-consuming and does not provide sufficiently detailed information about the underlying problem.
A modern and more advanced approach is to apply and use profiling techniques and tools that highlight the slowest application code and methods that consume most of the resources (such as CPU and memory)."><meta itemprop="datePublished" content="2022-01-29T16:16:06+08:00" />
<meta itemprop="dateModified" content="2022-01-29T16:16:06+08:00" />
<meta itemprop="wordCount" content="756">
<meta itemprop="keywords" content="pyroscope," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="pyroscope: an easy-to-use platform for continuous profiling"/>
<meta name="twitter:description" content="Developers often need to track performance bottlenecks in applications in production environments and try to identify the root cause of the bottlenecks. To do this, they typically gather this information through logs. Unfortunately, this approach can be time-consuming and does not provide sufficiently detailed information about the underlying problem.
A modern and more advanced approach is to apply and use profiling techniques and tools that highlight the slowest application code and methods that consume most of the resources (such as CPU and memory)."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">pyroscope: an easy-to-use platform for continuous profiling</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-29 16:16:06 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 756 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction-to-pyroscope">Introduction to Pyroscope</a></li>
        <li><a href="#pyroscope-server-installation">Pyroscope server installation</a></li>
        <li><a href="#client-integration">Client integration</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Developers often need to track performance bottlenecks in applications in production environments and try to identify the root cause of the bottlenecks. To do this, they typically gather this information through logs. Unfortunately, this approach can be time-consuming and does not provide sufficiently detailed information about the underlying problem.</p>
<p>A modern and more advanced approach is to apply and use profiling techniques and tools that highlight the slowest application code and methods that consume most of the resources (such as CPU and memory). Continuous profiling is the process of continuously collecting application performance data in a production environment and making this data available to developers for in-depth analysis.</p>
<p>By, we generate a summary file (Profile) for a single analysis by capturing the metrics of the program. the Go language provides the pprof tool to easily generate a profile file. You can generate CPU, Heap, etc. profile files by calling <a href="https://pkg.go.dev/runtime/pprof">runtime/pprof</a> programmatically, or you can use <a href="https://pkg.go.dev/net/http/pprof">net/http/pprof</a> Integrate into web applications and analyze from command line or web page by go tool pprof tool.</p>
<p>Sometimes we can&rsquo;t perform pprof analysis in time, the fault may have disappeared or the program has crashed. In addition, we may need to compare profiles from different time periods and make comparisons to find problems, such as memory leaks. This is when continuous profiling is important. Many cloud service vendors provide continuous profiling capabilities, such as <a href="https://www.datadoghq.com/dg/apm/ts/profiler/go-continuous-profiler-ts/?utm_source=advertisement&amp;utm_medium=search&amp;utm_campaign=dg-google-profiler-emea-goprofiling-tshirt&amp;utm_keyword=%2Bgo%20%2Bprofiling&amp;utm_matchtype=b&amp;utm_campaignid=15426873343&amp;utm_adgroupid=128217964697&amp;gclid=Cj0KCQiA_8OPBhDtARIsAKQu0gYymyElbglw_I7uZJkZ7ynxfzn1nVojVZJ9rkm_6_hbchG09w4CCmEaAkWfEALw_wcB">Go Continuous Profiler | Datadog</a>, <a href="https://cloud.google.com/profiler/docs">Cloud Profiler | Google Cloud</a>, <a href="https://aws.amazon.com/cn/codeguru/features/">Amazon CodeGuru Profiler</a>, etc.</p>
<h2 id="introduction-to-pyroscope">Introduction to Pyroscope</h2>
<p>If you want to use continuous analysis in your own production system, consider <a href="https://pyroscope.io/">Pyroscope</a>.</p>
<p>Pyroscope is an open source continuous analysis system implemented in Go language. The server side uses web pages to view and provide rich functionality for analysis, and the client side provides support for Go, Java, Python, Ruby, PHP, .NET and other languages, and supports PUSH, PULL two collection methods.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/29/a72cea64c5c74bcfb121ab9b10a764a8.png" alt="sobyte"></p>
<p>First of all, you need to deploy a Pyroscope server, which uses BadgerDB as the storage engine at the bottom, and optimizes the profile data.</p>
<p>Pyroscope server is responsible for receiving (or pulling, we mainly demonstrate the push approach below) the profile data uploaded by the agent, and provides a timeline interface to view the profile data within a period of time. For example, the following figure demonstrates 12 hours of profile data for a <a href="https://rpcx.io/">rpcx</a> microservice application.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/29/f9fcfa0925f24ad08c110148c3d8029b.png" alt="sobyte"></p>
<p>It can display either a flame chart for this period of time, a sorted table display, or both. This flame chart shows that the time consumption is mainly on method calls and codecs of microservices (except for Go runtime scheduling).</p>
<p>You can also select different time periods for comparison, and the time for the left and right graphs can be selected by simply dragging and dropping on the timeline.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/29/c6d84966d0be445d8587ab3c5eb4c94a.png" alt="sobyte"></p>
<p>A diff view is also available, and this is often used for memory leak analysis.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/29/95a285bd261d4e0d96b0cdffe45f9455.png" alt="sobyte"></p>
<h2 id="pyroscope-server-installation">Pyroscope server installation</h2>
<p>The Pyroscope server side can be installed via docker:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">docker run -it -p 4040:4040 pyroscope/pyroscope:latest server
</code></pre></td></tr></table>
</div>
</div><p>It can also be installed directly in each operating system.</p>
<p>For example, Mac:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">brew install pyroscope-io/brew/pyroscope
brew services start pyroscope-server
</code></pre></td></tr></table>
</div>
</div><p>Various Liunx distributions are also easy to install, such as Cebtos:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">wget https://dl.pyroscope.io/release/pyroscope-0.8.0-1-x86_64.rpm
sudo yum localinstall pyroscope-0.8.0-1-x86_64.rpm
sudo systemctl start pyroscope-server
sudo systemctl <span class="nb">enable</span> pyroscope-server
</code></pre></td></tr></table>
</div>
</div><p>For example, ubuntu:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">wget https://dl.pyroscope.io/release/pyroscope_0.8.0_amd64.deb
sudo apt-get install ./pyroscope_0.8.0_amd64.deb
</code></pre></td></tr></table>
</div>
</div><p>Once the installation is complete, you can access it through the web interface: <code>http://localhost:4040</code> , you can change the listening port and some other configuration items through the configuration file.</p>
<h2 id="client-integration">Client integration</h2>
<p>As mentioned above, Pyroscope provides agent sdk in several languages, let&rsquo;s take the Go Push method as an example. Add the agent configuration at the beginning of the application that you need to analyze continuously:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">pyroscope</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="nx">pyroscope</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
    <span class="nx">ApplicationName</span><span class="p">:</span> <span class="s">&#34;simple.golang.app&#34;</span><span class="p">,</span>
    <span class="c1">// replace this with the address of pyroscope server
</span><span class="c1"></span>    <span class="nx">ServerAddress</span><span class="p">:</span>   <span class="s">&#34;http://pyroscope-server:4040&#34;</span><span class="p">,</span>
    <span class="c1">// you can disable logging by setting this to nil
</span><span class="c1"></span>    <span class="nx">Logger</span><span class="p">:</span>          <span class="nx">pyroscope</span><span class="p">.</span><span class="nx">StandardLogger</span><span class="p">,</span>
    <span class="c1">// by default all profilers are enabled,
</span><span class="c1"></span>    <span class="c1">// but you can select the ones you want to use:
</span><span class="c1"></span>    <span class="nx">ProfileTypes</span><span class="p">:</span> <span class="p">[]</span><span class="nx">pyroscope</span><span class="p">.</span><span class="nx">ProfileType</span><span class="p">{</span>
      <span class="nx">pyroscope</span><span class="p">.</span><span class="nx">ProfileCPU</span><span class="p">,</span>
      <span class="nx">pyroscope</span><span class="p">.</span><span class="nx">ProfileAllocObjects</span><span class="p">,</span>
      <span class="nx">pyroscope</span><span class="p">.</span><span class="nx">ProfileAllocSpace</span><span class="p">,</span>
      <span class="nx">pyroscope</span><span class="p">.</span><span class="nx">ProfileInuseObjects</span><span class="p">,</span>
      <span class="nx">pyroscope</span><span class="p">.</span><span class="nx">ProfileInuseSpace</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>The main configuration is the name of the ApplicationName, which is displayed in the Pyroscope server drop-down box. profile data to be sent to which Pyroscope server, you can configure the ServerAddress, and the profile items to be monitored via ProfileTypes.</p>
<p>Just add these lines of code, start the program, and you&rsquo;ll be able to view the continuously analyzed data in the Pyroscope server&rsquo;s web interface.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/pyroscope/">pyroscope</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/not-addressable-in-golang/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Understanding of non-addressability in Golang</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/volcengine-apache-skywalking/">
            <span class="next-text nav-default">Violation of redistribution SkyWalking, Volcano Engine responds and apologizes</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
