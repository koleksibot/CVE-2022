<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Golang Common Design Patterns - Option Pattern - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="As any developer familiar with Python knows, Python has default parameters that allow us to optionally override certain default parameters as needed when instantiating an object to determine how to instantiate the object. This feature is great for elegantly simplifying code when an object has multiple default arguments.
The Go language does not syntactically support default parameters, so in order to create objects both by default parameters and by passing custom parameters, we need to use some programming tricks to achieve this." /><meta name="keywords" content="Google, Patterns, Option" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/golang-patterns/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Golang Common Design Patterns - Option Pattern" />
<meta property="og:description" content="As any developer familiar with Python knows, Python has default parameters that allow us to optionally override certain default parameters as needed when instantiating an object to determine how to instantiate the object. This feature is great for elegantly simplifying code when an object has multiple default arguments.
The Go language does not syntactically support default parameters, so in order to create objects both by default parameters and by passing custom parameters, we need to use some programming tricks to achieve this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/golang-patterns/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-11T11:09:28+08:00" />
<meta property="article:modified_time" content="2022-01-11T11:09:28+08:00" />

<meta itemprop="name" content="Golang Common Design Patterns - Option Pattern">
<meta itemprop="description" content="As any developer familiar with Python knows, Python has default parameters that allow us to optionally override certain default parameters as needed when instantiating an object to determine how to instantiate the object. This feature is great for elegantly simplifying code when an object has multiple default arguments.
The Go language does not syntactically support default parameters, so in order to create objects both by default parameters and by passing custom parameters, we need to use some programming tricks to achieve this."><meta itemprop="datePublished" content="2022-01-11T11:09:28+08:00" />
<meta itemprop="dateModified" content="2022-01-11T11:09:28+08:00" />
<meta itemprop="wordCount" content="1267">
<meta itemprop="keywords" content="google," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Golang Common Design Patterns - Option Pattern"/>
<meta name="twitter:description" content="As any developer familiar with Python knows, Python has default parameters that allow us to optionally override certain default parameters as needed when instantiating an object to determine how to instantiate the object. This feature is great for elegantly simplifying code when an object has multiple default arguments.
The Go language does not syntactically support default parameters, so in order to create objects both by default parameters and by passing custom parameters, we need to use some programming tricks to achieve this."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Golang Common Design Patterns - Option Pattern</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-11 11:09:28 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1267 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#implementation-via-multiple-constructors">Implementation via multiple constructors</a></li>
        <li><a href="#implementing-with-default-parameter-options">Implementing with default parameter options</a></li>
        <li><a href="#implemented-by-option-mode">Implemented by option mode</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>As any developer familiar with Python knows, Python has default parameters that allow us to optionally override certain default parameters as needed when instantiating an object to determine how to instantiate the object. This feature is great for elegantly simplifying code when an object has multiple default arguments.</p>
<p>The Go language does not syntactically support default parameters, so in order to create objects both by default parameters and by passing custom parameters, we need to use some programming tricks to achieve this. For these common problems in program development, pioneers in the software industry have summarized many best practices for solving common coding scenarios, which have since become what we call design patterns. One of them is the option pattern, which is often used in Go language development.</p>
<p>Typically we have the following three approaches to creating objects by default parameters and by passing custom parameters.</p>
<ul>
<li>using multiple constructors</li>
<li>default parameter options</li>
<li>The option pattern</li>
</ul>
<h2 id="implementation-via-multiple-constructors">Implementation via multiple constructors</h2>
<p>The first way is through multiple constructors, and the following is a simple example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">defaultAddr</span> <span class="p">=</span> <span class="s">&#34;127.0.0.1&#34;</span>
    <span class="nx">defaultPort</span> <span class="p">=</span> <span class="mi">8000</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Addr</span> <span class="kt">string</span>
    <span class="nx">Port</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewServer</span><span class="p">()</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Server</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="nx">defaultAddr</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="nx">defaultPort</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewServerWithOptions</span><span class="p">(</span><span class="nx">addr</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">port</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Server</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="nx">addr</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="nx">port</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s1</span> <span class="o">:=</span> <span class="nf">NewServer</span><span class="p">()</span>
    <span class="nx">s2</span> <span class="o">:=</span> <span class="nf">NewServerWithOptions</span><span class="p">(</span><span class="s">&#34;localhost&#34;</span><span class="p">,</span> <span class="mi">8001</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s1</span><span class="p">)</span>  <span class="c1">// &amp;{127.0.0.1 8000}
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s2</span><span class="p">)</span>  <span class="c1">// &amp;{localhost 8001}
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Here we have implemented two constructors for the Server structure.</p>
<ul>
<li>NewServer: returns the Server object directly without passing parameters.</li>
<li>NewServerWithOptions: you need to pass the addr and port parameters to construct the Server object.</li>
</ul>
<p>If the object created by default parameters can meet the requirements, we can use NewServer to generate the object (s1) when no customization of the Server is needed. If we need to customize the Server, we can use NewServerWithOptions to generate the object (s2).</p>
<h2 id="implementing-with-default-parameter-options">Implementing with default parameter options</h2>
<p>Another option to implement default parameters is to define an option structure for the structure object to be generated, which is used to generate default parameters for the object to be created, the code implementation is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">defaultAddr</span> <span class="p">=</span> <span class="s">&#34;127.0.0.1&#34;</span>
    <span class="nx">defaultPort</span> <span class="p">=</span> <span class="mi">8000</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Addr</span> <span class="kt">string</span>
    <span class="nx">Port</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ServerOptions</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Addr</span> <span class="kt">string</span>
    <span class="nx">Port</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewServerOptions</span><span class="p">()</span> <span class="o">*</span><span class="nx">ServerOptions</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">ServerOptions</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="nx">defaultAddr</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="nx">defaultPort</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewServerWithOptions</span><span class="p">(</span><span class="nx">opts</span> <span class="o">*</span><span class="nx">ServerOptions</span><span class="p">)</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Server</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">Addr</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">Port</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s1</span> <span class="o">:=</span> <span class="nf">NewServerWithOptions</span><span class="p">(</span><span class="nf">NewServerOptions</span><span class="p">())</span>
    <span class="nx">s2</span> <span class="o">:=</span> <span class="nf">NewServerWithOptions</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ServerOptions</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="s">&#34;localhost&#34;</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="mi">8001</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s1</span><span class="p">)</span>  <span class="c1">// &amp;{127.0.0.1 8000}
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s2</span><span class="p">)</span>  <span class="c1">// &amp;{localhost 8001}
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We implement a ServerOptions specifically for the Server structure to generate default parameters, and call the NewServerOptions function to get the default parameter configuration. The constructor NewServerWithOptions receives a *ServerOptions type as a parameter. So we can accomplish the function in two ways.</p>
<ul>
<li>directly passing the return value of the call to the NewServerOptions function to NewServerWithOptions to achieve object generation by default parameters (s1)</li>
<li>Generate custom objects by manually constructing ServerOptions configuration (s2)</li>
</ul>
<h2 id="implemented-by-option-mode">Implemented by option mode</h2>
<p>Although both of the above ways can accomplish the function, they have the following disadvantages.</p>
<ul>
<li>The scheme implemented through multiple constructors requires us to call different constructors separately when instantiating the object, which is not well encapsulated in the code and will add a usage burden to the caller.</li>
<li>The option scheme with default parameters requires us to pre-construct an option structure, which makes the code look redundant when the object is generated with default parameters.</li>
</ul>
<p>The option pattern allows us to solve this problem more elegantly. The code implementation is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">defaultAddr</span> <span class="p">=</span> <span class="s">&#34;127.0.0.1&#34;</span>
    <span class="nx">defaultPort</span> <span class="p">=</span> <span class="mi">8000</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Addr</span> <span class="kt">string</span>
    <span class="nx">Port</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ServerOptions</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Addr</span> <span class="kt">string</span>
    <span class="nx">Port</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ServerOption</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">apply</span><span class="p">(</span><span class="o">*</span><span class="nx">ServerOptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">FuncServerOption</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">ServerOptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">fo</span> <span class="nx">FuncServerOption</span><span class="p">)</span> <span class="nf">apply</span><span class="p">(</span><span class="nx">option</span> <span class="o">*</span><span class="nx">ServerOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fo</span><span class="p">.</span><span class="nf">f</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithAddr</span><span class="p">(</span><span class="nx">addr</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">ServerOption</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">FuncServerOption</span><span class="p">{</span>
        <span class="nx">f</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">options</span> <span class="o">*</span><span class="nx">ServerOptions</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">Addr</span> <span class="p">=</span> <span class="nx">addr</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithPort</span><span class="p">(</span><span class="nx">port</span> <span class="kt">int</span><span class="p">)</span> <span class="nx">ServerOption</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">FuncServerOption</span><span class="p">{</span>
        <span class="nx">f</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">options</span> <span class="o">*</span><span class="nx">ServerOptions</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">Port</span> <span class="p">=</span> <span class="nx">port</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewServer</span><span class="p">(</span><span class="nx">opts</span> <span class="o">...</span><span class="nx">ServerOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">:=</span> <span class="nx">ServerOptions</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="nx">defaultAddr</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="nx">defaultPort</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">opt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
        <span class="nx">opt</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">options</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Server</span><span class="p">{</span>
        <span class="nx">Addr</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">Addr</span><span class="p">,</span>
        <span class="nx">Port</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">Port</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s1</span> <span class="o">:=</span> <span class="nf">NewServer</span><span class="p">()</span>
    <span class="nx">s2</span> <span class="o">:=</span> <span class="nf">NewServer</span><span class="p">(</span><span class="nf">WithAddr</span><span class="p">(</span><span class="s">&#34;localhost&#34;</span><span class="p">),</span> <span class="nf">WithPort</span><span class="p">(</span><span class="mi">8001</span><span class="p">))</span>
    <span class="nx">s3</span> <span class="o">:=</span> <span class="nf">NewServer</span><span class="p">(</span><span class="nf">WithPort</span><span class="p">(</span><span class="mi">8001</span><span class="p">))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s1</span><span class="p">)</span>  <span class="c1">// &amp;{127.0.0.1 8000}
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s2</span><span class="p">)</span>  <span class="c1">// &amp;{localhost 8001}
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s3</span><span class="p">)</span>  <span class="c1">// &amp;{127.0.0.1 8001}
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>At first glance our code looks much more complex, but in fact the complexity of the code that calls the constructor to generate the object is unchanged, only the definition is complex.</p>
<p>We have defined the ServerOptions structure to configure the default parameters. Since both Addr and Port have default parameters, the definition of ServerOptions is the same as the Server definition. However, structures with some complexity may have some parameters that do not have default parameters and must be configured by the user, in which case ServerOptions will have fewer fields and you can define them as needed.</p>
<p>Also, we define a ServerOption interface and a FuncServerOption structure that implements this interface. Their role is to allow us to individually configure a parameter for the ServerOptions structure via the apply method.</p>
<p>We can define a separate WithXXX function for each default parameter to configure the parameter, such as WithAddr and WithPort defined here, so that the user can customize the default parameter to be overridden by calling the WithXXX function.</p>
<p>In this case, the default parameters are defined in the constructor NewServer, which receives an indefinite parameter of type ServerOption, and a for loop inside the constructor calls the apply method of each ServerOption object passed in, assigning the user-configured parameters to the default parameter object inside the constructor in turn After the for loop is executed, the options object will be the final configuration, and the new object will be generated by assigning its properties to Server in turn.</p>
<h2 id="summary">Summary</h2>
<p>As you can see from the results of s2 and s3, the constructor implemented in option mode is more flexible than the previous two implementations, and we are free to change any one or more of the default configurations in option mode.</p>
<p>While option mode does require a bit more code, in most cases it is worth it. For example, Google&rsquo;s Go implementation of the gRPC framework uses the option mode in the constructor NewServer to create a gRPC server, and for those interested, the source code is actually the same as the sample program here.</p>
<p>The above is my experience about Golang option pattern, I hope today&rsquo;s sharing can bring you some help.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/google/">google</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/flink-window/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Flink Window Mechanism</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/build-jdk/">
            <span class="next-text nav-default">Build and debug openjdk 11 on win10</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
