<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Build your own home NAS and streaming server using Raspberry Pi - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Network Attached Storage (NAS) provides file-level data access to heterogeneous network users over a computer network. As hard drive prices continue to drop, NAS devices have made their way into the homes of the masses. Leading SMB and home NAS market brands such as Synology range in price from $300 on the low end to $700 on the high end. But if you are a Raspberry Pi player, you can build a very good home NAS and streaming service at about half the cost of the lowest price." /><meta name="keywords" content="raspberrypi, nas" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/rpi-nas-plex/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Build your own home NAS and streaming server using Raspberry Pi" />
<meta property="og:description" content="Network Attached Storage (NAS) provides file-level data access to heterogeneous network users over a computer network. As hard drive prices continue to drop, NAS devices have made their way into the homes of the masses. Leading SMB and home NAS market brands such as Synology range in price from $300 on the low end to $700 on the high end. But if you are a Raspberry Pi player, you can build a very good home NAS and streaming service at about half the cost of the lowest price." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/rpi-nas-plex/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-10T12:55:21+08:00" />
<meta property="article:modified_time" content="2022-01-10T12:55:21+08:00" />

<meta itemprop="name" content="Build your own home NAS and streaming server using Raspberry Pi">
<meta itemprop="description" content="Network Attached Storage (NAS) provides file-level data access to heterogeneous network users over a computer network. As hard drive prices continue to drop, NAS devices have made their way into the homes of the masses. Leading SMB and home NAS market brands such as Synology range in price from $300 on the low end to $700 on the high end. But if you are a Raspberry Pi player, you can build a very good home NAS and streaming service at about half the cost of the lowest price."><meta itemprop="datePublished" content="2022-01-10T12:55:21+08:00" />
<meta itemprop="dateModified" content="2022-01-10T12:55:21+08:00" />
<meta itemprop="wordCount" content="6163">
<meta itemprop="keywords" content="raspberrypi,nas," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Build your own home NAS and streaming server using Raspberry Pi"/>
<meta name="twitter:description" content="Network Attached Storage (NAS) provides file-level data access to heterogeneous network users over a computer network. As hard drive prices continue to drop, NAS devices have made their way into the homes of the masses. Leading SMB and home NAS market brands such as Synology range in price from $300 on the low end to $700 on the high end. But if you are a Raspberry Pi player, you can build a very good home NAS and streaming service at about half the cost of the lowest price."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Build your own home NAS and streaming server using Raspberry Pi</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-10 12:55:21 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 6163 words </span>
          <span class="more-meta"> 29 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#project-planning">Project Planning</a></li>
        <li><a href="#system-implementation">System Implementation</a>
          <ul>
            <li><a href="#prepare-raspberry-pi-4b">Prepare Raspberry Pi 4B</a></li>
            <li><a href="#nsapi-kit-assembly">NSAPi kit assembly</a></li>
            <li><a href="#omv-installation-and-configuration">OMV Installation and Configuration</a></li>
            <li><a href="#plex-installation-and-configuration">Plex Installation and Configuration</a></li>
          </ul>
        </li>
        <li><a href="#performance-evaluation">Performance evaluation</a>
          <ul>
            <li><a href="#system-stress-test">System Stress Test</a></li>
            <li><a href="#file-transfer-speed-measurement">File transfer speed measurement</a></li>
            <li><a href="#hard-drive-readwrite-speed-test">Hard drive read/write speed test</a></li>
          </ul>
        </li>
        <li><a href="#project-summary">Project Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Network Attached Storage (NAS) provides file-level data access to heterogeneous network users over a computer network. As hard drive prices continue to drop, NAS devices have made their way into the homes of the masses. Leading SMB and home NAS market brands such as Synology range in price from <code>$300</code> on the low end to <code>$700</code> on the high end. But if you are a Raspberry Pi player, you can build a very good home NAS and streaming service at about half the cost of the lowest price.</p>
<p>This blog post documents the entire process of building a Raspberry Pi NAS and home media server, including project planning, system implementation, and performance evaluation. Some important lessons learned and related shopping information are also summarized here, which I hope will be helpful to anyone who wants to try this DIY project.</p>
<h2 id="project-planning">Project Planning</h2>
<p><strong><a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry Pi 4B</a></strong> has an upgraded processor to a 1.8GHz Broadcom BCM2711 (quad-core Cortex-A72) with onboard memory capacity of up to 8GB, with two updated USB 3.0 ports and full-speed Gigabit Ethernet, and a newer USB-C port for the power supply. These greatly improve system throughput and overall overall performance, and we can use it to build a full-featured home NAS.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/82d403c85c62456fb83150dd6681d80b.png" alt="image"></p>
<p>In terms of NAS system software, <strong><a href="https://www.openmediavault.org/">OpenMediaVault</a></strong> (OMV) is a complete NAS solution based on Debian Linux. It is a Linux rewrite of the well-known open source NAS server system FreeNAS (based on FreeBSD). notable features of OMV are</p>
<ul>
<li>Out-of-the-box, no network and storage system expertise required for installation and management</li>
<li>Suitable for x86-64 and ARM platforms, with a full Web management interface</li>
<li>Supports file storage access under multiple protocols (such as SFTP, SMB/CIFS or NFS)</li>
<li>Can be managed via SSH with the ability to control user and group access rights</li>
</ul>
<p>OMV is primarily used in home environments or small home offices, but is not limited to these scenarios. The system is based on a modular design and can be easily expanded using plug-ins after installing the basic system. Obviously, OMV is the NAS server system software we need.</p>
<p>The NAS system with media playback system can provide an excellent audio/video on demand experience in a home network environment. <strong><a href="https://support.plex.tv/articles/categories/plex-media-server/">Plex Media Server</a></strong> The software integrates Internet media services (YouTube, Vimeo, TED, etc.) and local multimedia libraries to provide streaming media playback services to users' various devices. The features of Plex for managing local libraries are</p>
<ul>
<li>Centralized management and easy sharing of a single library</li>
<li>Web interface media material navigation, streaming playback</li>
<li>Real-time saving and resuming of playback progress</li>
<li>Multi-user support and hierarchical playback privilege settings</li>
</ul>
<p>The Plex Media Server software itself is free and also supports numerous operating systems, making it ideal for integration with a home NAS.</p>
<p>These cover all the software we need for our NAS project, but this is not enough for a complete NAS system. We also need a preferable enclosure, otherwise the Raspberry Pi NAS will only run bare metal. Although there are many cases available in the market for Raspberry Pi 4B, as a NAS system we need a case kit that can accommodate at least 1-2 internal SSD/HDD and must also have a good thermal design.</p>
<p>After some comparison, we decided to use Geekworm&rsquo;s <a href="https://wiki.geekworm.com/NASPi"> <strong>NASPi Raspberry Pi 4B NAS storage kit</strong> </a>. NASPi is a NUC (Next Unit of Computing) style NAS storage solution designed for the latest Raspberry Pi 4B. solution for the latest Raspberry Pi 4B. It consists of three components.</p>
<ol>
<li>the X823 storage shield, which supports 2.5-inch SATA solid-state drives (SDD) or mechanical hard drives (HDD)</li>
<li>X-C1 adapter board, which adjusts all Raspberry Pi 4B interfaces to the back of the enclosure and provides a safety shutdown button</li>
<li>temperature-controlled PWM (Pulse-Width Modulation) fan-based cooling system</li>
</ol>
<p>All these components are finally assembled into an aluminum case with an anodized surface.</p>
<p>In this regard, our NAS project is planned as follows.</p>
<ul>
<li>Hardware system.
<ul>
<li>Raspberry Pi 4B 8GB RAM main hardware system</li>
<li>32GB microSD for Raspberry Pi OS storage</li>
<li>NASPi NAS storage kit</li>
<li>15-20W USB-C power adapter</li>
<li>500GB internal SSD (USB 3.0)</li>
<li>2TB external HDD (USB 3.0)</li>
</ul>
</li>
<li>Software System.
<ul>
<li>Lightweight Raspberry Pi OS (no desktop environment)</li>
<li>OMV for NAS file server</li>
<li>Plex media server for streaming services</li>
</ul>
</li>
</ul>
<p>It is important to note that NAS servers are generally headless systems, which do not require a keyboard, mouse and monitor. This poses some challenges for the installation, configuration and debugging of hardware and software systems. In practice, as described in the next section, we apply SSH terminal connection to complete the basic project implementation process.</p>
<h2 id="system-implementation">System Implementation</h2>
<p>The implementation of this project is divided into four phases, which are described in detail paragraph by paragraph as follows.</p>
<h3 id="prepare-raspberry-pi-4b">Prepare Raspberry Pi 4B</h3>
<p>In the first phase we need to pre-prepare the Raspberry Pi OS and do some basic unit tests. This is very important, if we wait until the complete NSAPi kit is assembled and then test it, it will be troublesome to find the problems with Raspberry Pi then.</p>
<h4 id="prepare-the-os">Prepare the OS</h4>
<p>First, insert the microSD card into the USB adapter and connect it to the macOS computer, then go to the Raspberry Pi website and download the <a href="https://www.raspberrypi.org/software/">Raspberry Pi Imager</a> software to run. From the application screen, click <strong>CHOOSE OS &gt; Raspberry Pi OS (other) &gt; Raspberry Pi OS Lite (32-bit)</strong> step by step, select the lightweight Raspberry Pi OS that does not require a desktop environment, and then click <strong>CHOOSE STORAGE</strong> to select the microSD card.</p>
<p>Next is a tip - hit the <code>ctrl-shift-x</code> key combination and the following advanced options dialog box will pop up</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/e6cf4e3ac4ea40539560ba3ed148dfcd.png" alt="image"></p>
<p>There is just the option we need to enable SSH on boot <strong>Enable SSH</strong>, and you can also preset a password for the default username <code>pi</code> (default is raspberry). Once set up, click <strong>SAVE</strong> to return to the main page and then click <strong>WRITE</strong> to start formatting the microSD card and writing to the system. When finished, remove the microSD card and insert it into the Raspberry Pi, connect to Ethernet and power up.</p>
<h4 id="detect-ip-address">Detect IP address</h4>
<p>At this point we have a problem: since the installed system does not have a desktop environment, we cannot connect to the keyboard, mouse and monitor, so how do we find its IP address? There are two ways.</p>
<ol>
<li>connect to the home router&rsquo;s administration web page and check the address corresponding to the host name raspberry.</li>
<li>Apply the nmap tool to scan the corresponding network segment and compare the changes before and after the Raspberry Pi boots.</li>
</ol>
<p>The nmap tool runs the following log. Notice that the new IP address 192.168.2.4 is scanned, and then run nmap on it alone and found that TCP port 22 is open. Accordingly, we can roughly determine that this is our new online Raspberry Pi.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">❯ nmap -sn 192.168.2.0/24
Starting Nmap 7.92 ( https://nmap.org ) at 2021-11-28 21:07 PST
Nmap scan report for router.sx.com (192.168.2.1)
Host is up (0.0050s latency).
Nmap scan report for 192.168.2.3
Host is up (0.0048s latency).
Nmap scan report for 192.168.2.4 ## New IP after Raspberry Pi boots up
Host is up (0.0057s latency).
Nmap done: 256 IP addresses (3 hosts up) scanned in 15.31 seconds

❯ nmap 192.168.2.4
Nmap scan report for 192.168.2.4
Host is up (0.0066s latency).
Not shown: 999 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
</code></pre></td></tr></table>
</div>
</div><h4 id="system-update-upgrade">system update upgrade</h4>
<p>Next try SSH connection</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">❯ ssh pi@192.168.2.4
pi@192.168.2.4<span class="err">&#39;</span>s password:
Linux raspberrypi 5.10.63-v7l+ <span class="c1">#1488 SMP Thu Nov 18 16:15:28 GMT 2021 armv7l</span>

The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Dec <span class="m">24</span> 19:46:15 <span class="m">2021</span> from 192.168.2.3
pi@raspberrypi:~ $
</code></pre></td></tr></table>
</div>
</div><p>Once confirmed, the following commands can be executed in the Raspberry Pi to update and upgrade the system.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ sudo apt update <span class="o">&amp;&amp;</span> sudo apt upgrade
</code></pre></td></tr></table>
</div>
</div><h4 id="network-connectivity-test">Network connectivity test</h4>
<p>This phase concludes with testing the stability of the Raspberry Pi 4B system&rsquo;s Ethernet connection. The test was run on a macOS computer using the simple ping command, setting the <code>-i 0.05</code> option to specify 20 packets per second, and the <code>-t 3600</code> option for 1 hour</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">❯ sudo ping -i 0.05 192.168.2.4 -t <span class="m">3600</span>
</code></pre></td></tr></table>
</div>
</div><p>There should be no more than 1% packet loss or timeout on a segment with no wireless connectivity, otherwise it should be checked for troubleshooting. In fact, in the real test there was really nearly 10% ping packet loss and SSH connection dropped from time to time. Searching the Internet, I found that there have been many reports of similar packet loss problems with the Raspberry Pi 4B Ethernet connection. The analysis and suggestions given by people on the relevant forums focus on the following points.</p>
<ol>
<li>unstable power supply causes packet loss, need to be replaced with a reliable USB-C power adapter of 15W or more.</li>
<li>energy-efficient Ethernet (Energy-Efficient Ethernet) malfunction, can be solved by closing.</li>
<li>The full-speed Gigabit Ethernet connection function is malfunctioning and must be slowed down to 100Mbit/s for use.</li>
</ol>
<p>In practice, all of the above experiments, the results are not very effective. Later found that the home router connected to the Raspberry Pi 4B is a 2011 Belkin N750 DB. Although it provides Wi-Fi dual-band 802.11n and four Gigabit Ethernet ports, but the production age is too long, it makes people doubt its interoperability problems. And points 2 and 3 of the above report are also essentially interoperability issues. Thinking of these, I immediately ordered the TP-Link TL-SG105 5-port Gigabit Ethernet switch. After receiving it, I extended the Gigabit Ethernet port of N750 with TL-SG105, connected Raspberry Pi 4B to TL-SG105, and retested it again. Sure enough this time the ping packet loss rate is less than 0.1% and the SSH connection is solid.</p>
<p>The conclusion is that the Raspberry Pi 4B Gigabit Ethernet interface may have compatibility issues with some older devices, which can be solved by inserting a switch with good interoperability between the two.</p>
<h3 id="nsapi-kit-assembly">NSAPi kit assembly</h3>
<p>The second stage of assembling the NSAPi storage kit, the goal is to assemble all the hardware and complete the standalone NAS body.</p>
<h4 id="prepare-internal-ssd">Prepare internal SSD</h4>
<p>NSAPi supports either a built-in SSD or HDD. the project choice is the Samsung 870 EVO 500GB built-in SSD, here you must first make sure the SSD works properly on its own, otherwise you will have to disassemble the machine to replace it. The SSD can be hooked up to Windows to check the file system and basic read and write operations. If the SSD is new, the following steps can be performed on Windows to quickly format it.</p>
<ol>
<li>Click the <strong>Start</strong> or <strong>Windows</strong> button and select <strong>Control Panel &gt; System and Security</strong></li>
<li>Select <strong>Administrative Tools &gt; Computer Management &gt; Disk management</strong></li>
<li>Select the drive you want to format, right-click and select <strong>Format</strong>.</li>
<li>In the dialog box that appears, select
<ul>
<li><strong>File System → NTFS</strong></li>
<li><strong>Allocation Unit Size → Default</strong></li>
<li><strong>Volume Label → (specify volume name)</strong></li>
<li><strong>Perform a quick format</strong></li>
</ul>
</li>
<li>Click OK to start a quick format of the SSD</li>
</ol>
<p>⚠️Note: The file system selected here is NTFS, which is one of the file systems supported by OMV for mounting (mount).</p>
<h4 id="pwm-fan-control">PWM Fan Control</h4>
<p>Before the actual hardware assembly, a special software provided by Geekworm - PWM fan control script - has to be installed. PWM fan speed control based on temperature changes is a major feature that sets NASPi apart from other hardware solutions, so this step is important.</p>
<p>Referring to Geekworm&rsquo;s <a href="https://wiki.geekworm.com/X-C1_Software">X-C1 software wiki page</a>, the installation command sequence after SSH connection to the Raspberry Pi 4B system is as follows</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get install -y git pigpio 
sudo apt-get install -y python3-pigpio
sudo apt-get install -y python3-smbus
git clone https://github.com/geekworm-com/x-c1.git
<span class="nb">cd</span> x-c1
sudo chmod +x *.sh
sudo bash install.sh
<span class="nb">echo</span> <span class="s2">&#34;alias xoff=&#39;sudo /usr/local/bin/x-c1-softsd.sh&#39;&#34;</span> &gt;&gt; ~/.bashrc
</code></pre></td></tr></table>
</div>
</div><p>If you can&rsquo;t do <code>git clone</code> directly on Raspberry Pi 4B, you can first download the X-C1 software from the SSH client, then use scp to transfer it to Raspberry Pi 4B, and then execute the subsequent commands</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">❯ scp -r x-c1 pi@192.168.2.4:/home/pi/
</code></pre></td></tr></table>
</div>
</div><p><strong>How does the X-C1 software control PWM fans?</strong></p>
<p>The core of the X-C1 software is a Python program called fan.py with the following code</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">pigpio</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">servo</span> <span class="o">=</span> <span class="mi">18</span>

<span class="n">pwm</span> <span class="o">=</span> <span class="n">pigpio</span><span class="o">.</span><span class="n">pi</span><span class="p">()</span>
<span class="n">pwm</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="n">pigpio</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">)</span>
<span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_frequency</span><span class="p">(</span> <span class="n">servo</span><span class="p">,</span> <span class="mi">25000</span> <span class="p">)</span>
<span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_range</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
     <span class="c1">#get CPU temp</span>
     <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/sys/class/thermal/thermal_zone0/temp&#34;</span><span class="p">)</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span> <span class="o">/</span> <span class="mf">1000.00</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">temp</span><span class="p">)</span>
     <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">):</span>
          <span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_dutycycle</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">):</span>
          <span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_dutycycle</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">):</span>
          <span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_dutycycle</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">):</span>
          <span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_dutycycle</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">75</span><span class="p">):</span>
          <span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_dutycycle</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">):</span>
          <span class="n">pwm</span><span class="o">.</span><span class="n">set_PWM_dutycycle</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
     <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><p>Its logic is actually quite simple. By importing the pigpio module, it first initializes a PWM control object and then starts a cycle of 1 second. The CPU temperature is read at each cycle, and the duty cycle of PWM is set according to the temperature level to control the fan speed. The duty cycle is 0 when it is lower than 30℃, and the fan stops; when it is higher than 75℃, the duty cycle is 100, and the fan rotates at full speed. Users can modify the temperature threshold and duty cycle parameters in the program to customize the PWM fan control.</p>
<p>Also, the following pi-temp.sh script that reads out the GPU and CPU temperatures is useful</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ cat ./pi-temp.sh
<span class="c1">#!/bin/bash</span>
<span class="c1"># Script: pi-temp.sh</span>
<span class="c1"># Purpose: Display the ARM CPU and GPU  temperature of Raspberry Pi</span>
<span class="c1"># -------------------------------------------------------</span>
<span class="nv">cpu</span><span class="o">=</span><span class="k">$(</span>&lt;/sys/class/thermal/thermal_zone0/temp<span class="k">)</span>
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> @ </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;-------------------------------------------&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;GPU =&gt; </span><span class="k">$(</span>vcgencmd measure_temp<span class="k">)</span><span class="s2">&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;CPU =&gt; temp=</span><span class="k">$((</span>cpu/1000<span class="k">))</span><span class="s2">’C&#34;</span>

pi@raspberrypi:~ $ ./pi-temp.sh
Mon <span class="m">29</span> Nov 06:59:17 GMT <span class="m">2021</span> @ raspberrypi
-------------------------------------------
<span class="nv">GPU</span> <span class="o">=</span>&gt; <span class="nv">temp</span><span class="o">=</span>33.1<span class="err">&#39;</span>C
<span class="nv">CPU</span> <span class="o">=</span>&gt; <span class="nv">temp</span><span class="o">=</span>32’C
</code></pre></td></tr></table>
</div>
</div><h4 id="hardware-assembly-process">hardware assembly process</h4>
<p>Below is a snapshot of the Geekwork NASPi parts out of the box (except for the Raspberry Pi 4B on the far right of the second row and the screwdriver in the lower right corner)</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/632ee2f2f7554f4aa20932b1690e356f.png" alt="image"></p>
<p>The three key components in the second row, from left to right, are</p>
<ul>
<li>X-C1 V1.3 adapter board provides power management, interface adaptation and security shutdown functions</li>
<li>X823 V1.5 storage shield board provides 2.5-inch SSD/HDD storage function (UASP support)</li>
<li>4010 PWM fan and metal fan bracket</li>
</ul>
<p>The assembly process is done step-by-step mainly by referring to the <a href="https://youtu.be/ithz2Mg5Vrc">NASPi installation instructional video</a> on Youtube, and the general steps are as follows.</p>
<ul>
<li>Insert the SSD into the SATA III connector of the X823, flip it over to the other side and secure it with screws</li>
<li>Install the Raspberry Pi 4B after adding a space divider on this side, and run the 7-pin cable between the two</li>
<li>Install PWM fan on top of Raspberry Pi 4B and additional space divider</li>
<li>Connect X-C1 and Raspberry Pi 4B, insert the right end of the 7-pin cable to X-C1 GPIO port, and insert the 3-pin cable to X-C1 FAN port</li>
<li>Align the daughter board by inserting the left end of the 7-pin cable to the GPIO port of the Raspberry Pi 4B and secure it with screws</li>
<li>Plug in the USB 3.0 connector and connect the X823 to the corresponding USB 3.0 port of the Raspberry Pi 4B.</li>
</ul>
<p>The internal components are installed and the following view is obtained</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/78136941b37f418ebfc0fa2409d8463f.png" alt="image"></p>
<p>At this point plus the USB-C power to start the system, press the button switch, you should see the PWM fan began to rotate. The rotation rate is fast and slow, not constant, which is the performance of the temperature-sensitive PWM fan working properly.</p>
<p>The key switch with blue LED embedded in the front end controls the whole system on/off and can be tested as follows</p>
<ul>
<li>Press the switch after power on, the system starts</li>
<li>Press and hold the switch for 1-2 seconds while running, the system restarts</li>
<li>Press and hold the switch for 3 seconds during operation to shut down the system safely.</li>
<li>Press and hold the switch for 7-8 seconds during operation to force shutdown</li>
</ul>
<p>You can also safely shut down the system by running the xoff command from an SSH-connected terminal. However, you cannot use Linux shutdown directly to shut down the computer, as this will not unpower X-C1.</p>
<p>Once the shutdown test is complete and the USB 3.0 connector is unplugged, the entire module can be inserted into the enclosure. After adding the back panel and tightening the screws, then re-inserting the USB 3.0 connector, the NASPi system kit is assembled and the following is the front and rear view of the complete system provided by Geekworm (all interfaces and ventilation holes are marked)</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/dd7ac958bf7445dfab9d3566ddb2230b.png" alt="image"></p>
<h3 id="omv-installation-and-configuration">OMV Installation and Configuration</h3>
<p>The third phase installs and configures the core software of the NAS system, OMV, with the goal of implementing basic network file access services. Before rebooting, insert the Seagate 2TB external HDD with the NTSF file system formatted to the other remaining USB 3.0 port. After booting, connect SSH to NASPi from macOS and perform the following procedure.</p>
<h4 id="install-the-omv-package">Install the OMV package</h4>
<p>Installing OMV is as simple as running the following command line directly from an SSH-connected terminal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">wget -O - https://raw.githubusercontent.com/OpenMediaVault-Plugin-Developers/installScript/master/install <span class="p">|</span> sudo bash
</code></pre></td></tr></table>
</div>
</div><p>Due to the large size of the entire OMV package, this installation process can take a long time. After the installation, the IP address of the system may change and you will need to reconnect to SSH at this time:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">(</span>Reading database ... <span class="m">51781</span> files and directories currently installed.<span class="o">)</span>
Purging configuration files <span class="k">for</span> dhcpcd5 <span class="o">(</span>1:8.1.2-1+rpt3<span class="o">)</span> ...
Purging configuration files <span class="k">for</span> raspberrypi-net-mods <span class="o">(</span>1.3.2<span class="o">)</span> ...
Enable and start systemd-resolved ...
Unblocking wifi with rfkill ...
Adding eth0 to openmedivault database ...
IP address may change and you could lose connection <span class="k">if</span> running this script via ssh.
client_loop: send disconnect: Broken pipe	
</code></pre></td></tr></table>
</div>
</div><p>After reconnecting, you can use <code>dpkg</code> to view the OMV packages. As you can see, the latest version of OMV installed here is the current 6.0.5 version.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ dpkg -l <span class="p">|</span> grep openme
ii  openmediavault                       6.0.5-1                          all          openmediavault - The open network attached storage solution
ii  openmediavault-flashmemory           6.0.2                            all          folder2ram plugin <span class="k">for</span> openmediavault
ii  openmediavault-keyring               1.0                              all          GnuPG archive keys of the OpenMediaVault archive
ii  openmediavault-omvextrasorg          6.0.4                            all          OMV-Extras.org Package Repositories <span class="k">for</span> OpenMediaVault
</code></pre></td></tr></table>
</div>
</div><h4 id="connection-management-interface">Connection Management Interface</h4>
<p>At this point OMV&rsquo;s workbench is already online, open a browser on a macOS computer and enter the IP address and enter to open the nice login screen (click on the 🌍 icon in the upper right corner to select the user interface language):.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/477291a713af4e9aa3218388309c4759.png" alt="image"></p>
<p>After logging in with the default username and password shown above, you will see the Workbench screen. The first thing you should do at this point is to click the ⚙️ icon in the top right corner to bring up the settings menu and click &ldquo;Change Password&rdquo;. You can also change the language here, the following is the result after selecting &ldquo;Simplified Chinese&rdquo;</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/c43b979d087f4e9b96db87c974b35a9a.png" alt="image"></p>
<p>Clicking on &ldquo;Dashboard&rdquo; in the settings menu allows you to select the relevant components to be enabled. The menu series on the left side of the interface provides task navigation for administrators and can be hidden when not needed. The complete OMV administration manual can be found in the <a href="https://openmediavault.readthedocs.io/en/latest/index.html">online documentation</a></p>
<h4 id="configuring-file-services">Configuring File Services</h4>
<p>Next is the key process for configuring the NAS, which consists of the following 5 steps.</p>
<ol>
<li>
<p><strong>Scan for system-mounted hard drives</strong> Click <strong>Storage &gt; Disk</strong> from the sidebar menu to enter the hard drive management page. If there is a USB storage device just inserted, you can click 🔍 here to scan it out. The scan results for this system are as follows, both the internal Samsung 500GB SSD and the external Seagate 2TB HDD are detected, and the 32GB microSD that loads the entire system is listed at the top:</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/0e6c23ac4ab0416fa21d915f32961505.png" alt="image"></p>
<p>You can see the corresponding drive mount information on the SSH terminal</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ df -h <span class="p">|</span> grep disk
/dev/sdb2       466G   13G  454G   3% /srv/dev-disk-by-uuid-D0604B68604B547E
/dev/sda1       1.9T  131G  1.7T   7% /srv/dev-disk-by-uuid-DEB2474FB2472B7B
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>Mount the hard disk file system</strong></p>
<p>Click <strong>Storage &gt; File System</strong> from the sidebar menu to enter the file system management page. If the storage device does not have a file system yet, you can click ⨁ Create or Mount file system. OMV can create/mount ext4, ext3, jfs, xfs file systems, but only mounts are supported for ntfs file systems. The following figure shows that OMV correctly mounts ntfs file systems for SSDs and HDDs.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/d1c76393034d4b40afa0a46c3798f889.png" alt="image"></p>
</li>
<li>
<p><strong>Set Up Shared Folders</strong></p>
<p>Click <strong>Storage &gt; Shared Folders</strong> from the sidebar menu to access the Shared Folder Management page. Here, click ⨁ to create a shared folder. When creating, specify the name, corresponding file system and relative path, and you can also add comments. Select the created folder and click the pencil icon again to edit the related information. This system sets the relative paths of shared folders Zixi-Primary and Zixi-Secondary for SSD and HDD respectively</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/1bce95cf80f846e38153e87ff90b90bf.png" alt="image"></p>
<p>Notice the orange alert at the top of the image above, which alerts the administrator that the settings have changed and must be clicked on the ✔️ icon to take effect.</p>
</li>
<li>
<p><strong>Add File Share Access Users</strong></p>
<p>Click <strong>User Management &gt; Users</strong> from the sidebar menu to enter the user management page. The default user pi has root privileges and cannot be used for file sharing access due to security concerns. So you need to add a new user separately. In this page, click ⨁ New User, only user name and password are required when creating a new user, others are optional. Once created, select this user and click the third folder icon with the key (prompting &ldquo;Share folder permissions&rdquo;) to enter the following permission settings page</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/2a9a6e70a3c64176b1f970c4c86db398.png" alt="image"></p>
<p>As shown in the figure, for this new user zixi, the administrator can set the read and write access permissions for each shared folder.</p>
</li>
<li>
<p><strong>Start File Sharing Service</strong></p>
<p>Expand the &ldquo;Services&rdquo; item in the navigation menu, you can see that OMV manages five services: FTP, NFS, Rsync, SMB/CIFS and SSH. SSH is enabled at the beginning of the system, NFS and SMB/CIFS are the most common network file sharing protocols, and both are supported by macOS. Here is an example of SMB/CIFS. Click <strong>Services &gt; SMB/CIFS</strong> from the sidebar menu to enter the administration page. The page contains two buttons: Settings and Sharing. First click on &ldquo;Settings&rdquo; to start the SMB/CIFS service and configure the workgroup name on the new page, and leave the other options at their default values. Save and return to the SMB/CIFS administration page. Then click &ldquo;Sharing&rdquo;, click ⨁ Add shared folders Zixi-Primary and Zixi-Secondary on the new page and save. After that, click the ✔️ icon in the orange warning bar to make all configuration updates take effect, and you will end up with the following result</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/bd7af188096e43b49a8fe777df6c9ddb.png" alt="image"></p>
</li>
</ol>
<p>At this point our Raspberry Pi NAS system is configured for file sharing and the SMB/CIFS service is started. After selecting the relevant components to turn on, our dashboard live monitoring shows the following</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/064a055b0f494312bfcb27df4c856a00.png" alt="image"></p>
<h4 id="client-side-setup">Client Side Setup</h4>
<p>After the server side is ready, we have to load the network share folder on the client side as follows.</p>
<ul>
<li>
<p>Windows PC client</p>
<ul>
<li>Open File Explore and click on &ldquo;This PC&rdquo;.</li>
<li>Click the right mouse button in the right margin and select &ldquo;Add a network location&rdquo; from the pop-up menu.</li>
<li>In the &ldquo;Internet or network address&rdquo; input box, type <code>&quot;\\\&lt;IP address&gt;\&lt;shared folder name&gt;&quot;</code>.</li>
<li>Enter the user name and password</li>
</ul>
</li>
<li>
<p>MacBook client (screenshot example below)</p>
<ul>
<li>Open the Finder and click the menu item Go</li>
<li>Click &ldquo;Connect to Server&hellip;&rdquo;</li>
<li>Enter the URL <code>&quot;smb://&lt;IP address&gt;/&lt;shared folder name&gt;&quot;</code> and click Connect</li>
<li>Enter the username and password</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/bc568ffdbfab4954b9ccb50c5b269946.png" alt="image"></p>
<p>Once the client side is set up, users can perform various operations on the network share folder as if it were a local directory, such as previewing, creating new, opening or copying files, as well as creating new subdirectories or deleting existing subdirectories.</p>
</li>
</ul>
<h3 id="plex-installation-and-configuration">Plex Installation and Configuration</h3>
<p>The last phase installs and configures the Plex media server for network streaming services.</p>
<h4 id="installing-the-media-server">Installing the Media Server</h4>
<p>The process of installing Plex Media Server requires HTTPS transport support, thus we must first install the https-transport package. ssh to our Raspberry Pi NAS and execute the installation command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get install apt-transport-https
</code></pre></td></tr></table>
</div>
</div><p>Next add the Plex repository to the system, which requires downloading the Plex signing key first. Here are the corresponding commands and run logs</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ curl https://downloads.plex.tv/plex-keys/PlexSign.key <span class="p">|</span> sudo apt-key add -
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  <span class="m">0</span>     <span class="m">0</span>    <span class="m">0</span>     <span class="m">0</span>    <span class="m">0</span>     <span class="m">0</span>      <span class="m">0</span>      <span class="m">0</span> --:--:-- --:--:-- --:--:--     <span class="m">0</span>
  Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead <span class="o">(</span>see apt-key<span class="o">(</span>8<span class="o">))</span>.
<span class="m">100</span>  <span class="m">3072</span>  <span class="m">100</span>  <span class="m">3072</span>    <span class="m">0</span>     <span class="m">0</span>  <span class="m">10039</span>      <span class="m">0</span> --:--:-- --:--:-- --:--:-- <span class="m">10039</span>
OK
</code></pre></td></tr></table>
</div>
</div><p>Use the same apt-key command to view the joined Plex signing keys</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ apt-key list
Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead <span class="o">(</span>see apt-key<span class="o">(</span>8<span class="o">))</span>.
/etc/apt/trusted.gpg
...
pub   rsa4096 2015-03-22 <span class="o">[</span>SC<span class="o">]</span>
      CD66 5CBA 0E2F 88B7 373F  7CB9 <span class="m">9720</span> 3C7B 3ADC A79D
uid           <span class="o">[</span> unknown<span class="o">]</span> Plex Inc.
sub   rsa4096 2015-03-22 <span class="o">[</span>E<span class="o">]</span>
...
</code></pre></td></tr></table>
</div>
</div><p>You can see that Plex uses 4096-bit RSA keys. For the warning message &ldquo;apt-key is deprecated&hellip;&rdquo; in the above log, you can ignore it for now. you can read the discussion on the <a href="https://askubuntu.com/questions/1286545/what-commands-exactly-should-replace-the-deprecated-apt-key?newreg=20085e604ada43c2a3466bb51eb4349a">askubuntu forum</a> if you are interested.</p>
<p>Next add the Plex repository to the system repository list and update the package</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">echo</span> deb https://downloads.plex.tv/repo/deb public main <span class="p">|</span> sudo tee /etc/apt/sources.list.d/plexmediaserver.list
sudo apt-get update
</code></pre></td></tr></table>
</div>
</div><p>Now you can start the substantial Plex Media Server installation with the following installation commands and logs</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ sudo apt install plexmediaserver
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following NEW packages will be installed:
  plexmediaserver
<span class="m">0</span> upgraded, <span class="m">1</span> newly installed, <span class="m">0</span> to remove and <span class="m">20</span> not upgraded.
Need to get 66.1 MB of archives.
After this operation, <span class="m">146</span> MB of additional disk space will be used.
Get:1 https://downloads.plex.tv/repo/deb public/main armhf plexmediaserver armhf 1.25.0.5282-2edd3c44d <span class="o">[</span>66.1 MB<span class="o">]</span>
Fetched 66.1 MB in 28s <span class="o">(</span><span class="m">2392</span> kB/s<span class="o">)</span>
Selecting previously unselected package plexmediaserver.
<span class="o">(</span>Reading database ... <span class="m">51783</span> files and directories currently installed.<span class="o">)</span>
Preparing to unpack .../plexmediaserver_1.25.0.5282-2edd3c44d_armhf.deb ...
PlexMediaServer install: Pre-installation Validation.
PlexMediaServer install: Pre-installation Validation complete.
Unpacking plexmediaserver <span class="o">(</span>1.25.0.5282-2edd3c44d<span class="o">)</span> ...
Setting up plexmediaserver <span class="o">(</span>1.25.0.5282-2edd3c44d<span class="o">)</span> ...

Configuration file <span class="s1">&#39;/etc/apt/sources.list.d/plexmediaserver.list&#39;</span>
 <span class="o">==</span>&gt; File on system created by you or by a script.
 <span class="o">==</span>&gt; File also in package provided by package maintainer.
   What would you like to <span class="k">do</span> about it ?  Your options are:
    Y or I  : install the package maintainer<span class="err">&#39;</span>s version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** plexmediaserver.list <span class="o">(</span>Y/I/N/O/D/Z<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>N<span class="o">]</span> ?
PlexMediaServer install: PlexMediaServer-1.25.0.5282-2edd3c44d - Installation starting.
PlexMediaServer install:
PlexMediaServer install: Now installing based on:
PlexMediaServer install:   Installation Type:   New
PlexMediaServer install:   Process Control:     systemd
PlexMediaServer install:   Plex User:           plex
PlexMediaServer install:   Plex Group:          plex
PlexMediaServer install:   Video Group:         video
PlexMediaServer install:   Metadata Dir:        /var/lib/plexmediaserver/Library/Application Support
PlexMediaServer install:   Temp Directory:      /tmp
PlexMediaServer install:   Lang Encoding:       en_US.UTF-8
PlexMediaServer install:   Nvidia GPU card:     Not Found
PlexMediaServer install:
PlexMediaServer install: Completing final configuration.
Created symlink /etc/systemd/system/multi-user.target.wants/plexmediaserver.service → /lib/systemd/system/plexmediaserver.service.
PlexMediaServer install: PlexMediaServer-1.25.0.5282-2edd3c44d - Installation successful.  Errors: 0, Warnings: <span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><p>In the middle you will be asked about the Plex media server list (plexmediaserver.list), just choose the default N and you will be fine. When we see &ldquo;Installation successful&rdquo;, we know that the installation was successful. At this point, the Plex streaming service is up and running the nmap scan from the macOS side, and we find that TCP service port 32400 is open.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">❯ nmap -p1-65535 192.168.2.4 <span class="p">|</span> grep open
22/tcp    open     ssh
80/tcp    open     http
111/tcp   open     rpcbind
139/tcp   open     netbios-ssn
445/tcp   open     microsoft-ds
2049/tcp  open     nfs
5357/tcp  open     wsdapi
32400/tcp open     plex
</code></pre></td></tr></table>
</div>
</div><h4 id="configuring-the-media-server">Configuring the Media Server</h4>
<p>The configuration of the Plex media server is done on the web page. Launch a browser on the macOS computer side and type the URL <strong>http://<IP-address>:32400/web</strong> , and not surprisingly you will see the following page</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/25fd33c43684456d97fffc2c80fe7d9e.png" alt="image"></p>
<p>We can sign in with a Google, Facebook or Apple account, or we can enter an email to create a new account. Follow the instructions on the page step by step, at no cost, and you will soon reach the <strong>Server Setup</strong> page. Here you can configure the server name and add libraries. Normally we don&rsquo;t need to access our home media server from outside, so remember to uncheck the &ldquo;Allow me to access my media outside my home&rdquo; box at this step. To add a library, first select the type of library (movies, TV episodes, music, photos, etc.), then click the &ldquo;BROWSE FOR MEDIA FOLDER&rdquo; button to browse and select the corresponding folder. Once the library is added, the corresponding media files will immediately appear in the local service directory, as shown in the screenshot below</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/d0aabfdacac14ea8a3a206e38f1f6e78.png" alt="image"></p>
<p>Here we have a local server named ZIXI-RPI-NAS for our Raspberry Pi NAS. The movie directory in the library shows The Matrix trilogy and is playing the first one <em>The Matrix</em> . Move your mouse over the server name and a ➕ icon will appear to the right of the name, click on it to continue adding new media libraries.</p>
<p>Once the Plex Media Server is configured, we can open the browser to do streaming on-demand from any device on our home network, no need to download additional applications. The whole experience is just like our own proprietary home Netflix service!</p>
<h2 id="performance-evaluation">Performance evaluation</h2>
<p>By connecting a macOS laptop to one of the remaining ports on the TL-SG105, you can perform some simple in-segment tests to fully evaluate the performance of this NAS system.</p>
<h3 id="system-stress-test">System Stress Test</h3>
<p>Referring to Geekworm&rsquo;s <a href="https://wiki.geekworm.com/Naspi_stress_test">NASPi Stress Test Wiki page</a>, run a stress test from a GitHub clone test program by executing the following command in a SSH-connected terminal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">git clone https://github.com/geekworm-com/rpi-cpu-stress
<span class="nb">cd</span> rpi-cpu-stress
chmod +x stress.sh
sudo ./stress.sh
</code></pre></td></tr></table>
</div>
</div><p>A second SSH connection was also established and htop was run to monitor the system load status. The following screenshot is taken close to the 5 minute mark (left is the htop live display, right is the stress test output)</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/833ddb711bf84a308f2201a385b18c05.png" alt="image"></p>
<p>The <code>temp</code> value output on the right side divided by 1000 is the CPU temperature. As you can see, all 4 CPU cores reached 100% full load during the test, while the maximum temperature did not exceed 70°C. At this point, there is no significant heat sensation when touching the body. Stop the stress test by typing <code>ctrl-c</code> and execute the temperature measurement script separately.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">pi@raspberrypi:~ $ ./pi-temp.sh
Fri Dec <span class="m">24</span> 15:59:21 PST <span class="m">2021</span> @ raspberrypi
-------------------------------------------
<span class="nv">GPU</span> <span class="o">=</span>&gt; <span class="nv">temp</span><span class="o">=</span>39.9<span class="s1">&#39;C
</span><span class="s1">CPU =&gt; temp=40&#39;</span>C
</code></pre></td></tr></table>
</div>
</div><p>The system temperature returns to a lower range of values. The test results confirm that the system meets the design requirements.</p>
<h3 id="file-transfer-speed-measurement">File transfer speed measurement</h3>
<p>The remote file copy tool scp can be used to roughly measure the file transfer speed. First run the <code>mkfile</code> command on the macOS client to create a 1GB file, then use the <code>scp</code> command to copy it to the user directory of the remote NAS system</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">❯ mkfile 1G test-nas.dmg
❯ ls -al test-nas.dmg
rw-------    <span class="m">1</span> sxiao  staff  <span class="m">1073741824</span> Dec <span class="m">19</span> 20:53 test-nas.dmg
❯ scp test-nas.dmg pi@192.168.2.4:/home/pi/
pi@192.168.2.4<span class="err">&#39;</span>s password:
test-nas.dmg                        100% 1024MB  19.2MB/s   00:53
</code></pre></td></tr></table>
</div>
</div><p>After a successful copy, the timing and the resulting speed are output. The speed of the file received from the NAS system can be obtained by applying it in the reverse direction</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">❯ scp pi@192.168.2.4:/home/pi/test-nas.dmg test-nas-rx.dmg
pi@192.168.2.4<span class="err">&#39;</span>s password:
test-nas.dmg                        100% 1024MB  65.7MB/s   00:15
</code></pre></td></tr></table>
</div>
</div><p>Repeat the process three times to get the following results</p>
<table>
<thead>
<tr>
<th>Transfer Type</th>
<th>Server Operation</th>
<th>Timing (sec)</th>
<th>Speed (MB/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Send</td>
<td>Write</td>
<td>53</td>
<td>19.2</td>
</tr>
<tr>
<td>Send</td>
<td>Write</td>
<td>45</td>
<td>22.5</td>
</tr>
<tr>
<td>send</td>
<td>write</td>
<td>50</td>
<td>20.4</td>
</tr>
<tr>
<td>Receive</td>
<td>Read</td>
<td>15</td>
<td>65.7</td>
</tr>
<tr>
<td>Receive</td>
<td>Read</td>
<td>16</td>
<td>60.3</td>
</tr>
<tr>
<td>Receive</td>
<td>Read</td>
<td>15</td>
<td>66.3</td>
</tr>
</tbody>
</table>
<p>The speed of remote write is around 20MB/s, while the speed of remote read file can reach over 60MB/s. Considering that scp-related encryption and decryption is implemented in software on general-purpose Raspberry Pi systems, this result can be considered poor.</p>
<h3 id="hard-drive-readwrite-speed-test">Hard drive read/write speed test</h3>
<p>The real test of the NAS&rsquo;s performance is the network drive read/write speed test. For this, download the AmorphousDiskMark app from Apple&rsquo;s App Store. This is an easy and efficient hard drive speed test that measures the read/write performance of a storage device in terms of MB/s and IOPS (input/output operations per second). It has four types of tests.</p>
<ol>
<li>sequential read/write of 1MB blocks with a queue depth of 8</li>
<li>Sequential read/write of 1MB blocks with a queue depth of 1</li>
<li>random read/write 4KB blocks with a queue depth of 64</li>
<li>random read/write 4KB blocks, queue depth 1</li>
</ol>
<p>The above queue depths are the default values, but other values are also available. In addition, the user can modify the test file size and duration.</p>
<p>Run the application on the macOS client and select the remote SMB folders Zixi-Primary (Samsung SSD) and Zixi-Secondary (Seagate HDD) respectively at the top, then click the <code>All</code> button in the upper left corner to start the NAS drive speed test process. A side-by-side comparison of the two test results is shown below</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/3788764c236a498b868e32554156a7cf.png" alt="image"></p>
<p>The following points can be observed from this.</p>
<ul>
<li>NAS drives read faster than they write, and the difference under random access is very large.</li>
<li>SSDs outperform HDDs for both sequential and random accesses.</li>
<li>A large queue depth speeds up reads, especially for random access, but has little effect on writes.</li>
<li>For both SSDs and HDDs, sequential reads and writes are significantly more efficient than random reads and writes.</li>
<li>For both SSDs and HDDs, sequential reads and writes reach their highest speeds at large queue depths.</li>
</ul>
<p>These are not really surprising, and are consistent with the results of tests on macOS laptops with directly external SSDs and HDDs, only with lower values. With this NAS system, both the SSD and HDD are connected via the USB 3.0 interface. USB 3.0 supports transfer speeds of up to 5Gbit/s, so the performance bottleneck of the system is the network interface bandwidth and processor capability.</p>
<p>On the other hand, both SSDs and HDDs reach transfer speeds in excess of 900Mbit/s at 1MB sequential read and queue depth 8, close to the upper bandwidth limit of the Gigabit Ethernet interface. This storage speed can support a single 1080p60 video stream at a frame rate of 60fps or 2 parallel 1080i50 video streams at a frame rate of 25fps, which is sufficient for home streaming services. The NAS system performs satisfactorily with three computers playing HD video on demand and one phone playing MP3 music without any lag.</p>
<h2 id="project-summary">Project Summary</h2>
<p>Our Raspberry Pi home NAS project is now successfully completed and can now be moved to a more permanent location to provide network file and streaming services for the whole family.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/01/10/c89657f1f89348489fdd824f79b81c4a.png" alt="image"></p>
<p>Economically, the cost statistics for our home NAS are shown in the table below (not counting SSD/HDD)</p>
<table>
<thead>
<tr>
<th>Equipment</th>
<th>Role</th>
<th>Cost ($)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Raspberry Pi 4B 2/4/8GB Memory</td>
<td>Main Hardware System</td>
<td>45/55/75</td>
</tr>
<tr>
<td>Samsung 32GB EVO+ Class-10 Micro SDHC</td>
<td>OS storage</td>
<td>10</td>
</tr>
<tr>
<td>Geekworm NASPi Raspberry Pi 4B NAS Storage Kit</td>
<td>Case, Expansion and PWM Fan</td>
<td>60</td>
</tr>
<tr>
<td>Geekworm 20W 5V 4A USB-C Power Adapter</td>
<td>Power Supply</td>
<td>15</td>
</tr>
<tr>
<td>Purplex TL-SG105 5-Port Gigabit Ethernet Switch</td>
<td>Desktop Switch</td>
<td>15</td>
</tr>
</tbody>
</table>
<p>Even with the highest memory configuration of the Raspberry Pi 4B, the entire overhead is only $175, a little more than half the price of the low-end brand NAS sold on the market. In fact, unless there are a lot of client devices that need streaming services, the memory consumption is usually under 2GB, so the 2GB Raspberry Pi 4B should be able to meet most home scenarios. This works out to <code>$145</code>, which is less than half of the MSRP.</p>
<p>On the other hand, this DIY project was a great hands-on exercise that helped us gain valuable intuitive experience in building network connections, configuring system hardware and software, and tuning and testing application layer services. To sum up, the Raspberry Pi 4B integrated OMV built home NAS combined with Plex media server provides a cost-effective solution for file backup and streaming media services for home networks.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/raspberrypi/">raspberrypi</a>
          <a href="/tags/nas/">nas</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/memory-overrun-detection/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">C programming implementation of memory management functions with out-of-bounds checking</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/ipv6-addressing/">
            <span class="next-text nav-default">IPv6 Dynamic Address Allocation Mechanism Explained</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
