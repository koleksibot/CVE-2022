<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Introduction to DNS SVCB/HTTPS records - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="The IETF is introducing a new type of record for DNS called SVCB/HTTPS. this SVCB/HTTPS record can solve some very important problems and I have been following the advancement of the standard. Today I&amp;rsquo;ll give you an introduction.
1987 CNAME records The DNS system first supported CNAME records in 1987 (RFC 1034), which means canonical name in Chinese. For example, we can set the a.example.com record type to CNAME and its value to b." /><meta name="keywords" content="Dns, svcb, https" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/dns-svcb-https/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Introduction to DNS SVCB/HTTPS records" />
<meta property="og:description" content="The IETF is introducing a new type of record for DNS called SVCB/HTTPS. this SVCB/HTTPS record can solve some very important problems and I have been following the advancement of the standard. Today I&rsquo;ll give you an introduction.
1987 CNAME records The DNS system first supported CNAME records in 1987 (RFC 1034), which means canonical name in Chinese. For example, we can set the a.example.com record type to CNAME and its value to b." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/dns-svcb-https/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-07T11:03:09+08:00" />
<meta property="article:modified_time" content="2022-01-07T11:03:09+08:00" />

<meta itemprop="name" content="Introduction to DNS SVCB/HTTPS records">
<meta itemprop="description" content="The IETF is introducing a new type of record for DNS called SVCB/HTTPS. this SVCB/HTTPS record can solve some very important problems and I have been following the advancement of the standard. Today I&rsquo;ll give you an introduction.
1987 CNAME records The DNS system first supported CNAME records in 1987 (RFC 1034), which means canonical name in Chinese. For example, we can set the a.example.com record type to CNAME and its value to b."><meta itemprop="datePublished" content="2022-01-07T11:03:09+08:00" />
<meta itemprop="dateModified" content="2022-01-07T11:03:09+08:00" />
<meta itemprop="wordCount" content="1523">
<meta itemprop="keywords" content="dns,svcb,https," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Introduction to DNS SVCB/HTTPS records"/>
<meta name="twitter:description" content="The IETF is introducing a new type of record for DNS called SVCB/HTTPS. this SVCB/HTTPS record can solve some very important problems and I have been following the advancement of the standard. Today I&rsquo;ll give you an introduction.
1987 CNAME records The DNS system first supported CNAME records in 1987 (RFC 1034), which means canonical name in Chinese. For example, we can set the a.example.com record type to CNAME and its value to b."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Introduction to DNS SVCB/HTTPS records</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-07 11:03:09 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1523 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1987-cname-records">1987 CNAME records</a></li>
        <li><a href="#2000-srv-records">2000 SRV records</a></li>
        <li><a href="#2000-2015-large-scale-use-of-cdns">2000-2015 Large-scale use of CDNs</a></li>
        <li><a href="#2010-2020-multi-cdn-deployment">2010-2020 Multi-CDN Deployment</a></li>
        <li><a href="#2018-esniech">2018 ESNI/ECH</a></li>
        <li><a href="#svcb-record-overview">SVCB record overview</a></li>
        <li><a href="#https-records-overview">HTTPS Records Overview</a></li>
        <li><a href="#alias-mode-aliasmode">Alias Mode AliasMode</a></li>
        <li><a href="#service-mode-servicemode">Service Mode ServiceMode</a></li>
        <li><a href="#dns-query-flow">DNS Query Flow</a></li>
        <li><a href="#ip-hints">IP hints</a></li>
        <li><a href="#current-status">Current Status</a></li>
        <li><a href="#other-random-thoughts">Other Random Thoughts</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>The IETF is introducing a new type of record for DNS called SVCB/HTTPS. this SVCB/HTTPS record can solve some very important problems and I have been following the advancement of the standard. Today I&rsquo;ll give you an introduction.</p>
<h2 id="1987-cname-records">1987 CNAME records</h2>
<p>The DNS system first supported CNAME records in 1987 (RFC 1034), which means canonical name in Chinese. For example, we can set the <code>a.example.com</code> record type to CNAME and its value to <code>b.example.com</code>. This way, I am parsing other records of <code>a.example.com</code> (e.g. A/AAAA) and actually getting the value of the record <code>b.example.com</code>. <code>b.example.com</code> is the authoritative domain name for <code>a.example.com</code>. If we set up A/AAAA records for both <code>a.example.com</code> and <code>b.example.com</code>, which one should be used in the query? From the CNAME semantics, the record of <code>b.example.com</code> should prevail. To avoid ambiguity, the standard stipulates that if a domain name sets a CNAME record, no other type of record can be set. All other records are to be based on the domain name pointed to by the CNAME.</p>
<p>This poses a problem, you can&rsquo;t set a CNAME for the apex domain, which is the root domain. For example, the apex domain name for a.example.com is example.com. Why can&rsquo;t you set a CNAME for example.com? Because each apex domain name must have an NS type record. Without an NS record there is no way to look up other records for the domain (including CNAME records).</p>
<h2 id="2000-srv-records">2000 SRV records</h2>
<p>SRV records were introduced to the DNS system in 2000 (RFC 2782).SRVs can be seen as a generalized form of MX records and can theoretically be used to discover protocols, ports, weights, etc. of other services.SRV records are structured as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">_Service._Protocol.Subdomain TTL IN SRV [Priority Weight] [Port] [Destination Domain]
</code></pre></td></tr></table>
</div>
</div><p>SRV is mainly used in SIP, LDAP and other protocols. In theory, we can also query the SRV record of <code>_http._tcp.example.com</code> to get the domain name and port information of the http service, but few HTTP clients/browsers implement this feature.</p>
<h2 id="2000-2015-large-scale-use-of-cdns">2000-2015 Large-scale use of CDNs</h2>
<p>From 2000 to 2015, CDN technology was heavily promoted. We only need to set a CNAME record for <a href="http://www.example.com/">www.example.com</a> to point to the domain name of the corresponding CDN to achieve global acceleration.</p>
<p>However, if we want to use <code>example.com</code> as the primary domain name (we cannot set a CNAME record), we can.</p>
<ul>
<li>Set up an A/AAAA record for <code>example.com</code>, pointing to the CDN&rsquo;s IP (hard-coded)
<ul>
<li>This requires the IP to have global anycast capability, otherwise the acceleration will not be accomplished.</li>
</ul>
</li>
<li>Let the CDN vendor manage your domain name
<ul>
<li>This is indeed a better approach, but it requires adjusting the business model or cooperative trust relationship, etc.</li>
</ul>
</li>
<li>Self-resolution
<ul>
<li>Use ALIAS records
<ul>
<li>Non-standard records, limited support</li>
</ul>
</li>
<li>Use ANAME records
<ul>
<li>Similar to CNAME, but only for A/AAAA records, standardization has stalled <a href="https://tools.ietf.org/html/draft-ietf-dnsop-aname-04">https://tools.ietf.org/html/draft-ietf-dnsop-aname-04</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In summary, we can add a CDN to the root domain, but it&rsquo;s not very convenient.</p>
<h2 id="2010-2020-multi-cdn-deployment">2010-2020 Multi-CDN Deployment</h2>
<p>Can we assign multiple CDNs to a domain name? Previously, Ali&rsquo;s server room was tapped out of fiber and affected all CDN customers. So you can&rsquo;t put all your eggs in one basket.</p>
<p>One way is to set two CNAME records. This is more or less against the return standard, but it works. The other is to set up multiple A/AAAA records. But this requires that the different CDN nodes be interchangeable.</p>
<h2 id="2018-esniech">2018 ESNI/ECH</h2>
<p>With the increasing popularity of HTTPS/TLS, the privacy issues of the Internet have been greatly alleviated. However, many domains are now deployed in the cloud and share IPs, so it is necessary to negotiate which domain&rsquo;s certificate to use when establishing a TLS session. To this end, TLS supports an extension called SNI. When a browser initiates a TLS connection it sends the domain name of the target website to the server in <strong>explicit text</strong>. Someone with an ulterior motive can then monitor the website visited by the user.</p>
<p>Therefore, SNI becomes the last privacy risk of TLS. For this reason, the ESNI scheme has been proposed to encrypt SNI information. The basic principle is to publish a public key (TXT record) through DNS. The browser queries the public key through DNS to encrypt SNI, and then initiates a TLS connection. The earliest encrypted SNI information. At first, we only encrypted SNI information, but later we found that there were still problems, so we simply encrypted all ClientHello information. In this way, the last weak link of TLS is fixed (the standard is still under development).</p>
<p>Different CDNs must use different ECH keys. If you use CDN A&rsquo;s public key to encrypt and connect to CDN B&rsquo;s IP, this will definitely fail. Existing DNS systems also do not provide the ability to bind different records together.</p>
<p>Therefore, it is necessary to introduce a new type of record that correlates the IP address of the service, the ECH public key, and other information needed to establish the connection, and that also supports binding the root domain. This new type of record is called Service Binding Record (SVCB).</p>
<h2 id="svcb-record-overview">SVCB record overview</h2>
<p>The structure of the SVCB record is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">_Port._Protocol.Subdomain TTL IN SVCB [Priority] [Destination Domain] [Service Parameters...]
</code></pre></td></tr></table>
</div>
</div><ul>
<li>The goal is to speed up the communication connection process with a single DNS query</li>
<li><code>priority == 0</code> indicates AliasMode
<ul>
<li>Support for binding root domains</li>
</ul>
</li>
<li><code> Priority ! = 0</code> indicates ServiceMode
<ul>
<li>Service parameters are arbitrary key-value pairs, the main ones are.
<ul>
<li>TLS ALPN prompt message</li>
<li>Port</li>
<li>ECH configuration information (public key, etc.)</li>
<li>IP hints</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="https-records-overview">HTTPS Records Overview</h2>
<p>https records are a special class of svcb records that are functionally indistinguishable, but do not require the _https protocol prefix to be specified. Wildcard domains can be better supported. For example <code>*.example.com TTL IN HTTPS ... </code>, accommodates the existing CNAME semantics.</p>
<p>If a domain name has HTTPS records set up, it means that the domain name supports HTTPS/TLS access (similar to HSTS).</p>
<p>The DNS server itself does not make any distinction between SVCB/HTTPS.</p>
<h2 id="alias-mode-aliasmode">Alias Mode AliasMode</h2>
<p>The following record points the http service information of example.com to the svc.example.net domain.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">example.com. 7200 IN HTTPS 0 svc.example.net.
</code></pre></td></tr></table>
</div>
</div><p>If you are also listening on a non-standard port (e.g. 8443) at example.com, then you should set the following record again</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">_8443._https.example.com. 7200 IN HTTPS 0 svc.example.net.
</code></pre></td></tr></table>
</div>
</div><h2 id="service-mode-servicemode">Service Mode ServiceMode</h2>
<p>Here are two HTTPS logs for service mode</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">svc.example.net. 7200 IN HTTPS 2 svc3.example.net. alpn=h3 port=8003 ech=...
svc.example.net. 7200 IN HTTPS 3 svc2.example.net. alpn=h2 port=8002 ech=...
</code></pre></td></tr></table>
</div>
</div><p>This means that you can connect to port 8003 of svc3.example.net using the QUIC protocol or to port 8002 of svc2.example.net using HTTP/2, and that you can encrypt the TLS handshake using the ech message.</p>
<h2 id="dns-query-flow">DNS Query Flow</h2>
<ol>
<li>Client initiates both A/AAAA and HTTPS records (50% increase in query volume)</li>
<li>If the HTTPS record is in alias mode, then the A/AAAA and HTTPS records for the domain name need to be queried</li>
<li>the client needs to query the A/AAAA record of the target domain in service mode</li>
<li>the DNS recursive resolution server can provide these records through additional fields</li>
<li>Special requirements for ECH records: 1.</li>
<li>the client needs to initiate a TLS connection after receiving the HTTPS query result to prevent the server from enabling ECH</li>
<li>If the HTTPS query times out, the client cannot assume that the server does not support ECH in order to prevent a degradation attack</li>
</ol>
<h2 id="ip-hints">IP hints</h2>
<p>SVCB/HTTPS records can also add so-called IP hints, which have the following effect.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">@ 7200 IN HTTPS 1 svc.cdn.example ipv4hint=192.0.0.1
</code></pre></td></tr></table>
</div>
</div><p>IP hints are optional. It is mainly used to speed up the dns resolution process. If the HTTPS record contains an ip hint, the IP address of the target domain can be eliminated.</p>
<h2 id="current-status">Current Status</h2>
<ul>
<li>IANA has assigned two type IDs, 64/65, to SVCB/HTTPS.</li>
<li><a href="https://tools.ietf.org/html/draft-ietf-dnsop-svcb-https-05">draft-ietf-dnsop-svcb-https</a> is nearing completion</li>
<li>iOS 14/macOS 11 already partially supports SVCB/HTTPS queries</li>
<li>Cloudflare&rsquo;s CDN and DNS already support SVCB/HTTPS records</li>
<li>BIND/PowerDNS/Unbound and other DNS service software are working on corresponding features</li>
</ul>
<h2 id="other-random-thoughts">Other Random Thoughts</h2>
<p>Why am I so concerned about the progress of the SVCB/HTTPS standard? It has to do with the network control in China. As you know, operators in China block standard ports like 80/443, which means you can&rsquo;t use your home broadband to serve websites. HTTP/1.1 and HTTP/2 can only work on the standard 80 and 443 ports. HTTP/3, however, can work on any port. In other words, you can listen to any port, update the port information to the corresponding HTTPS record, and the supported clients will be able to access the corresponding HTTP/3 content. When the time comes, everyone can use home broadband to provide Internet services to the outside world again. The key is that Apple is very supportive of SVCB/HTTPS, and I believe that SVCB/HTTPS will soon be able to complete the standardization.</p>
<p>Of course, China will continue to control the Internet. When the time comes, it will definitely interfere with SVCB/HTTPS queries. This can only use DNS over HTTPS/TLS to cope with it. The good thing is that the mainstream systems are now accelerating the deployment of DoH/DoT, and with ECH technology, it should be difficult to prevent people from providing network services to the public.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/dns/">dns</a>
          <a href="/tags/svcb/">svcb</a>
          <a href="/tags/https/">https</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/go-is-better-php/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Go is a better PHP</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/vpn-over-tcp/">
            <span class="next-text nav-default">Analysis of efficiency issues of TCP-based VPNs</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
