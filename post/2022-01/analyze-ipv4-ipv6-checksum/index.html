<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Analysis of IPv4 and IPv6 packet header checksum algorithm - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Regarding the checksum algorithm of the IP packet header, it is simply the one&amp;rsquo;s complement operation of 16-bit accumulation, but how to realize it, many data are not detailed. TCP and UDP datagram headers also use the same checksum algorithm, but the data involved in the operation is different from the IP header. In addition, IPv6&amp;rsquo;s operation of checksums is slightly different from IPv4. Therefore, it is necessary to analyze" /><meta name="keywords" content="ipv4, IPv6, Checksum" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/analyze-ipv4-ipv6-checksum/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Analysis of IPv4 and IPv6 packet header checksum algorithm" />
<meta property="og:description" content="Regarding the checksum algorithm of the IP packet header, it is simply the one&rsquo;s complement operation of 16-bit accumulation, but how to realize it, many data are not detailed. TCP and UDP datagram headers also use the same checksum algorithm, but the data involved in the operation is different from the IP header. In addition, IPv6&rsquo;s operation of checksums is slightly different from IPv4. Therefore, it is necessary to analyze" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/analyze-ipv4-ipv6-checksum/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-10T09:53:06+08:00" />
<meta property="article:modified_time" content="2022-01-10T09:53:06+08:00" />

<meta itemprop="name" content="Analysis of IPv4 and IPv6 packet header checksum algorithm">
<meta itemprop="description" content="Regarding the checksum algorithm of the IP packet header, it is simply the one&rsquo;s complement operation of 16-bit accumulation, but how to realize it, many data are not detailed. TCP and UDP datagram headers also use the same checksum algorithm, but the data involved in the operation is different from the IP header. In addition, IPv6&rsquo;s operation of checksums is slightly different from IPv4. Therefore, it is necessary to analyze"><meta itemprop="datePublished" content="2022-01-10T09:53:06+08:00" />
<meta itemprop="dateModified" content="2022-01-10T09:53:06+08:00" />
<meta itemprop="wordCount" content="1555">
<meta itemprop="keywords" content="ipv4,ipv6," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Analysis of IPv4 and IPv6 packet header checksum algorithm"/>
<meta name="twitter:description" content="Regarding the checksum algorithm of the IP packet header, it is simply the one&rsquo;s complement operation of 16-bit accumulation, but how to realize it, many data are not detailed. TCP and UDP datagram headers also use the same checksum algorithm, but the data involved in the operation is different from the IP header. In addition, IPv6&rsquo;s operation of checksums is slightly different from IPv4. Therefore, it is necessary to analyze"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Analysis of IPv4 and IPv6 packet header checksum algorithm</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-10 09:53:06 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1555 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ipv4-header-checksum">IPv4 header checksum</a></li>
        <li><a href="#c-implementation">C implementation</a></li>
        <li><a href="#tcpudp-header-checksum">TCP/UDP Header Checksum</a></li>
        <li><a href="#the-ipv6-difference">The IPv6 Difference</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Regarding the checksum algorithm of the IP packet header, it is simply the one&rsquo;s complement operation of 16-bit accumulation, but how to realize it, many data are not detailed. TCP and UDP datagram headers also use the same checksum algorithm, but the data involved in the operation is different from the IP header. In addition, IPv6&rsquo;s operation of checksums is slightly different from IPv4. Therefore, it is necessary to analyze the checksum algorithm of IP packets comprehensively.</p>
<h2 id="ipv4-header-checksum">IPv4 header checksum</h2>
<p>The structure of an IPv4 message header is shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">0                   1                   2                   3    
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |        Header Checksum        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</code></pre></td></tr></table>
</div>
</div><p>The <code>Header Checksum</code> field is the header checksum part. When calculating the IPv4 message header checksum, the sender first sets it to all zeros, and then accumulates them one by one in 16 bits to the end of the IPv4 message header, which is stored in a 32-bit value. If the total number of bytes is odd, the last byte is summed separately. The result is inverted and stored in the initial checksum field.</p>
<p>The following is a demonstration of the entire calculation process using an actual intercepted IPv4 packet.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">0x0000: 00 60 47 41 11 c9 00 09 6b 7a 5b 3b 08 00 45 00 
0x0010: 00 1c 74 68 00 00 80 11 59 8f c0 a8 64 01 ab 46 
0x0020: 9c e9 0f 3a 04 05 00 08 7f c5 00 00 00 00 00 00 
0x0030: 00 00 00 00 00 00 00 00 00 00 00 00
</code></pre></td></tr></table>
</div>
</div><p>In the hex dump above, the start is the beginning of the Ethernet frame. the IPv4 message header starts at address offset 0x000e, the first byte is 0x45 and the last byte is 0xe9. based on the algorithm described above, we can make the following calculations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">(1) 0x4500 + 0x001c + 0x7468 + 0x0000 + 0x8011 +
    0x0000 + 0xc0a8 + 0x6401 + 0xab46 + 0x9ce9 = 0x3a66d
(2) 0xa66d + 0x3 = 0xa670
(3) 0xffff - 0xa670 = 0x598f
</code></pre></td></tr></table>
</div>
</div><p>Note that in the first step we set the header checksum part with 0x0000. You can see that the checksum of the header of this message is exactly the same as the value received. The above procedure is only for the sender to calculate the initial checksum. In practice, for the intermediate forwarding routers and the final receiver, the header checksum of the received IPv4 message can be added directly according to the same algorithm, and if the result is 0xffff, then the checksum is correct.</p>
<h2 id="c-implementation">C implementation</h2>
<p>How do I programmatically compute an IPv4 header checksum? <a href="https://tools.ietf.org/html/rfc1071">RFC 1071</a> (Computing the Internet Checksum) gives a reference implementation in C, as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="p">{</span>
    <span class="cm">/* Compute Internet Checksum for &#34;count&#34; bytes
</span><span class="cm">     * beginning at location &#34;addr&#34;.
</span><span class="cm">     */</span>
    <span class="k">register</span> <span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>  <span class="p">{</span>
        <span class="cm">/* This is the inner loop */</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="o">*</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span><span class="o">++</span><span class="p">;</span>
        <span class="n">count</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/*  Add left-over byte, if any */</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="o">*</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span><span class="p">;</span>

    <span class="cm">/*  Fold 32-bit sum to 16 bits */</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">sum</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>

    <span class="n">checksum</span> <span class="o">=</span> <span class="o">~</span><span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>In an actual network connection, the source device can call the above code to generate the initial IPv4 message Header checksum. The header checksum is then updated at each step of the routing hop because the router must decrement the header Time To Live (TTL) field. A reference implementation of fast checksum updating is given in <a href="https://tools.ietf.org/html/rfc1141">RFC 1141</a> (Incremental Updating of the Internet Checksum).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sum</span><span class="p">;</span>
<span class="n">ipptr</span><span class="o">-&gt;</span><span class="n">ttl</span><span class="o">--</span><span class="p">;</span>                  <span class="cm">/* decrement ttl */</span>
<span class="n">sum</span> <span class="o">=</span> <span class="n">ipptr</span><span class="o">-&gt;</span><span class="n">Checksum</span> <span class="o">+</span> <span class="mh">0x100</span><span class="p">;</span> <span class="cm">/* increment checksum high byte*/</span>
<span class="n">ipptr</span><span class="o">-&gt;</span><span class="n">Checksum</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">));</span> <span class="cm">/* add carry */</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="tcpudp-header-checksum">TCP/UDP Header Checksum</h2>
<p>For TCP and UDP datagrams, the header also contains a 16-bit checksum, which is verified by the destination receiver. The checksum algorithm is exactly the same as the IPv4 message header, but the data involved in the checksum is different. The checksum then not only contains the entire TCP/UDP datagram, but also covers a pseudo-header. the IPv4 pseudo-header is defined as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"> 0      7 8     15 16    23 24    31 
+--------+--------+--------+--------+
|          source address           |
+--------+--------+--------+--------+
|        destination address        |
+--------+--------+--------+--------+
|  zero  |protocol| TCP/UDP length  |
+--------+--------+--------+--------+

</code></pre></td></tr></table>
</div>
</div><p>This includes the IP source address, IP destination address, protocol number (TCP:6/UDP:17) and the total length of the TCP or UDP datagram (first part + data). The purpose of adding the pseudo-header to the checksum is to double-check that the datagram has reached the correct destination and to prevent IP spoofing attacks (spoofing). Also for IPv4, the UDP header checksum is optional and the field should be populated with all zeros when not in use.</p>
<h2 id="the-ipv6-difference">The IPv6 Difference</h2>
<p>IPv6 is version 6 of the Internet Protocol, which was designed primarily to address the IPv4 address exhaustion problem, but of course it has many other improvements as well. Although IPv6 usage is growing slowly, the trend is unstoppable. The latest Internet standard for IPv6 is governed by <a href="https://tools.ietf.org/html/rfc8200">RFC 8200</a> (Internet Protocol, Version 6 (IPv6) Specification). The structure of an IPv6 message header is shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Traffic Class |           Flow Label                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length        |  Next Header  |   Hop Limit   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                         Source Address                        +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                      Destination Address                      +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</code></pre></td></tr></table>
</div>
</div><p>Note that the IPv6 header does not contain a checksum field, which is a significant difference from IPv4, and that the design of the IPv6 protocol extends the end-to-end principles of Internet design by eliminating the header checksum field to simplify processing by routers and speed up the network transmission of IPv6 messages. Protection of message data integrity can be accomplished by error detection at the link layer or by the higher layer protocols between endpoints (TCP/UDP). This is why IPv6 forces the UDP layer to set the header checksum field.</p>
<p>For the calculation of the TCP/UDP header checksum of an IPv6 datagram, the IPv6 pseudo-header is defined as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                         Source Address                        +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                      Destination Address                      +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Upper-Layer Packet Length                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      zero                     |  Next Header  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</code></pre></td></tr></table>
</div>
</div><p>The UDP-Lite protocol specifies the values of the &ldquo;checksum override&rdquo; field (in groups of 8 bits).</p>
<table>
<thead>
<tr>
<th>checksum coverage value</th>
<th>checksum coverage area</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>The entire UDP-Lites datagram</td>
<td>is calculated to include the IP pseudo-primary</td>
</tr>
<tr>
<td>1-7</td>
<td>(invalid values)</td>
<td>The receiver must discard the datagram</td>
</tr>
<tr>
<td>8</td>
<td>UDP-Lites initial</td>
<td>calculation to include IP pseudo-primitives</td>
</tr>
<tr>
<td>&gt; 8</td>
<td>UDP-Lites Prefix + partial load data (payload)</td>
<td>computation to include IP pseudo-primitives</td>
</tr>
<tr>
<td>&gt; IP Datagram Length</td>
<td>(invalid value)</td>
<td>Receiver must discard datagram</td>
</tr>
</tbody>
</table>
<p>For multimedia applications, using VoIP or streaming video data transmission protocols, it is better to receive data with some degree of corruption than not receiving any data at all. Another example, the <a href="https://tools.ietf.org/html/rfc5415">CAPWAP</a> protocol specification, on which Cisco&rsquo;s wireless LAN controller and wireless access point connections are based, specifies that when a connection is established over an IPv6 network, the data channel defaults to a checksum coverage value of 8 for the UDP-Lite protocol.</p>
<p>Finally, a small C program is shared to demonstrate how to initialize a Berkeley socket to establish an IPv6 UDP-Lite connection.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;netinet/in.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;net/udplite.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="n">udplite_conn</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">IPPROTO_UDPLITE</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>    <span class="cm">/* 校验和只覆盖8字节的UDP-Lite首部 */</span>
<span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">udplite_conn</span><span class="p">,</span> <span class="n">IPPROTO_UDPLITE</span><span class="p">,</span> <span class="n">UDPLITE_SEND_CSCOV</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">val</span><span class="p">);</span>
<span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">udplite_conn</span><span class="p">,</span> <span class="n">IPPROTO_UDPLITE</span><span class="p">,</span> <span class="n">UDPLITE_RECV_CSCOV</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">val</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><p>Here <code>IPPROTO_UDPLITE</code> is protocol number 136, which is used along with the <code>AF_INET6</code> address set parameter to call the <code>socket()</code> function to create an IPv6 socket. <code>UDPLITE_SEND_CSCOV</code> (10) and <code>UDPLITE_RECV_CSCOV</code> (11) are the control parameters of the socket option setting function <code>setsockopt()</code>, which are used to specify the checksum and override values for sending and receiving, respectively. Note that the same value must be set for both the sender and receiver, otherwise the receiver will not be able to verify the checksum correctly.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/ipv4/">ipv4</a>
          <a href="/tags/ipv6/">ipv6</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/asan-intro/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">AddressSanitizer - A tool for programmers to detect memory access errors</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/go-bytes-compare-equal/">
            <span class="next-text nav-default">Golang bytes performance comparison of two functions Compare, Equal</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
