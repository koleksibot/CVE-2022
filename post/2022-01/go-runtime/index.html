<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to compile and debug Go runtime source code - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Compile and modify Golang source code for debugging First download and compile I&amp;rsquo;m using a centos environment, so I need to install yum -y install gcc first. Then download the go source code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [root@localhost src]# git clone https://github.com/golang/go.git #进入到src 目录执" /><meta name="keywords" content="golang, Runtime, Source Code" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/go-runtime/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="How to compile and debug Go runtime source code" />
<meta property="og:description" content="Compile and modify Golang source code for debugging First download and compile I&rsquo;m using a centos environment, so I need to install yum -y install gcc first. Then download the go source code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [root@localhost src]# git clone https://github.com/golang/go.git #进入到src 目录执" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/go-runtime/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-22T17:06:26+08:00" />
<meta property="article:modified_time" content="2022-01-22T17:06:26+08:00" />

<meta itemprop="name" content="How to compile and debug Go runtime source code">
<meta itemprop="description" content="Compile and modify Golang source code for debugging First download and compile I&rsquo;m using a centos environment, so I need to install yum -y install gcc first. Then download the go source code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [root@localhost src]# git clone https://github.com/golang/go.git #进入到src 目录执"><meta itemprop="datePublished" content="2022-01-22T17:06:26+08:00" />
<meta itemprop="dateModified" content="2022-01-22T17:06:26+08:00" />
<meta itemprop="wordCount" content="2329">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to compile and debug Go runtime source code"/>
<meta name="twitter:description" content="Compile and modify Golang source code for debugging First download and compile I&rsquo;m using a centos environment, so I need to install yum -y install gcc first. Then download the go source code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [root@localhost src]# git clone https://github.com/golang/go.git #进入到src 目录执"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How to compile and debug Go runtime source code</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-22 17:06:26 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2329 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#compile-and-modify-golang-source-code-for-debugging">Compile and modify Golang source code for debugging</a>
          <ul>
            <li><a href="#first-download-and-compile">First download and compile</a></li>
            <li><a href="#then-download-the-go-source-code">Then download the go source code</a></li>
            <li><a href="#godebug">GODEBUG</a></li>
            <li><a href="#modify-the-compilation">Modify the compilation</a></li>
          </ul>
        </li>
        <li><a href="#delve-debugging">Delve Debugging</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="compile-and-modify-golang-source-code-for-debugging">Compile and modify Golang source code for debugging</h2>
<h3 id="first-download-and-compile">First download and compile</h3>
<p>I&rsquo;m using a centos environment, so I need to install <code>yum -y install gcc</code> first.</p>
<h3 id="then-download-the-go-source-code">Then download the go source code</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">src</span><span class="p">]</span><span class="err">#</span> <span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/golang/go.git
</span><span class="c1"></span>
<span class="err">#</span><span class="nx">进入到src</span> <span class="nx">目录执行</span>
<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">src</span><span class="p">]</span><span class="err">#</span> <span class="p">.</span><span class="o">/</span><span class="nx">all</span><span class="p">.</span><span class="nx">bash</span>

<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">src</span><span class="p">]</span><span class="err">#</span> <span class="p">.</span><span class="o">/</span><span class="nx">all</span><span class="p">.</span><span class="nx">bash</span>
<span class="nx">Building</span> <span class="nx">Go</span> <span class="nx">cmd</span><span class="o">/</span><span class="nx">dist</span> <span class="nx">using</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="k">go</span><span class="p">.</span> <span class="p">(</span><span class="nx">go1</span><span class="mf">.15.8</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">amd64</span><span class="p">)</span>
<span class="nx">Building</span> <span class="nx">Go</span> <span class="nx">toolchain1</span> <span class="nx">using</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="k">go</span><span class="p">.</span>
<span class="nx">Building</span> <span class="nx">Go</span> <span class="nx">bootstrap</span> <span class="nx">cmd</span><span class="o">/</span><span class="k">go</span> <span class="p">(</span><span class="nx">go_bootstrap</span><span class="p">)</span> <span class="nx">using</span> <span class="nx">Go</span> <span class="nx">toolchain1</span><span class="p">.</span>
<span class="nx">Building</span> <span class="nx">Go</span> <span class="nx">toolchain2</span> <span class="nx">using</span> <span class="nx">go_bootstrap</span> <span class="nx">and</span> <span class="nx">Go</span> <span class="nx">toolchain1</span><span class="p">.</span>
<span class="nx">Building</span> <span class="nx">Go</span> <span class="nx">toolchain3</span> <span class="nx">using</span> <span class="nx">go_bootstrap</span> <span class="nx">and</span> <span class="nx">Go</span> <span class="nx">toolchain2</span><span class="p">.</span>
<span class="nx">Building</span> <span class="nx">packages</span> <span class="nx">and</span> <span class="nx">commands</span> <span class="k">for</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">amd64</span><span class="p">.</span>
<span class="o">...</span>

<span class="err">#####</span> <span class="nx">API</span> <span class="nx">check</span>
<span class="nx">Go</span> <span class="nx">version</span> <span class="nx">is</span> <span class="s">&#34;go1.15.10&#34;</span><span class="p">,</span> <span class="nx">ignoring</span> <span class="o">-</span><span class="nx">next</span> <span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">next</span><span class="p">.</span><span class="nx">txt</span>

<span class="nx">ALL</span> <span class="nx">TESTS</span> <span class="nx">PASSED</span>
<span class="o">---</span>
<span class="nx">Installed</span> <span class="nx">Go</span> <span class="k">for</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">amd64</span> <span class="nx">in</span> <span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="k">go</span>
<span class="nx">Installed</span> <span class="nx">commands</span> <span class="nx">in</span> <span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="nx">bin</span>
<span class="o">***</span> <span class="nx">You</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">add</span> <span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="nx">bin</span> <span class="nx">to</span> <span class="nx">your</span> <span class="nx">PATH</span><span class="p">.</span>
</code></pre></td></tr></table>
</div>
</div><p>The compiled go and gofmt are in the bin directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">src</span><span class="p">]</span><span class="err">#</span> <span class="nx">cd</span> <span class="p">..</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span>
<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">bin</span><span class="p">]</span><span class="err">#</span> <span class="nx">ls</span>
<span class="k">go</span>  <span class="nx">gofmt</span>
</code></pre></td></tr></table>
</div>
</div><p>To prevent conflicts between our modified go and the go we installed in the past, create a mygo softlink that points to the modified go.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">bin</span><span class="p">]</span><span class="err">#</span> <span class="nx">mkdir</span> <span class="o">-</span><span class="nx">p</span> <span class="err">~</span><span class="o">/</span><span class="nx">mygo</span><span class="o">/</span><span class="nx">bin</span>

<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">bin</span><span class="p">]</span><span class="err">#</span> <span class="nx">cd</span> <span class="err">~</span><span class="o">/</span><span class="nx">mygo</span><span class="o">/</span><span class="nx">bin</span>

<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">bin</span><span class="p">]</span><span class="err">#</span> <span class="nx">ln</span> <span class="o">-</span><span class="nx">sf</span> <span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="k">go</span> <span class="nx">mygo</span>
</code></pre></td></tr></table>
</div>
</div><p>Finally, add <code>~/testgo/bin</code> to the <code>PATH</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">bin</span><span class="p">]</span><span class="err">#</span> <span class="nx">vim</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">profile</span>

<span class="nx">export</span> <span class="nx">PATH</span><span class="p">=</span><span class="err">$</span><span class="nx">PATH</span><span class="p">:</span><span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="nx">mygo</span><span class="o">/</span><span class="nx">bin</span>

<span class="nx">source</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">profile</span>
</code></pre></td></tr></table>
</div>
</div><p>Run mygo and check the version.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">bin</span><span class="p">]</span><span class="err">#</span> <span class="nx">mygo</span> <span class="nx">version</span>
<span class="k">go</span> <span class="nx">version</span> <span class="nx">go1</span><span class="mf">.15.10</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">amd64</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="godebug">GODEBUG</h3>
<p>When we modify the source code, we can print debugging information with the help of GODEBUG variables.</p>
<h4 id="schedtrace">schedtrace</h4>
<p>schedtrace: setting schedtrace=X causes the scheduler to emit a single line to standard
error every X milliseconds, summarizing the scheduler state.</p>
<p>For example, set schedtrace=1000 to print one line of scheduler summary information every one second after the program starts.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@localhost gotest<span class="o">]</span><span class="c1"># GOMAXPROCS=1 GODEBUG=schedtrace=1000 mygo run main.go SCHED 0ms: gomaxprocs=1 idleprocs=0 threads=4 spinningthreads=0 idlethreads=0 runqueue=0 [2]</span>
<span class="c1"># command-line-arguments</span>
SCHED 0ms: <span class="nv">gomaxprocs</span><span class="o">=</span><span class="m">1</span> <span class="nv">idleprocs</span><span class="o">=</span><span class="m">0</span> <span class="nv">threads</span><span class="o">=</span><span class="m">3</span> <span class="nv">spinningthreads</span><span class="o">=</span><span class="m">0</span> <span class="nv">idlethreads</span><span class="o">=</span><span class="m">1</span> <span class="nv">runqueue</span><span class="o">=</span><span class="m">0</span> <span class="o">[</span>2<span class="o">]</span>
SCHED 0ms: <span class="nv">gomaxprocs</span><span class="o">=</span><span class="m">1</span> <span class="nv">idleprocs</span><span class="o">=</span><span class="m">0</span> <span class="nv">threads</span><span class="o">=</span><span class="m">3</span> <span class="nv">spinningthreads</span><span class="o">=</span><span class="m">0</span> <span class="nv">idlethreads</span><span class="o">=</span><span class="m">0</span> <span class="nv">runqueue</span><span class="o">=</span><span class="m">0</span> <span class="o">[</span>2<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>0ms : the number of milliseconds since the start of the program.</p>
<p>gomaxprocs=1: the number of configured processors.</p>
<p>idleprocs=0: number of idle P(processors).</p>
<p>threads=3: number of threads managed during runtime, currently 6 threads.</p>
<p>spinningthreads=0: number of threads preempted by execution.</p>
<p>idlethreads=1: number of idle threads.</p>
<p>runqueue=0: the number of goroutines in the global run queue.</p>
<p>[2]: the number of goroutines in the local run queue, indicating that two are waiting.</p>
<h4 id="scheddetail">scheddetail</h4>
<blockquote>
<p>scheddetail: setting schedtrace=X and scheddetail=1 causes the scheduler to emit
detailed multiline info every X milliseconds, describing state of the scheduler,
processors, threads and goroutines.</p>
</blockquote>
<p>schedtrace and scheddetail together can be set to provide details about processor P, thread M and goroutine G.</p>
<p>Example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@localhost gotest<span class="o">]</span><span class="c1"># GOMAXPROCS=1 GODEBUG=schedtrace=1000,scheddetail=1 mygo run main.go </span>
SCHED 0ms: <span class="nv">gomaxprocs</span><span class="o">=</span><span class="m">1</span> <span class="nv">idleprocs</span><span class="o">=</span><span class="m">0</span> <span class="nv">threads</span><span class="o">=</span><span class="m">4</span> <span class="nv">spinningthreads</span><span class="o">=</span><span class="m">0</span> <span class="nv">idlethreads</span><span class="o">=</span><span class="m">0</span> <span class="nv">runqueue</span><span class="o">=</span><span class="m">0</span> <span class="nv">gcwaiting</span><span class="o">=</span><span class="m">0</span> <span class="nv">nmidlelocked</span><span class="o">=</span><span class="m">0</span> <span class="nv">stopwait</span><span class="o">=</span><span class="m">0</span> <span class="nv">sysmonwait</span><span class="o">=</span><span class="m">0</span>
  P0: <span class="nv">status</span><span class="o">=</span><span class="m">0</span> <span class="nv">schedtick</span><span class="o">=</span><span class="m">0</span> <span class="nv">syscalltick</span><span class="o">=</span><span class="m">0</span> <span class="nv">m</span><span class="o">=</span>-1 <span class="nv">runqsize</span><span class="o">=</span><span class="m">2</span> <span class="nv">gfreecnt</span><span class="o">=</span><span class="m">0</span> <span class="nv">timerslen</span><span class="o">=</span><span class="m">0</span>
  M3: <span class="nv">p</span><span class="o">=</span>-1 <span class="nv">curg</span><span class="o">=</span>-1 <span class="nv">mallocing</span><span class="o">=</span><span class="m">0</span> <span class="nv">throwing</span><span class="o">=</span><span class="m">0</span> <span class="nv">preemptoff</span><span class="o">=</span> <span class="nv">locks</span><span class="o">=</span><span class="m">0</span> <span class="nv">dying</span><span class="o">=</span><span class="m">0</span> <span class="nv">spinning</span><span class="o">=</span><span class="nb">false</span> <span class="nv">blocked</span><span class="o">=</span><span class="nb">false</span> <span class="nv">lockedg</span><span class="o">=</span>-1
  M2: <span class="nv">p</span><span class="o">=</span>-1 <span class="nv">curg</span><span class="o">=</span>-1 <span class="nv">mallocing</span><span class="o">=</span><span class="m">0</span> <span class="nv">throwing</span><span class="o">=</span><span class="m">0</span> <span class="nv">preemptoff</span><span class="o">=</span> <span class="nv">locks</span><span class="o">=</span><span class="m">2</span> <span class="nv">dying</span><span class="o">=</span><span class="m">0</span> <span class="nv">spinning</span><span class="o">=</span><span class="nb">false</span> <span class="nv">blocked</span><span class="o">=</span><span class="nb">false</span> <span class="nv">lockedg</span><span class="o">=</span>-1
  M1: <span class="nv">p</span><span class="o">=</span>-1 <span class="nv">curg</span><span class="o">=</span><span class="m">17</span> <span class="nv">mallocing</span><span class="o">=</span><span class="m">0</span> <span class="nv">throwing</span><span class="o">=</span><span class="m">0</span> <span class="nv">preemptoff</span><span class="o">=</span> <span class="nv">locks</span><span class="o">=</span><span class="m">0</span> <span class="nv">dying</span><span class="o">=</span><span class="m">0</span> <span class="nv">spinning</span><span class="o">=</span><span class="nb">false</span> <span class="nv">blocked</span><span class="o">=</span><span class="nb">false</span> <span class="nv">lockedg</span><span class="o">=</span><span class="m">17</span>
  M0: <span class="nv">p</span><span class="o">=</span>-1 <span class="nv">curg</span><span class="o">=</span>-1 <span class="nv">mallocing</span><span class="o">=</span><span class="m">0</span> <span class="nv">throwing</span><span class="o">=</span><span class="m">0</span> <span class="nv">preemptoff</span><span class="o">=</span> <span class="nv">locks</span><span class="o">=</span><span class="m">1</span> <span class="nv">dying</span><span class="o">=</span><span class="m">0</span> <span class="nv">spinning</span><span class="o">=</span><span class="nb">false</span> <span class="nv">blocked</span><span class="o">=</span><span class="nb">false</span> <span class="nv">lockedg</span><span class="o">=</span><span class="m">1</span>
  G1: <span class="nv">status</span><span class="o">=</span>1<span class="o">(</span>chan receive<span class="o">)</span> <span class="nv">m</span><span class="o">=</span>-1 <span class="nv">lockedm</span><span class="o">=</span><span class="m">0</span>
  G17: <span class="nv">status</span><span class="o">=</span>6<span class="o">()</span> <span class="nv">m</span><span class="o">=</span><span class="m">1</span> <span class="nv">lockedm</span><span class="o">=</span><span class="m">1</span>
  G2: <span class="nv">status</span><span class="o">=</span>1<span class="o">()</span> <span class="nv">m</span><span class="o">=</span>-1 <span class="nv">lockedm</span><span class="o">=</span>-1
  G3: <span class="nv">status</span><span class="o">=</span>1<span class="o">()</span> <span class="nv">m</span><span class="o">=</span>-1 <span class="nv">lockedm</span><span class="o">=</span>-1
  G4: <span class="nv">status</span><span class="o">=</span>4<span class="o">(</span>GC scavenge <span class="nb">wait</span><span class="o">)</span> <span class="nv">m</span><span class="o">=</span>-1 <span class="nv">lockedm</span><span class="o">=</span>-1
...
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s start by looking at what G stands for.</p>
<ul>
<li>status: the operational status of G.</li>
<li>m: which M it belongs to.</li>
<li>lockedm: whether or not there is a locked M.</li>
</ul>
<p>The operational status of G probably has these meanings.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">const <span class="o">(</span>
    //  刚刚被分配并且还没有被初始化
    <span class="nv">_Gidle</span> <span class="o">=</span> iota // <span class="m">0</span> 
    // 没有执行代码，没有栈的所有权，存储在运行队列中
    _Grunnable // <span class="m">1</span> 
    // 可以执行代码，拥有栈的所有权，被赋予了内核线程 M 和处理器 P
    _Grunning // <span class="m">2</span> 
    // 正在执行系统调用，拥有栈的所有权，没有执行用户代码，
    // 被赋予了内核线程 M 但是不在运行队列上
    _Gsyscall // <span class="m">3</span> 
    // 由于运行时而被阻塞，没有执行用户代码并且不在运行队列上，
    // 但是可能存在于 Channel 的等待队列上
    _Gwaiting // <span class="m">4</span>  
    // 表示当前goroutine没有被使用，没有执行代码，可能有分配的栈
    _Gdead // <span class="m">6</span>  
    // 栈正在被拷贝，没有执行代码，不在运行队列上
    _Gcopystack // <span class="m">8</span> 
    // 由于抢占而被阻塞，没有执行用户代码并且不在运行队列上，等待唤醒
    _Gpreempted // <span class="m">9</span> 
    // GC 正在扫描栈空间，没有执行代码，可以与其他状态同时存在
    <span class="nv">_Gscan</span>          <span class="o">=</span> 0x1000 
    ...
<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>What M stands for.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">M0: <span class="nv">p</span><span class="o">=</span>-1 <span class="nv">curg</span><span class="o">=</span>-1 <span class="nv">mallocing</span><span class="o">=</span><span class="m">0</span> <span class="nv">throwing</span><span class="o">=</span><span class="m">0</span> <span class="nv">preemptoff</span><span class="o">=</span> <span class="nv">locks</span><span class="o">=</span><span class="m">1</span> <span class="nv">dying</span><span class="o">=</span><span class="m">0</span> <span class="nv">spinning</span><span class="o">=</span><span class="nb">false</span> <span class="nv">blocked</span><span class="o">=</span><span class="nb">false</span> <span class="nv">lockedg</span><span class="o">=</span><span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>p: which P to belong to.</li>
<li>curg: which G is currently in use.</li>
<li>mallocing: whether memory is being allocated.</li>
<li>throwing: whether an exception is being thrown.</li>
<li>preemptoff: keep curg running on this m if it is not equal to the empty string (&quot;&quot;).</li>
<li>runqsize: the number of G&rsquo;s in the run queue.</li>
<li>spinning: whether G is being preempted or not.</li>
</ul>
<p>What P stands for.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">P0: <span class="nv">status</span><span class="o">=</span><span class="m">0</span> <span class="nv">schedtick</span><span class="o">=</span><span class="m">0</span> <span class="nv">syscalltick</span><span class="o">=</span><span class="m">0</span> <span class="nv">m</span><span class="o">=</span>-1 <span class="nv">runqsize</span><span class="o">=</span><span class="m">2</span> <span class="nv">gfreecnt</span><span class="o">=</span><span class="m">0</span> <span class="nv">timerslen</span><span class="o">=</span><span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>status: the running status of P.</li>
<li>schedtick: the number of times P was scheduled.</li>
<li>syscalltick: the number of system calls of P.</li>
<li>m: which M to belong to.</li>
<li>runqsize: the number of G&rsquo;s in the run queue.</li>
<li>gfreecnt: the available Gs (with status Gdead).</li>
</ul>
<p>The status state of P represents the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">const <span class="o">(</span> 
    // 表示P没有运行用户代码或者调度器 
    <span class="nv">_Pidle</span> <span class="o">=</span> iota 
    // 被线程 M 持有，并且正在执行用户代码或者调度器
    _Prunning 
    // 没有执行用户代码，当前线程陷入系统调用
    _Psyscall
    // 被线程 M 持有，当前处理器由于垃圾回收 STW 被停止
    _Pgcstop 
    // 当前处理器已经不被使用
    _Pdead
<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="modify-the-compilation">Modify the compilation</h3>
<p>Let&rsquo;s say we make a change to the channel and add a print to it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">func makechan<span class="o">(</span>t *chantype, size int<span class="o">)</span> *hchan <span class="o">{</span>
    ...  
    <span class="k">if</span> debug.schedtrace &gt; <span class="m">0</span> <span class="o">{</span>
        print<span class="o">(</span><span class="s2">&#34;bearluo makechan: chan=&#34;</span>, c, <span class="s2">&#34;; elemsize=&#34;</span>, elem.size, <span class="s2">&#34;; dataqsiz=&#34;</span>, size, <span class="s2">&#34;\n&#34;</span><span class="o">)</span>
    <span class="o">}</span>
    ...
    <span class="k">return</span> c
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then go to the src directory of go and recompile.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@localhost src<span class="o">]</span><span class="c1"># ./make.bash</span>
Building Go cmd/dist using /usr/local/go. <span class="o">(</span>go1.15.8 linux/amd64<span class="o">)</span>
Building Go toolchain1 using /usr/local/go.
Building Go bootstrap cmd/go <span class="o">(</span>go_bootstrap<span class="o">)</span> using Go toolchain1.
Building Go toolchain2 using go_bootstrap and Go toolchain1.
Building Go toolchain3 using go_bootstrap and Go toolchain2.
Building packages and commands <span class="k">for</span> linux/amd64.
---
Installed Go <span class="k">for</span> linux/amd64 in /data/learn/go
Installed commands in /data/learn/go/bin
</code></pre></td></tr></table>
</div>
</div><p>Write a simple demo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>run</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">localhost</span> <span class="nx">gotest</span><span class="p">]</span><span class="err">#</span> <span class="nx">GODEBUG</span><span class="p">=</span><span class="nx">schedtrace</span><span class="p">=</span><span class="mi">1000</span> <span class="nx">mygo</span> <span class="nx">run</span> <span class="nx">main</span><span class="p">.</span><span class="k">go</span> 
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000036070</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">8</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">SCHED</span> <span class="mi">0</span><span class="nx">ms</span><span class="p">:</span> <span class="nx">gomaxprocs</span><span class="p">=</span><span class="mi">16</span> <span class="nx">idleprocs</span><span class="p">=</span><span class="mi">13</span> <span class="nx">threads</span><span class="p">=</span><span class="mi">6</span> <span class="nx">spinningthreads</span><span class="p">=</span><span class="mi">1</span> <span class="nx">idlethreads</span><span class="p">=</span><span class="mi">0</span> <span class="nx">runqueue</span><span class="p">=</span><span class="mi">0</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc00010e000</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">0</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc00010e060</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">0</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc00010e180</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">0</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc0006a8000</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">35</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc0003f6660</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000226540</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc0001381e0</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc0005043c0</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc00049c420</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000594300</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000090360</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000220000</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc00075e000</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000138840</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc000226780</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc0003ea420</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">2</span>
<span class="nx">bearluo</span> <span class="nx">makechan</span><span class="p">:</span> <span class="kd">chan</span><span class="p">=</span><span class="mh">0xc00049d320</span><span class="p">;</span> <span class="nx">elemsize</span><span class="p">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">dataqsiz</span><span class="p">=</span><span class="mi">1</span>
<span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="delve-debugging">Delve Debugging</h2>
<p>Currently Go language supports several debuggers, GDB, LLDB and Delve. Only Delve is a debugging tool designed and developed specifically for the Go language. Delve itself is also developed in Go language and provides the same support for Windows platform. In this section, we briefly explain how to debug Go runtime code and assembler based on Delve.</p>
<p>Github: <a href="https://github.com/go-delve/delve">https://github.com/go-delve/delve</a></p>
<p>Installation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">go get github.com/go-delve/delve/cmd/dlv
</code></pre></td></tr></table>
</div>
</div><p>First write an example of test.go.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">type</span> <span class="nx">A</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">test</span> <span class="kt">string</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then enter the package directory at the command line and enter the <code>dlv debug</code> command to debug.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">PS</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">document</span><span class="err">\</span><span class="nx">code</span><span class="err">\</span><span class="nx">test_go</span><span class="err">\</span><span class="nx">src</span><span class="p">&gt;</span> <span class="nx">dlv</span> <span class="nx">debug</span>
<span class="nx">Type</span> <span class="err">&#39;</span><span class="nx">help</span><span class="err">&#39;</span> <span class="k">for</span> <span class="nx">list</span> <span class="nx">of</span> <span class="nx">commands</span><span class="p">.</span>
</code></pre></td></tr></table>
</div>
</div><p>Then you can use the break command to set a breakpoint on the main method of the main package</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">(</span>dlv<span class="o">)</span> <span class="nb">break</span> main.main
Breakpoint <span class="m">1</span> <span class="nb">set</span> at 0x4bd30a <span class="k">for</span> main.main<span class="o">()</span> c:/document/code/test_go/src/test.go:8
</code></pre></td></tr></table>
</div>
</div><p>View all breakpoints that have been set via breakpoints.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">(</span>dlv<span class="o">)</span> breakpoints
Breakpoint runtime-fatal-throw at 0x4377e0 <span class="k">for</span> runtime.fatalthrow<span class="o">()</span> c:/software/go/src/runtime/panic.go:1162 <span class="o">(</span>0<span class="o">)</span>
Breakpoint unrecovered-panic at 0x437860 <span class="k">for</span> runtime.fatalpanic<span class="o">()</span> c:/software/go/src/runtime/panic.go:1189 <span class="o">(</span>0<span class="o">)</span>
        print runtime.curg._panic.arg
Breakpoint <span class="m">1</span> at 0x4bd30a <span class="k">for</span> main.main<span class="o">()</span> c:/document/code/test_go/src/test.go:8 <span class="o">(</span>0<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>The continue command allows the program to run to the next breakpoint</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">(</span>dlv<span class="o">)</span> <span class="k">continue</span>
&gt; main.main<span class="o">()</span> c:/document/code/test_go/src/test.go:8 <span class="o">(</span>hits goroutine<span class="o">(</span>1<span class="o">)</span>:1 total:1<span class="o">)</span> <span class="o">(</span>PC: 0x4bd30a<span class="o">)</span>
     3: import <span class="s2">&#34;fmt&#34;</span>
     4:
     5: <span class="nb">type</span> A struct <span class="o">{</span>
     6:         <span class="nb">test</span> string
     7: <span class="o">}</span>
<span class="o">=</span>&gt;   8: func main<span class="o">()</span> <span class="o">{</span>
     9:         a :<span class="o">=</span> new<span class="o">(</span>A<span class="o">)</span>
    10:         fmt.Println<span class="o">(</span>a<span class="o">)</span>
    11: <span class="o">}</span>
    12:
    13:
</code></pre></td></tr></table>
</div>
</div><p>View the assembly code corresponding to the main function by using the disassemble disassembly command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">(</span><span class="nx">dlv</span><span class="p">)</span> <span class="nx">disassemble</span>
<span class="nx">TEXT</span> <span class="nx">main</span><span class="p">.</span><span class="nf">main</span><span class="p">(</span><span class="nx">SB</span><span class="p">)</span> <span class="nx">C</span><span class="p">:</span><span class="o">/</span><span class="nx">document</span><span class="o">/</span><span class="nx">code</span><span class="o">/</span><span class="nx">test_go</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">test</span><span class="p">.</span><span class="k">go</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd2f0</span>        <span class="mi">65488</span><span class="nx">b0c2528000000</span>      <span class="nx">mov</span> <span class="nx">rcx</span><span class="p">,</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="nx">gs</span><span class="p">:[</span><span class="mh">0x28</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd2f9</span>        <span class="mi">488</span><span class="nx">b8900000000</span>          <span class="nx">mov</span> <span class="nx">rcx</span><span class="p">,</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rcx</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd300</span>        <span class="mi">483</span><span class="nx">b6110</span>                <span class="nx">cmp</span> <span class="nx">rsp</span><span class="p">,</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rcx</span><span class="o">+</span><span class="mh">0x10</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd304</span>        <span class="mi">0</span><span class="nx">f8697000000</span>            <span class="nx">jbe</span> <span class="mh">0x4bd3a1</span>
<span class="p">=&gt;</span>      <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd30a</span><span class="o">*</span>       <span class="mi">4883</span><span class="nx">ec78</span>                <span class="nx">sub</span> <span class="nx">rsp</span><span class="p">,</span> <span class="mh">0x78</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd30e</span>        <span class="mi">48896</span><span class="nx">c2470</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x70</span><span class="p">],</span> <span class="nx">rbp</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd313</span>        <span class="mi">488</span><span class="nx">d6c2470</span>              <span class="nx">lea</span> <span class="nx">rbp</span><span class="p">,</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x70</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">9</span>       <span class="mh">0x4bd318</span>        <span class="mi">488</span><span class="nx">d0581860100</span>          <span class="nx">lea</span> <span class="nx">rax</span><span class="p">,</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">__image_base__</span><span class="o">+</span><span class="mi">874912</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">9</span>       <span class="mh">0x4bd31f</span>        <span class="mi">48890424</span>                <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="p">],</span> <span class="nx">rax</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">9</span>       <span class="mh">0x4bd323</span>        <span class="nx">e8e800f5ff</span>              <span class="nx">call</span> <span class="err">$</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">newobject</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">9</span>       <span class="mh">0x4bd328</span>        <span class="mi">488</span><span class="nx">b442408</span>              <span class="nx">mov</span> <span class="nx">rax</span><span class="p">,</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x8</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">9</span>       <span class="mh">0x4bd32d</span>        <span class="mi">4889442430</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x30</span><span class="p">],</span> <span class="nx">rax</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd332</span>        <span class="mi">4889442440</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x40</span><span class="p">],</span> <span class="nx">rax</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd337</span>        <span class="mi">0</span><span class="nx">f57c0</span>                  <span class="nx">xorps</span> <span class="nx">xmm0</span><span class="p">,</span> <span class="nx">xmm0</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd33a</span>        <span class="mi">0</span><span class="nx">f11442448</span>              <span class="nx">movups</span> <span class="nx">xmmword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x48</span><span class="p">],</span> <span class="nx">xmm0</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd33f</span>        <span class="mi">488</span><span class="nx">d442448</span>              <span class="nx">lea</span> <span class="nx">rax</span><span class="p">,</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x48</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd344</span>        <span class="mi">4889442438</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x38</span><span class="p">],</span> <span class="nx">rax</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd349</span>        <span class="mi">8400</span>                    <span class="nx">test</span> <span class="kt">byte</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rax</span><span class="p">],</span> <span class="nx">al</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd34b</span>        <span class="mi">488</span><span class="nx">b4c2440</span>              <span class="nx">mov</span> <span class="nx">rcx</span><span class="p">,</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x40</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd350</span>        <span class="mi">488</span><span class="nx">d15099f0000</span>          <span class="nx">lea</span> <span class="nx">rdx</span><span class="p">,</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">__image_base__</span><span class="o">+</span><span class="mi">815712</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd357</span>        <span class="mi">4889542448</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x48</span><span class="p">],</span> <span class="nx">rdx</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd35c</span>        <span class="mi">48894</span><span class="nx">c2450</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x50</span><span class="p">],</span> <span class="nx">rcx</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd361</span>        <span class="mi">8400</span>                    <span class="nx">test</span> <span class="kt">byte</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rax</span><span class="p">],</span> <span class="nx">al</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd363</span>        <span class="nx">eb00</span>                    <span class="nx">jmp</span> <span class="mh">0x4bd365</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd365</span>        <span class="mi">4889442458</span>              <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x58</span><span class="p">],</span> <span class="nx">rax</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd36a</span>        <span class="mi">48</span><span class="nx">c744246001000000</span>      <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x60</span><span class="p">],</span> <span class="mh">0x1</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd373</span>        <span class="mi">48</span><span class="nx">c744246801000000</span>      <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x68</span><span class="p">],</span> <span class="mh">0x1</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd37c</span>        <span class="mi">48890424</span>                <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="p">],</span> <span class="nx">rax</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd380</span>        <span class="mi">48</span><span class="nx">c744240801000000</span>      <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x8</span><span class="p">],</span> <span class="mh">0x1</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd389</span>        <span class="mi">48</span><span class="nx">c744241001000000</span>      <span class="nx">mov</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x10</span><span class="p">],</span> <span class="mh">0x1</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">10</span>      <span class="mh">0x4bd392</span>        <span class="nx">e869a0ffff</span>              <span class="nx">call</span> <span class="err">$</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">11</span>      <span class="mh">0x4bd397</span>        <span class="mi">488</span><span class="nx">b6c2470</span>              <span class="nx">mov</span> <span class="nx">rbp</span><span class="p">,</span> <span class="nx">qword</span> <span class="nx">ptr</span> <span class="p">[</span><span class="nx">rsp</span><span class="o">+</span><span class="mh">0x70</span><span class="p">]</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">11</span>      <span class="mh">0x4bd39c</span>        <span class="mi">4883</span><span class="nx">c478</span>                <span class="nx">add</span> <span class="nx">rsp</span><span class="p">,</span> <span class="mh">0x78</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">11</span>      <span class="mh">0x4bd3a0</span>        <span class="nx">c3</span>                      <span class="nx">ret</span>
        <span class="nx">test</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">8</span>       <span class="mh">0x4bd3a1</span>        <span class="nx">e82a50faff</span>              <span class="nx">call</span> <span class="err">$</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">morestack_noctxt</span>
        <span class="p">.:</span><span class="mi">0</span>             <span class="mh">0x4bd3a6</span>        <span class="nx">e945ffffff</span>              <span class="nx">jmp</span> <span class="err">$</span><span class="nx">main</span><span class="p">.</span><span class="nx">main</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we can use the break breakpoint to the call to the runtime.newobject function</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">(</span><span class="nx">dlv</span><span class="p">)</span> <span class="k">break</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">newobject</span>
<span class="nx">Breakpoint</span> <span class="mi">2</span> <span class="nx">set</span> <span class="nx">at</span> <span class="mh">0x40d426</span> <span class="k">for</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">newobject</span><span class="p">()</span> <span class="nx">c</span><span class="p">:</span><span class="o">/</span><span class="nx">software</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">runtime</span><span class="o">/</span><span class="nx">malloc</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">1164</span>
</code></pre></td></tr></table>
</div>
</div><p>Type continue to jump to the location of the breakpoint.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">(</span><span class="nx">dlv</span><span class="p">)</span> <span class="k">continue</span>
<span class="p">&gt;</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">newobject</span><span class="p">()</span> <span class="nx">c</span><span class="p">:</span><span class="o">/</span><span class="nx">software</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">runtime</span><span class="o">/</span><span class="nx">malloc</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">1164</span> <span class="p">(</span><span class="nx">hits</span> <span class="nf">goroutine</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span> <span class="nx">total</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nx">PC</span><span class="p">:</span> <span class="mh">0x40d426</span><span class="p">)</span>
<span class="nx">Warning</span><span class="p">:</span> <span class="nx">debugging</span> <span class="nx">optimized</span> <span class="nx">function</span>
  <span class="mi">1159</span><span class="p">:</span> <span class="p">}</span>
  <span class="mi">1160</span><span class="p">:</span>
  <span class="mi">1161</span><span class="p">:</span> <span class="c1">// implementation of new builtin
</span><span class="c1"></span>  <span class="mi">1162</span><span class="p">:</span> <span class="c1">// compiler (both frontend and SSA backend) knows the signature
</span><span class="c1"></span>  <span class="mi">1163</span><span class="p">:</span> <span class="c1">// of this function
</span><span class="c1"></span><span class="p">=&gt;</span><span class="mi">1164</span><span class="p">:</span> <span class="kd">func</span> <span class="nf">newobject</span><span class="p">(</span><span class="nx">typ</span> <span class="o">*</span><span class="nx">_type</span><span class="p">)</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span> <span class="p">{</span>
  <span class="mi">1165</span><span class="p">:</span>         <span class="k">return</span> <span class="nf">mallocgc</span><span class="p">(</span><span class="nx">typ</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="nx">typ</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="mi">1166</span><span class="p">:</span> <span class="p">}</span>
  <span class="mi">1167</span><span class="p">:</span>
  <span class="mi">1168</span><span class="p">:</span> <span class="c1">//go:linkname reflect_unsafe_New reflect.unsafe_New
</span><span class="c1"></span>  <span class="mi">1169</span><span class="p">:</span> <span class="kd">func</span> <span class="nf">reflect_unsafe_New</span><span class="p">(</span><span class="nx">typ</span> <span class="o">*</span><span class="nx">_type</span><span class="p">)</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span> <span class="p">{</span>
</code></pre></td></tr></table>
</div>
</div><p>print command to view the data of typ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">(</span>dlv<span class="o">)</span> print typ
*runtime._type <span class="o">{</span>size: 16, ptrdata: 8, hash: 875453117, tflag: tflagUncommon<span class="p">|</span>tflagExtraStar<span class="p">|</span>tflagNamed <span class="o">(</span>7<span class="o">)</span>, align: 8, fieldAlign: 8, kind: 25, equal: runtime.strequal, gcdata: *1, str: 5418, ptrToThis: 37472<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can see that the size printed here is 16bytes, because we have a string type field inside the A structure.</p>
<p>Once you get to the mallocgc method, you can view the arguments and local variables of the function by using the args and locals commands.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="p">(</span><span class="nx">dlv</span><span class="p">)</span> <span class="nx">args</span>
<span class="nx">size</span> <span class="p">=</span> <span class="p">(</span><span class="nx">unreadable</span> <span class="nx">could</span> <span class="nx">not</span> <span class="nx">find</span> <span class="nx">loclist</span> <span class="nx">entry</span> <span class="nx">at</span> <span class="mh">0x8b40</span> <span class="k">for</span> <span class="nx">address</span> <span class="mh">0x40ca73</span><span class="p">)</span>
<span class="nx">typ</span> <span class="p">=</span> <span class="p">(</span><span class="o">*</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">_type</span><span class="p">)(</span><span class="mh">0x4d59a0</span><span class="p">)</span>
<span class="nx">needzero</span> <span class="p">=</span> <span class="kc">true</span>
<span class="err">~</span><span class="nx">r3</span> <span class="p">=</span> <span class="p">(</span><span class="nx">unreadable</span> <span class="nx">empty</span> <span class="nx">OP</span> <span class="nx">stack</span><span class="p">)</span>
<span class="p">(</span><span class="nx">dlv</span><span class="p">)</span> <span class="nf">locals</span>
<span class="p">(</span><span class="nx">no</span> <span class="nx">locals</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/tidb/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">What can we learn from TiDB?</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/go-stack/">
            <span class="next-text nav-default">An article to help you understand stack operations in Go</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
