<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Spring Cloud Gateway Guide - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Recently, I was working on the refactoring of the old system, and I needed to introduce a gateway service into the new system after the refactoring was completed, as an adaptation and proxy for the interface between the new system and the old system. Previously, many gateway applications used the Spring-Cloud-Netfilx solution based on the Zuul1.x version, but given that Zuul1.x had stopped iterating, it used a more traditional blocking" /><meta name="keywords" content="spring-cloud-gateway,guide,spring-cloud" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/spring-cloud-gateway-guide/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Spring Cloud Gateway Guide" />
<meta property="og:description" content="Recently, I was working on the refactoring of the old system, and I needed to introduce a gateway service into the new system after the refactoring was completed, as an adaptation and proxy for the interface between the new system and the old system. Previously, many gateway applications used the Spring-Cloud-Netfilx solution based on the Zuul1.x version, but given that Zuul1.x had stopped iterating, it used a more traditional blocking" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/spring-cloud-gateway-guide/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-02T11:24:22+08:00" />
<meta property="article:modified_time" content="2021-07-02T11:24:22+08:00" />

<meta itemprop="name" content="Spring Cloud Gateway Guide">
<meta itemprop="description" content="Recently, I was working on the refactoring of the old system, and I needed to introduce a gateway service into the new system after the refactoring was completed, as an adaptation and proxy for the interface between the new system and the old system. Previously, many gateway applications used the Spring-Cloud-Netfilx solution based on the Zuul1.x version, but given that Zuul1.x had stopped iterating, it used a more traditional blocking"><meta itemprop="datePublished" content="2021-07-02T11:24:22+08:00" />
<meta itemprop="dateModified" content="2021-07-02T11:24:22+08:00" />
<meta itemprop="wordCount" content="3254">
<meta itemprop="keywords" content="spring-cloud,spring-cloud-gateway," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring Cloud Gateway Guide"/>
<meta name="twitter:description" content="Recently, I was working on the refactoring of the old system, and I needed to introduce a gateway service into the new system after the refactoring was completed, as an adaptation and proxy for the interface between the new system and the old system. Previously, many gateway applications used the Spring-Cloud-Netfilx solution based on the Zuul1.x version, but given that Zuul1.x had stopped iterating, it used a more traditional blocking"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Spring Cloud Gateway Guide</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-02 11:24:22 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/microservices/"> microservices </a>
            </div>
          <span class="more-meta"> 3254 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a>
          <ul>
            <li><a href="#terminology">Terminology</a></li>
            <li><a href="#working-principle">Working Principle</a></li>
          </ul>
        </li>
        <li><a href="#introduction-of-dependencies">Introduction of dependencies</a></li>
        <li><a href="#gateway-configuration">Gateway Configuration</a>
          <ul>
            <li><a href="#yaml-configuration">Yaml configuration</a></li>
            <li><a href="#programmatic-streaming-configuration">Programmatic streaming configuration</a></li>
          </ul>
        </li>
        <li><a href="#routing-predicate-factory">Routing Predicate Factory</a>
          <ul>
            <li><a href="#specify-date-time-rule-routing-predicates">Specify date-time rule routing predicates</a></li>
            <li><a href="#cookie-routing-predicates">Cookie routing predicates</a></li>
            <li><a href="#header-routing-predicate">Header routing predicate</a></li>
            <li><a href="#host-routing-predicates">Host routing predicates</a></li>
            <li><a href="#request-method-routing-predicates">Request method routing predicates</a></li>
            <li><a href="#request-path-routing-predicates">Request path routing predicates</a></li>
          </ul>
        </li>
        <li><a href="#request-query-parameter-routing-predicate">Request query parameter routing predicate</a>
          <ul>
            <li><a href="#remote-ip-address-routing-predicate">Remote IP address routing predicate</a></li>
            <li><a href="#multiple-routing-predicate-combinations">Multiple routing predicate combinations</a></li>
          </ul>
        </li>
        <li><a href="#gatewayfilter-factory">GatewayFilter Factory</a></li>
        <li><a href="#globalfilter-factory">GlobalFilter Factory</a></li>
        <li><a href="#cross-configuration">Cross configuration</a></li>
        <li><a href="#actuator-endpoint-related">Actuator Endpoint Related</a></li>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#appendix">Appendix</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/02/e206c56471b1463b85e5477dec6788d9.png" alt=" "></p>
<p>Recently, I was working on the refactoring of the old system, and I needed to introduce a gateway service into the new system after the refactoring was completed, as an adaptation and proxy for the interface between the new system and the old system. Previously, many gateway applications used the <code>Spring-Cloud-Netfilx</code> solution based on the <code>Zuul1.x</code> version, but given that <code>Zuul1.x</code> had stopped iterating, it used a more traditional blocking <code>(B)IO</code> + multi-threaded implementation, which actually did not perform well. Then the <code>Spring</code> team simply redeveloped a set of gateway components on their own, and this is the <code>Spring-Cloud-Gateway</code> to be investigated.</p>
<h2 id="introduction">Introduction</h2>
<p><code>Spring Cloud Gateway</code> relies on <a href="https://spring.io/projects/spring-boot#learn">Spring Boot 2.0</a>, <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux</a>, and <a href="https://projectreactor.io/docs">Project Reactor</a>. Many familiar synchronous libraries (such as <code>Spring-Data</code> and <code>Spring-Security</code>) and synchronous programming patterns are not available in <code>Spring Cloud Gateway</code>, so it is best to read the documentation for the three frameworks mentioned above first.</p>
<p><code>Spring Cloud Gateway</code> relies on the <code>Netty</code> based runtime environment provided by <code>Spring Boot</code> and <code>Spring WebFlux</code>, it is not built as a <code>WAR</code> package or run in a traditional <code>Servlet</code> container.</p>
<h3 id="terminology">Terminology</h3>
<ul>
<li><code>Route</code>: A route is the basic component of a gateway. It is defined by an ID, a target URI, a collection of predicates (Predicate) and a collection of filters. If the predicate aggregation is judged to be true, the route is matched.</li>
<li><code>Predicate</code>: uses java.util.Predicate introduced in Java8 based on functional programming. when using the predicate (aggregation) judgment, the input parameters are of type ServerWebExchange, which allows the developer to match any parameter from an HTTP request, such as HTTP request headers, HTTP request parameters, etc.</li>
<li><code>Filter</code>: The GatewayFilter instance created by the specified GatewayFilter factory is used to modify the request (parameters) or response (parameters) before or after sending the request downstream.</li>
</ul>
<p>Actually, <code>Filter</code> also includes <code>GlobalFilter</code>, but it is not mentioned in the official documentation.</p>
<h3 id="working-principle">Working Principle</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/02/9d94f71aead94b9aab676f70b5875c7d.png" alt=" "></p>
<p>The client sends a request to <code>Spring Cloud Gateway</code> and if the <code>Gateway Handler Mapping</code> module processes the current request if it matches a target route configuration, the request is forwarded to the <code>Gateway Web Handler</code> module. When the <code>Gateway Web Handler</code> module sends the request, it passes the request through a chain of filters that match the request. The reason the filters are separated by dashed lines in the above diagram is that the filter processing logic can be executed before or after the proxy request is sent. All <code>pre</code> type filters are executed before the proxy request is created (and sent), and all <code>post</code> type filters are executed when the proxy request is created (and sent).</p>
<p>See the above figure, if the external request comes in and falls into the filter chain, then the left side of the dotted line is the pre type filter, and the request goes through the <code>pre</code> type filter first, and then is sent to the target proxied service. The target proxied service responds to the request, and the response goes through the filter chain again, that is, through the filter chain on the right side of the dotted line, and these filters are the post filters.</p>
<p>Note that if the corresponding routing port is not explicitly specified in the routing configuration, the following default port will be used.</p>
<ul>
<li>HTTP protocol, use port 80.</li>
<li>HTTPS protocol, use port 443.</li>
</ul>
<h2 id="introduction-of-dependencies">Introduction of dependencies</h2>
<p>It is recommended to introduce Spring-Cloud-Gateway directly through the <code>Train</code> version (in fact, I have checked that the code name of the <code>Train</code> version is actually the naming of the London Underground station, like the current <code>Spring Cloud</code> latest version is <code>Greenwich.SR1</code>, <code>Greenwich</code> can be found in the map of London Underground station, corresponding to the <code>SpringBoot</code> version is 2.1.x) into <code>Spring-Cloud-Gateway</code>, as this will keep up with the latest stable version of <code>Spring-Cloud</code>, and because <code>Spring-Cloud-Gateway</code> is based on the <code>Netty</code> runtime environment to start, there is no need to introduce the <code>Servlet</code> container with the <code>spring-boot-starter-web</code> with a <code>Servlet</code> container.</p>
<p>The parent POM introduces the following configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependencyManagement&gt;</span>
        <span class="nt">&lt;dependencies&gt;</span>
            <span class="nt">&lt;dependency&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>Greenwich.SR1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;/dependency&gt;</span>
            <span class="nt">&lt;dependency&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-boot-dependencies<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.1.4.RELEASE<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>submodule or the module <code>POM</code> that needs to introduce <code>Spring-Cloud-Gateway</code> introduces the following configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Creating a starter class is sufficient.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RouteServerApplication</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">RouteServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="gateway-configuration">Gateway Configuration</h2>
<p>The gateway configuration eventually needs to be translated into a collection of <code>RouteDefinition</code>, with the following interface for the definition of the configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RouteDefinitionLocator</span> <span class="o">{</span>
    <span class="n">Flux</span><span class="o">&lt;</span><span class="n">RouteDefinition</span><span class="o">&gt;</span> <span class="nf">getRouteDefinitions</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Configuration through <code>YAML</code> files or streaming programmatic configuration (in fact, there is also <code>DiscoveryClient</code> for configuration with <code>Eureka</code> in the documentation, which will not be studied here for now) is ultimately aimed at creating a collection of <code>RouteDefinition</code>.</p>
<h3 id="yaml-configuration">Yaml configuration</h3>
<p>The configuration implementation is <code>PropertiesRouteDefinitionLocator</code>, associated with the configuration class <code>GatewayProperties</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">datetime_after_route   </span><span class="w"> </span><span class="c"># &lt;------ Here is the ID of the route configuration</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://www.throwable.club </span><span class="w"> </span><span class="c"># &lt;------ Here is the URI (Host) for routing the final destination Server</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">                     </span><span class="c"># &lt;------ Predicate set configuration, multiple are logically connected with and</span><span class="w">
</span><span class="w">         </span>- <span class="l">Path=/blog   </span><span class="w"> </span><span class="c"># &lt;------- Key(name)=Expression，键is the ID of the predicate rule factory, and the value is generally the regular representation of the matching rule</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="programmatic-streaming-configuration">Programmatic streaming configuration</h3>
<p>Programmatic and streaming configurations rely on the <code>RouteLocatorBuilder</code> and the goal is to construct a <code>RouteLocator</code> instance.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">RouteLocator</span> <span class="nf">customRouteLocator</span><span class="o">(</span><span class="n">RouteLocatorBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">routes</span><span class="o">()</span>
            <span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="n">r</span> <span class="o">-&gt;</span> <span class="n">r</span><span class="o">.</span><span class="na">path</span><span class="o">(</span><span class="s">&#34;/blog&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;http://www.throwable.club&#34;</span><span class="o">)</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="routing-predicate-factory">Routing Predicate Factory</h2>
<p><code>Spring Cloud Gateway</code> uses <code>Route</code> as part of the <code>HandlerMapping</code> component infrastructure of <code>Spring-WebFlux</code>, which means that when <code>HandlerMapping</code> does the matching, it includes the configured routing rules in the matching mechanism. <code>Spring Cloud Gateway</code> itself contains a number of built-in routing predicate factories. Each of these predicates matches a different attribute of an <code>HTTP</code> request. Multiple routing predicate factories can be combined together using <code>and</code> logic.</p>
<p>The built-in routing predicate factories currently provided by <code>Spring Cloud Gateway</code> are as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/02/f7d1460d88f94eb5b885996519a27236.png" alt=" "></p>
<h3 id="specify-date-time-rule-routing-predicates">Specify date-time rule routing predicates</h3>
<p>There are three optional rules for the routing predicate specified by the configured datetime.</p>
<ul>
<li>Match requests before the specified datetime.</li>
<li>The match request is after the specified date time.</li>
<li>The matching request is between the specified datetime.</li>
</ul>
<p>It is important to note that the configured datetime must satisfy the <code>ZonedDateTime</code> format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">//The year, month, day and hour, minute and second are separated by &#39;T&#39;, then -07:00 is the time difference from UTC, and the last [America/Denver] is the time zone.
2017-01-20T17:42:47.789-07:00[America/Denver]
</code></pre></td></tr></table>
</div>
</div><p>For example, if the gateway application is live on 2019-05-01T00:00:00+08:00 [Asia/Shanghai], and all requests after the live date are routed to <code>www.throwable.club</code>, then the configuration is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">server </span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9090</span><span class="w">
</span><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">datetime_after_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://www.throwable.club</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="l">After=2019-05-01T00:00:00+08:00[Asia/Shanghai]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>In this case, as long as the request gateway <code>http://localhost:9090</code>, the request will be forwarded to <code>http://www.throwable.club</code>.</p>
<p>If you want to allow only requests before <code>2019-05-01T00:00:00+08:00[Asia/Shanghai]</code>, then just change it to.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">server </span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9091</span><span class="w">
</span><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">datetime_before_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://www.throwable.club</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="l">Before=2019-05-01T00:00:00+08:00[Asia/Shanghai]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>If only the time between two date periods is allowed to be requested, then simply read</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">server </span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9090</span><span class="w">
</span><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">datetime_between_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://www.throwable.club</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="l">Between=2019-05-01T00:00:00+08:00[Asia/Shanghai],2019-05-02T00:00:00+08:00[Asia/Shanghai]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Then only requests from May 1, 2019, 0:00 to May 2, 2019, 0:00 will be routed properly.</p>
<h3 id="cookie-routing-predicates">Cookie routing predicates</h3>
<p>The <code>CookieRoutePredicateFactory</code> takes two parameters, the <code>name</code> of the <code>Cookie</code> and a regular expression (<code>value</code>). Only if the <code>name</code> and <code>value</code> corresponding to the <code>Cookie</code> in the request match the values configured in the <code>Cookie</code> route predicate will a hit be matched for routing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">server </span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9090</span><span class="w">
</span><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">cookie_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://www.throwable.club</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="l">Cookie=doge,throwable</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>The request needs to carry a <code>cookie</code>, the <code>name</code> is <code>doge</code> and the <code>value</code> needs to match the regular expression <code>throwable</code> to route to <code>http://www.throwable.club</code>.</p>
<p>Here we try to build an order <code>Order</code> service locally, based on <code>SpringBoot 2.1.4</code>, started on port <code>9091</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// main
</span><span class="c1"></span><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#34;/order&#34;</span><span class="o">)</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">OrderServiceApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/cookie&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">cookie</span><span class="o">(</span><span class="nd">@CookieValue</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;doge&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">doge</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">doge</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The application.yaml configuration for the order service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">order-service</span><span class="w">
</span><span class="w"></span><span class="nt">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9091</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Gateway routing configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">route-server</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">cookie_route</span><span class="w">
</span><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="l">Cookie=doge,throwable</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/cookie --cookie &#34;doge=throwable&#34;

//response
throwable
</code></pre></td></tr></table>
</div>
</div><h3 id="header-routing-predicate">Header routing predicate</h3>
<p>The <code>HeaderRoutePredicateFactory</code> takes two parameters, the <code>name</code> of the <code>Header</code> and a regular expression (<code>value</code>). Only if the <code>name</code> and <code>value</code> corresponding to the <code>Header</code> in the request match the values configured in the <code>Header</code> route predicate, a hit will be matched for routing.</p>
<p>A new <code>/header</code> endpoint is added to the order service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#34;/order&#34;</span><span class="o">)</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">OrderServiceApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/header&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">header</span><span class="o">(</span><span class="nd">@RequestHeader</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;accessToken&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">accessToken</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The routing configuration of the gateway is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">header_route</span><span class="w">
</span><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="l">Header=accessToken,Doge</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl -H &#34;accessToken:Doge&#34; http://localhost:9090/order/header

// response
Doge
</code></pre></td></tr></table>
</div>
</div><h3 id="host-routing-predicates">Host routing predicates</h3>
<p>The <code>HostRoutePredicateFactory</code> only needs to specify a list of host names, and each element in the list supports the <code>Ant</code> naming style, using <code>.</code> is used as a separator and multiple elements are distinguished from each other using <code>,</code>. The <code>Host</code> routing predicate actually targets the <code>Host</code> attribute in the <code>HTTP</code> request header.</p>
<p>A new <code>/header</code> endpoint is added to the order service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#34;/order&#34;</span><span class="o">)</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">OrderServiceApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/host&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">host</span><span class="o">(</span><span class="nd">@RequestHeader</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;Host&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">host</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">host</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The routing configuration of the gateway is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">host_route</span><span class="w">
</span><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="l">Host=localhost:9090</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/host

//response
localhost:9091  # &lt;--------- Note here that when routing to the order service, the Host will be modified to localhost:9091
</code></pre></td></tr></table>
</div>
</div><p>In fact, it is possible to customize more diverse Host matching patterns and even support URI template variables.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">- Host=www.throwable.**,**.throwable.**

- Host={sub}.throwable.club
</code></pre></td></tr></table>
</div>
</div><h3 id="request-method-routing-predicates">Request method routing predicates</h3>
<p>The <code>MethodRoutePredicateFactory</code> takes only one parameter: the HTTP request method to be matched.</p>
<p>The routing configuration of the gateway is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">method_route</span><span class="w">
</span><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="l">Method=GET</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Configured this way, all incoming requests to the <code>GET</code> method of the gateway will be routed to <code>http://localhost:9091</code>.</p>
<p>A new <code>/get</code> endpoint is added to the order service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/get&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">&#34;get&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/get

// response
get 
</code></pre></td></tr></table>
</div>
</div><h3 id="request-path-routing-predicates">Request path routing predicates</h3>
<p>The <code>PathRoutePredicateFactory</code> takes a list of <code>PathMatcher</code> pattern paths and an optional flag bit parameter <code>matchOptionalTrailingSeparator</code>. This is one of the most commonly used routing predicates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">path_route</span><span class="w">
</span><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="l">Path=/order/path</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/path&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">path</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">&#34;path&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/path

// response
path 
</code></pre></td></tr></table>
</div>
</div><p>In addition, paths can be configured with <code>{segment}</code> placeholders such as <code>/foo/1</code> or <code>/foo/bar</code> or <code>/bar/baz</code>, if configured in this form, when matching hits for routing, the corresponding content in the path will be extracted and the key-value pairs will be placed in the <code>ServerWebExchange. getAttributes()</code> collection, <code>KEY</code> is <code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>, these extracted attributes can be used by <code>GatewayFilter Factories</code>.</p>
<h2 id="request-query-parameter-routing-predicate">Request query parameter routing predicate</h2>
<p>The <code>QueryRoutePredicateFactory</code> takes a mandatory request query parameter (<code>name</code> of <code>param</code>) and an optional regular expression (<code>regexp</code>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">query_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">Query=doge,throwabl.</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>The <code>param</code> configured here is <code>doge</code> and the regular expression is <code>throwabl.</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/query&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">query</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">doge</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">doge</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/query?doge=throwable

// response
throwable 
</code></pre></td></tr></table>
</div>
</div><h3 id="remote-ip-address-routing-predicate">Remote IP address routing predicate</h3>
<p>The <code>RemoteAddrRoutePredicateFactory</code> match rule takes a list of <code>CIDR</code> symbolic (IPv4 or IPv6) strings (minimum value is 1), e.g. <code>192.168.0.1/16</code> (where <code>192.168.0.1</code> is the remote IP address and 16 is the subnet mask).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">remoteaddr_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">RemoteAddr=127.0.0.1</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/remote&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">remote</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">&#34;remote&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/remote

// response
remote 
</code></pre></td></tr></table>
</div>
</div><p>There are actually many extensions to the routing predicate of remote IP routing, so I won&rsquo;t start here for now.</p>
<h3 id="multiple-routing-predicate-combinations">Multiple routing predicate combinations</h3>
<p>Because the <code>predicates</code> attribute in the routing configuration is actually a list, multiple routing rules can be added directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">remoteaddr_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9091</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">RemoteAddr=xxxx</span><span class="w">
</span><span class="w">        </span>- <span class="l">Path=/yyyy</span><span class="w">
</span><span class="w">        </span>- <span class="l">Query=zzzz,aaaa</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>These rules are logically combined using <code>and</code>, e.g. the example above is equivalent to</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">request = ...
if(request.getRemoteAddr == &#39;xxxx&#39; &amp;&amp; request.getPath match &#39;/yyyy&#39; &amp;&amp; request.getQuery(&#39;zzzz&#39;) match &#39;aaaa&#39;) {
    return true;
}
return false;
</code></pre></td></tr></table>
</div>
</div><h2 id="gatewayfilter-factory">GatewayFilter Factory</h2>
<p>A routing filter <code>GatewayFilter</code> allows modifying the content of an incoming <code>HTTP</code> request or the content of a returned <code>HTTP</code> response. The scope of a routing filter is a specific routing configuration. <code>Spring Cloud Gateway</code> provides a rich set of built-in <code>GatewayFilter</code> factories that can be selected on demand.</p>
<p>Because there are so many <code>GatewayFilter</code> factory classes, I&rsquo;ll give a simple example here.</p>
<p>If we want to attach special <code>HTTP</code> request headers to some requests, we can use <code>AddRequestHeaderX-Request-Foo:Bar</code>, <code>application.yml</code> as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">add_request_header_route</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">https://example.org</span><span class="w">
</span><span class="w">        </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">AddRequestHeader=X-Request-Foo,Bar</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Then all HTTP requests from the gateway portal will have a special <code>HTTP</code> request header added: <code>X-Request-Foo:Bar</code>.</p>
<p>The current built-in implementation of the <code>GatewayFilter</code> factory is as follows.</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>class</th>
<th>type</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>StripPrefix</td>
<td>StripPrefixGatewayFilterFactory</td>
<td>pre</td>
<td>Remove the first part of the request <code>URL</code> path, e.g. the original request path is <code>/order/query</code>, after processing it is <code>/query</code></td>
</tr>
<tr>
<td>SetStatus</td>
<td>SetStatusGatewayFilterFactory</td>
<td>post</td>
<td>Setting the HTTP status code (parsed from <code>org.springframework.http.HttpStatus</code>)</td>
</tr>
<tr>
<td>SetResponseHeader</td>
<td>SetResponseHeaderGatewayFilterFactory</td>
<td>post</td>
<td>Set (add) the response header of the request response</td>
</tr>
<tr>
<td>SetRequestHeader</td>
<td>SetRequestHeaderGatewayFilterFactory</td>
<td>pre</td>
<td>Set (add) request header</td>
</tr>
<tr>
<td>SetPath</td>
<td>SetPathGatewayFilterFactory</td>
<td>pre</td>
<td>Set (override) request path</td>
</tr>
<tr>
<td>SecureHeader</td>
<td>SecureHeadersGatewayFilterFactory</td>
<td>pre</td>
<td>Set security-related request headers, see <code>SecureHeadersProperties</code></td>
</tr>
<tr>
<td>SaveSession</td>
<td>SaveSessionGatewayFilterFactory</td>
<td>pre</td>
<td>Save WebSession</td>
</tr>
<tr>
<td>RewriteResponseHeader</td>
<td>RewriteResponseHeaderGatewayFilterFactory</td>
<td>post</td>
<td>Re-response header</td>
</tr>
<tr>
<td>RewritePath</td>
<td>RewritePathGatewayFilterFactory</td>
<td>pre</td>
<td>Rewrite the request path</td>
</tr>
<tr>
<td>Retry</td>
<td>RetryGatewayFilterFactory</td>
<td>pre</td>
<td>Retry requests based on conditions</td>
</tr>
<tr>
<td>RequestSize</td>
<td>RequestSizeGatewayFilterFactory</td>
<td>pre</td>
<td>Limit the size of the request in byte, exceeding the set value returns 413 Payload Too Large</td>
</tr>
<tr>
<td>RequestRateLimiter</td>
<td>RequestRateLimiterGatewayFilterFactory</td>
<td>pre</td>
<td>Restricted flow</td>
</tr>
<tr>
<td>RequestHeaderToRequestUri</td>
<td>RequestHeaderToRequestUriGatewayFilterFactory</td>
<td>pre</td>
<td>Change the request URL by the value of the request header</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>RemoveResponseHeaderGatewayFilterFactory</td>
<td>post</td>
<td>Remove the configured response header</td>
</tr>
<tr>
<td>RemoveRequestHeader</td>
<td>RemoveRequestHeaderGatewayFilterFactory</td>
<td>pre</td>
<td>Remove the configured request header</td>
</tr>
<tr>
<td>RedirectTo</td>
<td>RedirectToGatewayFilterFactory</td>
<td>pre</td>
<td>Redirect, need to specify HTTP status code and redirect URL</td>
</tr>
<tr>
<td>PreserveHostHeader</td>
<td>PreserveHostHeaderGatewayFilterFactory</td>
<td>pre</td>
<td>Set the attribute <code>preserveHostHeader</code> carried by the request to <code>true</code></td>
</tr>
<tr>
<td>PrefixPath</td>
<td>PrefixPathGatewayFilterFactory</td>
<td>pre</td>
<td>Request path add predecessor path</td>
</tr>
<tr>
<td>Hystrix</td>
<td>HystrixGatewayFilterFactory</td>
<td>pre</td>
<td>Integrating <code>Hystrix</code></td>
</tr>
<tr>
<td>FallbackHeaders</td>
<td>FallbackHeadersGatewayFilterFactory</td>
<td>pre</td>
<td>The <code>Hystrix</code> implementation allows for exception details to be carried through the request header if the hit downgrade logic</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>AddResponseHeaderGatewayFilterFactory</td>
<td>post</td>
<td>Add response headers</td>
</tr>
<tr>
<td>AddRequestParameter</td>
<td>AddRequestParameterGatewayFilterFactory</td>
<td>pre</td>
<td>Add request parameters, limited to the <code>Query</code> parameter of the <code>URL</code> only</td>
</tr>
<tr>
<td>AddRequestHeader</td>
<td>AddRequestHeaderGatewayFilterFactory</td>
<td>pre</td>
<td>Add request header</td>
</tr>
</tbody>
</table>
<p>When using the <code>GatewayFilter</code> factory, you need to know its <code>ID</code> and how to configure it, which can be seen in the public static internal class <code>XXXXConfig</code> of the corresponding factory class.</p>
<h2 id="globalfilter-factory">GlobalFilter Factory</h2>
<p>The function of <code>GlobalFilter</code> is actually the same as <code>GatewayFilter</code>, except that the scope of <code>GlobalFilter</code> is all route configurations, not bound to the specified route configuration. Multiple <code>GlobalFilter</code>s can specify the order of execution of each <code>GlobalFilter</code> via the <code>@Order</code> or <code>getOrder()</code> methods. The smaller the <code>order</code> value, the higher the priority of <code>GlobalFilter</code> execution.</p>
<p>Note that since there are two types of filters, <code>pre</code> and <code>post</code>, the <code>pre</code> type filter should be at the top of the <code>pre</code> filter chain if the <code>order</code> value is smaller, and the post type filter should be at the bottom of the <code>pre</code> filter chain if the <code>order</code> value is smaller. The schematic diagram is as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/02/ce51f4fc7f1f4f2080db9f878228695a.png" alt=" "></p>
<p>For example, to implement the load balancing feature, <code>application.yml</code> is configured as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">myRoute</span><span class="w">
</span><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://myservice  </span><span class="w"> </span><span class="c"># &lt;-------- lb special tag will use LoadBalancerClient to search for target services for load balancing</span><span class="w">
</span><span class="w">        </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">Path=/service/**</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>The built-in <code>GlobalFilter</code> currently provided by <code>Spring Cloud Gateway</code> is as follows.</p>
<table>
<thead>
<tr>
<th>class</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>ForwardRoutingFilter</td>
<td>Redirection</td>
</tr>
<tr>
<td>LoadBalancerClientFilter</td>
<td>Load Balancing</td>
</tr>
<tr>
<td>NettyRoutingFilter</td>
<td>Netty&rsquo;s HTTP client routing</td>
</tr>
<tr>
<td>NettyWriteResponseFilter</td>
<td>Netty response for write operations</td>
</tr>
<tr>
<td>RouteToRequestUrlFilter</td>
<td>Update URL based on routing configuration</td>
</tr>
<tr>
<td>WebsocketRoutingFilter</td>
<td>Websocket request forwarding to downstream</td>
</tr>
</tbody>
</table>
<p>Most of the built-in <code>GlobalFilter</code>s are related to the properties of <code>ServerWebExchangeUtils</code>, so we won&rsquo;t go into depth here.</p>
<h2 id="cross-configuration">Cross configuration</h2>
<p>The gateway can control the global <code>CORS</code> behavior through configuration. The global <code>CORS</code> configuration corresponds to the class <code>CorsConfiguration</code>, which is a mapping of the <code>URL</code> schema. For example, the <code>application.yaml</code> file is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">globalcors</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">corsConfigurations</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">&#39;[/**]&#39;</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">allowedOrigins</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://docs.spring.io&#34;</span><span class="w">
</span><span class="w">            </span><span class="nt">allowedMethods</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="l">GET</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>In the above example, for all requested paths, <code>CORS</code> requests will be allowed from <code>docs.spring.io</code> and are <code>GET</code> methods.</p>
<h2 id="actuator-endpoint-related">Actuator Endpoint Related</h2>
<p>To introduce <code>spring-boot-starter-actuator</code>, you need to do the following configuration to enable the <code>gateway</code> monitoring endpoint.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">management.endpoint.gateway.enabled=true 
management.endpoints.web.exposure.include=gateway
</code></pre></td></tr></table>
</div>
</div><p>Current list of supported endpoints.</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>request path</th>
<th>HTTP method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globalfilters</td>
<td>/actuator/gateway/globalfilters</td>
<td>GET</td>
<td>Show the list of GlobalFilter in the routing configuration</td>
</tr>
<tr>
<td>routefilters</td>
<td>/actuator/gateway/routefilters</td>
<td>GET</td>
<td>Show the list of <code>GatewayFilter</code>s bound to the corresponding route configuration</td>
</tr>
<tr>
<td>refresh</td>
<td>/actuator/gateway/refresh</td>
<td>POST</td>
<td>Emptying the routing configuration cache</td>
</tr>
<tr>
<td>routes</td>
<td>/actuator/gateway/routes</td>
<td>GET</td>
<td>Display a list of defined routing configurations</td>
</tr>
<tr>
<td>routes/{id}</td>
<td>/actuator/gateway/routes/{id}</td>
<td>GET</td>
<td>Display the routing configuration already defined for the corresponding ID</td>
</tr>
<tr>
<td>routes/{id}</td>
<td>/actuator/gateway/routes/{id}</td>
<td>POST</td>
<td>Add a new routing configuration</td>
</tr>
<tr>
<td>routes/{id}</td>
<td>/actuator/gateway/routes/{id}</td>
<td>DELETE</td>
<td>Delete the routing configuration for the specified ID</td>
</tr>
</tbody>
</table>
<p>where <code>/actuator/gateway/routes/{id}</code> adds a new route configuration request parameter in the following format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;first_route&#34;</span><span class="p">,</span>
  <span class="nt">&#34;predicates&#34;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Path&#34;</span><span class="p">,</span>
    <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;doge&#34;</span><span class="p">:</span><span class="s2">&#34;/throwable&#34;</span><span class="p">}</span>
  <span class="p">}],</span>
  <span class="nt">&#34;filters&#34;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&#34;uri&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.throwable.club&#34;</span><span class="p">,</span>
  <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="summary">Summary</h2>
<p>Although the author is a developer at the bottom, but a long time ago said to friends around.</p>
<blockquote>
<p>Reactive programming combined with synchronous non-blocking IO or asynchronous non-blocking IO is the mainstream direction of the current network programming framework, it is best to keep pace with the mainstream to master the use of these frameworks, the best ability to become their contributors</p>
</blockquote>
<p>The common reactive programming frameworks currently available are.</p>
<ul>
<li><a href="https://projectreactor.io/">Reactor</a> and <code>RxJava2</code>, where <code>Reactor</code> is more common in back-end JVM applications, and <code>RxJava2</code> is more common in APP clients written for Android.</li>
<li><code>Reactor-Netty</code>, this is based on Reactor and Netty package .</li>
<li><code>Spring-WebFlux</code> and <code>Spring-Cloud-Gateway</code>, where <code>Spring-Cloud-Gateway</code> depends on <code>Spring-WebFlux</code> and <code>Spring-WebFlux</code> underlying depends on <code>Reactor-Netty</code>.</li>
</ul>
<p>According to this chain, it is better to learn <code>Reactor</code> and <code>Netty</code> systematically.</p>
<p>Reference.</p>
<ul>
<li><a href="https://projectreactor.io/docs">https://projectreactor.io/docs</a></li>
</ul>
<h2 id="appendix">Appendix</h2>
<p>The <code>Spring-Cloud-Gateway</code> was chosen not only to use the new technology, but more importantly for its impressive performance improvements. The results of the benchmarking project <code>spring-cloud-gateway-bench</code> are as follows.</p>
<table>
<thead>
<tr>
<th>Proxy</th>
<th>Avg Latency</th>
<th>Avg Requests/Sec</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spring Cloud Gateway</td>
<td>6.61ms</td>
<td>32213.38</td>
</tr>
<tr>
<td>Linkered</td>
<td>7.62ms</td>
<td>28050.76</td>
</tr>
<tr>
<td>Zuul(1.x)</td>
<td>12.56ms</td>
<td>20800.13</td>
</tr>
<tr>
<td>None(Direct call)</td>
<td>2.09ms</td>
<td>116841.15</td>
</tr>
</tbody>
</table>
<hr>
<p>Reference <code>https://www.throwx.cn/2019/05/03/spring-cloud-gateway-guide/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring-cloud/">spring-cloud</a>
          <a href="/tags/spring-cloud-gateway/">spring-cloud-gateway</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/getting-started-with-mockoon/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Getting Started With Mockoon</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/spring-cloud-gateway-custom-globalfilter/">
            <span class="next-text nav-default">Spring Cloud Gateway Custom Globalfilter</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
