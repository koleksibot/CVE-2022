<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Web Worker Tutorial - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="1. Overview The JavaScript language uses a single-threaded model, which means that all tasks can only be done on one thread, one thing at a time. If the previous task is not done, the later task has to wait. With the increase in computing power of computers, especially with the advent of multi-core CPUs, single-threading poses a great inconvenience and cannot fully utilize the computing power of computers.
The role of the Web Worker is to create a multi-threaded environment for JavaScript, allowing the main thread to create Worker threads and assign some tasks to the latter to run." /><meta name="keywords" content="WebWorker,Tutorial" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/web-worker-tutorial/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Web Worker Tutorial" />
<meta property="og:description" content="1. Overview The JavaScript language uses a single-threaded model, which means that all tasks can only be done on one thread, one thing at a time. If the previous task is not done, the later task has to wait. With the increase in computing power of computers, especially with the advent of multi-core CPUs, single-threading poses a great inconvenience and cannot fully utilize the computing power of computers.
The role of the Web Worker is to create a multi-threaded environment for JavaScript, allowing the main thread to create Worker threads and assign some tasks to the latter to run." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/web-worker-tutorial/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-13T09:26:19+08:00" />
<meta property="article:modified_time" content="2021-07-13T09:26:19+08:00" />

<meta itemprop="name" content="Web Worker Tutorial">
<meta itemprop="description" content="1. Overview The JavaScript language uses a single-threaded model, which means that all tasks can only be done on one thread, one thing at a time. If the previous task is not done, the later task has to wait. With the increase in computing power of computers, especially with the advent of multi-core CPUs, single-threading poses a great inconvenience and cannot fully utilize the computing power of computers.
The role of the Web Worker is to create a multi-threaded environment for JavaScript, allowing the main thread to create Worker threads and assign some tasks to the latter to run."><meta itemprop="datePublished" content="2021-07-13T09:26:19+08:00" />
<meta itemprop="dateModified" content="2021-07-13T09:26:19+08:00" />
<meta itemprop="wordCount" content="2324">
<meta itemprop="keywords" content="web-worker,javascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Web Worker Tutorial"/>
<meta name="twitter:description" content="1. Overview The JavaScript language uses a single-threaded model, which means that all tasks can only be done on one thread, one thing at a time. If the previous task is not done, the later task has to wait. With the increase in computing power of computers, especially with the advent of multi-core CPUs, single-threading poses a great inconvenience and cannot fully utilize the computing power of computers.
The role of the Web Worker is to create a multi-threaded environment for JavaScript, allowing the main thread to create Worker threads and assign some tasks to the latter to run."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Web Worker Tutorial</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-13 09:26:19 </span>
        <div class="post-category">
            <a href="/categories/frontend/"> frontend </a>
            <a href="/categories/web/"> web </a>
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 2324 words </span>
          <span class="more-meta"> 11 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-overview">1. Overview</a>
          <ul>
            <li><a href="#11-homologous-restrictions">1.1. Homologous restrictions</a></li>
            <li><a href="#12-dom-limitations">1.2. DOM Limitations</a></li>
            <li><a href="#13-communication-contact">1.3. Communication Contact</a></li>
            <li><a href="#14-script-restrictions">1.4. Script Restrictions</a></li>
            <li><a href="#15-file-restrictions">1.5. File Restrictions</a></li>
          </ul>
        </li>
        <li><a href="#2-basic-usage">2. Basic usage</a>
          <ul>
            <li><a href="#21-main-threads">2.1. Main threads</a></li>
            <li><a href="#22-worker-threads">2.2. Worker threads</a></li>
            <li><a href="#23-worker-load-script">2.3. Worker load script</a></li>
            <li><a href="#24-error-handling">2.4. Error Handling</a></li>
            <li><a href="#25-close-worker">2.5. Close Worker</a></li>
          </ul>
        </li>
        <li><a href="#3-data-communication">3. Data Communication</a></li>
        <li><a href="#4-web-worker-for-the-same-page">4. Web Worker for the same page</a></li>
        <li><a href="#5-example-worker-thread-completes-polling">5. Example: Worker thread completes polling</a></li>
        <li><a href="#6-example-worker-new-worker">6. Example: Worker New Worker</a></li>
        <li><a href="#7-api">7. API</a>
          <ul>
            <li><a href="#71-main-threads">7.1. Main threads</a></li>
            <li><a href="#72-worker-threads">7.2. Worker threads</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-overview">1. Overview</h2>
<p>The JavaScript language uses a single-threaded model, which means that all tasks can only be done on one thread, one thing at a time. If the previous task is not done, the later task has to wait. With the increase in computing power of computers, especially with the advent of multi-core CPUs, single-threading poses a great inconvenience and cannot fully utilize the computing power of computers.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/13/caf11e5260c54a79904c6df5893d47a6.png" alt=" "></p>
<p>The role of the Web Worker is to create a multi-threaded environment for JavaScript, allowing the main thread to create Worker threads and assign some tasks to the latter to run. While the main thread is running, the worker thread is running in the background without interfering with each other. When the worker thread finishes the computation, it returns the result to the main thread. The advantage of this is that some computationally intensive or high-latency tasks are taken care of by the worker thread, and the main thread (which is usually responsible for UI interactions) is smooth and does not get blocked or slowed down.</p>
<p>Once a worker thread is created successfully, it will always run without being interrupted by activities on the main thread (e.g., user clicks on buttons, form submissions). This makes it easier to respond to communication from the main thread at all times. However, it also means that the worker is resource-intensive and should not be overused, and should be closed once it has been used.</p>
<p>The Web Worker has the following points of caution for use.</p>
<h3 id="11-homologous-restrictions">1.1. Homologous restrictions</h3>
<p>The script file assigned to the worker thread to run must be the same source as the main thread&rsquo;s script file.</p>
<h3 id="12-dom-limitations">1.2. DOM Limitations</h3>
<p>The global object where the worker thread is located, unlike the main thread, cannot read the DOM object of the web page where the main thread is located, nor can it use the document, window, and parent objects. However, the Worker thread can navigator object and location object.</p>
<h3 id="13-communication-contact">1.3. Communication Contact</h3>
<p>Worker threads and main threads are not in the same context, they cannot communicate directly and must do so via messages.</p>
<h3 id="14-script-restrictions">1.4. Script Restrictions</h3>
<p>The worker thread cannot execute the alert() method and confirm() method, but can issue AJAX requests using the XMLHttpRequest object</p>
<h3 id="15-file-restrictions">1.5. File Restrictions</h3>
<p>The worker thread cannot read local files, i.e. it cannot open the local file system (file://), and the scripts it loads must come from the network.</p>
<h2 id="2-basic-usage">2. Basic usage</h2>
<h3 id="21-main-threads">2.1. Main threads</h3>
<p>The thread uses the new command to call the Worker() constructor to create a new Worker thread.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s1">&#39;work.js&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>The argument to the <code>Worker()</code> constructor is a script file that is the task to be executed by the Worker thread. Since the Worker cannot read local files, this script must come from the network. If the download does not succeed (e.g., a 404 error), the worker fails silently.</p>
<p>Then, the main thread calls the <code>worker.postMessage()</code> method to send a message to the Worker.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
<span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span><span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="nx">args</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Work&#39;</span><span class="p">]});</span>
</code></pre></td></tr></table>
</div>
</div><p>The argument to the <code>worker.postMessage()</code> method is the data that the main thread passes to the <code>Worker</code>. It can be of various data types, including binary data.</p>
<p>Then, the main thread specifies the listener function via <code>worker.onmessage</code> to receive the message sent back by the child thread.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">worker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Received message &#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">doSomething</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Execution of tasks
</span><span class="c1"></span>  <span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Work done!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, the <code>data</code> property of the event object gets the data sent by the <code>Worker</code>.</p>
<p>Once the <code>Worker</code> finishes its task, the main thread can shut it down.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">worker</span><span class="p">.</span><span class="nx">terminate</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-worker-threads">2.2. Worker threads</h3>
<p>The worker thread needs to have a listener function inside it that listens for <code>message</code> events.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">self</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;You said: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, self represents the subthread itself, i.e. the global object of the subthread. Therefore, it is equivalent to the following two ways of writing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// Writing Method I
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;You said: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// Writing method 2
</span><span class="c1"></span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;You said: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>In addition to using <code>self.addEventListener()</code> to specify the listener function, you can also use <code>self.onmessage</code> to specify it. The argument to the listener function is an event object whose <code>data</code> property contains the data sent by the main thread. The <code>self.postMessage()</code> method is used to send a message to the main thread.</p>
<p>Depending on the data sent by the main thread, the <code>Worker</code> thread can call different methods, here is an example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;start&#39;</span><span class="o">:</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;WORKER STARTED: &#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;stop&#39;</span><span class="o">:</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;WORKER STOPPED: &#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="c1">// Terminates the worker.
</span><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Unknown command: &#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, <code>self.close()</code> is used to close itself inside <code>Worker</code>.</p>
<h3 id="23-worker-load-script">2.3. Worker load script</h3>
<p>There is a special method <code>importScripts()</code> inside the Worker if you want to load other scripts.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">importScripts</span><span class="p">(</span><span class="s1">&#39;script1.js&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>This method can load multiple scripts at the same time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">importScripts</span><span class="p">(</span><span class="s1">&#39;script1.js&#39;</span><span class="p">,</span> <span class="s1">&#39;script2.js&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="24-error-handling">2.4. Error Handling</h3>
<p>The main thread can listen to <code>Worker</code> to see if an error occurs. If an error occurs, <code>Worker</code> will trigger the <code>error</code> event of the main thread.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">worker</span><span class="p">.</span><span class="nx">onerror</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span>
    <span class="s1">&#39;ERROR: Line &#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">lineno</span><span class="p">,</span> <span class="s1">&#39; in &#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span>
  <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
<span class="p">});</span>

<span class="c1">// or
</span><span class="c1"></span><span class="nx">worker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Worker</code> can also listen for <code>error</code> events internally.</p>
<h3 id="25-close-worker">2.5. Close Worker</h3>
<p>When you have finished using it, you must close Worker in order to save system resources.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// Main threads
</span><span class="c1"></span><span class="nx">worker</span><span class="p">.</span><span class="nx">terminate</span><span class="p">();</span>

<span class="c1">// Worker threads
</span><span class="c1"></span><span class="nx">self</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3-data-communication">3. Data Communication</h2>
<p>As mentioned earlier, the content of communication between the main thread and the <code>Worker</code> can be either text or objects. It should be noted that this communication is a copy relationship, i.e., it passes values instead of addresses, and any changes made by <code>Worker</code> to the communication content will not affect the main thread. In fact, the internal mechanism of the browser is to serialize the communication content, and then send the serialized string to <code>Worker</code>, who then restores it.</p>
<p>Binary data, such as File, Blob, ArrayBuffer, and other types, can also be exchanged between the main thread and the worker, and can also be sent between threads. Here is an example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// Main threads
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">uInt8Array</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">uInt8Array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">uInt8Array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// [0, 2, 4, 6, 8,...]
</span><span class="c1"></span><span class="p">}</span>
<span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">uInt8Array</span><span class="p">);</span>

<span class="c1">// Worker threads
</span><span class="c1"></span><span class="nx">self</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">uInt8Array</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Inside worker.js: uInt8Array.toString() = &#39;</span> <span class="o">+</span> <span class="nx">uInt8Array</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Inside worker.js: uInt8Array.byteLength = &#39;</span> <span class="o">+</span> <span class="nx">uInt8Array</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>However, the copy method of sending binary data can cause performance problems. For example, if the main thread sends a 500MB file to the worker, by default the browser will generate a copy of the original file. To solve this problem, JavaScript allows the main thread to transfer the binary data directly to the child thread, but once transferred, the main thread can no longer use the binary data, to prevent the problem of multiple threads modifying the data at the same time. This method of transferring data is called <a href="https://www.w3.org/html/wg/drafts/html/master/infrastructure.html#transferable-objects">Transferable Objects</a>. This allows the main thread to quickly hand over the data to the worker, which is very convenient for image processing, sound processing, 3D operations, etc., and does not create a performance burden.</p>
<p>If you want to transfer control of the data directly, you have to use the following write method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// Transferable Objects
</span><span class="c1"></span><span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">arrayBuffer</span><span class="p">,</span> <span class="p">[</span><span class="nx">arrayBuffer</span><span class="p">]);</span>

<span class="c1">// Demo
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">ab</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">ab</span><span class="p">,</span> <span class="p">[</span><span class="nx">ab</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4-web-worker-for-the-same-page">4. Web Worker for the same page</h2>
<p>Typically, the worker loads a single JavaScript script file, but it can also load code that is on the same page as the main thread.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;worker&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;app/worker&#34;</span><span class="p">&gt;</span>
      <span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;some message&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>The above is a script embedded in a web page. Note that you must specify that the type attribute of the <code>&lt;script&gt;</code> tag is a value that the browser does not recognize, in the above case <code>app/worker</code>.</p>
<p>Then, this embedded script is read and processed with <code>Worker</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js">
<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#worker&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="p">]);</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

<span class="nx">worker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// e.data === &#39;some message&#39;
</span><span class="c1"></span><span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, the script code embedded in the web page is first converted into a binary object, then a URL is generated for the binary object, and then the Worker loads the URL, so that both the main thread and the Worker&rsquo;s code are on the same web page.</p>
<h2 id="5-example-worker-thread-completes-polling">5. Example: Worker thread completes polling</h2>
<p>Sometimes, browsers need to poll the server state to be the first to know about state changes. This can be done in the Worker.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">createWorker</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">f</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span><span class="s1">&#39;)()&#39;</span><span class="p">]);</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">worker</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">pollingWorker</span> <span class="o">=</span> <span class="nx">createWorker</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">cache</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">compare</span><span class="p">(</span><span class="k">new</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/my-api-endpoint&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">compare</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">cache</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">cache</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">pollingWorker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// render data
</span><span class="c1"></span><span class="p">}</span>

<span class="nx">pollingWorker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, the worker polls the data once every second and compares it with the cache. If it doesn&rsquo;t match, there is a new change on the server side, so the main thread is notified.</p>
<h2 id="6-example-worker-new-worker">6. Example: Worker New Worker</h2>
<p>New worker threads can be created inside worker threads (currently only supported by Firefox browser). The following example takes a computationally intensive task and assigns it to 10 workers</p>
<p>The main thread code is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s1">&#39;worker.js&#39;</span><span class="p">);</span>
<span class="nx">worker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>The code of the worker thread is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// worker.js
</span><span class="c1"></span>
<span class="c1">// settings
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">num_workers</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">items_per_worker</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>

<span class="c1">// start the workers
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">pending_workers</span> <span class="o">=</span> <span class="nx">num_workers</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">num_workers</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s1">&#39;core.js&#39;</span><span class="p">);</span>
  <span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">items_per_worker</span><span class="p">);</span>
  <span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">((</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">items_per_worker</span><span class="p">);</span>
  <span class="nx">worker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">storeResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// handle the results
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">storeResult</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">result</span> <span class="o">+=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="nx">pending_workers</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">pending_workers</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// finished!
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, 10 new Worker threads are created inside the Worker thread and messages are sent to each of the 10 Workers in turn, informing them of the start and end points of the computation. The code of the computation task script is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// core.js
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">start</span><span class="p">;</span>
<span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">getStart</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">getStart</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">start</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">getEnd</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">end</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">getEnd</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">end</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="nx">onmessage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">work</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">work</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// perform some complex calculation here
</span><span class="c1"></span>    <span class="nx">result</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">postMessage</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="nx">close</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7-api">7. API</h2>
<h3 id="71-main-threads">7.1. Main threads</h3>
<p>The <code>Worker()</code> constructor is natively provided by the browser for the main thread to generate the worker thread.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="nx">jsUrl</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>Worker()</code> constructor, can accept two parameters. The first parameter is the URL of the script (which must comply with the same-origin policy), which is required and can only load JS scripts, otherwise it will report an error. The second parameter is a configuration object, which is optional. One of its roles is to specify the name of the worker, which is used to distinguish between multiple worker threads.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// Main threads
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s1">&#39;worker.js&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;myWorker&#39;</span> <span class="p">});</span>

<span class="c1">// Worker threads
</span><span class="c1"></span><span class="nx">self</span><span class="p">.</span><span class="nx">name</span> <span class="c1">// myWorker
</span></code></pre></td></tr></table>
</div>
</div><p>The Worker() constructor returns a Worker thread object for the main thread to manipulate the Worker.The properties and methods of the Worker thread object are as follows.</p>
<ul>
<li><code>Worker.onerror</code>: Specifies the listener function for the error event.</li>
<li><code>Worker.onmessage</code>: specifies the listener function for the message event, the data sent is in the Event.data property.</li>
<li><code>Worker.onmessageerror</code>: specifies the listener function for the messageerror event. This event will be triggered when the sent data cannot be serialized to a string.</li>
<li><code>Worker.postMessage()</code>: sends a message to the worker thread.</li>
<li><code>Worker.terminate()</code>: terminate the worker thread immediately.</li>
</ul>
<h3 id="72-worker-threads">7.2. Worker threads</h3>
<p>The <code>Web Worker</code> has its own global object, not the main thread&rsquo;s <code>window</code>, but a global object customized for the <code>Worker</code>. So not all the objects and methods defined on <code>window</code> are available.</p>
<p>The <code>Worker</code> thread has some global properties and methods of its own.</p>
<ul>
<li><code>self.name</code>: the name of the worker. This property is read-only and is specified by the constructor.</li>
<li><code>self.onmessage</code>: the listener for the message event.</li>
<li><code>self.onmessageerror</code>: specifies the listener function for the messageerror event. This event will be triggered when the sent data cannot be serialized to a string.</li>
<li><code>self.close()</code>: Close the worker thread.</li>
<li><code>self.postMessage()</code>: send a message to the worker thread that spawned it.</li>
<li><code>self.importScripts()</code>: Load JS scripts.</li>
</ul>
<hr>
<p>Reference <code>https://www.ruanyifeng.com/blog/2018/07/web-worker.html</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/web-worker/">web-worker</a>
          <a href="/tags/javascript/">javascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/android-surfaceview-source-code-analysis-and-use/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Android Surfaceview Source Code Analysis and Use</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/build-an-etcd-cluster-with-etcdadm/">
            <span class="next-text nav-default">Build an Etcd Cluster With Etcdadm</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
