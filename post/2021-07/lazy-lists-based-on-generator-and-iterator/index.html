<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Lazy Lists Based on Generator and Iterator - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="If you know Haskell, you are familiar with the following expressions
1 2 3  repeat 1 -- =&amp;gt; [1, 1, 1, 1, 1,...]  cycle &amp;#34;abc&amp;#34; -- =&amp;gt; &amp;#34;abcabcabc...&amp;#34;  [1, 3..] -- =&amp;gt; [1, 3, 5, 7, ...]   Several of the above expressions produce infinite lists. For those of you who are used to mainstream programming voices may be confused as to how the concept of infinity can be expressed inside a finite amount of memory." /><meta name="keywords" content="javascript,Lazy,ListsIterator,Generator" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/lazy-lists-based-on-generator-and-iterator/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Lazy Lists Based on Generator and Iterator" />
<meta property="og:description" content="If you know Haskell, you are familiar with the following expressions
1 2 3  repeat 1 -- =&gt; [1, 1, 1, 1, 1,...]  cycle &#34;abc&#34; -- =&gt; &#34;abcabcabc...&#34;  [1, 3..] -- =&gt; [1, 3, 5, 7, ...]   Several of the above expressions produce infinite lists. For those of you who are used to mainstream programming voices may be confused as to how the concept of infinity can be expressed inside a finite amount of memory." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/lazy-lists-based-on-generator-and-iterator/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-04T09:46:50+08:00" />
<meta property="article:modified_time" content="2021-07-04T09:46:50+08:00" />

<meta itemprop="name" content="Lazy Lists Based on Generator and Iterator">
<meta itemprop="description" content="If you know Haskell, you are familiar with the following expressions
1 2 3  repeat 1 -- =&gt; [1, 1, 1, 1, 1,...]  cycle &#34;abc&#34; -- =&gt; &#34;abcabcabc...&#34;  [1, 3..] -- =&gt; [1, 3, 5, 7, ...]   Several of the above expressions produce infinite lists. For those of you who are used to mainstream programming voices may be confused as to how the concept of infinity can be expressed inside a finite amount of memory."><meta itemprop="datePublished" content="2021-07-04T09:46:50+08:00" />
<meta itemprop="dateModified" content="2021-07-04T09:46:50+08:00" />
<meta itemprop="wordCount" content="2034">
<meta itemprop="keywords" content="javascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Lazy Lists Based on Generator and Iterator"/>
<meta name="twitter:description" content="If you know Haskell, you are familiar with the following expressions
1 2 3  repeat 1 -- =&gt; [1, 1, 1, 1, 1,...]  cycle &#34;abc&#34; -- =&gt; &#34;abcabcabc...&#34;  [1, 3..] -- =&gt; [1, 3, 5, 7, ...]   Several of the above expressions produce infinite lists. For those of you who are used to mainstream programming voices may be confused as to how the concept of infinity can be expressed inside a finite amount of memory."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Lazy Lists Based on Generator and Iterator</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-04 09:46:50 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 2034 words </span>
          <span class="more-meta"> 10 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#so-why-lazy">So, Why Lazy?</a></li>
        <li><a href="#implementing-lazy-lists-in-javascript">Implementing Lazy Lists in JavaScript</a>
          <ul>
            <li><a href="#getting-started-with-iterable">Getting Started with Iterable</a></li>
            <li><a href="#define-infinite-list">Define Infinite List</a></li>
            <li><a href="#define-operator">Define Operator</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>If you know Haskell, you are familiar with the following expressions</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="nf">repeat</span> <span class="mi">1</span> <span class="c1">-- =&gt; [1, 1, 1, 1, 1,...]  </span>
<span class="nf">cycle</span> <span class="s">&#34;abc&#34;</span> <span class="c1">-- =&gt; &#34;abcabcabc...&#34;  </span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">..</span><span class="p">]</span> <span class="c1">-- =&gt; [1, 3, 5, 7, ...]</span>
</code></pre></td></tr></table>
</div>
</div><p>Several of the above expressions produce infinite lists. For those of you who are used to mainstream programming voices may be confused as to how the concept of infinity can be expressed inside a finite amount of memory. The main reason is that Haskell is a language that uses an inert evaluation strategy by default, and the part that is not used is just an expression inside the memory and does not really do the computation.</p>
<p>If we just look at the above expressions, many of you may say that it doesn&rsquo;t feel like there&rsquo;s anything magical about it, and it doesn&rsquo;t seem to do anything. Let&rsquo;s look at the following code again.</p>
<p>The <code>fibonacci</code> series in Haskell.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="nf">fibonacci</span> <span class="ow">=</span> <span class="mi">1</span> <span class="kt">:</span> <span class="mi">1</span> <span class="kt">:</span> <span class="n">zipWith</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="n">fibonacci</span> <span class="p">(</span><span class="n">tail</span> <span class="n">fibonacci</span><span class="p">)</span>  
</code></pre></td></tr></table>
</div>
</div><p>Here <code>fibonacci</code> itself is an inert structure, so in the calculation, it will first count the two <code>1</code>s in front of the list, to get <code>1 : 1...</code>, and then how to express the <code>fib(n) = fib(n - 1) + fib(n - 2)</code> property of <code>fibonacci</code>? We can notice that <code>n - 1</code> and <code>n - 2</code> are exactly one place apart in the series, so <code>n</code> can be seen as the result of the sum of the wrong places in the series.</p>
<p>Let&rsquo;s look at a <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">sieve method</a> for finding prime numbers. If you are not familiar with the sieve method, you can click <code>wiki</code> to see how the algorithm works. The following code is a simple implementation of <code>Haskell</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="nf">primes</span> <span class="ow">=</span> <span class="mi">2</span> <span class="kt">:</span> <span class="n">filter</span> <span class="n">isPrime</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="o">..</span><span class="p">]</span>  
  <span class="kr">where</span>
    <span class="n">isPrime</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">all</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">takeWhile</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="n">primes</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="so-why-lazy">So, Why Lazy?</h2>
<p>Inert lists make the code and structure more flexible for certain list operations of indefinite length. To use the <code>primes</code> list as an example, in a traditional C or Java implementation, we would have to declare a maximum length or a maximum range of values, such as prime numbers up to 10000. If the later calculation is to use more than this range, we will have to re-call the generation function to regenerate a longer list. The problem here is: first, to actively call this factory function, and second, to manually maintain a cache list if we want to reuse the already computed data, which inevitably increases the complexity of the code. Another possible scenario is that we pre-generate a very long list and only use a drop of data from the head of the list in the later calculations, which is also a great waste.</p>
<p>The use of inert lists increases the expressiveness of our programming, allowing us to focus more on the properties of the data structure itself, rather than wasting time on how to manage the stack. Because the inert value feature ensures that we only compute a value when we need it, we can automatically minimize our computation and save resources.</p>
<p>For example, we can read and write files with lazy byteString, which itself does not load the whole file into our memory, but reads it on demand. Sometimes we can read a large file and filter out only the first few dozens of data we need, but we have to put hundreds of M or even G files into memory.</p>
<p>Here is also an article from more than 10 years ago <a href="http://filimanjaro.com/blog/2014/introducing-lazy-evaluation/">How to Speed Up Lo-Dash ×100? Introducing Lazy Evaluation</a>, if you are interested, you can click on it.</p>
<h2 id="implementing-lazy-lists-in-javascript">Implementing Lazy Lists in JavaScript</h2>
<p>Is there an inert structure in JavaScript? Let&rsquo;s look at the following example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">fetchSomething</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/some/thing&#39;</span><span class="p">);</span>  
<span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nx">fetchSomething</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/some/thing/condition&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">fetchSomething</span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>  
  <span class="c1">// TODO
</span><span class="c1"></span><span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>fetch</code> method itself is executed immediately, but if the condition is met, the <code>fetch</code> method here will be executed twice. This is not the behavior we expect, and the usual way to make this <code>fetch</code> action execute when we need it, instead of starting it when it is declared, is to change it to look like the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">fetchSomething</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/some/thing&#39;</span><span class="p">);</span>  
<span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>  
  <span class="nx">fetchSomething</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/some/thing/condition&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">fetchSomething</span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>  
  <span class="c1">// TODO
</span><span class="c1"></span><span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>Inspired by this, we can roughly implement the following structure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">List</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="nx">head</span><span class="o">:</span> <span class="nx">T</span> <span class="o">|</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">T</span>
  <span class="nx">tail</span><span class="o">:</span> <span class="nx">List</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">List</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">head</span><span class="o">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">tail</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">List</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">head</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">head</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tail</span> <span class="o">=</span> <span class="nx">tail</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>List&lt;T&gt;</code> is essentially a single-linked table, and the <code>tail</code> passed into the constructor is a factory function that builds new <code>List</code> nodes. Only when we access a node, we evaluate its <code>head</code>, and when we access its next node, we evaluate <code>tail</code>, otherwise both <code>head</code> and <code>tail</code> are just expressions to be evaluated.</p>
<p>This seems to have solved my problem, but this structure has a lot of unnecessary extra overhead when converting to and from normal <code>Array</code>.</p>
<p>So is there a more natural structure in <code>JavaScript</code> that would save us from having to construct such a complex object, simplifying the code while making it more generalizable?</p>
<h3 id="getting-started-with-iterable">Getting Started with Iterable</h3>
<p>A new feature of ES6 gave me the answer I was looking for, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols">Iteration Protocols</a>. If the MDN description is too long, you can just look at the equivalent type declaration below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">interface</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span><span class="o">:</span> <span class="nx">Iterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Iterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="nx">next</span><span class="p">()</span><span class="o">:</span> <span class="nx">IteratorResult</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">IteratorResult</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="nx">done</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">;</span>
  <span class="nx">value</span><span class="o">?:</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span><span class="o">:</span> <span class="nx">Iterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">next</span><span class="p">()</span><span class="o">:</span> <span class="nx">IteratorResult</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>All objects that implement an Iterable interface can be used by means of an object such as <code>for... ...of...</code>, <code>... .itor</code> and <code>Array.from</code>. The iteration ends when <code>done</code> is <code>true</code> in the return value of the <code>next</code> method. And only when we access the <code>next</code> method will we move to the next iteration, the ideal <code>Lazy</code> structure.</p>
<p>At this point we look at how our <code>fibonacci</code> should be written.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Fibonacci</span> <span class="kr">implements</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="kr">private</span> <span class="nx">prev</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kr">private</span> <span class="nx">next</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kr">public</span> <span class="nx">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">prev</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">current</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">current</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">fib</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fibonacci</span><span class="p">();</span>  
<span class="nx">fib</span><span class="p">.</span><span class="nx">next</span><span class="p">()</span> <span class="c1">// =&gt; { done: false, value: 1 }  
</span><span class="c1"></span><span class="nx">fib</span><span class="p">.</span><span class="nx">next</span><span class="p">()</span> <span class="c1">// =&gt; { done: false, value: 1 }  
</span><span class="c1"></span><span class="nx">fib</span><span class="p">.</span><span class="nx">next</span><span class="p">()</span> <span class="c1">// =&gt; { done: false, value: 2 }  
</span><span class="c1">// etc
</span></code></pre></td></tr></table>
</div>
</div><p>At this point, we can already express an inert infinite series. But the above code is too cumbersome, so it&rsquo;s a good thing that <code>ES6</code> also provides us with <code>Generator</code>, which makes it easy to write <code>IterableItorator</code>, and in a sense, <code>Generator</code> is syntactic sugar for the above code.</p>
<p>Using <code>Generator</code>, the above code can be simplified to look like the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">fibonacci</span><span class="p">()</span> <span class="p">{</span>  
  <span class="kd">let</span> <span class="nx">prev</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">next</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">prev</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">prev</span><span class="p">;</span>
    <span class="nx">prev</span> <span class="o">=</span> <span class="nx">next</span><span class="p">;</span>
    <span class="nx">next</span> <span class="o">=</span> <span class="nx">temp</span> <span class="o">+</span> <span class="nx">prev</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">fib</span> <span class="o">=</span> <span class="nx">fibonacci</span><span class="p">();</span>  
<span class="c1">// etc
</span></code></pre></td></tr></table>
</div>
</div><p>If you don&rsquo;t know the syntax of Generator, you can read this article <a href="https://medium.com/dailyjs/a-simple-guide-to-understanding-javascript-es6-generators-d1c350551950">A Simple Guide to Understanding Javascript (ES6) Generators</a> first.</p>
<h3 id="define-infinite-list">Define Infinite List</h3>
<p>Moving on from the above code, the following code implements the <code>repeat</code>, <code>cycle</code>, <code>iterate</code>, <code>range</code> and other methods from the beginning of the article.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">repeat</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">item</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">item</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">cycle</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">items</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span><span class="o">*</span> <span class="p">[...</span><span class="nx">items</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">iterate</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">initial</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>  
  <span class="kd">let</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">initial</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">val</span><span class="p">;</span>
    <span class="nx">val</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">range</span><span class="p">(</span><span class="nx">start</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">end</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">,</span> <span class="nx">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">while</span> <span class="p">(</span><span class="nx">start</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">start</span><span class="p">;</span>
    <span class="nx">start</span> <span class="o">+=</span> <span class="nx">step</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, the code is very intuitive and easy to understand.</p>
<h3 id="define-operator">Define Operator</h3>
<p>Once we have the list, we need to operate on top of it. The following code implements the <code>map/filter/take/takeWhile</code> methods respectively.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">map</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">U</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">U</span><span class="p">,</span> <span class="nx">items</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">filter</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>  
  <span class="nx">predicate</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="kr">boolean</span><span class="p">,</span>
  <span class="nx">items</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">predicate</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">yield</span> <span class="nx">item</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">take</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">items</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>  
  <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">item</span><span class="p">;</span>
    <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">takeWhile</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>  
  <span class="nx">predicate</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="kr">boolean</span><span class="p">,</span>
  <span class="nx">items</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">predicate</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">yield</span> <span class="nx">item</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above code is relatively simple. The more difficult part is to implement the <code>zip</code> method, that is, how to merge two lists into one?</p>
<p>The difficulty is that if you receive an <code>Iterable</code> object, you don&rsquo;t necessarily need to implement the next method, such as <code>Array</code>, <code>String</code>, etc. Also, not all <code>Iterable</code> objects can be accessed by <code>index</code>. In addition, if we want to turn <code>Array.from</code> into an array first and then operate on the array, we will encounter a situation where the <code>Iterable</code> object we pass in is infinite, like <code>fibonacci</code> above, in which case we can&rsquo;t use <code>Array.from</code>.</p>
<p>One of my ideas is to elevate an <code>Iterable</code> object to an <code>IterableItorator</code> object, and then iterate through it one by one using the next method.</p>
<p><code>How</code>? Fortunately, <code>Generator</code> gives us a <code>yield*</code> operator that allows us to easily define a <code>lift</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">lift</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">items</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>  
  <span class="k">yield</span><span class="o">*</span> <span class="nx">items</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>With this <code>lift</code> method, it is easy to write <code>zip</code> methods and <code>zipWith</code> methods.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">zip</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">G</span><span class="o">&gt;</span><span class="p">(</span>  
  <span class="nx">seqA</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">seqB</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">G</span><span class="o">&gt;</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="p">[</span><span class="nx">T</span><span class="p">,</span> <span class="nx">G</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">itorA</span> <span class="o">=</span> <span class="nx">lift</span><span class="p">(</span><span class="nx">seqA</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">itorB</span> <span class="o">=</span> <span class="nx">lift</span><span class="p">(</span><span class="nx">seqB</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">valA</span> <span class="o">=</span> <span class="nx">itorA</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">valB</span> <span class="o">=</span> <span class="nx">itorB</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">valA</span><span class="p">.</span><span class="nx">done</span> <span class="o">||</span> <span class="o">!</span><span class="nx">valB</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="p">[</span><span class="nx">valA</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">valB</span><span class="p">.</span><span class="nx">value</span><span class="p">];</span>
    <span class="nx">valA</span> <span class="o">=</span> <span class="nx">itorA</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
    <span class="nx">valB</span> <span class="o">=</span> <span class="nx">itorB</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span><span class="o">*</span> <span class="nx">zipWith</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">G</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>  
  <span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="o">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">G</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">R</span><span class="p">,</span>
  <span class="nx">seqA</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">seqB</span><span class="o">:</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">G</span><span class="o">&gt;</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">R</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">itorA</span> <span class="o">=</span> <span class="nx">lift</span><span class="p">(</span><span class="nx">seqA</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">itorB</span> <span class="o">=</span> <span class="nx">lift</span><span class="p">(</span><span class="nx">seqB</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">valA</span> <span class="o">=</span> <span class="nx">itorA</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">valB</span> <span class="o">=</span> <span class="nx">itorB</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">valA</span><span class="p">.</span><span class="nx">done</span> <span class="o">||</span> <span class="o">!</span><span class="nx">valB</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">valA</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">valB</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">valA</span> <span class="o">=</span> <span class="nx">itorA</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
    <span class="nx">valB</span> <span class="o">=</span> <span class="nx">itorB</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>More methods can be found at the bottom of my <code>repo</code>, so I won&rsquo;t list them all here.</p>
<h2 id="summary">Summary</h2>
<p><code>Generator</code> and <code>Iterator</code> are very powerful language-level capabilities that <code>ES6</code> brings to the table, and its own evaluation can be seen as inert.</p>
<p>When <code>co</code> from <code>TJ</code> first came out around 13 years ago, the code was amazingly short and concise. However, in our use, one is limited by browser compatibility, and the other is limited by our use scenario, I think we have not developed its features far enough. Combining <code>IO</code>, <code>network</code>, <code>Generator</code> and <code>Iterator</code> can do a lot more for us.</p>
<p>On the contrary, the abuse of inert structures will cache a lot of thunk during the execution of the program and increase the overhead in memory.</p>
<ul>
<li>GitHub <a href="https://github.com/nodew/lazyList">lazyList</a>。</li>
<li>Slide <a href="https://speakerdeck.com/nodew/lazy-list-with-generator-and-iterator">Lazy List With Generator and Iterator</a></li>
</ul>
<hr>
<p>Reference <code>https://tech.youzan.com/lazy-list-with-generator-and-iterator/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascript/">javascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/golang-context-source-code-analysis/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang Context Source Code Analysis</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/react-getderiveddtatefromprop/">
            <span class="next-text nav-default">React-getDerivedStateFromProp</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
