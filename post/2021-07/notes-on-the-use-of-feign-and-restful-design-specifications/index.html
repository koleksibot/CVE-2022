<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Notes on the Use of Feign and Restful Design Specifications - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="I recently used Spring Cloud Feign as an HTTP client in a lot of projects, and encountered a lot of pitfalls, and also generated some ideas about RESTFUL design, which I&amp;rsquo;d like to document here.
SpringMVC&amp;rsquo;s request parameter binding mechanism Users who know the history of Feign will know that Feign itself is a Netflix product, Spring Cloud Feign is based on the native Feign encapsulation, the introduction of a large number of SpringMVC annotation support, making it easier to use by the majority of Spring users, but also produced a not small confusing effect." /><meta name="keywords" content="spring-cloud-feign,restful,spring-cloud" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/notes-on-the-use-of-feign-and-restful-design-specifications/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Notes on the Use of Feign and Restful Design Specifications" />
<meta property="og:description" content="I recently used Spring Cloud Feign as an HTTP client in a lot of projects, and encountered a lot of pitfalls, and also generated some ideas about RESTFUL design, which I&rsquo;d like to document here.
SpringMVC&rsquo;s request parameter binding mechanism Users who know the history of Feign will know that Feign itself is a Netflix product, Spring Cloud Feign is based on the native Feign encapsulation, the introduction of a large number of SpringMVC annotation support, making it easier to use by the majority of Spring users, but also produced a not small confusing effect." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/notes-on-the-use-of-feign-and-restful-design-specifications/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-01T16:55:40+08:00" />
<meta property="article:modified_time" content="2021-07-01T16:55:40+08:00" />

<meta itemprop="name" content="Notes on the Use of Feign and Restful Design Specifications">
<meta itemprop="description" content="I recently used Spring Cloud Feign as an HTTP client in a lot of projects, and encountered a lot of pitfalls, and also generated some ideas about RESTFUL design, which I&rsquo;d like to document here.
SpringMVC&rsquo;s request parameter binding mechanism Users who know the history of Feign will know that Feign itself is a Netflix product, Spring Cloud Feign is based on the native Feign encapsulation, the introduction of a large number of SpringMVC annotation support, making it easier to use by the majority of Spring users, but also produced a not small confusing effect."><meta itemprop="datePublished" content="2021-07-01T16:55:40+08:00" />
<meta itemprop="dateModified" content="2021-07-01T16:55:40+08:00" />
<meta itemprop="wordCount" content="1851">
<meta itemprop="keywords" content="spring-cloud,spring-cloud-feign," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Notes on the Use of Feign and Restful Design Specifications"/>
<meta name="twitter:description" content="I recently used Spring Cloud Feign as an HTTP client in a lot of projects, and encountered a lot of pitfalls, and also generated some ideas about RESTFUL design, which I&rsquo;d like to document here.
SpringMVC&rsquo;s request parameter binding mechanism Users who know the history of Feign will know that Feign itself is a Netflix product, Spring Cloud Feign is based on the native Feign encapsulation, the introduction of a large number of SpringMVC annotation support, making it easier to use by the majority of Spring users, but also produced a not small confusing effect."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Notes on the Use of Feign and Restful Design Specifications</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-01 16:55:40 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/microservices/"> microservices </a>
            </div>
          <span class="more-meta"> 1851 words </span>
          <span class="more-meta"> 9 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#springmvcs-request-parameter-binding-mechanism">SpringMVC&rsquo;s request parameter binding mechanism</a></li>
        <li><a href="#feigns-request-parameter-binding-mechanism">Feign&rsquo;s request parameter binding mechanism</a></li>
        <li><a href="#feign-binding-composite-parameters">Feign Binding Composite Parameters</a></li>
        <li><a href="#using-pathvariable-with-the-restful-specification-in-feign">Using @PathVariable with the RESTFUL specification in Feign</a></li>
        <li><a href="#resuftl-structured-query">RESUFTL Structured Query</a></li>
        <li><a href="#restful-behavior-qualification">RESTFUL behavior qualification</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>I recently used <code>Spring Cloud Feign</code> as an HTTP client in a lot of projects, and encountered a lot of pitfalls, and also generated some ideas about <code>RESTFUL</code> design, which I&rsquo;d like to document here.</p>
<h2 id="springmvcs-request-parameter-binding-mechanism">SpringMVC&rsquo;s request parameter binding mechanism</h2>
<p>Users who know the history of Feign will know that Feign itself is a Netflix product, Spring Cloud Feign is based on the native Feign encapsulation, the introduction of a large number of SpringMVC annotation support, making it easier to use by the majority of Spring users, but also produced a not small confusing effect.</p>
<p>So before using Spring Cloud Feign, I would like to introduce a parameter binding mechanism of SpringMVC. A RestController is preconfigured to start an application on the local port 8080 to receive http requests.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BookController</span> <span class="o">{</span>

<span class="o">&lt;!--</span> <span class="n">more</span> <span class="o">--&gt;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/hello&#34;</span><span class="o">)</span> <span class="c1">// &lt;1&gt;
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// &lt;2&gt;
</span><span class="c1"></span>        <span class="k">return</span> <span class="s">&#34;hello&#34;</span> <span class="o">+</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This demo is very simple to write, but the actual springmvc does a lot of compatibility, so that this interface can accept multiple requests.</p>
<ol>
<li><code>RequestMapping</code> represents the mapped path to which the endpoint can be mapped using <code>GET,POST,PUT,DELETE</code> methods.</li>
<li>The common request parameter annotations in SpringMVC are <code>@RequestParam</code>, <code>@RequestBody</code>, <code>@PathVariable</code> and so on. <code>name</code> is treated as <code>@RequestParam</code> by default. The parameter <code>String name</code> on the method is obtained by the framework using bytecode techniques to get the name <code>name</code> and automatically detect parameters with <code>key</code> value of <code>name</code> in the request parameters, or you can use <code>@RequestParam(&quot;name&quot;)</code> to override the name of the variable itself. It is fetched when we carry the <code>name</code> parameter in the <code>url</code> or the <code>name</code> parameter in the <code>form</code> form.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">POST /hello HTTP/1.1
Host: localhost:8080
Content-Type: application/x-www-form-urlencoded

name=formParam
</code></pre></td></tr></table>
</div>
</div><p>or</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /hello?name=queryString HTTP/1.1
Host: localhost:8080
</code></pre></td></tr></table>
</div>
</div><h2 id="feigns-request-parameter-binding-mechanism">Feign&rsquo;s request parameter binding mechanism</h2>
<p>The above SpringMVC parameter binding mechanism should be very familiar to everyone, but it&rsquo;s all a little different in Feign.</p>
<p>Let&rsquo;s look at a very simple, but actually wrong way to write an interface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Note: Wrong way to write the interface
</span><span class="c1"></span><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;book&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookApi</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/hello&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Configure the request path.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">ribbon</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">eureka</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">book</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">ribbon</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">listOfServers</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8080</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>We wrote a FeignClient as we are used to writing SpringMVC&rsquo;s RestController, and as we thought at the beginning, since the request method is specified as GET, the <code>name</code> should be spliced into the Url as a <code>QueryString</code>, right? Send a GET request like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /hello?name=xxx HTTP/1.1
Host: localhost:8080
</code></pre></td></tr></table>
</div>
</div><p>Whereas, in fact, the RestController does not receive it, we get some hints on the RestController side of the application.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/01/a5cef165812f42589ca95d91531a60f8.png" alt=" "></p>
<ul>
<li>Instead of sending the request using the GET method as expected, the POST method</li>
<li>The <code>name</code> parameter is not handled correctly and a null value is obtained</li>
</ul>
<p>Looking at the documentation, we see that without the default annotation, <code>Feign</code> adds the <code>@RequestBody</code> annotation to the parameters by default, and the <code>RequestBody</code> must be included in the request body, while the <code>GET</code> method does not have a request body. So the above two phenomena are explained. <code>Feign</code> forces a <code>POST</code> request when the <code>GET</code> request contains a <code>RequestBody</code>, instead of reporting an error.</p>
<p>By understanding this mechanism, we can avoid many pitfalls in developing Feign interfaces. The solution to the above problem is also simple</p>
<ul>
<li>Add the <code>@RequestParam(&quot;name&quot;)</code> annotation to the name in the Feign interface. <code>name</code> must be specified and the request parameters of <code>Feign</code> will not be automatically given a default name using the SpringMVC bytecode mechanism.</li>
<li>Since Feign uses <code>@RequestBody</code> by default, it is possible to retrofit <code>RestController</code> to receive using <code>@RequestBody</code>. However, request parameters are usually multiple, and it is recommended to use <code>@RequestParam</code> as described above, while <code>@RequestBody</code> is generally only used for submission objects.</li>
</ul>
<h2 id="feign-binding-composite-parameters">Feign Binding Composite Parameters</h2>
<p>The above problem is actually due to the analogy with SpringMVC without clear understanding of Feign&rsquo;s internal mechanism. Similarly, when using objects as parameters, you need to pay attention to such issues.</p>
<p>For such an interface</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;book&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookApi</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/book&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Book</span> <span class="n">book</span><span class="o">);</span> <span class="c1">// &lt;1&gt;
</span><span class="c1"></span>  
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/book&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">id</span><span class="o">,</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">);</span> <span class="c1">// &lt;2&gt;
</span><span class="c1"></span>  
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/book&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">Map</span> <span class="n">map</span><span class="o">);</span> <span class="c1">// &lt;3&gt;
</span><span class="c1"></span>  
    <span class="c1">// Wrong way of writing
</span><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/book&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">Book</span> <span class="n">book</span><span class="o">);</span> <span class="c1">// &lt;4&gt;
</span><span class="c1"></span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>Submitting objects using <code>@RequestBody</code> is the most common way to do this.</li>
<li>If there are not many parameters, you can use more than one <code>@RequestParam</code></li>
<li>Using <code>Map</code>, which is perfectly fine, is not quite object-oriented and it is not immediately obvious from the code what kind of parameters the interface needs.</li>
<li>Wrong usage, <code>Feign</code> does not provide such a mechanism to automatically convert entities to Map.</li>
</ol>
<h2 id="using-pathvariable-with-the-restful-specification-in-feign">Using @PathVariable with the RESTFUL specification in Feign</h2>
<p>This involves a topic of how to design RESTFUL interfaces, we know that since RESTFUL was proposed in the early 2000s, there is no shortage of articles mentioning resources, contract specifications, CRUD corresponding to add, delete, change and check operations, and so on. The following is my opinion from two practical interfaces.</p>
<p>Find user interface based on id</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserApi</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/user/{userId}&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">findById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">userId</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This should be uncontroversial, and note that the id in the <code>@PathVariable(&quot;id&quot;)</code> brackets should not be forgotten, as emphasized earlier. What if it&rsquo;s &ldquo;find users by email&rdquo;? It is likely that the subconscious interface would be written like this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserApi</span> <span class="o">{</span>
  
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/user/{email}&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">findByEmail</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;email&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">email</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>First look at the Feign problem. email usually contains the &lsquo;. &lsquo;, a special character, can have unexpected results if included in the path. I&rsquo;m not going to explore how to fix it (you can actually use <code>{email:. +}</code>), because I don&rsquo;t think it&rsquo;s by design.</li>
<li>A few more questions about the specification. Are the two interfaces similar and should email be placed in the path? This brings us to the original intention of RESTFUL, why the userId attribute is generally considered suitable to appear in the RESTFUL path, because the id itself plays the role of resource location, he is the marker of the resource. Unlike email, which may be unique, it is more of an attribute of the resource, so I believe that non-locative dynamic parameters should not be present in the path. Instead, email should be used as the <code>@RequestParam</code> parameter.</li>
</ul>
<h2 id="resuftl-structured-query">RESUFTL Structured Query</h2>
<p>The author has successfully moved from the topic of Feign to the design of the RESTFUL interface, which has led to the length of this article, but I&rsquo;m not going to open another article about it.</p>
<p>Consider another interface design, query a month of a user&rsquo;s order, may also carry paging parameters, then the parameters become a lot, according to the traditional design, this should be a query operation, that is, corresponding to the GET request, that does not mean that these parameters should be stitched to the url after? Thinking about Feign, as mentioned in the second paragraph of this article, it does not support GET requests to carry entity classes, which puts us in a design dilemma. In fact, reference to some DSL language design such as elasticSearch, is also the use of POST JSON way to query, so in the actual project, I do not particularly favor CRUD and the four types of requests corresponding to the so-called RESTFUL specification, if we say that the design of RESTFUL should follow what If there is a specification that should be followed for designing RESTFUL, it is probably some other term, such as contract specification and domain-driven design. Structured Queries</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;order&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookApi</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/order/history&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">Page</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Orders</span><span class="o">&gt;&gt;</span> <span class="nf">queryOrderHistory</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">QueryVO</span> <span class="n">queryVO</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="restful-behavior-qualification">RESTFUL behavior qualification</h2>
<p>In the actual interface design, I encountered such a requirement, the user module interface needs to support the modification of user password, modify the user&rsquo;s email, modify the user&rsquo;s name, and I have previously read an article, is also about abandoning CRUD but with domain-driven design to regulate the definition of RESTFUL interface, and my project coincides with the idea. It seems that these three properties are three properties of the same entity class, which can be designed as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserApi</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/user&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">User</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>But in reality, if you consider one more layer, you should think about this: Do these three functions require the same permissions? Should they really be put into a single interface? In fact, I do not want the interface caller to pass an entity, because such behavior is not controllable, completely do not know what properties it actually modified, if you really want to limit the behavior, you also need to add an operation type field in the User, and then in the interface implementation side to check, which is too much trouble. In fact, I think the design of the specification should be as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FeignClient</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserApi</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/user/{userId}/password/update&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">ResultBean</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="nf">updatePassword</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;userId) String userId,@RequestParam(&#34;</span><span class="n">password</span><span class="s">&#34;) password);
</span><span class="s">    
</span><span class="s">    @RequestMapping(value = &#34;</span><span class="o">/</span><span class="n">user</span><span class="o">/{</span><span class="n">userId</span><span class="o">}/</span><span class="n">email</span><span class="o">/</span><span class="n">update</span><span class="s">&#34;,method = RequestMethod.POST)
</span><span class="s">    ResultBean&lt;Boolean&gt; updateEmail(@PathVariable(&#34;</span><span class="n">userId</span><span class="o">)</span> <span class="n">String</span> <span class="n">userId</span><span class="o">,</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;email&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">email</span><span class="o">);</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/user/{userId}/username/update&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">ResultBean</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="nf">updateUsername</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;userId) String userId,@RequestParam(&#34;</span><span class="n">username</span><span class="err">&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>In general, the RESTFUL interface should not have a verb, the update here is not an action, but marks the type of operation, because there may be many types of operations for a property, so I used to add an update suffix to clearly express the desired operation, rather than just rely on GET, POST, PUT, DELETE. In fact, the recommended request method for modifying an operation should be PUT, which is my understanding that update has been used to mark the behavior and PUT is not customary in actual development.</li>
<li>password, email, and username are all attributes of user, and userId is the identifier of user, so userId appears as PathVariable in the url, and the three attributes appear in ReqeustParam.</li>
</ul>
<p>A word about logical deletion, in passing.</p>
<p>If a requirement is to delete a user&rsquo;s common address, the operation type of this api, which I usually do not design as a DELETE request, also uses delete to mark the operation behavior.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/user/{userId}/address/{addressId}/delete&#34;</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">ResultBean</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="nf">updateEmail</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">userId</span><span class="o">,</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">email</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="summary">Summary</h2>
<p>This article talks about the design of RESTFUL interfaces from Feign&rsquo;s usage notes, which is actually a mutually complementary behavior. Interface design needs a carrier, so I talk about my understanding of RESTFUL design with Feign&rsquo;s interface style, and some of the pitfalls in Feign are also the starting point for me to standardize RESTFUL design.</p>
<hr>
<p>Reference <code>https://www.cnkirito.moe/feign-1/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring-cloud/">spring-cloud</a>
          <a href="/tags/spring-cloud-feign/">spring-cloud-feign</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/various-database-connection-strings-commonly-used-by-go/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Various Database Connection Strings Commonly Used by Go</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/spring-cloud-gateway-downgrading-with-hystrix-using-custom-filters/">
            <span class="next-text nav-default">Spring Cloud Gateway - Downgrading with Hystrix using Custom Filters</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
