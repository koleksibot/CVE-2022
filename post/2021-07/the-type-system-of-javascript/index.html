<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>The Type System of Javascript - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Overview The type judgment of JavaScript is a necessary part of the front-end engineers&#39; code every day, and every day they must write a if (a === &#39;xxx&#39;) or if (typeof a === &#39;object&#39;) similar type judgment statement, so mastering the type judgment of JavaScript is also a necessary skill for the front-end, the following will be from the type of JavaScript, type judgment and some internal implementation to give" /><meta name="keywords" content="javascript,type" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/the-type-system-of-javascript/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="The Type System of Javascript" />
<meta property="og:description" content="Overview The type judgment of JavaScript is a necessary part of the front-end engineers&#39; code every day, and every day they must write a if (a === &#39;xxx&#39;) or if (typeof a === &#39;object&#39;) similar type judgment statement, so mastering the type judgment of JavaScript is also a necessary skill for the front-end, the following will be from the type of JavaScript, type judgment and some internal implementation to give" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/the-type-system-of-javascript/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-15T10:20:15+08:00" />
<meta property="article:modified_time" content="2021-07-15T10:20:15+08:00" />

<meta itemprop="name" content="The Type System of Javascript">
<meta itemprop="description" content="Overview The type judgment of JavaScript is a necessary part of the front-end engineers&#39; code every day, and every day they must write a if (a === &#39;xxx&#39;) or if (typeof a === &#39;object&#39;) similar type judgment statement, so mastering the type judgment of JavaScript is also a necessary skill for the front-end, the following will be from the type of JavaScript, type judgment and some internal implementation to give"><meta itemprop="datePublished" content="2021-07-15T10:20:15+08:00" />
<meta itemprop="dateModified" content="2021-07-15T10:20:15+08:00" />
<meta itemprop="wordCount" content="2106">
<meta itemprop="keywords" content="javascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The Type System of Javascript"/>
<meta name="twitter:description" content="Overview The type judgment of JavaScript is a necessary part of the front-end engineers&#39; code every day, and every day they must write a if (a === &#39;xxx&#39;) or if (typeof a === &#39;object&#39;) similar type judgment statement, so mastering the type judgment of JavaScript is also a necessary skill for the front-end, the following will be from the type of JavaScript, type judgment and some internal implementation to give"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">The Type System of Javascript</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-15 10:20:15 </span>
        <div class="post-category">
            <a href="/categories/implementation-details/"> implementation-details </a>
            <a href="/categories/frontend/"> frontend </a>
            </div>
          <span class="more-meta"> 2106 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#type">Type</a></li>
        <li><a href="#type-judgment">Type judgment</a>
          <ul>
            <li><a href="#typeof">typeof</a></li>
            <li><a href="#tostring">toString</a></li>
            <li><a href="#instanceof">instanceof</a></li>
          </ul>
        </li>
        <li><a href="#type-conversion">Type conversion</a>
          <ul>
            <li><a href="#toprimitive">ToPrimitive</a></li>
            <li><a href="#toobject">ToObject</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/15/2e14dcd7ca364f30a3bc4428b0f37d43.png" alt=" "></p>
<h2 id="overview">Overview</h2>
<p>The type judgment of <code>JavaScript</code> is a necessary part of the front-end engineers' code every day, and every day they must write a <code>if (a === 'xxx')</code> or <code>if (typeof a === 'object')</code> similar type judgment statement, so mastering the type judgment of <code>JavaScript</code> is also a necessary skill for the front-end, the following will be from the type of <code>JavaScript</code>, type judgment and some internal implementation to give you an in-depth understanding of <code>JavaScript</code> type of those things.</p>
<h2 id="type">Type</h2>
<p>The types in <code>JavaScript</code> mainly include <code>primitive</code> and <code>object</code> types, where the <code>primitive</code> types include: <code>null</code>, <code>undefined</code>, <code>boolean</code>, <code>number</code>, <code>string</code> and <code>symbol(es6)</code>. All others are of type <code>object</code>.</p>
<h2 id="type-judgment">Type judgment</h2>
<p>Type detection mainly includes three ways to determine the type of a variable: <code>typeof</code>, <code>instanceof</code> and <code>toString</code>.</p>
<h3 id="typeof">typeof</h3>
<p><code>typeof</code> takes a value and returns its type, and it has two possible syntaxes.</p>
<ul>
<li><code>typeof x</code></li>
<li><code>typeof(x)</code></li>
</ul>
<p>When using <code>typeof</code> on the <code>primitive</code> type to detect the type of a variable, we always get the result we want, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="k">typeof</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// &#34;number&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="s2">&#34;&#34;</span><span class="p">;</span> <span class="c1">// &#34;string&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// &#34;boolean&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="nx">bla</span><span class="p">;</span> <span class="c1">// &#34;undefined&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// &#34;undefined&#34;  
</span></code></pre></td></tr></table>
</div>
</div><p>And when using <code>typeof</code> detection on <code>object</code> types, sometimes you may not get the result you want, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="k">typeof</span> <span class="p">[];</span> <span class="c1">// &#34;object&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// &#34;object&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="sr">/regex/</span> <span class="c1">// &#34;object&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span> <span class="c1">// &#34;object&#34;  
</span><span class="c1"></span><span class="k">typeof</span> <span class="kd">function</span><span class="p">(){};</span> <span class="c1">// &#34;function&#34;  
</span></code></pre></td></tr></table>
</div>
</div><p>Here <code>[]</code> returns <code>object</code>, which may not be what you want, because an array is a special object, and sometimes that may not be what you want.</p>
<p>For <code>null</code> here it does return <code>object</code>, wtf, some people say <code>null</code> is considered to be the absence of an object.</p>
<p>Use caution when you are unsure about <code>typeof</code> to detect data types.</p>
<h3 id="tostring">toString</h3>
<p>The problem with <code>typeof</code> is mainly that it doesn&rsquo;t tell you too much about the object, except for the function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="k">typeof</span> <span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="s1">&#39;val&#39;</span><span class="p">};</span> <span class="c1">// Object is object  
</span><span class="c1"></span><span class="k">typeof</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// Array is object  
</span><span class="c1"></span><span class="k">typeof</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span> <span class="c1">// Date object  
</span></code></pre></td></tr></table>
</div>
</div><p>And <code>toString</code> will give you the result you want, whether for <code>object</code> types or <code>primitive</code> types.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">toClass</span> <span class="o">=</span> <span class="p">{}.</span><span class="nx">toString</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">123</span><span class="p">));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Symbol</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;some string&#39;</span><span class="p">));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toClass</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span>  
    <span class="nx">a</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span>
<span class="p">}));</span>

<span class="c1">// output
</span><span class="c1"></span><span class="p">[</span><span class="nx">object</span> <span class="nb">Number</span><span class="p">]</span>
<span class="p">[</span><span class="nx">object</span> <span class="nb">Boolean</span><span class="p">]</span>
<span class="p">[</span><span class="nx">object</span> <span class="nx">Symbol</span><span class="p">]</span>
<span class="p">[</span><span class="nx">object</span> <span class="nb">String</span><span class="p">]</span>
<span class="p">[</span><span class="nx">object</span> <span class="nb">Array</span><span class="p">]</span>
<span class="p">[</span><span class="nx">object</span> <span class="nb">Date</span><span class="p">]</span>
<span class="p">[</span><span class="nx">object</span> <span class="nb">Object</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>In the <code>underscore</code> you will see the following code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.
</span><span class="c1"></span>  <span class="nx">each</span><span class="p">([</span><span class="s1">&#39;Arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;Function&#39;</span><span class="p">,</span> <span class="s1">&#39;String&#39;</span><span class="p">,</span> <span class="s1">&#39;Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;RegExp&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">[</span><span class="s1">&#39;is&#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;[object &#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>Here is where <code>toString</code> is used to determine the type of a variable, for example you can tell if <code>someFunc</code> is a function by <code>_.isFunction(someFunc)</code>.</p>
<p>From the above code we can see that <code>toString</code> is dependable and it can tell us the correct result regardless of whether it is of type <code>object</code> or <code>primitive</code>. However, it can only be used to determine built-in data types. For objects we construct ourselves, it still can&rsquo;t give us the result we want, such as the following code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Person</span><span class="p">()</span> <span class="p">{</span>  
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">();</span>  
<span class="c1">// [object Object]
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">({}.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">));</span>  
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span> <span class="k">instanceof</span> <span class="nx">Person</span><span class="p">);</span>  
</code></pre></td></tr></table>
</div>
</div><p>This is where we need to use <code>instanceof</code>, which we describe below.</p>
<h3 id="instanceof">instanceof</h3>
<p>For objects created using constructors, we usually use <code>instanceof</code> to determine whether a certain instance belongs to a certain type, for example: <code>a instanceof Person</code>, the internal principle is actually to determine whether <code>Person.prototype</code> is in the prototype chain of <code>a</code> instance, the principle can be expressed by the following function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">instance_of</span><span class="p">(</span><span class="nx">V</span><span class="p">,</span> <span class="nx">F</span><span class="p">)</span> <span class="p">{</span>  
  <span class="kd">var</span> <span class="nx">O</span> <span class="o">=</span> <span class="nx">F</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
  <span class="nx">V</span> <span class="o">=</span> <span class="nx">V</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">V</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">O</span> <span class="o">===</span> <span class="nx">V</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">V</span> <span class="o">=</span> <span class="nx">V</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// use
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">Person</span><span class="p">()</span> <span class="p">{</span>  
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">();</span>

<span class="c1">// true
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">instance_of</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">Person</span><span class="p">));</span>  
</code></pre></td></tr></table>
</div>
</div><h2 id="type-conversion">Type conversion</h2>
<p>Because <code>JavaScript</code> is dynamically typed, variables are untyped and can be assigned arbitrary values at any time. However, there are various operators or conditional judgments that require specific types, such as if judgments that convert judgment statements to Boolean types. Here&rsquo;s an in-depth look at type conversion in <code>JavaScript</code>.</p>
<h3 id="toprimitive">ToPrimitive</h3>
<p>When we need to convert a variable to a primitive type, we need to use <code>ToPrimitive</code>. The following code illustrates the internal implementation principle of <code>ToPrimitive</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ECMA-262, section 9.1, page 30. Use null/undefined for no hint,
</span><span class="c1">// (1) for number hint, and (2) for string hint.
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ToPrimitive</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">hint</span><span class="p">)</span> <span class="p">{</span>  
  <span class="c1">// Fast case check.
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="c1">// Normal behavior.
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">IS_SPEC_OBJECT</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL_WRAPPER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">throw</span> <span class="nx">MakeTypeError</span><span class="p">(</span><span class="nx">kSymbolToPrimitive</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hint</span> <span class="o">==</span> <span class="nx">NO_HINT</span><span class="p">)</span> <span class="nx">hint</span> <span class="o">=</span> <span class="p">(</span><span class="nx">IS_DATE</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="o">?</span> <span class="nx">STRING_HINT</span> <span class="o">:</span> <span class="nx">NUMBER_HINT</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">hint</span> <span class="o">==</span> <span class="nx">NUMBER_HINT</span><span class="p">)</span> <span class="o">?</span> <span class="nx">DefaultNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">:</span> <span class="nx">DefaultString</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ECMA-262, section 8.6.2.6, page 28.
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">DefaultNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">IS_SYMBOL_WRAPPER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">valueOf</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SPEC_FUNCTION</span><span class="p">(</span><span class="nx">valueOf</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="o">%</span><span class="nx">_CallFunction</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">valueOf</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IsPrimitive</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">toString</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SPEC_FUNCTION</span><span class="p">(</span><span class="nx">toString</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="o">%</span><span class="nx">_CallFunction</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">toString</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IsPrimitive</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span> <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">throw</span> <span class="nx">MakeTypeError</span><span class="p">(</span><span class="nx">kCannotConvertToPrimitive</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ECMA-262, section 8.6.2.6, page 28.
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">DefaultString</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">IS_SYMBOL_WRAPPER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">toString</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SPEC_FUNCTION</span><span class="p">(</span><span class="nx">toString</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="o">%</span><span class="nx">_CallFunction</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">toString</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IsPrimitive</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span> <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">valueOf</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SPEC_FUNCTION</span><span class="p">(</span><span class="nx">valueOf</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="o">%</span><span class="nx">_CallFunction</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">valueOf</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IsPrimitive</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">throw</span> <span class="nx">MakeTypeError</span><span class="p">(</span><span class="nx">kCannotConvertToPrimitive</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The logic of the above code is as follows.</p>
<ol>
<li>
<p>If the variable is a string, return it directly</p>
</li>
<li>
<p>if <code>!IS_SPEC_OBJECT(x)</code>, return directly</p>
</li>
<li>
<p>if <code>IS_SYMBOL_WRAPPER(x)</code>, then throw an exception</p>
</li>
<li>
<p>Otherwise, <code>DefaultNumber</code> and <code>DefaultString</code> will be called according to the <code>hint</code> passed in, for example, if it is a <code>Date</code> object, <code>DefaultString</code> will be called</p>
<ul>
<li><code>DefaultNumber</code>: first <code>x.valueOf</code>, if <code>primitive</code>, return the value after <code>valueOf</code>, otherwise continue to call <code>x.toString</code>, if <code>primitive</code>, return the value after <code>toString</code>, otherwise throw an exception</li>
<li><code>DefaultString</code>: the opposite of <code>DefaultNumber</code>, call <code>toString</code> first, then <code>valueOf</code> if it is not <code>primitive</code></li>
</ul>
</li>
</ol>
<p>So after talking about the implementation principle, what is the use of this <code>ToPrimitive</code>? ToPrimitive is called for many operations, such as adding, equaling, or comparing. In the add operation, the left and right operands will be converted to <code>primitive</code> and then added together.</p>
<p>Here&rsquo;s an example. What does <code>({}) + 1</code> (the <code>{}</code> is put in parentheses so that the kernel thinks of it as a block of code) output? You probably don&rsquo;t write code like this every day, but there are similar interview questions online.</p>
<p>The add operation only performs the corresponding <code>%_StringAdd</code> or <code>%NumberAdd</code> when the left and right operators are both <code>String</code> or <code>Number</code>, so look at the following steps inside <code>({}) + 1</code>.</p>
<ol>
<li><code>{}</code> and <code>1</code> will first call <code>ToPrimitive</code></li>
<li><code>{}</code> goes to <code>DefaultNumber</code>, which first calls <code>valueOf</code>, which returns <code>Object {}</code>, not the <code>primitive</code> type, and thus continues to <code>toString</code>, which returns <code>[object Object]</code>, the <code>String</code> type</li>
<li>The final add operation results in <code>[object Object]1</code></li>
</ol>
<p>If someone asks you what the output of <code>[] + 1</code> is, you may know how to calculate it, first call <code>ToPrimitive</code> on [], return the empty string, and the final result is <code>&quot;1&quot;</code>.</p>
<p>In addition to <code>ToPrimitive</code>, there are more fine-grained <code>ToBoolean</code>, <code>ToNumber</code> and <code>ToString</code>, for example, when a boolean type is needed, it will be converted by <code>ToBoolean</code>. Looking at the source code we can clearly see how these conversions between boolean types, numbers, etc. occur.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ECMA-262, section 9.2, page 30
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ToBoolean</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="c1">// Returns true if length is not 0 when converting a string to boolean
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="c1">// Returns true if the variable is not 0 or NAN when converting from numeric to boolean
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="o">!</span><span class="p">((</span><span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">NUMBER_IS_NAN</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ECMA-262, section 9.3, page 31.
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ToNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="c1">// String to number call StringToNumber
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">%</span><span class="nx">_HasCachedArrayIndex</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">?</span> <span class="o">%</span><span class="nx">_GetCachedArrayIndex</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
                                    <span class="o">:</span> <span class="o">%</span><span class="nx">StringToNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Boolean to numeric true returns 1, false returns 0
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// undefined return NAN
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_UNDEFINED</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">NAN</span><span class="p">;</span>
  <span class="c1">// Symbol throws an exception, e.g. Symbol() + 1
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">throw</span> <span class="nx">MakeTypeError</span><span class="p">(</span><span class="nx">kSymbolToNumber</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">IS_NULL</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">ToNumber</span><span class="p">(</span><span class="nx">DefaultNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ECMA-262, section 9.8, page 35.
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ToString</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="c1">// Number to string, call the internal _NumberToString
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">_NumberToString</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="c1">// Boolean to string, true returns string true
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">?</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span><span class="p">;</span>
  <span class="c1">// undefined to string, return undefined
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_UNDEFINED</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="s1">&#39;undefined&#39;</span><span class="p">;</span>
  <span class="c1">// Symbol throws an exception
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">throw</span> <span class="nx">MakeTypeError</span><span class="p">(</span><span class="nx">kSymbolToString</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">IS_NULL</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="o">?</span> <span class="s1">&#39;null&#39;</span> <span class="o">:</span> <span class="nx">ToString</span><span class="p">(</span><span class="nx">DefaultString</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>After all these principles, what is the use of this <code>ToPrimitive</code>? It is very useful for us to understand the implicit conversions inside <code>JavaScript</code> and some details, such as</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="s1">&#39;[object Object]&#39;</span><span class="p">;</span>  
<span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">==</span> <span class="p">{})</span> <span class="p">{</span>  
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Do you think it will output <code>something</code>? The answer is yes, so that&rsquo;s why many code specifications recommend using <code>===</code> three equal. So why is it equal here? It&rsquo;s because when the equal operation is performed, <code>{}</code> calls <code>ToPrimitive</code>, and the result returned is <code>[object Object]</code>, which also returns <code>true</code>. We can look at the source code of <code>EQUALS</code> in <code>JavaScript</code> to see this at a glance</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ECMA-262 Section 11.9.3.
</span><span class="c1"></span><span class="nx">EQUALS</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">EQUALS</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">StringEquals</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">NumberEquals</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">IS_SPEC_OBJECT</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="p">{</span>
          <span class="c1">// String or boolean.
</span><span class="c1"></span>          <span class="k">return</span> <span class="o">%</span><span class="nx">NumberEquals</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="o">%</span><span class="nx">$toPrimitive</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">NO_HINT</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// 上面的代码就是进入了这里，对y调用了toPrimitive
</span><span class="c1"></span>      <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">StringEquals</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">NumberEquals</span><span class="p">(</span><span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">y</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">NumberEquals</span><span class="p">(</span><span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>        <span class="nx">y</span> <span class="o">=</span> <span class="o">%</span><span class="nx">$toPrimitive</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">NO_HINT</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">_ObjectEquals</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// not equal
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">_ObjectEquals</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">NumberEquals</span><span class="p">(</span><span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">y</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">NumberEquals</span><span class="p">(</span><span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>      <span class="c1">// y is object.
</span><span class="c1"></span>      <span class="nx">x</span> <span class="o">=</span> <span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="o">%</span><span class="nx">$toPrimitive</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">NO_HINT</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// x is an object.
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SPEC_OBJECT</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">%</span><span class="nx">_ObjectEquals</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// not equal
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span> <span class="nx">y</span> <span class="o">=</span> <span class="o">%</span><span class="nx">$toNumber</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="o">%</span><span class="nx">$toPrimitive</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">NO_HINT</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>So the importance of understanding how variables are converted to <code>primitive</code> types is understandable. The details of the code can be found here: <code>runtime.js</code>.</p>
<h3 id="toobject">ToObject</h3>
<p><code>ToObject</code> is, as the name implies, a conversion of variables to object types. You can see how it converts a non-object type to an object type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ECMA-262, section 9.9, page 36.
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ToObject</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>  
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_STRING</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">GlobalString</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NUMBER</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">GlobalNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_BOOLEAN</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">GlobalBoolean</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_SYMBOL</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="o">%</span><span class="nx">NewSymbolWrapper</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">IS_NULL_OR_UNDEFINED</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">IS_UNDETECTABLE</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">MakeTypeError</span><span class="p">(</span><span class="nx">kUndefinedOrNullToObject</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Because the daily code is rarely used, we will not go into it much.</p>
<hr>
<p>Reference <code>https://tech.youzan.com/javascript-type/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascript/">javascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/data-reading-in-golang/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Data Reading in Golang</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/android-surfaceview-source-code-analysis-and-use/">
            <span class="next-text nav-default">Android Surfaceview Source Code Analysis and Use</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
