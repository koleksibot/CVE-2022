<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Spring Cloud Gateway Custom Exception Handling - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="When we usually use SpringMVC, as long as the request is processed by DispatcherServlet, you can customize the handling logic of different types of exceptions through @ControllerAdvice and @ExceptionHandler, you can refer to ResponseEntityExceptionHandler and DefaultHandlerExceptionResolver, the underlying principle is very simple, that is, when an exception occurs, search for the exception handler that already exists in the container and match the corresponding exception type, after a successful match, use" /><meta name="keywords" content="spring-cloud-gateway,Exception,Handling,spring-cloud" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/spring-cloud-gateway-custom-exception-handling/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Spring Cloud Gateway Custom Exception Handling" />
<meta property="og:description" content="When we usually use SpringMVC, as long as the request is processed by DispatcherServlet, you can customize the handling logic of different types of exceptions through @ControllerAdvice and @ExceptionHandler, you can refer to ResponseEntityExceptionHandler and DefaultHandlerExceptionResolver, the underlying principle is very simple, that is, when an exception occurs, search for the exception handler that already exists in the container and match the corresponding exception type, after a successful match, use" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/spring-cloud-gateway-custom-exception-handling/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-09T14:10:33+08:00" />
<meta property="article:modified_time" content="2021-07-09T14:10:33+08:00" />

<meta itemprop="name" content="Spring Cloud Gateway Custom Exception Handling">
<meta itemprop="description" content="When we usually use SpringMVC, as long as the request is processed by DispatcherServlet, you can customize the handling logic of different types of exceptions through @ControllerAdvice and @ExceptionHandler, you can refer to ResponseEntityExceptionHandler and DefaultHandlerExceptionResolver, the underlying principle is very simple, that is, when an exception occurs, search for the exception handler that already exists in the container and match the corresponding exception type, after a successful match, use"><meta itemprop="datePublished" content="2021-07-09T14:10:33+08:00" />
<meta itemprop="dateModified" content="2021-07-09T14:10:33+08:00" />
<meta itemprop="wordCount" content="1583">
<meta itemprop="keywords" content="spring-cloud,spring-cloud-gateway," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring Cloud Gateway Custom Exception Handling"/>
<meta name="twitter:description" content="When we usually use SpringMVC, as long as the request is processed by DispatcherServlet, you can customize the handling logic of different types of exceptions through @ControllerAdvice and @ExceptionHandler, you can refer to ResponseEntityExceptionHandler and DefaultHandlerExceptionResolver, the underlying principle is very simple, that is, when an exception occurs, search for the exception handler that already exists in the container and match the corresponding exception type, after a successful match, use"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Spring Cloud Gateway Custom Exception Handling</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-09 14:10:33 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/microservices/"> microservices </a>
            </div>
          <span class="more-meta"> 1583 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#why-custom-exception-handling">Why custom exception handling</a></li>
        <li><a href="#how-to-customize-exception-handling">How to customize exception handling</a></li>
        <li><a href="#testing">Testing</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/01/657029505bd0489f9b1bea11b26d7fac.png" alt=" "></p>
<p>When we usually use <code>SpringMVC</code>, as long as the request is processed by <code>DispatcherServlet</code>, you can customize the handling logic of different types of exceptions through <code>@ControllerAdvice</code> and <code>@ExceptionHandler</code>, you can refer to <code>ResponseEntityExceptionHandler</code> and <code>DefaultHandlerExceptionResolver</code>, the underlying principle is very simple, that is, when an exception occurs, search for the exception handler that already exists in the container and match the corresponding exception type, after a successful match, use the specified exception handler to return The result of the <code>Response</code> rendering, if the default exception handler can not be found then the default for the bottom (personally, I think that <code>Spring</code> in many functional design time have this &ldquo;there is the use of custom, no use the default to provide&rdquo; this idea is very elegant).</p>
<p>The custom exception system provided in <code>SpringMVC</code> doesn&rsquo;t work in <code>Spring-WebFlux</code> for the simple reason that the underlying runtime containers are not the same. <code>WebExceptionHandler</code> is the top-level interface to the exception handler of <code>Spring-WebFlux</code>, so it can be traced back to the subclass <code>DefaultErrorWebExceptionHandler</code> which is the global exception handler of <code>Spring Cloud Gateway</code>, with the configuration class <code>ErrorWebFluxAutoConfiguration</code>.</p>
<h2 id="why-custom-exception-handling">Why custom exception handling</h2>
<p>Let&rsquo;s start by drawing a hypothetical but close to actual architecture diagram to locate the role of the gateway.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/09/d7328cb146444d338e16abf87fd8b466.png" alt=" "></p>
<p>The role of the gateway in the overall architecture is:</p>
<ol>
<li>Routing requests from the server-side application to the back-end application.</li>
<li>(Aggregation) Response forwarding from the back-end application to the server-side application</li>
</ol>
<p>Assuming that the gateway service is always normal.</p>
<p>For point 1, assuming that the back-end application can not be smoothly and losslessly online, there is a certain chance that the gateway will route the request to some back-end &ldquo;zombie node (request routing past the time when the application is better in restart or just stop)&rdquo;, this time the route will fail to throw an exception, the general situation is <code>Connection Refuse</code>.</p>
<p>For point 2, assuming that the back-end application does not handle the exception correctly, then the exception information should be forwarded back to the server-side application through the gateway, which in theory will not be an exception.</p>
<p>In fact, there is a hidden problem in point 3, if the gateway does not only assume the function of routing, but also contains the functions of authentication, flow restriction, etc. If these functions are developed without perfect processing of exception capture or even the logic itself exists <code>BUG</code>, it may lead to the exception not being properly captured and processed, and the default exception handler <code>DefaultErrorWebExceptionHandler</code>, the processing logic of the default exception handler may not meet our expected results.</p>
<h2 id="how-to-customize-exception-handling">How to customize exception handling</h2>
<p>We can start by looking at the configuration class <code>ErrorWebFluxAutoConfiguration</code> for the default exception handler.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="nd">@ConditionalOnWebApplication</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">ConditionalOnWebApplication</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">REACTIVE</span><span class="o">)</span>
<span class="nd">@ConditionalOnClass</span><span class="o">(</span><span class="n">WebFluxConfigurer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@AutoConfigureBefore</span><span class="o">(</span><span class="n">WebFluxAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">({</span> <span class="n">ServerProperties</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">ResourceProperties</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorWebFluxAutoConfiguration</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="n">ServerProperties</span> <span class="n">serverProperties</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="n">ResourceProperties</span> <span class="n">resourceProperties</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;</span> <span class="n">viewResolvers</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="n">ServerCodecConfigurer</span> <span class="n">serverCodecConfigurer</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">ErrorWebFluxAutoConfiguration</span><span class="o">(</span><span class="n">ServerProperties</span> <span class="n">serverProperties</span><span class="o">,</span>
			<span class="n">ResourceProperties</span> <span class="n">resourceProperties</span><span class="o">,</span>
			<span class="n">ObjectProvider</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;</span> <span class="n">viewResolversProvider</span><span class="o">,</span>
			<span class="n">ServerCodecConfigurer</span> <span class="n">serverCodecConfigurer</span><span class="o">,</span>
			<span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">serverProperties</span> <span class="o">=</span> <span class="n">serverProperties</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">resourceProperties</span> <span class="o">=</span> <span class="n">resourceProperties</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">viewResolvers</span> <span class="o">=</span> <span class="n">viewResolversProvider</span><span class="o">.</span><span class="na">orderedStream</span><span class="o">()</span>
				<span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
		<span class="k">this</span><span class="o">.</span><span class="na">serverCodecConfigurer</span> <span class="o">=</span> <span class="n">serverCodecConfigurer</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">ErrorWebExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
			<span class="n">search</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="na">CURRENT</span><span class="o">)</span>
	<span class="nd">@Order</span><span class="o">(-</span><span class="n">1</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">ErrorWebExceptionHandler</span> <span class="nf">errorWebExceptionHandler</span><span class="o">(</span>
			<span class="n">ErrorAttributes</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">DefaultErrorWebExceptionHandler</span> <span class="n">exceptionHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultErrorWebExceptionHandler</span><span class="o">(</span>
				<span class="n">errorAttributes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">resourceProperties</span><span class="o">,</span>
				<span class="k">this</span><span class="o">.</span><span class="na">serverProperties</span><span class="o">.</span><span class="na">getError</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span><span class="o">);</span>
		<span class="n">exceptionHandler</span><span class="o">.</span><span class="na">setViewResolvers</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">viewResolvers</span><span class="o">);</span>
		<span class="n">exceptionHandler</span><span class="o">.</span><span class="na">setMessageWriters</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverCodecConfigurer</span><span class="o">.</span><span class="na">getWriters</span><span class="o">());</span>
		<span class="n">exceptionHandler</span><span class="o">.</span><span class="na">setMessageReaders</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverCodecConfigurer</span><span class="o">.</span><span class="na">getReaders</span><span class="o">());</span>
		<span class="k">return</span> <span class="n">exceptionHandler</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">ErrorAttributes</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
			<span class="n">search</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="na">CURRENT</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">DefaultErrorAttributes</span> <span class="nf">errorAttributes</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="n">DefaultErrorAttributes</span><span class="o">(</span>
				<span class="k">this</span><span class="o">.</span><span class="na">serverProperties</span><span class="o">.</span><span class="na">getError</span><span class="o">().</span><span class="na">isIncludeException</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Notice that the two <code>Bean</code> instances <code>ErrorWebExceptionHandler</code> and <code>DefaultErrorAttributes</code> both use the <code>@ConditionalOnMissingBean</code> annotation, which means we can override them with a custom implementation. First customize a <code>CustomErrorWebFluxAutoConfiguration</code> (except for the custom implementation of <code>ErrorWebExceptionHandler</code>, which is a direct copy of <code>ErrorWebFluxAutoConfiguration</code>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="nd">@ConditionalOnWebApplication</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">ConditionalOnWebApplication</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">REACTIVE</span><span class="o">)</span>
<span class="nd">@ConditionalOnClass</span><span class="o">(</span><span class="n">WebFluxConfigurer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@AutoConfigureBefore</span><span class="o">(</span><span class="n">WebFluxAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">({</span><span class="n">ServerProperties</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">ResourceProperties</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomErrorWebFluxAutoConfiguration</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ServerProperties</span> <span class="n">serverProperties</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ResourceProperties</span> <span class="n">resourceProperties</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;</span> <span class="n">viewResolvers</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ServerCodecConfigurer</span> <span class="n">serverCodecConfigurer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CustomErrorWebFluxAutoConfiguration</span><span class="o">(</span><span class="n">ServerProperties</span> <span class="n">serverProperties</span><span class="o">,</span>
                                               <span class="n">ResourceProperties</span> <span class="n">resourceProperties</span><span class="o">,</span>
                                               <span class="n">ObjectProvider</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;</span> <span class="n">viewResolversProvider</span><span class="o">,</span>
                                               <span class="n">ServerCodecConfigurer</span> <span class="n">serverCodecConfigurer</span><span class="o">,</span>
                                               <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">serverProperties</span> <span class="o">=</span> <span class="n">serverProperties</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">resourceProperties</span> <span class="o">=</span> <span class="n">resourceProperties</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewResolvers</span> <span class="o">=</span> <span class="n">viewResolversProvider</span><span class="o">.</span><span class="na">orderedStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="k">this</span><span class="o">.</span><span class="na">serverCodecConfigurer</span> <span class="o">=</span> <span class="n">serverCodecConfigurer</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">ErrorWebExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="na">CURRENT</span><span class="o">)</span>
    <span class="nd">@Order</span><span class="o">(-</span><span class="n">1</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ErrorWebExceptionHandler</span> <span class="nf">errorWebExceptionHandler</span><span class="o">(</span><span class="n">ErrorAttributes</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Here completes the custom ErrorWebExceptionHandler implementation logic
</span><span class="c1"></span>        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">ErrorAttributes</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">search</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="na">CURRENT</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">DefaultErrorAttributes</span> <span class="nf">errorAttributes</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultErrorAttributes</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverProperties</span><span class="o">.</span><span class="na">getError</span><span class="o">().</span><span class="na">isIncludeException</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The implementation of <code>ErrorWebExceptionHandler</code> can directly refer to <code>DefaultErrorWebExceptionHandler</code>, or even directly inherit from <code>DefaultErrorWebExceptionHandler</code> and override the corresponding method. Here the exception information is directly encapsulated into the following format <code>Response</code> return, and finally need to be rendered into <code>JSON</code> format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Description Information&#34;</span><span class="p">,</span>
  <span class="nt">&#34;path&#34;</span> <span class="p">:</span> <span class="s2">&#34;Request Path&#34;</span><span class="p">,</span>
  <span class="nt">&#34;method&#34;</span><span class="p">:</span> <span class="s2">&#34;Request Method&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We need to analyze some source code in <code>DefaultErrorWebExceptionHandler</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Encapsulating Exception Properties
</span><span class="c1"></span><span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getErrorAttributes</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">includeStackTrace</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">errorAttributes</span><span class="o">.</span><span class="na">getErrorAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">includeStackTrace</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// Render ExceptionResponse
</span><span class="c1"></span><span class="kd">protected</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">renderErrorResponse</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
	<span class="kt">boolean</span> <span class="n">includeStackTrace</span> <span class="o">=</span> <span class="n">isIncludeStackTrace</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">ALL</span><span class="o">);</span>
	<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">error</span> <span class="o">=</span> <span class="n">getErrorAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">includeStackTrace</span><span class="o">);</span>
	<span class="k">return</span> <span class="n">ServerResponse</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">getHttpStatus</span><span class="o">(</span><span class="n">error</span><span class="o">))</span>
			<span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_UTF8</span><span class="o">)</span>
			<span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">BodyInserters</span><span class="o">.</span><span class="na">fromObject</span><span class="o">(</span><span class="n">error</span><span class="o">));</span>
<span class="o">}</span>

<span class="c1">// Returns a ServerResponse-based object for the routing method
</span><span class="c1"></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">RouterFunction</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">getRoutingFunction</span><span class="o">(</span><span class="n">ErrorAttributes</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">route</span><span class="o">(</span><span class="n">acceptsTextHtml</span><span class="o">(),</span> <span class="k">this</span><span class="o">::</span><span class="n">renderErrorView</span><span class="o">).</span><span class="na">andRoute</span><span class="o">(</span><span class="n">all</span><span class="o">(),</span> <span class="k">this</span><span class="o">::</span><span class="n">renderErrorResponse</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// The encapsulation of the HTTP response status code was originally parsed based on the status attribute of the exception property
</span><span class="c1"></span><span class="kd">protected</span> <span class="n">HttpStatus</span> <span class="nf">getHttpStatus</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">errorAttributes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;status&#34;</span><span class="o">);</span>
	<span class="k">return</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">statusCode</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Identify three points.</p>
<ol>
<li>the final object wrapped into the response body is derived from <code>DefaultErrorWebExceptionHandler#getErrorAttributes()</code> and the result is a sequence of bytes converted to a <code>Map&lt;String, Object&gt;</code> instance.</li>
<li>The original <code>RouterFunction</code> implementation only supports HTML format return, we need to modify it to JSON format return (or support all formats return).</li>
<li><code>DefaultErrorWebExceptionHandler#getHttpStatus()</code> is a wrapper for the response status code, the original logic is based on the <code>status</code> attribute of the exception property <code>getErrorAttributes()</code> for parsing.</li>
</ol>
<p>The custom <code>JsonErrorWebExceptionHandler</code> is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonErrorWebExceptionHandler</span> <span class="kd">extends</span> <span class="n">DefaultErrorWebExceptionHandler</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">JsonErrorWebExceptionHandler</span><span class="o">(</span><span class="n">ErrorAttributes</span> <span class="n">errorAttributes</span><span class="o">,</span>
                                        <span class="n">ResourceProperties</span> <span class="n">resourceProperties</span><span class="o">,</span>
                                        <span class="n">ErrorProperties</span> <span class="n">errorProperties</span><span class="o">,</span>
                                        <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">errorAttributes</span><span class="o">,</span> <span class="n">resourceProperties</span><span class="o">,</span> <span class="n">errorProperties</span><span class="o">,</span> <span class="n">applicationContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getErrorAttributes</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">includeStackTrace</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Here the logic can actually be customized according to the exception type
</span><span class="c1"></span>        <span class="n">Throwable</span> <span class="n">error</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getError</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">errorAttributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;(</span><span class="n">8</span><span class="o">);</span>
        <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;message&#34;</span><span class="o">,</span> <span class="n">error</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;code&#34;</span><span class="o">,</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">.</span><span class="na">value</span><span class="o">());</span>
        <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;method&#34;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">methodName</span><span class="o">());</span>
        <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;path&#34;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">path</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">errorAttributes</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">RouterFunction</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span> <span class="nf">getRoutingFunction</span><span class="o">(</span><span class="n">ErrorAttributes</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">RouterFunctions</span><span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="n">RequestPredicates</span><span class="o">.</span><span class="na">all</span><span class="o">(),</span> <span class="k">this</span><span class="o">::</span><span class="n">renderErrorResponse</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">HttpStatus</span> <span class="nf">getHttpStatus</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Here you can actually customize the HTTP response code based on the attributes inside the errorAttributes
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>配置类<code>CustomErrorWebFluxAutoConfiguration</code>添加<code>JsonErrorWebExceptionHandler</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">ErrorWebExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">search</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="na">CURRENT</span><span class="o">)</span>
<span class="nd">@Order</span><span class="o">(-</span><span class="n">1</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ErrorWebExceptionHandler</span> <span class="nf">errorWebExceptionHandler</span><span class="o">(</span><span class="n">ErrorAttributes</span> <span class="n">errorAttributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">JsonErrorWebExceptionHandler</span> <span class="n">exceptionHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonErrorWebExceptionHandler</span><span class="o">(</span>
                <span class="n">errorAttributes</span><span class="o">,</span>
                <span class="n">resourceProperties</span><span class="o">,</span>
                <span class="k">this</span><span class="o">.</span><span class="na">serverProperties</span><span class="o">.</span><span class="na">getError</span><span class="o">(),</span>
                <span class="n">applicationContext</span><span class="o">);</span>
    <span class="n">exceptionHandler</span><span class="o">.</span><span class="na">setViewResolvers</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">viewResolvers</span><span class="o">);</span>
    <span class="n">exceptionHandler</span><span class="o">.</span><span class="na">setMessageWriters</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverCodecConfigurer</span><span class="o">.</span><span class="na">getWriters</span><span class="o">());</span>
    <span class="n">exceptionHandler</span><span class="o">.</span><span class="na">setMessageReaders</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">serverCodecConfigurer</span><span class="o">.</span><span class="na">getReaders</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">exceptionHandler</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Very simple, here the HTTP response status code of the exception is unified as <code>HttpStatus.INTERNAL_SERVER_ERROR(500)</code>, the transformation is not much, as long as you understand the contextual logic of the original exception handling.</p>
<h2 id="testing">Testing</h2>
<p><strong>Test scenario 1</strong>: Direct invocation of a downstream service without starting only the gateway and the downstream service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/host

// response
{&#34;path&#34;:&#34;/order/host&#34;,&#34;code&#34;:500,&#34;message&#34;:&#34;Connection refused: no further information: localhost/127.0.0.1:9091&#34;,&#34;method&#34;:&#34;GET&#34;}
</code></pre></td></tr></table>
</div>
</div><p><strong>Test scenario 2</strong>: The downstream service is started and invoked normally, and the gateway itself throws an exception.</p>
<p>Customize a global filter in the gateway application and intentionally throw an exception.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorGlobalFilter</span> <span class="kd">implements</span> <span class="n">GlobalFilter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">filter</span><span class="o">(</span><span class="n">ServerWebExchange</span> <span class="n">exchange</span><span class="o">,</span> <span class="n">GatewayFilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">/</span><span class="n">0</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">curl http://localhost:9090/order/host

// response
{&#34;path&#34;:&#34;/order/host&#34;,&#34;code&#34;:500,&#34;message&#34;:&#34;/ by zero&#34;,&#34;method&#34;:&#34;GET&#34;}
</code></pre></td></tr></table>
</div>
</div><p>The response results are consistent with the custom logic, and the backend logs print the corresponding exception stacks.</p>
<h2 id="summary">Summary</h2>
<p>The author has always believed that doing exception classification and processing according to the classification is a very important part of the project. In the system I am responsible for in my company, I insist on implementing exception classification and capture, mainly because I need to distinguish between exceptions that can be retried to compensate and those that cannot be retried and need timely warning, so that I can customize the self-healing logic for recoverable exceptions and timely warning and human intervention for those that cannot be recovered. Therefore, Spring Cloud Gateway, the technology stack, must also investigate its custom exception handling logic.</p>
<hr>
<p>Reference <code>https://www.throwx.cn/2019/05/11/spring-cloud-gateway-custom-exception-handler/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring-cloud/">spring-cloud</a>
          <a href="/tags/spring-cloud-gateway/">spring-cloud-gateway</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/implementing-lock-free-queues-with-go/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Implementing Lock Free Queues With Go</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/spring-cloud-gateway-serverwebexchange-core-methods-and-request-or-response-content-modification/">
            <span class="next-text nav-default">Spring Cloud Gateway-ServerWebExchange Core Methods and Request or Response Content Modification</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
