<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Go Reflect Performance - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Go reflect package provides the ability to get the type and value of an object at runtime, which can help us to abstract and simplify the code, achieve dynamic data acquisition and method invocation, improve development efficiency and readability, and make up for Go&amp;rsquo;s ability to handle data uniformly in the absence of generics.
With reflect, we can achieve the ability to get object types, object fields, object methods, get tag information of struct, dynamically create objects, whether objects implement specific interfaces, convert objects, get and set object values, call Select branches dynamically, etc." /><meta name="keywords" content="Go,Reflect,Performance" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/go-reflect-performance/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Go Reflect Performance" />
<meta property="og:description" content="Go reflect package provides the ability to get the type and value of an object at runtime, which can help us to abstract and simplify the code, achieve dynamic data acquisition and method invocation, improve development efficiency and readability, and make up for Go&rsquo;s ability to handle data uniformly in the absence of generics.
With reflect, we can achieve the ability to get object types, object fields, object methods, get tag information of struct, dynamically create objects, whether objects implement specific interfaces, convert objects, get and set object values, call Select branches dynamically, etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/go-reflect-performance/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-03T16:24:33+08:00" />
<meta property="article:modified_time" content="2021-07-03T16:24:33+08:00" />

<meta itemprop="name" content="Go Reflect Performance">
<meta itemprop="description" content="Go reflect package provides the ability to get the type and value of an object at runtime, which can help us to abstract and simplify the code, achieve dynamic data acquisition and method invocation, improve development efficiency and readability, and make up for Go&rsquo;s ability to handle data uniformly in the absence of generics.
With reflect, we can achieve the ability to get object types, object fields, object methods, get tag information of struct, dynamically create objects, whether objects implement specific interfaces, convert objects, get and set object values, call Select branches dynamically, etc."><meta itemprop="datePublished" content="2021-07-03T16:24:33+08:00" />
<meta itemprop="dateModified" content="2021-07-03T16:24:33+08:00" />
<meta itemprop="wordCount" content="1447">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go Reflect Performance"/>
<meta name="twitter:description" content="Go reflect package provides the ability to get the type and value of an object at runtime, which can help us to abstract and simplify the code, achieve dynamic data acquisition and method invocation, improve development efficiency and readability, and make up for Go&rsquo;s ability to handle data uniformly in the absence of generics.
With reflect, we can achieve the ability to get object types, object fields, object methods, get tag information of struct, dynamically create objects, whether objects implement specific interfaces, convert objects, get and set object values, call Select branches dynamically, etc."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Go Reflect Performance</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-03 16:24:33 </span>
        <div class="post-category">
            <a href="/categories/implementation-details/"> implementation-details </a>
            </div>
          <span class="more-meta"> 1447 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#test">Test</a></li>
        <li><a href="#test-results">Test results</a></li>
        <li><a href="#optimization">Optimization</a></li>
        <li><a href="#performance-impact-of-crateuncrate-operations">Performance impact of &ldquo;crate/uncrate&rdquo; operations</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Go <code>reflect</code> package provides the ability to get the type and value of an object at runtime, which can help us to abstract and simplify the code, achieve dynamic data acquisition and method invocation, improve development efficiency and readability, and make up for <code>Go</code>&rsquo;s ability to handle data uniformly in the absence of generics.</p>
<p>With <code>reflect</code>, we can achieve the ability to get object types, object fields, object methods, get <code>tag</code> information of <code>struct</code>, dynamically create objects, whether objects implement specific interfaces, convert objects, get and set object values, call <code>Select</code> branches dynamically, etc. It looks good, but we all know one thing: <strong>there is a performance cost to using reflect!</strong></p>
<h2 id="test">Test</h2>
<p>The use of reflect in Java also has an impact on performance, but unlike <code>Java</code> <code>reflect</code>, <code>Java</code> does not distinguish between <code>Type</code> and <code>Value</code> types, so at least in Java we can pre-cache the corresponding reflect objects to reduce the impact of reflection on performance, but there is no way to pre-cache reflect in Go, because the Type type does not contain the runtime value of the object, you must go through ValueOf and runtime instance objects to get the Value object.</p>
<p>Reflection generation and acquisition of objects will add additional code instructions, and will also involve <code>interface{}</code> boxing/unboxing operations, and may increase the generation of temporary objects in the middle, so performance degradation is certain, but how much can be reduced, or the data to speak.</p>
<p>Of course, the different methods used by reflect, and the different types of objects, will more or less affect the performance of the test data, we will take a common struct type as an example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">test</span>
<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;reflect&#34;</span>
	<span class="s">&#34;testing&#34;</span>
<span class="p">)</span>
<span class="kd">type</span> <span class="nx">Student</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Name</span>  <span class="kt">string</span>
	<span class="nx">Age</span>   <span class="kt">int</span>
	<span class="nx">Class</span> <span class="kt">string</span>
	<span class="nx">Score</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkReflect_New</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">s</span> <span class="o">*</span><span class="nx">Student</span>
	<span class="nx">sv</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">Student</span><span class="p">{})</span>
	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">sn</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">sv</span><span class="p">)</span>
		<span class="nx">s</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">sn</span><span class="p">.</span><span class="nf">Interface</span><span class="p">().(</span><span class="o">*</span><span class="nx">Student</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">s</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkDirect_New</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">s</span> <span class="o">*</span><span class="nx">Student</span>
	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">s</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Student</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">s</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkReflect_Set</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">s</span> <span class="o">*</span><span class="nx">Student</span>
	<span class="nx">sv</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">Student</span><span class="p">{})</span>
	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">sn</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">sv</span><span class="p">)</span>
		<span class="nx">s</span> <span class="p">=</span> <span class="nx">sn</span><span class="p">.</span><span class="nf">Interface</span><span class="p">().(</span><span class="o">*</span><span class="nx">Student</span><span class="p">)</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;Jerry&#34;</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Age</span> <span class="p">=</span> <span class="mi">18</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Class</span> <span class="p">=</span> <span class="s">&#34;20005&#34;</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Score</span> <span class="p">=</span> <span class="mi">100</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkReflect_SetFieldByName</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">sv</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">Student</span><span class="p">{})</span>
	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">sn</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">sv</span><span class="p">).</span><span class="nf">Elem</span><span class="p">()</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">FieldByName</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">).</span><span class="nf">SetString</span><span class="p">(</span><span class="s">&#34;Jerry&#34;</span><span class="p">)</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">FieldByName</span><span class="p">(</span><span class="s">&#34;Age&#34;</span><span class="p">).</span><span class="nf">SetInt</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">FieldByName</span><span class="p">(</span><span class="s">&#34;Class&#34;</span><span class="p">).</span><span class="nf">SetString</span><span class="p">(</span><span class="s">&#34;20005&#34;</span><span class="p">)</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">FieldByName</span><span class="p">(</span><span class="s">&#34;Score&#34;</span><span class="p">).</span><span class="nf">SetInt</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkReflect_SetFieldByIndex</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">sv</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">Student</span><span class="p">{})</span>
	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">sn</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">sv</span><span class="p">).</span><span class="nf">Elem</span><span class="p">()</span> 
		<span class="nx">sn</span><span class="p">.</span><span class="nf">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">SetString</span><span class="p">(</span><span class="s">&#34;Jerry&#34;</span><span class="p">)</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">Field</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">SetInt</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">Field</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">SetString</span><span class="p">(</span><span class="s">&#34;20005&#34;</span><span class="p">)</span>
		<span class="nx">sn</span><span class="p">.</span><span class="nf">Field</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">SetInt</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkDirect_Set</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">s</span> <span class="o">*</span><span class="nx">Student</span>
	<span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">s</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Student</span><span class="p">)</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;Jerry&#34;</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Age</span> <span class="p">=</span> <span class="mi">18</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Class</span> <span class="p">=</span> <span class="s">&#34;20005&#34;</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">Score</span> <span class="p">=</span> <span class="mi">100</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Test results:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">BenchmarkReflect_New-4               	20000000	        70.0 ns/op	      48 B/op	       1 allocs/op
BenchmarkDirect_New-4                	30000000	        45.6 ns/op	      48 B/op	       1 allocs/op
BenchmarkReflect_Set-4               	20000000	        73.6 ns/op	      48 B/op	       1 allocs/op
BenchmarkReflect_SetFieldByName-4    	 3000000	       492 ns/op	      80 B/op	       5 allocs/op
BenchmarkReflect_SetFieldByIndex-4   	20000000	       111 ns/op	      48 B/op	       1 allocs/op
BenchmarkDirect_Set-4                   30000000	        43.1 ns/op	      48 B/op	       1 allocs/op
</code></pre></td></tr></table>
</div>
</div><h2 id="test-results">Test results</h2>
<p>We conducted tests for two functions.</p>
<ul>
<li>Creation of objects (struct)</li>
<li>Assignment of object fields</li>
</ul>
<p>For object creation, it takes 70 nanoseconds to generate the object through reflection, while it takes 45.6 nanoseconds to directly new the object, which is a big performance difference.</p>
<p>For the field assignment, there are four test cases.</p>
<ul>
<li><code>Reflect_Set</code>: Generate an object through reflection, convert it to an actual object, and call the object&rsquo;s fields directly for assignment, takes 73.6 nanoseconds</li>
<li><code>Reflect_SetFieldByName</code>: Generate the object by reflection and assign it by FieldByName, takes 492 nanoseconds</li>
<li><code>Reflect_SetFieldByIndex</code>: Generates an object by reflection and assigns it by Field, takes 111 nanoseconds</li>
<li><code>Direct_Set</code>: Assignment by calling the field of the object directly, in 43.1 nanoseconds</li>
</ul>
<p>The main difference between the performance of <code>Reflect_Set</code> and <code>Direct_Set</code> is still in the generation of the object, because the assignment methods for the fields are the same afterwards, which is also consistent with the results of the test <code>case</code> for object creation.</p>
<p>If the assignment is done by reflection, the performance degradation is very strong and the time consumption increases exponentially. Interestingly, the <code>FieldByName</code> method is several times more powerful than the <code>Field</code> method, because <code>FieldByName</code> has an extra loop to find the field, although it still ends up calling <code>Field</code> for the assignment.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nf">unc</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">Value</span><span class="p">)</span> <span class="nf">FieldByName</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">Value</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">.</span><span class="nf">mustBe</span><span class="p">(</span><span class="nx">Struct</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">typ</span><span class="p">.</span><span class="nf">FieldByName</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">FieldByIndex</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">Index</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">Value</span><span class="p">{}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">Value</span><span class="p">)</span> <span class="nf">FieldByIndex</span><span class="p">(</span><span class="nx">index</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="nx">Value</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Field</span><span class="p">(</span><span class="nx">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	<span class="p">}</span>
	<span class="nx">v</span><span class="p">.</span><span class="nf">mustBe</span><span class="p">(</span><span class="nx">Struct</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">x</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">index</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Kind</span><span class="p">()</span> <span class="o">==</span> <span class="nx">Ptr</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">typ</span><span class="p">.</span><span class="nf">Elem</span><span class="p">().</span><span class="nf">Kind</span><span class="p">()</span> <span class="o">==</span> <span class="nx">Struct</span> <span class="p">{</span>
				<span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nf">IsNil</span><span class="p">()</span> <span class="p">{</span>
					<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;reflect: indirection through nil pointer to embedded struct&#34;</span><span class="p">)</span>
				<span class="p">}</span>
				<span class="nx">v</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Elem</span><span class="p">()</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nx">v</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Field</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">v</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="optimization">Optimization</h2>
<p>From the results of the above tests, reflection can affect the performance of object generation and field assignment, but it does simplify the code and provide a unified code for business logic, such as the standard library <code>json</code> coding and decoding, <code>rpc</code> service registration and invocation, some <code>ORM</code> frameworks such as <code>gorm</code>, etc., are used to process data through reflection, which is to be able to handle common types.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// https://github.com/golang/go/blob/master/src/encoding/json/decode.go#L946
</span><span class="c1"></span>  <span class="o">......</span>
      <span class="k">case</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">String</span><span class="p">:</span>
	<span class="nx">v</span><span class="p">.</span><span class="nf">SetString</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span>
<span class="k">case</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Interface</span><span class="p">:</span>
	<span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nf">NumMethod</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">v</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">ValueOf</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">s</span><span class="p">)))</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">d</span><span class="p">.</span><span class="nf">saveError</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">UnmarshalTypeError</span><span class="p">{</span><span class="nx">Value</span><span class="p">:</span> <span class="s">&#34;string&#34;</span><span class="p">,</span> <span class="nx">Type</span><span class="p">:</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Type</span><span class="p">(),</span> <span class="nx">Offset</span><span class="p">:</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nf">readIndex</span><span class="p">())})</span>
          <span class="p">}</span>
  <span class="o">......</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// https://github.com/jinzhu/gorm/blob/master/scope.go#L495
</span><span class="c1"></span>     <span class="k">for</span> <span class="nx">fieldIndex</span><span class="p">,</span> <span class="nx">field</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">selectFields</span> <span class="p">{</span>
<span class="k">if</span> <span class="nx">field</span><span class="p">.</span><span class="nx">DBName</span> <span class="o">==</span> <span class="nx">column</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">field</span><span class="p">.</span><span class="nx">Field</span><span class="p">.</span><span class="nf">Kind</span><span class="p">()</span> <span class="o">==</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Ptr</span> <span class="p">{</span>
		<span class="nx">values</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">=</span> <span class="nx">field</span><span class="p">.</span><span class="nx">Field</span><span class="p">.</span><span class="nf">Addr</span><span class="p">().</span><span class="nf">Interface</span><span class="p">()</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">reflectValue</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">PtrTo</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">Struct</span><span class="p">.</span><span class="nx">Type</span><span class="p">))</span>
		<span class="nx">reflectValue</span><span class="p">.</span><span class="nf">Elem</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">Field</span><span class="p">.</span><span class="nf">Addr</span><span class="p">())</span>
		<span class="nx">values</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">=</span> <span class="nx">reflectValue</span><span class="p">.</span><span class="nf">Interface</span><span class="p">()</span>
		<span class="nx">resetFields</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">=</span> <span class="nx">field</span>
	<span class="p">}</span>
	<span class="nx">selectedColumnsMap</span><span class="p">[</span><span class="nx">column</span><span class="p">]</span> <span class="p">=</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">fieldIndex</span>
	<span class="k">if</span> <span class="nx">field</span><span class="p">.</span><span class="nx">IsNormal</span> <span class="p">{</span>
		<span class="k">break</span>
	<span class="p">}</span>
<span class="p">}</span>
     <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In our pursuit of high performance scenarios, we may need to avoid reflection calls as much as possible, such as <code>unmarshal</code> for <code>json</code> data, <code>easyjson</code> avoids using reflection by means of generators.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Student</span><span class="p">)</span> <span class="nf">UnmarshalJSON</span><span class="p">(</span><span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">jlexer</span><span class="p">.</span><span class="nx">Lexer</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span> <span class="nx">data</span><span class="p">}</span>
	<span class="nf">easyjson4a74e62dDecodeGitABCReflect</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">r</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Error</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Student</span><span class="p">)</span> <span class="nf">UnmarshalEasyJSON</span><span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">jlexer</span><span class="p">.</span><span class="nx">Lexer</span><span class="p">)</span> <span class="p">{</span>
	<span class="nf">easyjson4a74e62dDecodeGitABCReflect</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">easyjson4a74e62dDecodeGitABCReflect</span><span class="p">(</span><span class="nx">in</span> <span class="o">*</span><span class="nx">jlexer</span><span class="p">.</span><span class="nx">Lexer</span><span class="p">,</span> <span class="nx">out</span> <span class="o">*</span><span class="nx">Student</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">isTopLevel</span> <span class="o">:=</span> <span class="nx">in</span><span class="p">.</span><span class="nf">IsStart</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">in</span><span class="p">.</span><span class="nf">IsNull</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">isTopLevel</span> <span class="p">{</span>
			<span class="nx">in</span><span class="p">.</span><span class="nf">Consumed</span><span class="p">()</span>
		<span class="p">}</span>
		<span class="nx">in</span><span class="p">.</span><span class="nf">Skip</span><span class="p">()</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">in</span><span class="p">.</span><span class="nf">Delim</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">)</span>
	<span class="k">for</span> <span class="p">!</span><span class="nx">in</span><span class="p">.</span><span class="nf">IsDelim</span><span class="p">(</span><span class="sc">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">key</span> <span class="o">:=</span> <span class="nx">in</span><span class="p">.</span><span class="nf">UnsafeString</span><span class="p">()</span>
		<span class="nx">in</span><span class="p">.</span><span class="nf">WantColon</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">in</span><span class="p">.</span><span class="nf">IsNull</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">in</span><span class="p">.</span><span class="nf">Skip</span><span class="p">()</span>
			<span class="nx">in</span><span class="p">.</span><span class="nf">WantComma</span><span class="p">()</span>
			<span class="k">continue</span>
		<span class="p">}</span>
		<span class="k">switch</span> <span class="nx">key</span> <span class="p">{</span>
		<span class="k">case</span> <span class="s">&#34;Name&#34;</span><span class="p">:</span>
			<span class="nx">out</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">in</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="k">case</span> <span class="s">&#34;Age&#34;</span><span class="p">:</span>
			<span class="nx">out</span><span class="p">.</span><span class="nx">Age</span> <span class="p">=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">in</span><span class="p">.</span><span class="nf">Int</span><span class="p">())</span>
		<span class="k">case</span> <span class="s">&#34;Class&#34;</span><span class="p">:</span>
			<span class="nx">out</span><span class="p">.</span><span class="nx">Class</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">in</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="k">case</span> <span class="s">&#34;Score&#34;</span><span class="p">:</span>
			<span class="nx">out</span><span class="p">.</span><span class="nx">Score</span> <span class="p">=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">in</span><span class="p">.</span><span class="nf">Int</span><span class="p">())</span>
		<span class="k">default</span><span class="p">:</span>
			<span class="nx">in</span><span class="p">.</span><span class="nf">SkipRecursive</span><span class="p">()</span>
		<span class="p">}</span>
		<span class="nx">in</span><span class="p">.</span><span class="nf">WantComma</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="nx">in</span><span class="p">.</span><span class="nf">Delim</span><span class="p">(</span><span class="sc">&#39;}&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">isTopLevel</span> <span class="p">{</span>
		<span class="nx">in</span><span class="p">.</span><span class="nf">Consumed</span><span class="p">()</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Some other codec libraries also provide this method of avoiding the use of reflection to improve performance.</p>
<h2 id="performance-impact-of-crateuncrate-operations">Performance impact of &ldquo;crate/uncrate&rdquo; operations</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">DirectInvoke</span><span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Student</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;Jerry&#34;</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Age</span> <span class="p">=</span> <span class="mi">18</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Class</span> <span class="p">=</span> <span class="s">&#34;20005&#34;</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Score</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">InterfaceInvoke</span><span class="p">(</span><span class="nx">i</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.(</span><span class="o">*</span><span class="nx">Student</span><span class="p">)</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;Jerry&#34;</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Age</span> <span class="p">=</span> <span class="mi">18</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Class</span> <span class="p">=</span> <span class="s">&#34;20005&#34;</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">Score</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkDirectInvoke</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Student</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nf">DirectInvoke</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">s</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">BenchmarkInterfaceInvoke</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Student</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nf">InterfaceInvoke</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">s</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Test results:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">BenchmarkDirectInvoke-4              	300000000	         5.60 ns/op	       0 B/op	       0 allocs/op
BenchmarkInterfaceInvoke-4           	200000000	         6.64 ns/op	
</code></pre></td></tr></table>
</div>
</div><p>You can see that converting concrete objects to <code>interface{}</code> (and the reverse operation) does have a small performance impact, but it doesn&rsquo;t seem to be a big one.</p>
<hr>
<p>Reference <code>https://colobu.com/2019/01/29/go-reflect-performance/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/go-implements-prioritization-in-select-statements/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Go Implements Prioritization in Select Statements</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/tracking-users-via-js/">
            <span class="next-text nav-default">Tracking Users via Js</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
