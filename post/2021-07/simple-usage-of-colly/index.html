<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Simple Usage of Colly - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="colly is a powerful crawler framework written in Go language . It provides a simple API, has strong performance, can automatically handle cookies &amp;amp; sessions, and provides a flexible extension mechanism. First, we introduce the basic concept of colly. Then we introduce the usage and features of colly with a few examples: pulling GitHub Treading, pulling Baidu novel hotlist, downloading images from Unsplash . Quick Use Create the directory and" /><meta name="keywords" content="golang,colly" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/simple-usage-of-colly/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Simple Usage of Colly" />
<meta property="og:description" content="colly is a powerful crawler framework written in Go language . It provides a simple API, has strong performance, can automatically handle cookies &amp; sessions, and provides a flexible extension mechanism. First, we introduce the basic concept of colly. Then we introduce the usage and features of colly with a few examples: pulling GitHub Treading, pulling Baidu novel hotlist, downloading images from Unsplash . Quick Use Create the directory and" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/simple-usage-of-colly/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-19T17:09:52+08:00" />
<meta property="article:modified_time" content="2021-07-19T17:09:52+08:00" />

<meta itemprop="name" content="Simple Usage of Colly">
<meta itemprop="description" content="colly is a powerful crawler framework written in Go language . It provides a simple API, has strong performance, can automatically handle cookies &amp; sessions, and provides a flexible extension mechanism. First, we introduce the basic concept of colly. Then we introduce the usage and features of colly with a few examples: pulling GitHub Treading, pulling Baidu novel hotlist, downloading images from Unsplash . Quick Use Create the directory and"><meta itemprop="datePublished" content="2021-07-19T17:09:52+08:00" />
<meta itemprop="dateModified" content="2021-07-19T17:09:52+08:00" />
<meta itemprop="wordCount" content="2493">
<meta itemprop="keywords" content="colly,golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Simple Usage of Colly"/>
<meta name="twitter:description" content="colly is a powerful crawler framework written in Go language . It provides a simple API, has strong performance, can automatically handle cookies &amp; sessions, and provides a flexible extension mechanism. First, we introduce the basic concept of colly. Then we introduce the usage and features of colly with a few examples: pulling GitHub Treading, pulling Baidu novel hotlist, downloading images from Unsplash . Quick Use Create the directory and"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Simple Usage of Colly</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-19 17:09:52 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/tools/"> tools </a>
            </div>
          <span class="more-meta"> 2493 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#quick-use">Quick Use</a></li>
        <li><a href="#github-treading">GitHub Treading</a></li>
        <li><a href="#baidu-novel-hotlist">Baidu Novel Hotlist</a></li>
        <li><a href="#unsplash">Unsplash</a></li>
        <li><a href="#asynchronous">Asynchronous</a></li>
        <li><a href="#second-edition">Second Edition</a></li>
        <li><a href="#request-limits">Request Limits</a>
          <ul>
            <li><a href="#set-timeout">Set timeout</a></li>
          </ul>
        </li>
        <li><a href="#extensions">Extensions</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://github.com/gocolly/colly"><code>colly</code></a> is a powerful crawler framework written in Go language . It provides a simple API, has strong performance, can automatically handle cookies &amp; sessions, and provides a flexible extension mechanism.</p>
<p>First, we introduce the basic concept of <code>colly</code>. Then we introduce the usage and features of <code>colly</code> with a few examples: <strong>pulling GitHub Treading, pulling Baidu novel hotlist, downloading images from Unsplash</strong> .</p>
<h2 id="quick-use">Quick Use</h2>
<p>Create the directory and initialize.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ mkdir colly <span class="o">&amp;&amp;</span> <span class="nb">cd</span> colly
$ go mod init github.com/darjun/go-daily-lib/colly
</code></pre></td></tr></table>
</div>
</div><p>Install the <code>colly</code> library.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go get -u github.com/gocolly/colly/v2
</code></pre></td></tr></table>
</div>
</div><p>Use.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;fmt&#34;</span>

  <span class="s">&#34;github.com/gocolly/colly/v2&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">c</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">(</span>
    <span class="nx">colly</span><span class="p">.</span><span class="nf">AllowedDomains</span><span class="p">(</span><span class="s">&#34;www.baidu.com&#34;</span> <span class="p">),</span>
  <span class="p">)</span>

  <span class="nx">c</span><span class="p">.</span><span class="nf">OnHTML</span><span class="p">(</span><span class="s">&#34;a[href]&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">link</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Attr</span><span class="p">(</span><span class="s">&#34;href&#34;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Link found: %q -&gt; %s\n&#34;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">Text</span><span class="p">,</span> <span class="nx">link</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">AbsoluteURL</span><span class="p">(</span><span class="nx">link</span><span class="p">))</span>
  <span class="p">})</span>

  <span class="nx">c</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Visiting&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
  <span class="p">})</span>

  <span class="nx">c</span><span class="p">.</span><span class="nf">OnResponse</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Response %s: %d bytes\n&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">))</span>
  <span class="p">})</span>

  <span class="nx">c</span><span class="p">.</span><span class="nf">OnError</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Error %s: %v\n&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">c</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="s">&#34;http://www.baidu.com/&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The use of <code>colly</code> is relatively simple.</p>
<p>First, call <code>colly.NewCollector()</code> to create a crawler object of type <code>*colly.Collector</code>. Since each page has many links to other pages. If left unrestricted, the run may never stop. So the above restricts to crawl only pages with domain <code>www.baidu.com</code> by passing an option <code>colly.AllowedDomains(&quot;www.baidu.com&quot;)</code>.</p>
<p>Then we call the <code>c.OnHTML</code> method to register the <code>HTML</code> callback and execute the callback function for each <code>a</code> element that has the <code>href</code> attribute. Here we continue to access the URL pointed to by <code>href</code>, i.e. parse the crawled page and then continue to access links to other pages in the page.</p>
<p>Call the <code>c.OnRequest()</code> method to register the request callback, which is executed each time the request is sent, and simply prints the URL of the request.</p>
<p>Call the <code>c.OnResponse()</code> method to register the response callback, which is executed each time a response is received, and simply prints the URL and response size.</p>
<p>Call <code>c.OnError()</code> method to register the error callback, which is executed when an error occurs in the execution of the request, and here simply prints the URL and the error message.</p>
<p>Finally we call <code>c.Visit()</code> to start accessing the first page.</p>
<p>run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go run main.go
Visiting http://www.baidu.com/
Response http://www.baidu.com/: <span class="m">303317</span> bytes
Link found: <span class="s2">&#34;百度首页&#34;</span> -&gt; /
Link found: <span class="s2">&#34;设置&#34;</span> -&gt; javascript:<span class="p">;</span>
Link found: <span class="s2">&#34;登录&#34;</span> -&gt; https://passport.baidu.com/v2/?login<span class="p">&amp;</span><span class="nv">tpl</span><span class="o">=</span>mn<span class="p">&amp;</span><span class="nv">u</span><span class="o">=</span>http%3A%2F%2Fwww.baidu.com%2F<span class="p">&amp;</span><span class="nv">sms</span><span class="o">=</span><span class="m">5</span>
Link found: <span class="s2">&#34;新闻&#34;</span> -&gt; http://news.baidu.com
Link found: <span class="s2">&#34;hao123&#34;</span> -&gt; https://www.hao123.com
Link found: <span class="s2">&#34;地图&#34;</span> -&gt; http://map.baidu.com
Link found: <span class="s2">&#34;直播&#34;</span> -&gt; https://live.baidu.com/
Link found: <span class="s2">&#34;视频&#34;</span> -&gt; https://haokan.baidu.com/?sfrom<span class="o">=</span>baidu-top
Link found: <span class="s2">&#34;贴吧&#34;</span> -&gt; http://tieba.baidu.com
...
</code></pre></td></tr></table>
</div>
</div><p>After <code>colly</code> crawls the page, it parses the page using <a href="https://darjun.github.io/2020/10/11/godailylib/goquery/">goquery</a>. Then it looks for the registered HTML callback corresponding to the element-selector, and wraps <code>goquery.Selection</code> into a <code>colly.HTMLElement</code> execution callback.</p>
<p>The <code>colly.HTMLElement</code> is actually a simple wrapper around <code>goquery.Selection</code>.</p>
<p>and provides easy-to-use methods for.</p>
<ul>
<li><code>Attr(k string)</code> : returns the attribute of the current element, in the above example we used <code>e.Attr(&quot;href&quot;)</code> to get the <code>href</code> attribute.</li>
<li><code>ChildAttr(goquerySelector, attrName string)</code> : returns the <code>attrName</code> attribute of the first child element selected by <code>goquerySelector</code>.</li>
<li><code>ChildAttrs(goquerySelector, attrName string)</code> : returns the <code>attrName</code> attribute of all child elements selected by <code>goquerySelector</code>, returned as a <code>[]string</code>.</li>
<li><code>ChildText(goquerySelector string)</code> : Splices the text content of the child elements selected by <code>goquerySelector</code> and returns it.</li>
<li><code>ChildTexts(goquerySelector string)</code> : returns a slice of the text content of the child element selected by <code>goquerySelector</code>, returned as a <code>[]string</code>.</li>
<li><code>ForEach(goquerySelector string, callback func(int, *HTMLElement))</code> : Executes a callback <code>callback</code> for each child element selected by <code>goquerySelector</code>.</li>
<li><code>Unmarshal(v interface{})</code> : Unmarshal an HTMLElement object into a structure instance by specifying a tag in goquerySelector format to the structure field.</li>
</ul>
<p>These methods will be used frequently. Here we will introduce the features and usage of colly with some examples.</p>
<h2 id="github-treading">GitHub Treading</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Repository</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Author</span>  <span class="kt">string</span>
  <span class="nx">Name</span>    <span class="kt">string</span>
  <span class="nx">Link</span>    <span class="kt">string</span>
  <span class="nx">Desc</span>    <span class="kt">string</span>
  <span class="nx">Lang</span>    <span class="kt">string</span>
  <span class="nx">Stars</span>   <span class="kt">int</span>
  <span class="nx">Forks</span>   <span class="kt">int</span>
  <span class="nx">Add</span>     <span class="kt">int</span>
  <span class="nx">BuiltBy</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">c</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">(</span>
    <span class="nx">colly</span><span class="p">.</span><span class="nf">MaxDepth</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="p">)</span>


  <span class="nx">repos</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Repository</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
  <span class="nx">c</span><span class="p">.</span><span class="nf">OnHTML</span><span class="p">(</span><span class="s">&#34;.Box .Box-row&#34;</span><span class="p">,</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">repo</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Repository</span><span class="p">{}</span>

    <span class="c1">// author &amp; repository name
</span><span class="c1"></span>    <span class="nx">authorRepoName</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">ChildText</span><span class="p">(</span><span class="s">&#34;h1.h3 &gt; a&#34;</span><span class="p">)</span>
    <span class="nx">parts</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">authorRepoName</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">)</span>
    <span class="nx">repo</span><span class="p">.</span><span class="nx">Author</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nx">repo</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1">// link
</span><span class="c1"></span>    <span class="nx">repo</span><span class="p">.</span><span class="nx">Link</span> <span class="p">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">AbsoluteURL</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nf">ChildAttr</span><span class="p">(</span><span class="s">&#34;h1.h3 &gt;a&#34;</span><span class="p">,</span> <span class="s">&#34;href&#34;</span><span class="p">))</span>

    <span class="c1">// description
</span><span class="c1"></span>    <span class="nx">repo</span><span class="p">.</span><span class="nx">Desc</span> <span class="p">=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">ChildText</span><span class="p">(</span><span class="s">&#34;p.pr-4&#34;</span><span class="p">)</span>

    <span class="c1">// language
</span><span class="c1"></span>    <span class="nx">repo</span><span class="p">.</span><span class="nx">Lang</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nf">ChildText</span><span class="p">(</span><span class="s">&#34;div.mt-2 &gt; span.mr-3 &gt; span[itemprop]&#34;</span><span class="p">))</span>

    <span class="c1">// star &amp; fork
</span><span class="c1"></span>    <span class="nx">starForkStr</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">ChildText</span><span class="p">(</span><span class="s">&#34;div.mt-2 &gt; a.mr-3&#34;</span><span class="p">)</span>
    <span class="nx">starForkStr</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">starForkStr</span><span class="p">),</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">parts</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">starForkStr</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
    <span class="nx">repo</span><span class="p">.</span><span class="nx">Stars</span> <span class="p">,</span> <span class="nx">_</span><span class="p">=</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nx">repo</span><span class="p">.</span><span class="nx">Forks</span> <span class="p">,</span> <span class="nx">_</span><span class="p">=</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1">// add
</span><span class="c1"></span>    <span class="nx">addStr</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">ChildText</span><span class="p">(</span><span class="s">&#34;div.mt-2 &gt; span.float-sm-right&#34;</span><span class="p">)</span>
    <span class="nx">parts</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">addStr</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
    <span class="nx">repo</span><span class="p">.</span><span class="nx">Add</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1">// built by
</span><span class="c1"></span>    <span class="nx">e</span><span class="p">.</span><span class="nf">ForEach</span><span class="p">(</span><span class="s">&#34;div.mt-2 &gt; span.mr-3  img[src]&#34;</span><span class="p">,</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">index</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">img</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">repo</span><span class="p">.</span><span class="nx">BuiltBy</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">BuiltBy</span><span class="p">,</span> <span class="nx">img</span><span class="p">.</span><span class="nf">Attr</span><span class="p">(</span><span class="s">&#34;src&#34;</span><span class="p">))</span>
    <span class="p">})</span>

    <span class="nx">repos</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">repos</span><span class="p">,</span> <span class="nx">repo</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">c</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="s">&#34;https://github.com/trending&#34;</span><span class="p">)</span>
  
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d repositories\n&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">repos</span><span class="p">))</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;first repository:&#34;</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">repo</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">repos</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Author:&#34;</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Author</span><span class="p">)</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Name:&#34;</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We use <code>ChildText</code> to get the author, repository name, language, number of stars and fork, today&rsquo;s additions, etc., and <code>ChildAttr</code> to get the link to the repository, which is a relative path that is converted to an absolute path by calling the <code>e.Request.AbsoluteURL()</code> method.</p>
<p>Run.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go run main.go
<span class="m">25</span> repositories
first repository:
Author: Shopify
Name: dawn
</code></pre></td></tr></table>
</div>
</div><h2 id="baidu-novel-hotlist">Baidu Novel Hotlist</h2>
<p>The web page structure is as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/00db310c7b3346c6b61fd93bc90cfea1.png" alt=" "></p>
<p>The structure of each section is as follows.</p>
<ul>
<li>each hotlist is each in a <code>div.category-wrap_iQLoo</code>.</li>
<li><code>div.index_1Ew5p</code> under the <code>a</code> element is the ranking.</li>
<li>content in <code>div.content_1YWBm</code>.</li>
<li>content in <code>a.title_dIF3B</code> is the title.</li>
<li>two <code>div.intro_1l0wp</code> in content, the first being the author and the second being the type.</li>
<li><code>div.desc_3CTjT</code> in the content is the description.</li>
</ul>
<p>From this we define the structure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Hot</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Rank</span>   <span class="kt">string</span> <span class="s">`selector:&#34;a &gt; div.index_1Ew5p&#34;`</span>
  <span class="nx">Name</span>   <span class="kt">string</span> <span class="s">`selector:&#34;div.content_1YWBm &gt; a.title_dIF3B&#34;`</span>
  <span class="nx">Author</span> <span class="kt">string</span> <span class="s">`selector:&#34;div.content_1YWBm &gt; div.intro_1l0wp:nth-child(2)&#34;`</span>
  <span class="nx">Type</span>   <span class="kt">string</span> <span class="s">`selector:&#34;div.content_1YWBm &gt; div.intro_1l0wp:nth-child(3)&#34;`</span>
  <span class="nx">Desc</span>   <span class="kt">string</span> <span class="s">`selector:&#34;div.desc_3CTjT&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>tag is the CSS selector syntax, which is added so that the <code>HTMLElement.Unmarshal()</code> method can be called directly to populate the <code>Hot</code> object.</p>
<p>Then create the <code>Collector</code> object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">c</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Registration Callback.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">c</span><span class="p">.</span><span class="nf">OnHTML</span><span class="p">(</span><span class="s">&#34;div.category-wrap_iQLoo&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">hot</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Hot</span><span class="p">{}</span>

  <span class="nx">err</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">hot</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;error:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="nx">hots</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">hots</span><span class="p">,</span> <span class="nx">hot</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">c</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Requesting:&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">c</span><span class="p">.</span><span class="nf">OnResponse</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Response:&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">))</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p><code>OnHTML</code> performs <code>Unmarshal</code> on each entry to generate <code>Hot</code> objects.</p>
<p><code>OnRequest/OnResponse</code> simply outputs debugging information.</p>
<p>Then, call <code>c.Visit()</code> to access the URL.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="s">&#34;https://top.baidu.com/board?tab=novel&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Visit error:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
  <span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Finally add some debugging prints.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d hots\n&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">hots</span><span class="p">))</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">hot</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">hots</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;first hot:&#34;</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Rank:&#34;</span><span class="p">,</span> <span class="nx">hot</span><span class="p">.</span><span class="nx">Rank</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Name:&#34;</span><span class="p">,</span> <span class="nx">hot</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Author:&#34;</span><span class="p">,</span> <span class="nx">hot</span><span class="p">.</span><span class="nx">Author</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Type:&#34;</span><span class="p">,</span> <span class="nx">hot</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Desc:&#34;</span><span class="p">,</span> <span class="nx">hot</span><span class="p">.</span><span class="nx">Desc</span><span class="p">)</span>
  <span class="k">break</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Run output.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Requesting: https://top.baidu.com/board?tab=novel
Response: 118083
30 hots
first hot:
Rank: 1
Name: 逆天邪神
Author: 作者：火星引力
Type: 类型：玄幻
Desc: 掌天毒之珠，承邪神之血，修逆天之力，一代邪神，君临天下！  查看更多&gt;
</code></pre></td></tr></table>
</div>
</div><h2 id="unsplash">Unsplash</h2>
<p>I basically get my background images for my articles from unsplash, a site that offers a large, rich, and free collection of images. One problem with this site is that it is slow to access. Since we are learning to crawl, we just use the program to download the images automatically.</p>
<p>The unsplash home page is shown in the following image.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/546a9b7400d64e1d95b6a8aab2ae12f4.png" alt=" "></p>
<p>The web page structure is as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/e42461f1ce7c45208fc4d6149e6219c1.png" alt=" "></p>
<p>But the home page shows all the smaller size images, we click on a link to a particular image:.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/63dcb041db9d41219ecaf9ac2ee00803.png" alt=" "></p>
<p>Because of the three-layer web structure involved (<code>img</code> needs to be accessed once at the end), using a <code>colly.Collector</code> object, the <code>OnHTML</code> callback needs to be set with extra care, putting a relatively large mental burden on the coding. <code>colly</code> supports multiple <code>Collectors</code>, and we use this approach to code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">c1</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">()</span>
  <span class="nx">c2</span> <span class="o">:=</span> <span class="nx">c1</span><span class="p">.</span><span class="nf">Clone</span><span class="p">()</span>
  <span class="nx">c3</span> <span class="o">:=</span> <span class="nx">c1</span><span class="p">.</span><span class="nf">Clone</span><span class="p">()</span>

  <span class="nx">c1</span><span class="p">.</span><span class="nf">OnHTML</span><span class="p">(</span><span class="s">&#34;figure[itemProp] a[itemProp]&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">href</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Attr</span><span class="p">(</span><span class="s">&#34;href&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">href</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
      <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">c2</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">AbsoluteURL</span><span class="p">(</span><span class="nx">href</span><span class="p">))</span>
  <span class="p">})</span>

  <span class="nx">c2</span><span class="p">.</span><span class="nf">OnHTML</span><span class="p">(</span><span class="s">&#34;div._1g5Lu &gt; img[src]&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">src</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Attr</span><span class="p">(</span><span class="s">&#34;src&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">src</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
      <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">c3</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">c1</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Visiting&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">c1</span><span class="p">.</span><span class="nf">OnError</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Visiting&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span> <span class="s">&#34;failed:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We use 3 <code>Collector</code> objects, the first <code>Collector</code> is used to collect the corresponding image links on the home page, then we use the second <code>Collector</code> to access these image links, and finally we let the third <code>Collector</code> to download the images. Above we also registered request and error callbacks for the first <code>Collector</code>.</p>
<p>The third <code>Collector</code> downloads the specific image content and saves it locally to.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ... ignore
</span><span class="c1"></span>  <span class="kd">var</span> <span class="nx">count</span> <span class="kt">uint32</span>
  <span class="nx">c3</span><span class="p">.</span><span class="nf">OnResponse</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fileName</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;images/img%d.jpg&#34;</span><span class="p">,</span> <span class="nx">atomic</span><span class="p">.</span><span class="nf">AddUint32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="nx">fileName</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;saving %s failed:%v\n&#34;</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;saving %s success\n&#34;</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>

  <span class="nx">c3</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;visiting&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above uses <code>atomic.AddUint32()</code> to generate serial numbers for the images.</p>
<p>Run the program and crawl the results.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/d4c3c1aa79a74c3798191c290d9daa3d.png" alt=" "></p>
<h2 id="asynchronous">Asynchronous</h2>
<p>By default, <code>colly</code> crawls web pages synchronously, i.e. one crawls after another, as in the unplash program above. This takes a long time, <code>colly</code> provides asynchronous crawling, we just need to pass the option <code>colly.Async(true)</code> when constructing the <code>Collector</code> object to enable asynchronous: <code>colly.Async(true)</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">c1</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">(</span>
  <span class="nx">colly</span><span class="p">.</span><span class="nf">Async</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>However, since it is an asynchronous crawl, the program needs to wait for <code>Collector</code> to finish processing at the end, otherwise it will exit <code>main</code> early and the program will quit: the</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">c1</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="nx">c2</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="nx">c3</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Running again, much faster 😀.</p>
<h2 id="second-edition">Second Edition</h2>
<p>Scrolling down the unsplash page, we see that the image behind it is loaded asynchronously. Scroll down the page and view the request through the network tab of the chrome browser.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/2c68156cd2f343f0921cbf985c8c6426.png" alt=" "></p>
<p>Requesting the path <code>/photos</code>, setting the <code>per_page</code> and <code>page</code> parameters, returns a JSON array. So there is an alternative way.</p>
<p>Define a structure for each item, where we keep only the necessary fields.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Item</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Id</span>     <span class="kt">string</span>
  <span class="nx">Width</span>  <span class="kt">int</span>
  <span class="nx">Height</span> <span class="kt">int</span>
  <span class="nx">Links</span>  <span class="nx">Links</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Links</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Download</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The JSON is then parsed in the <code>OnResponse</code> callback, and the <code>Visit()</code> method of the <code>Collector</code> responsible for downloading the image is called for each <code>Download</code> link.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">c</span><span class="p">.</span><span class="nf">OnResponse</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">items</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Item</span>
  <span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">items</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">item</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">items</span> <span class="p">{</span>
    <span class="nx">d</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">Links</span><span class="p">.</span><span class="nx">Download</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>To initialize the visit, we set up a pull of 3 pages, 12 per page (consistent with the number of page requests).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">for</span> <span class="nx">page</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">page</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">page</span><span class="o">++</span> <span class="p">{</span>
  <span class="nx">c</span><span class="p">.</span><span class="nf">Visit</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;https://unsplash.com/napi/photos?page=%d&amp;per_page=12&#34;</span><span class="p">,</span> <span class="nx">page</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Run and view the downloaded images at</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/b1e275a9728841e3971d3d7eadea406b.png" alt=" "></p>
<h2 id="request-limits">Request Limits</h2>
<p>Sometimes there are too many concurrent requests and the site will restrict access. That&rsquo;s where <code>LimitRule</code> comes in. To put it plainly, <code>LimitRule</code> is what limits access speed and concurrency.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">LimitRule</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">DomainRegexp</span> <span class="kt">string</span>
  <span class="nx">DomainGlob</span> <span class="kt">string</span>
  <span class="nx">Delay</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
  <span class="nx">RandomDelay</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
  <span class="nx">Parallelism</span>    <span class="kt">int</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The common ones are <code>Delay/RandomDelay/Parallism</code>, which indicate the request-to-request delay, random delay, and concurrency, respectively. Also <strong>must</strong> specify which domains are restricted, set via <code>DomainRegexp</code> or <code>DomainGlob</code>, if neither of these fields is set the <code>Limit()</code> method returns an error. Used in the above example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Limit</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">colly</span><span class="p">.</span><span class="nx">LimitRule</span><span class="p">{</span>
  <span class="nx">DomainRegexp</span><span class="p">:</span> <span class="s">`unsplash\.com`</span><span class="p">,</span>
  <span class="nx">RandomDelay</span><span class="p">:</span>  <span class="mi">500</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">,</span>
  <span class="nx">Parallelism</span><span class="p">:</span>  <span class="mi">12</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We set a random maximum request-to-request delay of 500ms for the domain <code>unsplash.com</code>, with a maximum of 12 concurrent requests.</p>
<h3 id="set-timeout">Set timeout</h3>
<p>Sometimes the network is slow and the <code>http.Client</code> used in <code>colly</code> has a default timeout mechanism, which we can rewrite with the <code>colly.WithTransport()</code> option.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">c</span><span class="p">.</span><span class="nf">WithTransport</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Transport</span><span class="p">{</span>
  <span class="nx">Proxy</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ProxyFromEnvironment</span><span class="p">,</span>
  <span class="nx">DialContext</span><span class="p">:</span> <span class="p">(</span><span class="o">&amp;</span><span class="nx">net</span><span class="p">.</span><span class="nx">Dialer</span><span class="p">{</span>
    <span class="nx">Timeout</span><span class="p">:</span>   <span class="mi">30</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
    <span class="nx">KeepAlive</span><span class="p">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
  <span class="p">}).</span><span class="nx">DialContext</span><span class="p">,</span>
  <span class="nx">MaxIdleConns</span><span class="p">:</span>          <span class="mi">100</span><span class="p">,</span>
  <span class="nx">IdleConnTimeout</span><span class="p">:</span>       <span class="mi">90</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
  <span class="nx">TLSHandshakeTimeout</span><span class="p">:</span>   <span class="mi">10</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
  <span class="nx">ExpectContinueTimeout</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="extensions">Extensions</h2>
<p><code>colly</code> provides some extensions in the subpackage <code>extension</code>, the most common one being the random User-Agent. Usually a website will use the User-Agent to identify whether a request is sent by a browser, and crawlers usually set this Header to disguise themselves as browsers. It is also relatively simple to use.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="s">&#34;github.com/gocolly/colly/v2/extensions&#34;</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">c</span> <span class="o">:=</span> <span class="nx">colly</span><span class="p">.</span><span class="nf">NewCollector</span><span class="p">()</span>
  <span class="nx">extensions</span><span class="p">.</span><span class="nf">RandomUserAgent</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The random User-Agent implementation is also simple: a random one from some pre-defined User-Agent array is set in the Header.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">RandomUserAgent</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Collector</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">c</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">Headers</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;User-Agent&#34;</span><span class="p">,</span> <span class="nx">uaGens</span><span class="p">[</span><span class="nx">rand</span><span class="p">.</span><span class="nf">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">uaGens</span><span class="p">))]())</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>It is not difficult to implement your own extension, for example, if we need to set a specific Header for each request, the extension can be written like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">MyHeader</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Collector</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">c</span><span class="p">.</span><span class="nf">OnRequest</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">colly</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">Headers</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;My-Header&#34;</span><span class="p">,</span> <span class="s">&#34;dj&#34;</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Calling the <code>MyHeader()</code> function with the <code>Collector</code> object is sufficient.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nf">MyHeader</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="summary">Summary</h2>
<p><code>colly</code> is the most popular crawler framework in the Go language, supporting a rich set of features. This article introduces some common features, with examples. Due to space constraints, some advanced features are not covered, such as queues, storage and so on. If you are interested in crawling, you can go deeper.</p>
<hr>
<p>Reference <code>https://darjun.github.io/2021/06/30/godailylib/colly/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/colly/">colly</a>
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/common-ways-to-implement-animations-in-react/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Common Ways to Implement Animations in React</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/rust-lib-structopt/">
            <span class="next-text nav-default">Manual for structopt library</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
