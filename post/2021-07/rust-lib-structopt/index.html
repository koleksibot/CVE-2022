<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Manual for structopt library - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="The standard library provides std::env::args() to get command line arguments, the first value is the name of the program, similar to the way arguments are obtained in other languages:
1 2 3 4 5  letargs: Vec&amp;lt;String&amp;gt;=env::args().collect();letquery=&amp;amp;args[1];letfilename=&amp;amp;args[2];println!(&amp;#34;Searching for {}&amp;#34;,query);println!(&amp;#34;In file {}&amp;#34;,filename);  But in the process of product development, we need more program parameters, and need certain rules and checks, this time we need to use some other libraries to parse these parameters, such as the structopt library." /><meta name="keywords" content="rust,structopt" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/rust-lib-structopt/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Manual for structopt library" />
<meta property="og:description" content="The standard library provides std::env::args() to get command line arguments, the first value is the name of the program, similar to the way arguments are obtained in other languages:
1 2 3 4 5  letargs: Vec&lt;String&gt;=env::args().collect();letquery=&amp;args[1];letfilename=&amp;args[2];println!(&#34;Searching for {}&#34;,query);println!(&#34;In file {}&#34;,filename);  But in the process of product development, we need more program parameters, and need certain rules and checks, this time we need to use some other libraries to parse these parameters, such as the structopt library." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/rust-lib-structopt/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-19T10:50:12+08:00" />
<meta property="article:modified_time" content="2021-07-19T10:50:12+08:00" />

<meta itemprop="name" content="Manual for structopt library">
<meta itemprop="description" content="The standard library provides std::env::args() to get command line arguments, the first value is the name of the program, similar to the way arguments are obtained in other languages:
1 2 3 4 5  letargs: Vec&lt;String&gt;=env::args().collect();letquery=&amp;args[1];letfilename=&amp;args[2];println!(&#34;Searching for {}&#34;,query);println!(&#34;In file {}&#34;,filename);  But in the process of product development, we need more program parameters, and need certain rules and checks, this time we need to use some other libraries to parse these parameters, such as the structopt library."><meta itemprop="datePublished" content="2021-07-19T10:50:12+08:00" />
<meta itemprop="dateModified" content="2021-07-19T10:50:12+08:00" />
<meta itemprop="wordCount" content="1001">
<meta itemprop="keywords" content="rust,structopt," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Manual for structopt library"/>
<meta name="twitter:description" content="The standard library provides std::env::args() to get command line arguments, the first value is the name of the program, similar to the way arguments are obtained in other languages:
1 2 3 4 5  letargs: Vec&lt;String&gt;=env::args().collect();letquery=&amp;args[1];letfilename=&amp;args[2];println!(&#34;Searching for {}&#34;,query);println!(&#34;In file {}&#34;,filename);  But in the process of product development, we need more program parameters, and need certain rules and checks, this time we need to use some other libraries to parse these parameters, such as the structopt library."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Manual for structopt library</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-19 10:50:12 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/tools/"> tools </a>
            </div>
          <span class="more-meta"> 1001 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#structopt-macro"><code>structopt</code> macro</a></li>
        <li><a href="#properties">Properties</a>
          <ul>
            <li><a href="#raw-propertiesmethods">raw properties/methods</a></li>
            <li><a href="#magical-propertiesmethods">magical properties/methods</a></li>
          </ul>
        </li>
        <li><a href="#type">Type</a></li>
        <li><a href="#subcommands">Subcommands</a></li>
        <li><a href="#custom-string-parsing">Custom String Parsing</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>The standard library provides <code>std::env::args()</code> to get command line arguments, the first value is the name of the program, similar to the way arguments are obtained in other languages:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="kd">let</span><span class="w"> </span><span class="n">args</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">args</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Searching for {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;In file {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>But in the process of product development, we need more program parameters, and need certain rules and checks, this time we need to use some other libraries to parse these parameters, such as the <a href="https://crates.io/crates/structopt">structopt</a> library.</p>
<p><code>structopt</code> can easily parse command line arguments into a struct.</p>
<p>Here is an official example, which can be tested with <code>cargo run -- --help</code>: <code>cargo run -- --help</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">PathBuf</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">structopt</span>::<span class="n">StructOpt</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="sd">/// A basic example
</span><span class="sd"></span><span class="cp">#[derive(StructOpt, Debug)]</span><span class="w">
</span><span class="w"></span><span class="cp">#[structopt(name = </span><span class="s">&#34;basic&#34;</span><span class="cp">)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Opt</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// A flag, true if used in the command line. Note doc comment will
</span><span class="c1"></span><span class="w">    </span><span class="c1">// be used for the help message of the flag. The name of the
</span><span class="c1"></span><span class="w">    </span><span class="c1">// argument will be, by default, based on the name of the field.
</span><span class="c1"></span><span class="w">    </span><span class="sd">/// Activate debug mode
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short, long)]</span><span class="w">
</span><span class="w">    </span><span class="n">debug</span>: <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="c1">// The number of occurrences of the `v/verbose` flag
</span><span class="c1"></span><span class="w">    </span><span class="sd">/// Verbose mode (-v, -vv, -vvv, etc.)
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short, long, parse(from_occurrences))]</span><span class="w">
</span><span class="w">    </span><span class="n">verbose</span>: <span class="kt">u8</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Set speed
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short, long, default_value = </span><span class="s">&#34;42&#34;</span><span class="cp">)]</span><span class="w">
</span><span class="w">    </span><span class="n">speed</span>: <span class="kt">f64</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Output file
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short, long, parse(from_os_str))]</span><span class="w">
</span><span class="w">    </span><span class="n">output</span>: <span class="nc">PathBuf</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="c1">// the long option will be translated by default to kebab case,
</span><span class="c1"></span><span class="w">    </span><span class="c1">// i.e. `--nb-cars`.
</span><span class="c1"></span><span class="w">    </span><span class="sd">/// Number of cars
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short = </span><span class="s">&#34;c&#34;</span><span class="cp">, long)]</span><span class="w">
</span><span class="w">    </span><span class="n">nb_cars</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="sd">/// admin_level to consider
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short, long)]</span><span class="w">
</span><span class="w">    </span><span class="n">level</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Files to process
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(name = </span><span class="s">&#34;FILE&#34;</span><span class="cp">, parse(from_os_str))]</span><span class="w">
</span><span class="w">    </span><span class="n">files</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">PathBuf</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Opt</span>::<span class="n">from_args</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{:#?}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>We define a struct: to hold the command line arguments: <code>Opt</code> , which is defined using macros to define some properties of the arguments.
Then with a single line of code <code>let opt = Opt::from_args();</code> we can resolve the command line arguments to an instance of <code>Opt</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/005761d451624a899bf64f0cc7957800.png" alt=" "></p>
<p>The official library provides a lot of <a href="https://github.com/TeXitoi/structopt/tree/master/examples">examples</a> that can be used to understand and learn the functions and usage of structopt.</p>
<p><code>structopt</code> uses parsing as an argument, but by way of macros, which greatly simplifies the use of clap.</p>
<p>First let&rsquo;s see what <code>structopt</code> does to the above example by means of macros.</p>
<h2 id="structopt-macro"><code>structopt</code> macro</h2>
<p><code>structopt</code> implements the <code>structopt::StructOpt</code> trait for <code>Opt</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[allow(unused_variables)]</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span>::<span class="n">structopt</span>::<span class="n">StructOpt</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Opt</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">clap</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">&#39;</span><span class="na">b</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; ::<span class="n">structopt</span>:<span class="err">👏</span>:<span class="nc">App</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="o">&#39;</span><span class="na">b</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>::<span class="n">structopt</span>:<span class="err">👏</span>:<span class="nc">App</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;basic&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">about</span><span class="p">(</span><span class="s">&#34;A basic example&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">version</span><span class="p">(</span><span class="s">&#34;0.1.0&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="bp">Self</span>::<span class="n">augment_clap</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from_clap</span><span class="p">(</span><span class="n">matches</span>: <span class="kp">&amp;</span>::<span class="n">structopt</span>:<span class="err">👏</span>:<span class="nc">ArgMatches</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Opt</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">debug</span>: <span class="nc">matches</span><span class="p">.</span><span class="n">is_present</span><span class="p">(</span><span class="s">&#34;debug&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="n">verbose</span>: <span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}(</span><span class="n">matches</span><span class="p">.</span><span class="n">occurrences_of</span><span class="p">(</span><span class="s">&#34;verbose&#34;</span><span class="p">)),</span><span class="w">
</span><span class="w">            </span><span class="n">speed</span>: <span class="nc">matches</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">value_of</span><span class="p">(</span><span class="s">&#34;speed&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span>::<span class="n">std</span>::<span class="kt">str</span>::<span class="n">FromStr</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="n">unwrap</span><span class="p">())</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">(),</span><span class="w">
</span><span class="w">            </span><span class="n">output</span>: <span class="nc">matches</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">value_of_os</span><span class="p">(</span><span class="s">&#34;output&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span>::<span class="n">std</span>::<span class="n">convert</span>::<span class="nb">From</span>::<span class="n">from</span><span class="p">)</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">(),</span><span class="w">
</span><span class="w">            </span><span class="n">nb_cars</span>: <span class="nc">matches</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">value_of</span><span class="p">(</span><span class="s">&#34;nb-cars&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span>::<span class="n">std</span>::<span class="kt">str</span>::<span class="n">FromStr</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()),</span><span class="w">
</span><span class="w">            </span><span class="n">level</span>: <span class="nc">matches</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">values_of</span><span class="p">(</span><span class="s">&#34;level&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                    </span><span class="n">v</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span>::<span class="n">std</span>::<span class="kt">str</span>::<span class="n">FromStr</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="n">unwrap</span><span class="p">())</span><span class="w">
</span><span class="w">                        </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span><span class="w">                </span><span class="p">})</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="n">files</span>: <span class="nc">matches</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">values_of_os</span><span class="p">(</span><span class="s">&#34;file&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">map</span><span class="p">(</span>::<span class="n">std</span>::<span class="n">convert</span>::<span class="nb">From</span>::<span class="n">from</span><span class="p">).</span><span class="n">collect</span><span class="p">())</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><code>fn clap&lt;'a, 'b&gt;() -&gt; clap::App&lt;'a, 'b&gt;</code> generates a <code>clap::App</code> , the name of this App is what we defined <code>basic</code> , we put no defined about property, so here it takes the comment as about description information, this is the pose used by the clap library, clap application definition Some properties and parameters.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/2bb027cbb7ff4a38af7629b9eb488eed.png" alt=" "></p>
<p>But we use <code>structopt</code> not to create a clap app, but only to parse the parameters and map them into a struct, so the clap app created here is just an object to help handle the parameters.</p>
<p>The <code>augment_clap(app)</code> function is also called in the <code>clap()</code> method, which is defined below and defines the app&rsquo;s arguments.</p>
<p><code>fn from_clap(matches: &amp;ArgMatches) -&gt; Self</code> is mapping the parameters in the clap&rsquo;s App object to Opt&rsquo;s fields.</p>
<p>For example the <code>speed</code> field.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="n">speed</span>: <span class="nc">matches</span><span class="w">
</span><span class="w">    </span><span class="p">.</span><span class="n">value_of</span><span class="p">(</span><span class="s">&#34;speed&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span>::<span class="n">std</span>::<span class="kt">str</span>::<span class="n">FromStr</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="n">unwrap</span><span class="p">())</span><span class="w">
</span><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">(),</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>The way to configure the clap app Args is in the function <code>augment_clap</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/5a76b401b32a4d20a29b52bf545e6bf2.png" alt=" "></p>
<p>The attribute configuration of the arguments is generated according to the definition of each field in Opt.</p>
<p>Thus, when we call <code>let opt = Opt::from_args()</code> in our code, we actually call <code>from_clap(&amp;Self::clap().get_matches())</code>.</p>
<p>As a whole, we can see that <code>structopt</code> actually converts various definitions of macros into clap configurations, and we can learn the complex use of its macros.</p>
<h2 id="properties">Properties</h2>
<p>The struct you define will map to clap::App, and the non-subcommand fields of this struct will map to clap::Arg.
This is set via the attribute <code>#[structopt(...)]</code> is set, so let&rsquo;s take a look at its properties.</p>
<p>The attributes of structopt can be divided into two categories:</p>
<ul>
<li>structopt&rsquo;s own <code>magical method</code> : used by structopt itself, <code>attr = [&quot;whatever&quot;]</code> or <code>attr(args...)</code> format</li>
<li><code>raw attributes</code> : mapped to a method call of <code>clap::Arg/App</code>, <code>#[structopt(raw(...))]</code> format</li>
</ul>
<h3 id="raw-propertiesmethods">raw properties/methods</h3>
<p>property corresponds to <code>clap::App</code> / <code>clap::Arg</code> one by one.</p>
<p>Format.</p>
<p><code>#[structopt(method_name = single_arg)]</code> or <code>#[structopt(method_name(arg1, arg2))]</code></p>
<h3 id="magical-propertiesmethods">magical properties/methods</h3>
<p>For example, <code>name</code>, <code>version</code>, <code>no_version</code>, <code>author</code>, <code>about</code>, <code>short</code>, <code>long</code>, <code>rename_all</code>, <code>parse</code>, <code>skip</code>, <code>flatten</code>, <code>subcommand</code>.</p>
<p>For details, see: <a href="https://docs.rs/structopt/0.3.2/structopt/#magical-methods">Magical methods</a>.</p>
<h2 id="type">Type</h2>
<p>A number of built-in types are defined, along with corresponding clap methods.</p>
<ul>
<li>bool: <code>.takes_value(false).multiple(false)</code>。</li>
<li>Option&lt;T: FromStr&gt;: <code>.takes_value(true).multiple(false)</code>。</li>
<li>Option&lt;Option&lt;T: FromStr&raquo;: <code>.takes_value(true).multiple(false).min_values(0).max_values(1)</code>。</li>
<li>Vec&lt;T: FromStr&gt;: <code>.takes_value(true).multiple(true)</code>。</li>
<li>Option&lt;Vec&lt;T: FromStr&gt;: <code>.takes_values(true).multiple(true).min_values(0)</code>。</li>
<li>T: FromStr: <code>.takes_value(true).multiple(false).required(! has_default)</code>。</li>
</ul>
<h2 id="subcommands">Subcommands</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(StructOpt)]</span><span class="w">
</span><span class="w"></span><span class="cp">#[structopt(about = </span><span class="s">&#34;the stupid content tracker&#34;</span><span class="cp">)]</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Git</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Add</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(short)]</span><span class="w">
</span><span class="w">        </span><span class="n">interactive</span>: <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(short)]</span><span class="w">
</span><span class="w">        </span><span class="n">patch</span>: <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(parse(from_os_str))]</span><span class="w">
</span><span class="w">        </span><span class="n">files</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">PathBuf</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="p">},</span><span class="w">
</span><span class="w">    </span><span class="n">Fetch</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(long)]</span><span class="w">
</span><span class="w">        </span><span class="n">dry_run</span>: <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(long)]</span><span class="w">
</span><span class="w">        </span><span class="n">all</span>: <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">repository</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="p">},</span><span class="w">
</span><span class="w">    </span><span class="n">Commit</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(short)]</span><span class="w">
</span><span class="w">        </span><span class="n">message</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="cp">#[structopt(short)]</span><span class="w">
</span><span class="w">        </span><span class="n">all</span>: <span class="kt">bool</span>
    <span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="custom-string-parsing">Custom String Parsing</h2>
<p>If the type does not implement the <code>FromStr</code> trait, or if you just want to customize the parsing method, you can set a custom parsing method.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/07/19/0e5dc2a651cb405fb79daf6279eb1f05.png" alt=" "></p>
<p>For more information, see the structureopt documentation <a href="https://docs.rs/structopt">doc.rs/structopt</a>.</p>
<p>When developing cli/terminal applications, if you don&rsquo;t want this declarative way of getting parameters, then you can just use the <a href="https://crates.io/crates/clap">clap</a> library, which is powerful and widely used.</p>
<p>There are also extensions to structopt based libraries.</p>
<ul>
<li><a href="https://crates.io/crates/structopt-toml">structopt-toml</a>: parsing from toml files</li>
<li><a href="https://crates.io/crates/structopt-flags">structopt-flags</a>: a set of reusable flags</li>
</ul>
<p><a href="https://github.com/rust-cli/paw">paw</a> converts rust main functions into c-style main functions with incoming arguments, which can also be used in combination with structopt:.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">prelude</span>::<span class="o">*</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">net</span>::<span class="n">TcpListener</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">// With the &#34;paw&#34; feature enabled in structopt
</span><span class="c1"></span><span class="cp">#[derive(structopt::StructOpt)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Args</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Port to listen on.
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short = </span><span class="s">&#34;p&#34;</span><span class="cp">, long = </span><span class="s">&#34;port&#34;</span><span class="cp">, env = </span><span class="s">&#34;PORT&#34;</span><span class="cp">, default_value = </span><span class="s">&#34;8080&#34;</span><span class="cp">)]</span><span class="w">
</span><span class="w">    </span><span class="n">port</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Address to listen on.
</span><span class="sd"></span><span class="w">    </span><span class="cp">#[structopt(short = </span><span class="s">&#34;a&#34;</span><span class="cp">, long = </span><span class="s">&#34;address&#34;</span><span class="cp">, default_value = </span><span class="s">&#34;127.0.0.1&#34;</span><span class="cp">)]</span><span class="w">
</span><span class="w">    </span><span class="n">address</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="cp">#[paw::main]</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span>: <span class="nc">Args</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TcpListener</span>::<span class="n">bind</span><span class="p">((</span><span class="o">&amp;*</span><span class="n">args</span><span class="p">.</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;listening on {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="n">local_addr</span><span class="p">()</span><span class="o">?</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="n">incoming</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">stream</span><span class="o">?</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">b&#34;hello world!&#34;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><hr>
<p>Refurence <code>https://colobu.com/2019/09/29/rust-lib-per-week-structopt/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/rust/">rust</a>
          <a href="/tags/structopt/">structopt</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/simple-usage-of-colly/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Simple Usage of Colly</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/browser-database-indexeddb-getting-started-tutorial/">
            <span class="next-text nav-default">Browser Database IndexedDB Getting Started Tutorial</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
