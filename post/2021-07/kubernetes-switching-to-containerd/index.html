<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Kubernetes Switching to Containerd - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="1. Environmental preparation Ubuntu 20.04 x5 Etcd 3.4.16 Kubernetes 1.21.1 Containerd 1.3.3 1.1. Handling IPVS Since the new version of Kubernetes Service implementation switches to IPVS, you need to make sure the kernel has IPVS modules loaded; the following command will set the system to automatically load IPVS related modules at boot, and you need to reboot after execution. 1 2 3 4 5 6 7 8 9 10 11" /><meta name="keywords" content="kubernetes,cntainerd" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-07/kubernetes-switching-to-containerd/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Kubernetes Switching to Containerd" />
<meta property="og:description" content="1. Environmental preparation Ubuntu 20.04 x5 Etcd 3.4.16 Kubernetes 1.21.1 Containerd 1.3.3 1.1. Handling IPVS Since the new version of Kubernetes Service implementation switches to IPVS, you need to make sure the kernel has IPVS modules loaded; the following command will set the system to automatically load IPVS related modules at boot, and you need to reboot after execution. 1 2 3 4 5 6 7 8 9 10 11" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-07/kubernetes-switching-to-containerd/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-10T10:54:16+08:00" />
<meta property="article:modified_time" content="2021-07-10T10:54:16+08:00" />

<meta itemprop="name" content="Kubernetes Switching to Containerd">
<meta itemprop="description" content="1. Environmental preparation Ubuntu 20.04 x5 Etcd 3.4.16 Kubernetes 1.21.1 Containerd 1.3.3 1.1. Handling IPVS Since the new version of Kubernetes Service implementation switches to IPVS, you need to make sure the kernel has IPVS modules loaded; the following command will set the system to automatically load IPVS related modules at boot, and you need to reboot after execution. 1 2 3 4 5 6 7 8 9 10 11"><meta itemprop="datePublished" content="2021-07-10T10:54:16+08:00" />
<meta itemprop="dateModified" content="2021-07-10T10:54:16+08:00" />
<meta itemprop="wordCount" content="1982">
<meta itemprop="keywords" content="kubernetes,cntainerd," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kubernetes Switching to Containerd"/>
<meta name="twitter:description" content="1. Environmental preparation Ubuntu 20.04 x5 Etcd 3.4.16 Kubernetes 1.21.1 Containerd 1.3.3 1.1. Handling IPVS Since the new version of Kubernetes Service implementation switches to IPVS, you need to make sure the kernel has IPVS modules loaded; the following command will set the system to automatically load IPVS related modules at boot, and you need to reboot after execution. 1 2 3 4 5 6 7 8 9 10 11"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Kubernetes Switching to Containerd</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-10 10:54:16 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/cloud-native/"> cloud-native </a>
            <a href="/categories/container/"> container </a>
            </div>
          <span class="more-meta"> 1982 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-environmental-preparation">1. Environmental preparation</a>
          <ul>
            <li><a href="#11-handling-ipvs">1.1. Handling IPVS</a></li>
            <li><a href="#12-installing-containerd">1.2. Installing Containerd</a></li>
          </ul>
        </li>
        <li><a href="#2-installing-kubernetes">2. Installing kubernetes</a>
          <ul>
            <li><a href="#21-installing-etcd-cluster">2.1. Installing Etcd Cluster</a></li>
            <li><a href="#22-install-kubeadm">2.2. Install kubeadm</a></li>
            <li><a href="#23-install-kube-apiserver-proxy">2.3. Install kube-apiserver-proxy</a></li>
            <li><a href="#24-install-kubeadm-config">2.4. Install kubeadm-config</a></li>
            <li><a href="#25-pull-up-master">2.5. Pull up master</a></li>
            <li><a href="#26-pull-up-other-master">2.6. Pull up other master</a></li>
            <li><a href="#27-pull-up-other-node">2.7. Pull up other node</a></li>
            <li><a href="#28-other-processing">2.8. Other processing</a></li>
          </ul>
        </li>
        <li><a href="#3-containerd-common-operations">3. Containerd Common Operations</a></li>
        <li><a href="#4-resource-warehouse">4. Resource Warehouse</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-environmental-preparation">1. Environmental preparation</h2>
<ul>
<li>Ubuntu 20.04 x5</li>
<li>Etcd 3.4.16</li>
<li>Kubernetes 1.21.1</li>
<li>Containerd 1.3.3</li>
</ul>
<h3 id="11-handling-ipvs">1.1. Handling IPVS</h3>
<p>Since the new version of <code>Kubernetes</code> <code>Service</code> implementation switches to <code>IPVS</code>, you need to make sure the kernel has <code>IPVS modules</code> loaded; the following command will set the system to automatically load <code>IPVS</code> related modules at boot, and you need to reboot after execution.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Kernel modules</span>
cat &gt; /etc/modules-load.d/50-kubernetes.conf <span class="s">&lt;&lt;EOF
</span><span class="s"># Load some kernel modules needed by kubernetes at boot
</span><span class="s">nf_conntrack
</span><span class="s">br_netfilter
</span><span class="s">ip_vs
</span><span class="s">ip_vs_lc
</span><span class="s">ip_vs_wlc
</span><span class="s">ip_vs_rr
</span><span class="s">ip_vs_wrr
</span><span class="s">ip_vs_lblc
</span><span class="s">ip_vs_lblcr
</span><span class="s">ip_vs_dh
</span><span class="s">ip_vs_sh
</span><span class="s">ip_vs_fo
</span><span class="s">ip_vs_nq
</span><span class="s">ip_vs_sed
</span><span class="s">EOF</span>

<span class="c1"># sysctl</span>
cat &gt; /etc/sysctl.d/50-kubernetes.conf <span class="s">&lt;&lt;EOF
</span><span class="s">net.ipv4.ip_forward=1
</span><span class="s">net.bridge.bridge-nf-call-iptables=1
</span><span class="s">net.bridge.bridge-nf-call-ip6tables=1
</span><span class="s">fs.inotify.max_user_watches=525000
</span><span class="s">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>Be sure to check the module loading and kernel parameter settings after the reboot is complete:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># check ipvs modules</span>
➜ ~ lsmod <span class="p">|</span> grep ip_vs
ip_vs_sed              <span class="m">16384</span>  <span class="m">0</span>
ip_vs_nq               <span class="m">16384</span>  <span class="m">0</span>
ip_vs_fo               <span class="m">16384</span>  <span class="m">0</span>
ip_vs_sh               <span class="m">16384</span>  <span class="m">0</span>
ip_vs_dh               <span class="m">16384</span>  <span class="m">0</span>
ip_vs_lblcr            <span class="m">16384</span>  <span class="m">0</span>
ip_vs_lblc             <span class="m">16384</span>  <span class="m">0</span>
ip_vs_wrr              <span class="m">16384</span>  <span class="m">0</span>
ip_vs_rr               <span class="m">16384</span>  <span class="m">0</span>
ip_vs_wlc              <span class="m">16384</span>  <span class="m">0</span>
ip_vs_lc               <span class="m">16384</span>  <span class="m">0</span>
ip_vs                 <span class="m">155648</span>  <span class="m">22</span> ip_vs_wlc,ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_lc,ip_vs_sed
nf_conntrack          <span class="m">139264</span>  <span class="m">1</span> ip_vs
nf_defrag_ipv6         <span class="m">24576</span>  <span class="m">2</span> nf_conntrack,ip_vs
libcrc32c              <span class="m">16384</span>  <span class="m">5</span> nf_conntrack,btrfs,xfs,raid456,ip_vs

<span class="c1"># check sysctl</span>
➜ ~ sysctl -a <span class="p">|</span> grep ip_forward
net.ipv4.ip_forward <span class="o">=</span> <span class="m">1</span>
net.ipv4.ip_forward_update_priority <span class="o">=</span> <span class="m">1</span>
net.ipv4.ip_forward_use_pmtu <span class="o">=</span> <span class="m">0</span>

➜ ~ sysctl -a <span class="p">|</span> grep bridge-nf-call
net.bridge.bridge-nf-call-arptables <span class="o">=</span> <span class="m">1</span>
net.bridge.bridge-nf-call-ip6tables <span class="o">=</span> <span class="m">1</span>
net.bridge.bridge-nf-call-iptables <span class="o">=</span> <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="12-installing-containerd">1.2. Installing Containerd</h3>
<p>Containerd is already included in the default official repository in Ubuntu 20, so all you need to do is apt install it:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Other packages may be used later, so they are installed here together</span>
apt install containerd bridge-utils nfs-common tree -y
</code></pre></td></tr></table>
</div>
</div><p>A successful installation can be verified by executing the <code>ctr images ls</code> command. This section will not describe the <code>Containerd</code> configuration, which will be configured during the <code>Kubernetes</code> installation.</p>
<h2 id="2-installing-kubernetes">2. Installing kubernetes</h2>
<h3 id="21-installing-etcd-cluster">2.1. Installing Etcd Cluster</h3>
<p>Etcd is the core of Kubernetes, so I personally prefer to install it on the host; for the convenience of the host installation I packaged some <code>*-pack</code> kits for quick processing:</p>
<p>Installing CFSSL and ETCD</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Download the installation package</span>
wget https://github.com/mritd/etcd-pack/releases/download/v3.4.16/etcd_v3.4.16.run
wget https://github.com/mritd/cfssl-pack/releases/download/v1.5.0/cfssl_v1.5.0.run

<span class="c1"># Install cfssl and etcd</span>
chmod +x *.run
./etcd_v3.4.16.run install
./cfssl_v1.5.0.run install
</code></pre></td></tr></table>
</div>
</div><p>After installation, adjust the IP related to <code>/etc/cfssl/etcd/etcd-csr.json</code> by yourself, and then execute <code>create.sh</code> in the same directory to generate the certificate.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">➜ ~ cat /etc/cfssl/etcd/etcd-csr.json
<span class="o">{</span>
    <span class="s2">&#34;key&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;algo&#34;</span>: <span class="s2">&#34;rsa&#34;</span>,
        <span class="s2">&#34;size&#34;</span>: <span class="m">2048</span>
    <span class="o">}</span>,
    <span class="s2">&#34;names&#34;</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">&#34;O&#34;</span>: <span class="s2">&#34;etcd&#34;</span>,
            <span class="s2">&#34;OU&#34;</span>: <span class="s2">&#34;etcd Security&#34;</span>,
            <span class="s2">&#34;L&#34;</span>: <span class="s2">&#34;Beijing&#34;</span>,
            <span class="s2">&#34;ST&#34;</span>: <span class="s2">&#34;Beijing&#34;</span>,
            <span class="s2">&#34;C&#34;</span>: <span class="s2">&#34;CN&#34;</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">&#34;CN&#34;</span>: <span class="s2">&#34;etcd&#34;</span>,
    <span class="s2">&#34;hosts&#34;</span>: <span class="o">[</span>
        <span class="s2">&#34;127.0.0.1&#34;</span>,
        <span class="s2">&#34;localhost&#34;</span>,
        <span class="s2">&#34;*.etcd.node&#34;</span>,
        <span class="s2">&#34;*.kubernetes.node&#34;</span>,
        <span class="s2">&#34;10.0.0.11&#34;</span>,
        <span class="s2">&#34;10.0.0.12&#34;</span>,
        <span class="s2">&#34;10.0.0.13&#34;</span>
    <span class="o">]</span>
<span class="o">}</span>

<span class="c1"># Copy to 3 masters</span>
➜ ~ <span class="k">for</span> ip in <span class="sb">`</span>seq <span class="m">1</span> 3<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> scp /etc/cfssl/etcd/*.pem root@10.0.0.1<span class="nv">$ip</span>:/etc/etcd/ssl<span class="p">;</span> <span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><p>After the certificate generation is completed, adjust the Etcd configuration file of each machine and then repair the permission to start.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Copy Configuration</span>
<span class="k">for</span> ip in <span class="sb">`</span>seq <span class="m">1</span> 3<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> scp /etc/etcd/etcd.cluster.yaml root@10.0.0.1<span class="nv">$ip</span>:/etc/etcd/etcd.yaml<span class="p">;</span> <span class="k">done</span>

<span class="c1"># Modify Permissions</span>
<span class="k">for</span> ip in <span class="sb">`</span>seq <span class="m">1</span> 3<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> ssh root@10.0.0.1<span class="nv">$ip</span> chown -R etcd:etcd /etc/etcd<span class="p">;</span> <span class="k">done</span>

<span class="c1"># Start-up per machine</span>
systemctl start etcd
</code></pre></td></tr></table>
</div>
</div><p>Verify the cluster status via <code>etcdctl</code> after boot:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># To be on the safe side, you should run etcdctl endpoint health</span>
➜ ~ etcdctl member list
55fcbe0adaa45350, started, etcd3, https://10.0.0.13:2380, https://10.0.0.13:2379, <span class="nb">false</span>
cebdf10928a06f3c, started, etcd1, https://10.0.0.11:2380, https://10.0.0.11:2379, <span class="nb">false</span>
f7a9c20602b8532e, started, etcd2, https://10.0.0.12:2380, https://10.0.0.12:2379, <span class="nb">false</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-install-kubeadm">2.2. Install kubeadm</h3>
<p>kubeadm Chinese users are recommended to use aliyun&rsquo;s installation source:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># kubeadm</span>
apt-get install -y apt-transport-https
curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="p">|</span> apt-key add -
cat <span class="s">&lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list
</span><span class="s">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
</span><span class="s">EOF</span>
apt update

<span class="c1"># ebtables, ethtool kubelet may be used, I forget the details, anyway, from the official documentation</span>
apt install kubelet kubeadm kubectl ebtables ethtool -y
</code></pre></td></tr></table>
</div>
</div><h3 id="23-install-kube-apiserver-proxy">2.3. Install kube-apiserver-proxy</h3>
<p>kube-apiserver-proxy is a four-tier proxy-only Nginx that I compiled myself to listen to 127.0.0.1:6443 and load to all Api Server addresses (0.0.0.0:5443):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">wget https://github.com/mritd/kube-apiserver-proxy-pack/releases/download/v1.20.0/kube-apiserver-proxy_v1.20.0.run
chmod +x *.run
./kube-apiserver-proxy_v1.20.0.run install
</code></pre></td></tr></table>
</div>
</div><p>After the installation is complete, adjust your Nginx configuration file according to your IP address, and then start:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">➜</span> <span class="p">~</span> <span class="sr">cat</span> <span class="s">/etc/kubernetes/apiserver-proxy.conf</span>
<span class="s">error_log</span> <span class="s">syslog:server=unix:/dev/log</span> <span class="s">notice</span><span class="p">;</span>

<span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
<span class="k">events</span> <span class="p">{</span>
        <span class="kn">multi_accept</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">use</span> <span class="s">epoll</span><span class="p">;</span>
        <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">stream</span> <span class="p">{</span>
    <span class="kn">upstream</span> <span class="s">kube_apiserver</span> <span class="p">{</span>
        <span class="kn">least_conn</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.11</span><span class="p">:</span><span class="mi">5443</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.12</span><span class="p">:</span><span class="mi">5443</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.13</span><span class="p">:</span><span class="mi">5443</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span>        <span class="n">0.0.0.0</span><span class="p">:</span><span class="mi">6443</span><span class="p">;</span>
        <span class="kn">proxy_pass</span>    <span class="s">kube_apiserver</span><span class="p">;</span>
        <span class="kn">proxy_timeout</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">1s</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">systemctl</span> <span class="s">start</span> <span class="s">kube-apiserver-proxy</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="24-install-kubeadm-config">2.4. Install kubeadm-config</h3>
<p>kubeadm-config is a combination of a series of configuration files and a package of the necessary image files required for a kubeadm installation, which will automatically configure Containerd, ctrictl, etc. after installation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">wget https://github.com/mritd/kubeadm-config-pack/releases/download/v1.21.1/kubeadm-config_v1.21.1.run
chmod +x *.run

<span class="c1"># The --load option is used to load the required image of kubeadm into containerd</span>
./kubeadm-config_v1.21.1.run install --load
</code></pre></td></tr></table>
</div>
</div><h4 id="241-containerd-configuration">2.4.1. containerd configuration</h4>
<p>The Containerd configuration is located in <code>/etc/containerd/config.toml</code> and is configured as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="nx">version</span> <span class="p">=</span> <span class="mi">2</span>
<span class="c"># Specify the storage root directory</span>
<span class="nx">root</span> <span class="p">=</span> <span class="s2">&#34;/data/containerd&#34;</span>
<span class="nx">state</span> <span class="p">=</span> <span class="s2">&#34;/run/containerd&#34;</span>
<span class="c"># OOM Rating</span>
<span class="nx">oom_score</span> <span class="p">=</span> <span class="mi">-999</span>

<span class="p">[</span><span class="nx">grpc</span><span class="p">]</span>
  <span class="nx">address</span> <span class="p">=</span> <span class="s2">&#34;/run/containerd/containerd.sock&#34;</span>

<span class="p">[</span><span class="nx">metrics</span><span class="p">]</span>
  <span class="nx">address</span> <span class="p">=</span> <span class="s2">&#34;127.0.0.1:1234&#34;</span>

<span class="p">[</span><span class="nx">plugins</span><span class="p">]</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">]</span>
    <span class="c"># sandbox mirror</span>
    <span class="nx">sandbox_image</span> <span class="p">=</span> <span class="s2">&#34;k8s.gcr.io/pause:3.4.1&#34;</span>
    <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">]</span>
      <span class="nx">snapshotter</span> <span class="p">=</span> <span class="s2">&#34;overlayfs&#34;</span>
      <span class="nx">default_runtime_name</span> <span class="p">=</span> <span class="s2">&#34;runc&#34;</span>
      <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">]</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">runc</span><span class="p">]</span>
          <span class="nx">runtime_type</span> <span class="p">=</span> <span class="s2">&#34;io.containerd.runc.v2&#34;</span>
          <span class="c"># Turn on systemd cgroup</span>
          <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">runc</span><span class="p">.</span><span class="nx">options</span><span class="p">]</span>
            <span class="nx">SystemdCgroup</span> <span class="p">=</span> <span class="kc">true</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="242-crictl-configuration">2.4.2. crictl configuration</h4>
<p>Switching to Containerd means that the previous docker commands will no longer be available. Containerd comes with a ctr command by default, and the CRI specification comes with a crictl command; the crictl command configuration file is stored in <code>/etc/crictl.yaml</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">runtime-endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///run/containerd/containerd.sock</span><span class="w">
</span><span class="w"></span><span class="nt">image-endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///run/containerd/containerd.sock</span><span class="w">
</span><span class="w"></span><span class="nt">pull-image-on-create</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="243-kubeadm-configuration">2.4.3. kubeadm configuration</h4>
<p>The kubeadm configuration is currently divided into 2 configurations, one is the init configuration for the first boot, and the other is the configuration for other nodes to join to the master; the more important init configuration is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># /etc/kubernetes/kubeadm.yaml</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta2</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">InitConfiguration</span><span class="w">
</span><span class="w"></span><span class="c"># kubeadm token create</span><span class="w">
</span><span class="w"></span><span class="nt">bootstrapTokens</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;c2t0rj.cofbfnwwrb387890&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">nodeRegistration</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># CRI 地址(Containerd)</span><span class="w">
</span><span class="w">  </span><span class="nt">criSocket</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///run/containerd/containerd.sock</span><span class="w">
</span><span class="w">  </span><span class="nt">kubeletExtraArgs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">runtime-cgroups</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/system.slice/containerd.service&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">rotate-server-certificates</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">localAPIEndpoint</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">advertiseAddress</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.0.0.11&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">bindPort</span><span class="p">:</span><span class="w"> </span><span class="m">5443</span><span class="w">
</span><span class="w"></span><span class="c"># kubeadm certs certificate-key</span><span class="w">
</span><span class="w"></span><span class="nt">certificateKey</span><span class="p">:</span><span class="w"> </span><span class="l">31f1e534733a1607e5ba67b2834edd3a7debba41babb1fac1bee47072a98d88b</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta2</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterConfiguration</span><span class="w">
</span><span class="w"></span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kuberentes&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">kubernetesVersion</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;v1.21.1&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">certificatesDir</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/kubernetes/pki&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># Other components of the current control plane only connect to the apiserver on the current host.</span><span class="w">
</span><span class="w"></span><span class="c"># This is the expected behavior, see: https://github.com/kubernetes/kubeadm/issues/2271</span><span class="w">
</span><span class="w"></span><span class="nt">controlPlaneEndpoint</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;127.0.0.1:6443&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">etcd</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">external</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">endpoints</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;https://10.0.0.11:2379&#34;</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;https://10.0.0.12:2379&#34;</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;https://10.0.0.13:2379&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">caFile</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/etcd/ssl/etcd-ca.pem&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">certFile</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/etcd/ssl/etcd.pem&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">keyFile</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/etcd/ssl/etcd-key.pem&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">networking</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">serviceSubnet</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.66.0.0/16&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">podSubnet</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.88.0.1/16&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">dnsDomain</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;cluster.local&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">apiServer</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">extraArgs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">v</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">alsologtostderr</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    audit-log-maxage: &#34;21&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    audit-log-maxbackup: &#34;10&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    audit-log-maxsize: &#34;100&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    audit-log-path: &#34;/var/log/kube-audit/audit.log&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    audit-policy-file: &#34;/etc/kubernetes/audit-policy.yaml&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">authorization-mode</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Node,RBAC&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">event-ttl</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;720h&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">runtime-config</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;api/all=true&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">service-node-port-range</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;30000-50000&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">service-cluster-ip-range</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.66.0.0/16&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    insecure-bind-address: &#34;0.0.0.0&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    insecure-port: &#34;8080&#34;</span><span class="w">
</span><span class="w">    </span><span class="c"># The fraction of requests that will be closed gracefully(GOAWAY) to prevent</span><span class="w">
</span><span class="w">    </span><span class="c"># HTTP/2 clients from getting stuck on a single apiserver.</span><span class="w">
</span><span class="w">    </span><span class="nt">goaway-chance</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.001&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#  extraVolumes:</span><span class="w">
</span><span class="w"></span><span class="c">#  - name: &#34;audit-config&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    hostPath: &#34;/etc/kubernetes/audit-policy.yaml&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    mountPath: &#34;/etc/kubernetes/audit-policy.yaml&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    readOnly: true</span><span class="w">
</span><span class="w"></span><span class="c">#    pathType: &#34;File&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#  - name: &#34;audit-log&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    hostPath: &#34;/var/log/kube-audit&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    mountPath: &#34;/var/log/kube-audit&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    pathType: &#34;DirectoryOrCreate&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">certSANs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="s2">&#34;*.kubernetes.node&#34;</span><span class="w">
</span><span class="w">  </span>- <span class="s2">&#34;10.0.0.11&#34;</span><span class="w">
</span><span class="w">  </span>- <span class="s2">&#34;10.0.0.12&#34;</span><span class="w">
</span><span class="w">  </span>- <span class="s2">&#34;10.0.0.13&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">timeoutForControlPlane</span><span class="p">:</span><span class="w"> </span><span class="l">1m</span><span class="w">
</span><span class="w"></span><span class="nt">controllerManager</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">extraArgs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">v</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">node-cidr-mask-size</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;19&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">deployment-controller-sync-period</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10s&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">experimental-cluster-signing-duration</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;8670h&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">node-monitor-grace-period</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;20s&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">pod-eviction-timeout</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2m&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">terminated-pod-gc-threshold</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;30&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">scheduler</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">extraArgs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">v</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet.config.k8s.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeletConfiguration</span><span class="w">
</span><span class="w"></span><span class="nt">failSwapOn</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w"></span><span class="nt">oomScoreAdj</span><span class="p">:</span><span class="w"> </span>-<span class="m">900</span><span class="w">
</span><span class="w"></span><span class="nt">cgroupDriver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;systemd&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">kubeletCgroups</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/system.slice/kubelet.service&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">nodeStatusUpdateFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span><span class="w"></span><span class="nt">rotateCertificates</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="nt">evictionSoft</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;imagefs.available&#34;: </span><span class="s2">&#34;15%&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;memory.available&#34;: </span><span class="s2">&#34;512Mi&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;nodefs.available&#34;: </span><span class="s2">&#34;15%&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;nodefs.inodesFree&#34;: </span><span class="s2">&#34;10%&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">evictionSoftGracePeriod</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;imagefs.available&#34;: </span><span class="s2">&#34;3m&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;memory.available&#34;: </span><span class="s2">&#34;1m&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;nodefs.available&#34;: </span><span class="s2">&#34;3m&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;nodefs.inodesFree&#34;: </span><span class="s2">&#34;1m&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">evictionHard</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;imagefs.available&#34;: </span><span class="s2">&#34;10%&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;memory.available&#34;: </span><span class="s2">&#34;256Mi&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;nodefs.available&#34;: </span><span class="s2">&#34;10%&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;nodefs.inodesFree&#34;: </span><span class="s2">&#34;5%&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">evictionMaxPodGracePeriod</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="w"></span><span class="nt">imageGCLowThresholdPercent</span><span class="p">:</span><span class="w"> </span><span class="m">70</span><span class="w">
</span><span class="w"></span><span class="nt">imageGCHighThresholdPercent</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w"></span><span class="nt">kubeReserved</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;cpu&#34;: </span><span class="s2">&#34;500m&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;memory&#34;: </span><span class="s2">&#34;512Mi&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">&#34;ephemeral-storage&#34;: </span><span class="s2">&#34;1Gi&#34;</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeproxy.config.k8s.io/v1alpha1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeProxyConfiguration</span><span class="w">
</span><span class="w"></span><span class="c"># kube-proxy specific options here</span><span class="w">
</span><span class="w"></span><span class="nt">clusterCIDR</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.88.0.1/16&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ipvs&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">oomScoreAdj</span><span class="p">:</span><span class="w"> </span>-<span class="m">900</span><span class="w">
</span><span class="w"></span><span class="nt">ipvs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">minSyncPeriod</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span><span class="w">  </span><span class="nt">syncPeriod</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span><span class="w">  </span><span class="nt">scheduler</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;wrr&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Please refer to the official documentation for the specific meaning of the init configuration, compared to the init configuration, the join configuration is relatively simple, but it should be noted that if you need to join as master then you need the controlPlane part, otherwise please comment out the controlPlane.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># /etc/kubernetes/kubeadm-join.yaml</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta2</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">JoinConfiguration</span><span class="w">
</span><span class="w"></span><span class="nt">controlPlane</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">localAPIEndpoint</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">advertiseAddress</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.0.0.12&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">bindPort</span><span class="p">:</span><span class="w"> </span><span class="m">5443</span><span class="w">
</span><span class="w">  </span><span class="nt">certificateKey</span><span class="p">:</span><span class="w"> </span><span class="l">31f1e534733a1607e5ba67b2834edd3a7debba41babb1fac1bee47072a98d88b</span><span class="w">
</span><span class="w"></span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">bootstrapToken</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">apiServerEndpoint</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;127.0.0.1:6443&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;c2t0rj.cofbfnwwrb387890&#34;</span><span class="w">
</span><span class="w">    </span><span class="c"># Please replace with the &#34;--discovery-token-ca-cert-hash&#34; value printed</span><span class="w">
</span><span class="w">    </span><span class="c"># after the kubeadm init command is executed successfully</span><span class="w">
</span><span class="w">    </span><span class="nt">caCertHashes</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;sha256:97590810ae34a82501717e33acfca76f16044f1a365c5ad9a1c66433c386c75c&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">nodeRegistration</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">criSocket</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///run/containerd/containerd.sock</span><span class="w">
</span><span class="w">  </span><span class="nt">kubeletExtraArgs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">runtime-cgroups</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/system.slice/containerd.service&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">rotate-server-certificates</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="25-pull-up-master">2.5. Pull up master</h3>
<p>After adjusting the configuration, pulling up the master node requires only one command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">kubeadm init --config /etc/kubernetes/kubeadm.yaml --upload-certs --ignore-preflight-errors<span class="o">=</span>Swap
</code></pre></td></tr></table>
</div>
</div><p>After pulling up, remember to save the relevant Token for subsequent use.</p>
<h3 id="26-pull-up-other-master">2.6. Pull up other master</h3>
<p>After the first master is started, use the join command to let other masters join; note that the kubeadm-join.yaml configuration requires replacing the caCertHashes with the discovery-token-ca-cert value after the first master is pulled up. in the kubeadm-join.yaml configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">kubeadm join 127.0.0.1:6443 --config /etc/kubernetes/kubeadm-join.yaml --ignore-preflight-errors<span class="o">=</span>Swap
</code></pre></td></tr></table>
</div>
</div><h3 id="27-pull-up-other-node">2.7. Pull up other node</h3>
<p>Pulling up a node is the same as pulling up any other master node, except that the controlPlane section of the configuration needs to be commented out.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># /etc/kubernetes/kubeadm-join.yaml</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta2</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">JoinConfiguration</span><span class="w">
</span><span class="w"></span><span class="c">#controlPlane:</span><span class="w">
</span><span class="w"></span><span class="c">#  localAPIEndpoint:</span><span class="w">
</span><span class="w"></span><span class="c">#    advertiseAddress: &#34;10.0.0.12&#34;</span><span class="w">
</span><span class="w"></span><span class="c">#    bindPort: 5443</span><span class="w">
</span><span class="w"></span><span class="c">#  certificateKey: 31f1e534733a1607e5ba67b2834edd3a7debba41babb1fac1bee47072a98d88b</span><span class="w">
</span><span class="w"></span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">bootstrapToken</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">apiServerEndpoint</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;127.0.0.1:6443&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;c2t0rj.cofbfnwwrb387890&#34;</span><span class="w">
</span><span class="w">    </span><span class="c"># Please replace with the &#34;--discovery-token-ca-cert-hash&#34; value printed</span><span class="w">
</span><span class="w">    </span><span class="c"># after the kubeadm init command is executed successfully</span><span class="w">
</span><span class="w">    </span><span class="nt">caCertHashes</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;sha256:97590810ae34a82501717e33acfca76f16044f1a365c5ad9a1c66433c386c75c&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">nodeRegistration</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">criSocket</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///run/containerd/containerd.sock</span><span class="w">
</span><span class="w">  </span><span class="nt">kubeletExtraArgs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">runtime-cgroups</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/system.slice/containerd.service&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">rotate-server-certificates</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">kubeadm join 127.0.0.1:6443 --config /etc/kubernetes/kubeadm-join.yaml --ignore-preflight-errors<span class="o">=</span>Swap
</code></pre></td></tr></table>
</div>
</div><h3 id="28-other-processing">2.8. Other processing</h3>
<p>Since the kubelet has certificate rotation turned on, there will be a lot of csr requests from new clusters, so just allow them in bulk:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">kubectl get csr <span class="p">|</span> grep Pending <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> xargs kubectl certificate approve
</code></pre></td></tr></table>
</div>
</div><p>Also, in order for the <code>master</code> node to also load the <code>pod</code>, the taint needs to be adjusted:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre></td></tr></table>
</div>
</div><p>Subsequent CNI, etc. are outside the scope of this article</p>
<h2 id="3-containerd-common-operations">3. Containerd Common Operations</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># List Mirror</span>
ctr images ls

<span class="c1"># List k8s images</span>
ctr -n k8s.io images ls

<span class="c1"># Import Mirror</span>
ctr -n k8s.io images import xxxx.tar

<span class="c1"># Export Mirror</span>
ctr -n k8s.io images <span class="nb">export</span> kube-scheduler.tar k8s.gcr.io/kube-scheduler:v1.21.1
</code></pre></td></tr></table>
</div>
</div><h2 id="4-resource-warehouse">4. Resource Warehouse</h2>
<p>All *-pack repositories in this article are located at the following addresses:</p>
<ul>
<li><a href="https://github.com/mritd/cfssl-pack">https://github.com/mritd/cfssl-pack</a></li>
<li><a href="https://github.com/mritd/etcd-pack">https://github.com/mritd/etcd-pack</a></li>
<li><a href="https://github.com/mritd/kube-apiserver-proxy-pack">https://github.com/mritd/kube-apiserver-proxy-pack</a></li>
<li><a href="https://github.com/mritd/kubeadm-config-pack">https://github.com/mritd/kubeadm-config-pack</a></li>
</ul>
<hr>
<p>Reference <code>https://mritd.com/2021/05/29/use-containerd-with-kubernetes/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">kubernetes</a>
          <a href="/tags/cntainerd/">cntainerd</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-07/mysql-crash-safe/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">MySQL Crash Safe</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/npx-tutorial/">
            <span class="next-text nav-default">Npx Tutorial</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
