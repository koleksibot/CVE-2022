<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Pandas Data Processing Concise Tutorial - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="When using Python to process and analyze data, the most used is Pandas. Since Pandas is a very powerful tool and involves a lot of functions, it is often necessary to consult the documentation when using it. Here is a record of some of the functions and knowledge points that you commonly use. Introduction to Pandas Pandas is a data analysis package for python, originally developed by AQR Capital Management" /><meta name="keywords" content="python, pandas" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-10/pandas/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Pandas Data Processing Concise Tutorial" />
<meta property="og:description" content="When using Python to process and analyze data, the most used is Pandas. Since Pandas is a very powerful tool and involves a lot of functions, it is often necessary to consult the documentation when using it. Here is a record of some of the functions and knowledge points that you commonly use. Introduction to Pandas Pandas is a data analysis package for python, originally developed by AQR Capital Management" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-10/pandas/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-23T10:56:27+08:00" />
<meta property="article:modified_time" content="2021-10-23T10:56:27+08:00" />

<meta itemprop="name" content="Pandas Data Processing Concise Tutorial">
<meta itemprop="description" content="When using Python to process and analyze data, the most used is Pandas. Since Pandas is a very powerful tool and involves a lot of functions, it is often necessary to consult the documentation when using it. Here is a record of some of the functions and knowledge points that you commonly use. Introduction to Pandas Pandas is a data analysis package for python, originally developed by AQR Capital Management"><meta itemprop="datePublished" content="2021-10-23T10:56:27+08:00" />
<meta itemprop="dateModified" content="2021-10-23T10:56:27+08:00" />
<meta itemprop="wordCount" content="3677">
<meta itemprop="keywords" content="python,pandas," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pandas Data Processing Concise Tutorial"/>
<meta name="twitter:description" content="When using Python to process and analyze data, the most used is Pandas. Since Pandas is a very powerful tool and involves a lot of functions, it is often necessary to consult the documentation when using it. Here is a record of some of the functions and knowledge points that you commonly use. Introduction to Pandas Pandas is a data analysis package for python, originally developed by AQR Capital Management"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Pandas Data Processing Concise Tutorial</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-10-23 10:56:27 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 3677 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction-to-pandas">Introduction to Pandas</a>
          <ul>
            <li><a href="#series-and-dataframe">Series And DataFrame</a></li>
          </ul>
        </li>
        <li><a href="#pandas-row-column-and-index-operations">Pandas row, column, and index operations</a>
          <ul>
            <li><a href="#pandas-row-column-index-routines">Pandas Row, Column, Index Routines</a></li>
            <li><a href="#loc-and-iloc-in-pandas">loc and iloc in Pandas</a></li>
            <li><a href="#pandas-and-time-series">Pandas and Time Series</a></li>
          </ul>
        </li>
        <li><a href="#pandas-data-types">Pandas data types</a></li>
        <li><a href="#pandas-data-acquisition-and-processing">Pandas data acquisition and processing</a></li>
        <li><a href="#pandas-for-exploring-data">Pandas for exploring data</a>
          <ul>
            <li><a href="#view-data-basics">View Data Basics</a></li>
            <li><a href="#handling-of-abnormal-data">Handling of abnormal data</a></li>
            <li><a href="#summary-statistics-of-data">Summary statistics of data</a></li>
          </ul>
        </li>
        <li><a href="#pandas-apply-function">Pandas&rsquo; apply function</a></li>
        <li><a href="#pandas-panning-functions-shift-and-diff">Pandas panning functions shift() and diff()</a>
          <ul>
            <li><a href="#the-shift-function">The shift() function</a></li>
            <li><a href="#diff-function">diff() function</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When using Python to process and analyze data, the most used is Pandas. Since Pandas is a very powerful tool and involves a lot of functions, it is often necessary to consult the documentation when using it. Here is a record of some of the functions and knowledge points that you commonly use.</p>
<h2 id="introduction-to-pandas">Introduction to Pandas</h2>
<p>Pandas is a data analysis package for python, originally developed by AQR Capital Management in April 2008 and open sourced out at the end of 2009, and is now continued to be developed and maintained by the PyData development team, which focuses on Python data package development and is part of the PyData project. pandas was originally was originally developed as a financial data analysis tool, so pandas provides good support for time series analysis.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/23/d31e595aec6745369c63415e67c897e1.png" alt=""></p>
<p>Pandas is suitable for working with the following types of data.</p>
<ul>
<li>Tabular data with heterogeneous columns, similar to SQL or Excel tables</li>
<li>Ordered and unordered (non-fixed frequency) time series data</li>
<li>Matrix data with row labels, including isomorphic or heterogeneous data</li>
<li>Any other form of observations, statistical data sets, which do not need to be pre-tagged when transferred to the Pandas data structure.</li>
</ul>
<p>Advantages of Pandas.</p>
<ul>
<li>Handles missing data in floating-point and non-floating-point data, represented as NaN</li>
<li>Variable size: insert or delete columns of multidimensional objects such as DataFrame</li>
<li>Automatic, explicit data alignment: explicitly align objects to a set of labels, or ignore labels and automatically align to data in Series, DataFrame calculations</li>
<li>Powerful, flexible group by functionality: split-apply-combine datasets, aggregate, transform data</li>
<li>Easily convert irregular, differently indexed data from Python and NumPy data structures into DataFrame objects.</li>
<li>Slicing, fancy indexing, and subset decomposition of large datasets based on smart tags</li>
<li>Intuitively merge and join datasets</li>
<li>Flexible reshape and pivot datasets</li>
<li>Axis support for structured labels: multiple labels for one scale</li>
<li>Mature IO tools: read data from text files (CSV and other files with delimiter support), Excel files, databases, and other sources, and save/load data using the ultra-fast HDF5 format</li>
<li>Time series: Support date range generation, frequency conversion, moving window statistics, moving window linear regression, date displacement, and other time series functions.</li>
</ul>
<h3 id="series-and-dataframe">Series And DataFrame</h3>
<p>Pandas is based on NumPy and integrates well with other third-party scientific computing support libraries.</p>
<ul>
<li>A Series is a one-dimensional array-like object that consists of a set of data and a set of data sticky notes (i.e., an index) associated with it, producing the simplest Series from a set of data alone.</li>
<li>A DataFrame is a tabular data containing an ordered set of columns, each of which can be a different type of value. a DataFrame can be thought of as a dictionary of multiple Series that share a common index.</li>
</ul>
<p><strong>Series</strong> is a one-dimensional structure, each column of DataFrame is a series (Series), the series structure only has row index (row index), no column name (column name), but the series has Name, dtype and index attributes, where the Name attribute refers to the name of the series. dtype attribute is the type of the sequence value, and index attribute is the index of the sequence. The data type of the data stored in the sequence is the same.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/23/c360204797384ea1b813657bd39c48bc.png" alt=""></p>
<p><strong>DataFrame</strong> stores two-dimensional data. The structure of DataFrame consists of row and column, each row has a row label, each column has a column label, and the row and column are called axis, and the row label and column label are called axis label. Normally, column label is a text type, which is the column name, and row label is a numeric type, which is also called row index.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/23/799d6899ce8c48f69fcea6db039772fe.png" alt=""></p>
<p>For these two data structures, there are two most basic concepts: Axis and Label. For two-dimensional data structures, Axis refers to the rows and columns, and Axis Label refers to the row index and column name, and the data structure to store Axis Label is Index structure. Each row has an index by which the row can be located; each column has a column name by which the column can be located; and the data value of a unique data point (cell) can be uniquely located by the row index and column name.</p>
<p><strong>Axis Labels</strong></p>
<p>The data structure for storing axis labels is Index. For data frames, the row labels (i.e., row indexes) and column names (i.e., column indexes) are stored by Index objects; for sequences, the row indexes are stored by Index objects. The Index object is unmodifiable, similar to a fixed-size array.</p>
<p>For indexes, they can also be accessed by the ordinal number, which is automatically generated and starts from 0.</p>
<p>The most important roles of axis labels are.</p>
<ul>
<li>Uniquely identifies the data and is used to locate it</li>
<li>For data alignment</li>
<li>Get and set a subset of the data set.</li>
</ul>
<p>Both data frame and sequence objects have an attribute index for getting row labels and, for data frames, a columns attribute for getting column labels:.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="o">&gt;&gt;&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Pandas library axis=0, axis=1 axis usage</strong></p>
<p>When I first learned Pandas, I was confused by axis=0 or axis=&lsquo;index&rsquo;, axis=1 or axis=&lsquo;columns&rsquo;, and I often even thought that the book was written wrong and a bit counter-intuitive.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/23/c1d89be6e7aa4a199601d58c7343c86a.png" alt=""></p>
<p>In the figure above.</p>
<ul>
<li>axis = 1: means finding the maximum of all columns along the rows, which represents the horizontal axis.</li>
<li>axis = 0: is the average of all rows along the columns, representing the vertical axis.</li>
</ul>
<h2 id="pandas-row-column-and-index-operations">Pandas row, column, and index operations</h2>
<h3 id="pandas-row-column-index-routines">Pandas Row, Column, Index Routines</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>  <span class="c1"># 输出列名</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>  <span class="c1"># 重命名列名</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]]</span>  <span class="c1"># 只选取想要的列</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># 行列转换</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># 行列转换的简写方式</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>  <span class="c1"># 以c列作为索引</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1"># 重新变为默认的数值索引</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="loc-and-iloc-in-pandas">loc and iloc in Pandas</h3>
<p>The difference between loc and iloc.</p>
<ul>
<li>.loc is mainly based on labels (label), including row labels (index) and column labels (columns), i.e., row names and column names, which can be used loc[index_name,col_name]</li>
<li>.iloc is a position-based index, using the index number of the element on each axis for selection</li>
</ul>
<p>Example code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># .loc的用法</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># 选择index为3的一行，这里的’3’是index的名称，而不是序号</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>  <span class="c1"># 获取index是a的某一行</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]]</span>  <span class="c1"># 获取index为a,b,c的行</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>  <span class="c1"># 获取c到h行，包含c和h（左闭右闭）</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># 筛选出所有A列&gt;5的行</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]]</span>  <span class="c1"># 筛选出所有A列&gt;5的行的C和D列</span>

<span class="c1"># .iloc的用法</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># 选择第四行，下标从0开始</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span> <span class="c1"># 选择第2、4、6行</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># 选择1~3行，和loc不同的是这里是左闭右开</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># 选择1~3行,2~3列</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># 同上</span>
</code></pre></td></tr></table>
</div>
</div><p>Commonly used operations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="pandas-and-time-series">Pandas and Time Series</h3>
<p>Relying on NumPy&rsquo;s datetime64, timedelta64, and other data types, pandas can handle all kinds of time series data, and can also call the time series functions of Python support libraries such as scikits.timeseries.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># 解析时间格式字符串、np.datetime64、datetime.datetime 等多种时间序列数据。</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;1/1/2018&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

<span class="c1"># 生成 DatetimeIndex、TimedeltaIndex、PeriodIndex 等定频日期与时间段序列。</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="c1"># 处理、转换带时区的日期时间数据。</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
<span class="n">dti</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>

<span class="c1"># 按指定频率重采样，并转换为时间序列。</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;2H&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># 用绝对或相对时间差计算日期与时间。</span>
<span class="n">friday</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">friday</span><span class="o">.</span><span class="n">day_name</span><span class="p">())</span>
<span class="n">saturday</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1 day&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">saturday</span><span class="o">.</span><span class="n">day_name</span><span class="p">())</span>
<span class="n">monday</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">()</span> <span class="c1"># 添加 1 个工作日，从星期五跳到星期一</span>
<span class="nb">print</span><span class="p">(</span><span class="n">monday</span><span class="o">.</span><span class="n">day_name</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><p>Slicing for time-indexed data.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;2021&#39;</span><span class="p">]</span> <span class="c1"># 查询整个2021年的</span>
<span class="n">ts</span><span class="p">[</span><span class="s1">&#39;2021-6&#39;</span><span class="p">]</span> <span class="c1"># 查询 2021年6月的</span>
<span class="n">ts</span><span class="p">[</span><span class="s1">&#39;2021-6&#39;</span><span class="p">:</span><span class="s1">&#39;2021-10&#39;</span><span class="p">]</span> <span class="c1"># 6月到10月的</span>
<span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013-1&#39;</span><span class="p">:</span><span class="s1">&#39;2013-2-28 00:00:00&#39;</span><span class="p">]</span> <span class="c1"># 精确时间</span>
<span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013-1-15&#39;</span><span class="p">:</span><span class="s1">&#39;2013-1-15 12:30:00&#39;</span><span class="p">]</span>
<span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2013-01-05&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="pandas-data-types">Pandas data types</h2>
<p>The main data types in Pandas are.</p>
<ul>
<li>float</li>
<li>int</li>
<li>bool</li>
<li>datetime64[ns]</li>
<li>datetime64[ns, tz]</li>
<li>timedelta64[ns]</li>
<li>timedelta[ns]</li>
<li>category</li>
<li>object</li>
</ul>
<p>The default data types are int64 and float64, and the literal type is object.</p>
<p>Correspondence with Python and NumPy types.</p>
<table>
<thead>
<tr>
<th>Pandas types</th>
<th>Python types</th>
<th>NumPy types</th>
<th>Usage Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td>object</td>
<td>str or mixed</td>
<td>string_, unicode_, mixed types</td>
<td>Text or mixed numbers</td>
</tr>
<tr>
<td>int64</td>
<td>int</td>
<td>int_, int8, int16, int32, int64, uint8, uint16, uint32, uint64</td>
<td>Integer numbers</td>
</tr>
<tr>
<td>float64</td>
<td>float</td>
<td>float_, float16, float32, float64</td>
<td>Floating point numbers</td>
</tr>
<tr>
<td>bool</td>
<td>bool</td>
<td>bool_</td>
<td>True/False Boolean</td>
</tr>
<tr>
<td>datetime64[ns]</td>
<td>nan</td>
<td>datetime64[ns]</td>
<td>Date and time</td>
</tr>
<tr>
<td>timedelta[ns]</td>
<td>nan</td>
<td>nan</td>
<td>Distance between two times, time difference</td>
</tr>
<tr>
<td>category</td>
<td>nan</td>
<td>nan</td>
<td>Finite text values, enumerated</td>
</tr>
</tbody>
</table>
<p>Commonly used methods.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>  <span class="c1"># 各字段的数据类型</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>  <span class="c1"># 某个字段的类型</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c1"># 转换类型</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="pandas-data-acquisition-and-processing">Pandas data acquisition and processing</h2>
<p>In daily work, the most used is to read data from Excel and CSV files using Pandas. Another common operation is the conversion into a DataFrame by means of a dict list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;5:00&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2010</span><span class="p">},</span>
     <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;6:00&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="s2">&#34;february&#34;</span><span class="p">},</span>
     <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;9:00&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="s1">&#39;january&#39;</span><span class="p">},</span>
     <span class="p">{</span><span class="s1">&#39;points_h1&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="s1">&#39;june&#39;</span><span class="p">}]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>In addition to this, there are the usual operations such as merging and joining DataFrames in Pandas and reading database data in Pandas.</p>
<h2 id="pandas-for-exploring-data">Pandas for exploring data</h2>
<h3 id="view-data-basics">View Data Basics</h3>
<p>View, check data.</p>
<ul>
<li>head(n): view the first n rows of the DataFrame object</li>
<li>tail(n): view the last n rows of the DataFrame object</li>
<li>shape(): view the number of rows and columns</li>
<li>info(): view index, data type and memory information</li>
<li>describe(): view the summary statistics of numeric columns
<ul>
<li>describe(include=[np.number]) # Specify the number type</li>
<li>describe(include=[np.object]) # Specify the object type</li>
<li>describe(include=[&lsquo;category&rsquo;]) # Specify the column name</li>
</ul>
</li>
<li>value_counts(dropna=False): view the unique values and counts of the Series object</li>
<li>apply(pd.Series.value_counts): view the unique values and counts of each column in the DataFrame object</li>
<li>unique: return the unique value</li>
<li>corr(): return the column-to-column correlation</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter description.</p>
<ul>
<li>method: optional values are {&lsquo;pearson&rsquo;, &lsquo;kendall&rsquo;, &lsquo;spearman&rsquo;}</li>
<li>min_periods: the minimum amount of data to sample</li>
</ul>
<h3 id="handling-of-abnormal-data">Handling of abnormal data</h3>
<p><strong>Checking for null values</strong></p>
<p>There are two methods for checking null values in Pandas, pandas.DataFrame.isna() and pandas.DataFrame.isnull(), both of which I use exactly the same way.</p>
<p>Example usage.</p>
<ul>
<li>isna().sum()</li>
</ul>
<p><strong>Value substitution</strong></p>
<p>Example.</p>
<ul>
<li>replace('-',&lsquo;np.nan&rsquo;): replace &lsquo;-&rsquo; with a Null value</li>
<li>replace(1,&lsquo;one&rsquo;): replace all values equal to 1 with &lsquo;one&rsquo;</li>
<li>replace([1,3],[&lsquo;one&rsquo;,&lsquo;three&rsquo;]): replace 1 with &lsquo;one&rsquo; and 3 with &lsquo;three&rsquo;</li>
</ul>
<p><strong>Delete null values</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter description.</p>
<ul>
<li>axis: it determines whether the axis is a row or a column.
<ul>
<li>If it is 0 or &lsquo;index&rsquo;, then it will delete the row containing the missing value.</li>
<li>If it is 1 or &lsquo;column&rsquo;, then it will delete the column containing the missing value. By default, its value is 0</li>
</ul>
</li>
<li>how: This parameter determines how the function deletes rows or columns. It accepts only two strings, either all or all. by default, it is set to any.
<ul>
<li>any - if there is any null value in the row or column, it will be deleted.</li>
<li>all - if all values are missing from the row or column, it drops the row or column</li>
</ul>
</li>
<li>thresh: it is an integer that specifies the minimum number of non-missing values that prevent a row or column from being missing</li>
<li>subset: it is an array with the names of the rows or columns, which specifies the deletion procedure</li>
<li>inplace: it is a Boolean value that, if set to True, will change the caller DataFrame in place. by default, its value is False</li>
</ul>
<p>Example.</p>
<ul>
<li>dropna(): delete all rows that contain null values</li>
<li>dropna(axis=1): delete all columns that contain null values</li>
<li>dropna(axis=1,fresh=n): delete all rows with less than n non-null values</li>
</ul>
<p><strong>Fill with empty values</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter Description.</p>
<ul>
<li>value: the value used to fill the null value</li>
<li>method: {&lsquo;backfill&rsquo;, &lsquo;bfill&rsquo;, &lsquo;pad&rsquo;, &lsquo;ffill &lsquo;, None}, default None, pad/ffill means backfill, backfill/bfill means forward fill</li>
<li>axis: the axis along which the missing value is filled</li>
<li>inplace: boolean, default is False. if True, fill in place.</li>
<li>limit: int, default is None, if method is specified, then this is the maximum number of consecutive NaN values to be filled forward/backward</li>
<li>downcast: dict, default None, the item in the dictionary is a type-down conversion rule.</li>
</ul>
<p>Example.</p>
<ul>
<li>fillna(x): replace all null values in the DataFrame object with x</li>
<li>fillna(s.mean()): fill with the mean value</li>
<li>fillna(s.median()): fill with the median</li>
</ul>
<p><strong>Remove duplicates</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter Description.</p>
<ul>
<li>subset: Enter the name of the column to be de-duplicated, default is None</li>
<li>keep: There are three optional parameters: &lsquo;first&rsquo;, &lsquo;last&rsquo;, False, and the default value is &lsquo;first&rsquo;. Among them, the
<ul>
<li>first means: Keep the first occurrence of duplicate rows, and delete the following duplicate rows.</li>
<li>last means: Remove duplicates and keep the last occurrence.</li>
<li>False means: Remove all duplicates.</li>
</ul>
</li>
<li>inplace: Boolean value, default is False, whether to remove duplicate items directly on the original data or return a copy after removing duplicate items.</li>
</ul>
<p>Example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="summary-statistics-of-data">Summary statistics of data</h3>
<p>Commonly used statistical functions in Pandas.</p>
<ul>
<li>.count() # Non-null element count</li>
<li>.size() # count with NaN</li>
<li>.min() # min value</li>
<li>.max() # maximum value</li>
<li>.idxmin() # the position of the minimum value, similar to the min function in R</li>
<li>.idxmax() # location of the maximum value, similar to the max function in R</li>
<li>.quantile(0.1) # 10% quantile</li>
<li>.sum() # summation</li>
<li>.mean() # mean value</li>
<li>.median() # median</li>
<li>.mode() # plurality</li>
<li>.var() # variance</li>
<li>.std() # standard deviation</li>
<li>.mad() # mean absolute deviation</li>
<li>.skew() # skewness</li>
<li>.kurt() # kurtosis</li>
</ul>
<p>When we want to view the data in each column of the DataFrame, we can customize a function to conveniently summarize the statistical indicators together (the effect is similar to df.describe()).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">.25</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">.75</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span>
         <span class="n">x</span><span class="o">.</span><span class="n">mad</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">skew</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">kurt</span><span class="p">()],</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;总数&#39;</span><span class="p">,</span> <span class="s1">&#39;最小值&#39;</span><span class="p">,</span> <span class="s1">&#39;最小值位置&#39;</span><span class="p">,</span> <span class="s1">&#39;25%分位数&#39;</span><span class="p">,</span> <span class="s1">&#39;中位数&#39;</span><span class="p">,</span> <span class="s1">&#39;75%分位数&#39;</span><span class="p">,</span> <span class="s1">&#39;均值&#39;</span><span class="p">,</span> <span class="s1">&#39;最大值&#39;</span><span class="p">,</span> <span class="s1">&#39;最大值位数&#39;</span><span class="p">,</span> <span class="s1">&#39;平均绝对偏差&#39;</span><span class="p">,</span> <span class="s1">&#39;方差&#39;</span><span class="p">,</span> <span class="s1">&#39;标准差&#39;</span><span class="p">,</span> <span class="s1">&#39;偏度&#39;</span><span class="p">,</span>
               <span class="s1">&#39;峰度&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span> 
    <span class="c1"># df = pd.DataFrame(status(d1))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="s1">&#39;x3&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="groupby-in-pandas">Groupby() in Pandas</h4>
<p>In the simplest way, specify the columns and statistical functions to be grouped.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span><span class="s1">&#39;col2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Usually the values counted do not have column names, which can be specified by this method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>groupby combined with agg for aggregation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">,</span> <span class="s1">&#39;col3&#39;</span><span class="p">,</span> <span class="s1">&#39;col4&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>The above code is similar to the following SQL.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">avg</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="n">count</span><span class="p">(</span><span class="n">col2</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">df</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
</code></pre></td></tr></table>
</div>
</div><p>Add column name.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">key1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;key1&#34;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&#34;data1&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&#34;col_name&#34;</span><span class="p">:</span> <span class="s2">&#34;count&#34;</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="sorting-sort_values-in-pandas">Sorting sort_values() in Pandas</h4>
<p>Usage.</p>
<ul>
<li>sort_values(col1): sort data by column col1, ascending by default</li>
<li>sort_values(col2, ascending=False): sort data by column col1 in descending order</li>
<li>sort_values([col1,col2], ascending=[True,False]): sort the data by column col1 ascending first, then by column col2 descending</li>
</ul>
<h4 id="pandas-dataframe-traversal">Pandas Dataframe traversal</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;c1&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;c2&#39;</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="pandas-apply-function">Pandas&rsquo; apply function</h2>
<p>The apply() method of Pandas is used to call a function (Python method) that allows this function to perform batch processing on data objects.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">result_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter Description.</p>
<ul>
<li>func: function to be applied to each column or row.</li>
<li>axis: {0 or &lsquo;index&rsquo;, 1 or &lsquo;columns&rsquo;}, default is 0
<ul>
<li>0 or &lsquo;index&rsquo;: function to be applied to each column.</li>
<li>1 or &lsquo;columns&rsquo;: apply the function to each row.</li>
</ul>
</li>
<li>raw: Determines if rows or columns are passed as Series or ndarray objects.
<ul>
<li>False: Passes each row or column as a Series to the function.</li>
<li>True: The passed function will instead receive an ndarray object. You will get better performance if you only apply the NumPy reduction function.</li>
</ul>
</li>
<li>result_type: {&lsquo;expand&rsquo;, &lsquo;reduce&rsquo;, &lsquo;broadcast&rsquo;, None}, these only work if axis=1 (column).
<ul>
<li>&lsquo;expand&rsquo;: list-like results will become columns.</li>
<li>&lsquo;reduce&rsquo;: If possible, a sequence is returned instead of the expanded list-like result. This is the opposite of &lsquo;expand&rsquo;.</li>
<li>&lsquo;broadcast&rsquo;: the result will be broadcast to the DataFrame&rsquo;s original</li>
</ul>
</li>
</ul>
<p>Example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span> <span class="c1"># 自定义</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="c1"># python 内置函数</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># lambda</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="c1"># numpy 等其他库的函数 ufunc</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">first_valid_index</span><span class="p">)</span> <span class="c1"># Pandas 自己的函数</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span> <span class="c1"># Pandas 自己的函数</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="c1"># Pandas 自己的属性</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;tan&#39;</span><span class="p">)</span> <span class="c1"># numpy 的 ufunc 名</span>
<span class="c1"># 多个函数</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">([</span><span class="nb">sum</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span> <span class="c1"># 相当于 .aggregate, 即.agg</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&#34;sum&#34;</span><span class="p">,</span> <span class="s2">&#34;mean&#34;</span><span class="p">]))</span>
<span class="n">ser</span><span class="o">.</span><span class="n">apply</span><span class="p">({</span><span class="s1">&#39;Q1&#39;</span><span class="p">:</span><span class="nb">sum</span><span class="p">,</span> <span class="s1">&#39;Q2&#39;</span><span class="p">:</span><span class="s1">&#39;count&#39;</span><span class="p">})</span> <span class="c1"># 同上</span>
<span class="c1">#SQL中row_number()的实现</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;交易日期&#39;</span><span class="p">])[</span><span class="s1">&#39;交易时间&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="pandas-panning-functions-shift-and-diff">Pandas panning functions shift() and diff()</h2>
<h3 id="the-shift-function">The shift() function</h3>
<p>shift () function is the main function is to make the data in the data box to move, if freq = None, according to the axis setting, line index data remain unchanged, column index data can be moved up and down on the line or left and right on the column; if the line index for the time series, you can set the freq parameter, according to the periods and freq parameter value combination, so that each time the line index occurs periods * freq offset scroll, column index data will not move.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=&lt;</span><span class="n">no_default</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter Description.</p>
<ul>
<li>period: the magnitude of the move, can be positive or negative, the default value is 1,1 means move once, note that here the move is all data, and the index is not moved, after the move there is no corresponding value, the value is assigned to NaN.</li>
<li>freq: DateOffset, timedelta, or time rule string, optional parameter, default value is None, only for time series, if this parameter exists, then the time index will be moved according to the parameter value, and the data value is not changed.</li>
<li>axis: {0, 1, &lsquo;index&rsquo;, &lsquo;columns&rsquo;}, indicates the direction of moving, if it is 0 or &lsquo;index&rsquo; means move up and down, if it is 1 or &lsquo;columns&rsquo;, it will move left and right.</li>
<li>fill_value: the value to be filled for empty rows</li>
</ul>
<h3 id="diff-function">diff() function</h3>
<p>From the official description has been very clear to know the relationship of its shift function: df.diff () = df - df.shift ()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">DataFrame</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Parameter description.</p>
<ul>
<li>periods: the magnitude of the move, int type, default value is 1.</li>
<li>axis: the direction to move, {0 or &lsquo;index&rsquo;, 1 or &lsquo;columns&rsquo;}, if it is 0 or &lsquo;index&rsquo;, then move up and down. If it is 1 or &lsquo;columns&rsquo;, then move left and right.</li>
</ul>
<p>Reference links.</p>
<ul>
<li><a href="https://pandas.pydata.org/docs/reference/index.html">Pandas API reference</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          <a href="/tags/pandas/">pandas</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-10/python-garbage-collector/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python garbage collection mechanism and implementation</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-10/exception-handling-in-python/">
            <span class="next-text nav-default">Python Exception Catching and Handling</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
