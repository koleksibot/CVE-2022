<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>In-depth learning of the Python import mechanism - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="When I was learning Python, I basically skimmed over how to import modules and packages. The reason for this is not only that the syntax of importing is very simple, but also that at the early stage of learning, you will not be involved in large projects, nor will you be writing your own modules and packages, so you will not encounter any problems here. In the process of using" /><meta name="keywords" content="python, import" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-10/python-import/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="In-depth learning of the Python import mechanism" />
<meta property="og:description" content="When I was learning Python, I basically skimmed over how to import modules and packages. The reason for this is not only that the syntax of importing is very simple, but also that at the early stage of learning, you will not be involved in large projects, nor will you be writing your own modules and packages, so you will not encounter any problems here. In the process of using" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-10/python-import/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-20T16:02:26+08:00" />
<meta property="article:modified_time" content="2021-10-20T16:02:26+08:00" />

<meta itemprop="name" content="In-depth learning of the Python import mechanism">
<meta itemprop="description" content="When I was learning Python, I basically skimmed over how to import modules and packages. The reason for this is not only that the syntax of importing is very simple, but also that at the early stage of learning, you will not be involved in large projects, nor will you be writing your own modules and packages, so you will not encounter any problems here. In the process of using"><meta itemprop="datePublished" content="2021-10-20T16:02:26+08:00" />
<meta itemprop="dateModified" content="2021-10-20T16:02:26+08:00" />
<meta itemprop="wordCount" content="4704">
<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="In-depth learning of the Python import mechanism"/>
<meta name="twitter:description" content="When I was learning Python, I basically skimmed over how to import modules and packages. The reason for this is not only that the syntax of importing is very simple, but also that at the early stage of learning, you will not be involved in large projects, nor will you be writing your own modules and packages, so you will not encounter any problems here. In the process of using"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">In-depth learning of the Python import mechanism</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-10-20 16:02:26 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 4704 words </span>
          <span class="more-meta"> 10 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#pythons-import-statement">Python&rsquo;s import statement</a>
          <ul>
            <li><a href="#absolute-import-and-relative-import">Absolute import and relative import</a></li>
            <li><a href="#module-search-path">Module search path</a></li>
          </ul>
        </li>
        <li><a href="#overview-of-the-import-statement-mechanism">Overview of the import statement mechanism</a>
          <ul>
            <li><a href="#sysmodules">sys.modules</a></li>
            <li><a href="#finder-finder-and-loader">Finder finder and loader</a></li>
            <li><a href="#import-hook">import hook</a></li>
            <li><a href="#meta-path-finder">meta path finder</a></li>
            <li><a href="#path-based-finder">path based finder</a></li>
            <li><a href="#module-spec-object">module spec object</a></li>
            <li><a href="#loader-object">loader object</a></li>
            <li><a href="#import-the-relevant-module-properties">Import the relevant module properties</a></li>
          </ul>
        </li>
        <li><a href="#pep-302-new-import-hook">PEP 302: New import hook</a></li>
        <li><a href="#resource-imports">Resource Imports</a>
          <ul>
            <li><a href="#introduction-to-importlibresources">Introduction to importlib.resources</a></li>
          </ul>
        </li>
        <li><a href="#import-tips-and-tricks">Import Tips and Tricks</a>
          <ul>
            <li><a href="#handling-packages-across-python-versions">Handling packages across Python versions</a></li>
            <li><a href="#handling-lost-packages-using-alternative-methods">Handling lost packages: using alternative methods</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When I was learning Python, I basically skimmed over how to import modules and packages. The reason for this is not only that the syntax of importing is very simple, but also that at the early stage of learning, you will not be involved in large projects, nor will you be writing your own modules and packages, so you will not encounter any problems here. In the process of using Python, you will often encounter import errors or failures when deploying or packaging, which is difficult to solve without understanding the relevant mechanism.</p>
<h2 id="pythons-import-statement">Python&rsquo;s import statement</h2>
<p>The import statement is Python&rsquo;s most common import mechanism, but it&rsquo;s not the only way. importlib.import_module() and the built-in <code>__import__()</code> function can both invoke the import mechanism.</p>
<p>Python&rsquo;s import statement actually combines two operations.</p>
<ul>
<li>a search operation that looks for a module based on a specified naming</li>
<li>Bind operation: binds the result of the search to the naming corresponding to the current scope</li>
</ul>
<p>When a module is first imported, Python searches for it, creating a module object and initializing it if it is found, or throwing a ModuleNotFoundError exception if it is not found. As for how to find these modules, Python defines a variety of search strategies, which can be modified and extended by various hooks provided by importlib, etc.</p>
<p>According to the Python 3.3 changlog, the import system now fully implements the PEP 302 proposal, and all import mechanisms are exposed through sys.meta_path, so there are no more implicit import mechanisms.</p>
<h3 id="absolute-import-and-relative-import">Absolute import and relative import</h3>
<p><strong>Relative import</strong> is the default import method prior to Python 2.5 and takes the following form.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">from</span> <span class="nn">.example</span> <span class="kn">import</span> <span class="n">a</span>
<span class="kn">from</span> <span class="nn">..example</span> <span class="kn">import</span> <span class="n">b</span>
<span class="kn">from</span> <span class="nn">...example</span> <span class="kn">import</span> <span class="n">c</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Absolute import</strong>, also called full import, was fully implemented after Python 2.5 and is also advocated in PEP 8, where it is used in the following way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">from</span> <span class="nn">pkg</span> <span class="kn">import</span> <span class="n">foo</span>
<span class="kn">from</span> <span class="nn">pkg.moduleA</span> <span class="kn">import</span> <span class="n">foo</span>
</code></pre></td></tr></table>
</div>
</div><p>With absolute import, we often run into the problem that Python cannot find the corresponding library file because of the location, thus throwing an ImportError exception.</p>
<h3 id="module-search-path">Module search path</h3>
<p>When we want to import a module, the interpreter first looks for built-in modules based on naming, and if it doesn&rsquo;t find one, it goes to the directory in the sys.path list to see if it&rsquo;s in the directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Output results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="p">[</span><span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">CodeHub</span><span class="se">\\</span><span class="s1">LearnPython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">CodeHub</span><span class="se">\\</span><span class="s1">LearnPython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">JetBrains</span><span class="se">\\</span><span class="s1">PyCharm &#39;</span>
 <span class="s1">&#39;2020.1.1</span><span class="se">\\</span><span class="s1">plugins</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">helpers</span><span class="se">\\</span><span class="s1">pycharm_display&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">python37.zip&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">DLLs&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">CodeHub</span><span class="se">\\</span><span class="s1">LearnPython</span><span class="se">\\</span><span class="s1">venv&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">CodeHub</span><span class="se">\\</span><span class="s1">LearnPython</span><span class="se">\\</span><span class="s1">venv</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">site-packages&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">JetBrains</span><span class="se">\\</span><span class="s1">PyCharm &#39;</span>
 <span class="s1">&#39;2020.1.1</span><span class="se">\\</span><span class="s1">plugins</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">helpers</span><span class="se">\\</span><span class="s1">pycharm_matplotlib_backend&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>The initial value of sys.path comes from.</p>
<ul>
<li>the directory where the script is running (or the current directory if the interactive interpreter is open)</li>
<li>PYTHONPATH environment variable (similar to the PATH variable, also consisting of a set of directory names)</li>
<li>The default settings for Python installations</li>
</ul>
<p>Of course, this sys.path can be modified. Note that if the current directory contains a module with the same name as the standard library, the module in the current directory will be used directly instead of the standard module.</p>
<p>If you don&rsquo;t want to modify sys.path and want to extend the search path at the same time, you can use the .pth file. First of all, the contents of the file are simple, just add the path (absolute path) of the library you want to import, one line at a time; then put the file in a specific location, and Python will read the path in the .pth file when it loads the module.</p>
<p>This specific location can be obtained by the site module&rsquo;s getsitepackages method at</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">site</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">getsitepackages</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><p>The result, which varies from platform to platform, is a list of paths, which on Windows is typically the site-packages directory of the corresponding environment (or virtual environment).</p>
<h2 id="overview-of-the-import-statement-mechanism">Overview of the import statement mechanism</h2>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/20/3beafa05552843428ecf90f0b0ab2767.png" alt=""></p>
<p>The following code briefly illustrates the process of importing the load section.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="p">,</span> <span class="s1">&#39;create_module&#39;</span><span class="p">):</span>
    <span class="c1"># It is assumed &#39;exec_module&#39; will also be defined on the loader.</span>
    <span class="c1"># 假定 loader 中已经定义了 `exec_module` 模块</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">ModuleType</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># The import-related module attributes get set here:</span>
<span class="c1"># 和模块导入相关联的属性在这个初始化方法中被设置</span>
<span class="n">_init_module_attrs</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>

<span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">submodule_search_locations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># namespace package</span>
        <span class="c1"># 倘若这个模块是命名空间包</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># unsupported</span>
        <span class="c1"># 不支持命名空间包</span>
        <span class="k">raise</span> <span class="ne">ImportError</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="p">,</span> <span class="s1">&#39;exec_module&#39;</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># Set __loader__ and __package__ if missing.</span>
    <span class="c1"># 如果缺失 `__loader__` 和 `__package__` 属性则要补充</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">raise</span>
<span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Here are some details.</p>
<ul>
<li>Modules need to be cached in modules before the loader executes exec_module: because modules may import themselves, this prevents infinite recursion (worst case) or multiple loads (best case).</li>
<li>If the load fails, then the failed module will be removed from modules. Any modules that already exist or depend on but are successfully loaded are retained &ndash; this is not the same as reloading, which keeps the failed module in sys.modules even if it fails to load.</li>
<li>Module execution is the key step in loading, and is responsible for populating the module&rsquo;s namespace. Module execution will be fully delegated to the loader, which will decide how and what to fill.</li>
<li>The module object created and passed to exec_module for execution may not be the same as the module object that is finally imported.</li>
</ul>
<h3 id="sysmodules">sys.modules</h3>
<p>When the import mechanism is triggered, Python first looks in sys.modules to see if the module has already been introduced, and if it has, it calls it directly, otherwise it proceeds to the next step. Here sys.modules can be thought of as a cache container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Output results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="p">{</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;__main__&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:/CodeHub/LearnPython/test.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_abc&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_abc&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_bootlocale&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_bootlocale&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">_bootlocale.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_codecs&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_codecs&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_codecs_cn&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_codecs_cn&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_collections&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_collections&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_collections_abc&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_collections_abc&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">_collections_abc.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_frozen_importlib&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_frozen_importlib&#39;</span> <span class="p">(</span><span class="n">frozen</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_frozen_importlib_external&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_frozen_importlib_external&#39;</span> <span class="p">(</span><span class="n">frozen</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_functools&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_functools&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_heapq&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_heapq&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_imp&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_imp&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_io&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;io&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_locale&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_locale&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_multibytecodec&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_multibytecodec&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_operator&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_operator&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_signal&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_signal&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_sitebuiltins&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_sitebuiltins&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">_sitebuiltins.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_sre&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_sre&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_stat&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_stat&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_thread&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_thread&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_warnings&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_warnings&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;_weakref&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;_weakref&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;abc&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;abc&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">abc.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;builtins&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;builtins&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;codecs&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;codecs&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">codecs.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;collections&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;collections&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">collections</span><span class="se">\\</span><span class="s1">__init__.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;copyreg&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;copyreg&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">copyreg.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;encodings&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;encodings&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">encodings</span><span class="se">\\</span><span class="s1">__init__.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;encodings.aliases&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;encodings.aliases&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">encodings</span><span class="se">\\</span><span class="s1">aliases.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;encodings.gbk&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;encodings.gbk&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">encodings</span><span class="se">\\</span><span class="s1">gbk.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;encodings.latin_1&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;encodings.latin_1&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">encodings</span><span class="se">\\</span><span class="s1">latin_1.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;encodings.utf_8&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;encodings.utf_8&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">encodings</span><span class="se">\\</span><span class="s1">utf_8.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;enum&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;enum&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">enum.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;functools&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;functools&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">functools.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;genericpath&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;genericpath&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">genericpath.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;heapq&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;heapq&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">heapq.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;io&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;io&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">io.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;itertools&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;itertools&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;keyword&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">keyword.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;linecache&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;linecache&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">linecache.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;marshal&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;marshal&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;nt&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;nt&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;ntpath&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;ntpath&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">ntpath.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;operator&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">operator.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;os&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">os.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;os.path&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;ntpath&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">ntpath.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;pprint&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;pprint&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">pprint.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;re&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;re&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">re.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;reprlib&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;reprlib&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">reprlib.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;site&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">site.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;sitecustomize&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;sitecustomize&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">JetBrains</span><span class="se">\\</span><span class="s1">PyCharm 2020.1.1</span><span class="se">\\</span><span class="s1">plugins</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">helpers</span><span class="se">\\</span><span class="s1">pycharm_matplotlib_backend</span><span class="se">\\</span><span class="s1">sitecustomize.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;sre_compile&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;sre_compile&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">sre_compile.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;sre_constants&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;sre_constants&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">sre_constants.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;sre_parse&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;sre_parse&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">sre_parse.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;stat&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">stat.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;sys&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;sys&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;token&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">token.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;tokenize&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;tokenize&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">tokenize.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;traceback&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">traceback.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;types&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;types&#39;</span> <span class="kn">from</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">Program Files</span><span class="se">\\</span><span class="s1">Python37</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">types.py&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;winreg&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;winreg&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;zipimport&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;zipimport&#39;</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span><span class="o">&gt;</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>sys.modules is essentially a dictionary whose corresponding values are the respective module objects if they have been imported before. During import, if the key corresponding to the module name is found in sys.modules, its value is retrieved and the import is completed. If the value is None, a ModuleNotFoundError exception is thrown; otherwise, the search operation is performed.</p>
<p>sys.modules is modifiable, forcing the value None will cause the next import of the module to throw a MoudleNotFoundError exception; if the key is deleted, the next import will trigger a search operation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">import</span> <span class="nn">os</span>
</code></pre></td></tr></table>
</div>
</div><p>Post-execution exception.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;D:/CodeHub/LearnPython/test.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">4</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">import</span> <span class="nn">os</span>
<span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">of</span> <span class="n">os</span> <span class="n">halted</span><span class="p">;</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span>
</code></pre></td></tr></table>
</div>
</div><p>The best way to recover is to delete the key of sys.modules (side effect: the module object of the module with the same name imported before and after is not the same), and the best practice should be to use the importlib.reload() function.</p>
<h3 id="finder-finder-and-loader">Finder finder and loader</h3>
<p>If the corresponding module is found in sys.modules and the import is triggered by an import statement, then the next step is to bind the corresponding variable to a local variable.</p>
<p>If the module object is not found in the cache, Python will find and load the module according to the import protocol. This protocol, introduced in PEP 320, has two main components: finder and loader. finder&rsquo;s task is to determine whether a module of that name can be found according to a known policy. An object that implements both the finder and loader interfaces is called an importer &ndash; it returns itself when it finds the required module that can be loaded.</p>
<p>In the process, Python iterates over sys.meta_path to find if there is a meta path finder that matches. sys.meta_path is a list of meta path finders. It has three default finders.</p>
<ul>
<li>built-in module finder</li>
<li>Frozen module finder</li>
<li>path-based module finder.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Output.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">_frozen_importlib</span><span class="o">.</span><span class="n">BuiltinImporter</span><span class="s1">&#39;&gt;,</span>
 <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">_frozen_importlib</span><span class="o">.</span><span class="n">FrozenImporter</span><span class="s1">&#39;&gt;,</span>
 <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">_frozen_importlib_external</span><span class="o">.</span><span class="n">PathFinder</span><span class="s1">&#39;&gt;]</span>
</code></pre></td></tr></table>
</div>
</div><p>The finder&rsquo;s find_spec method determines whether the finder can handle the module to be introduced and returns a ModuleSpec object that contains the relevant information used to load this module. If no suitable ModuleSpec object is returned, then the system will look at the next meta path finder for sys.meta_path. If no suitable meta path finder is found by traversing sys.meta_path, ModuleNotFoundError will be thrown. this happens when introducing a non-existent module, as all the finders in sys.meta_path are unable to handle this case.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">nosuchmodule</span>
</code></pre></td></tr></table>
</div>
</div><p>Return.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;D:/CodeHub/LearnPython/test.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">import</span> <span class="nn">nosuchmodule</span>
<span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;nosuchmodule&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>However, if this manually adds a finder that can handle this module, then it can also be introduced.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">importlib.abc</span> <span class="kn">import</span> <span class="n">MetaPathFinder</span>
<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">ModuleSpec</span>


<span class="k">class</span> <span class="nc">NoSuchModuleFinder</span><span class="p">(</span><span class="n">MetaPathFinder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">find_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ModuleSpec</span><span class="p">(</span><span class="s1">&#39;nosuchmodule&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">NoSuchModuleFinder</span><span class="p">()]</span>
<span class="kn">import</span> <span class="nn">nosuchmodule</span>
</code></pre></td></tr></table>
</div>
</div><p>Post-execution exception.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;D:/CodeHub/LearnPython/test.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">12</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">import</span> <span class="nn">nosuchmodule</span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">missing</span> <span class="n">loader</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, the ModuleNotFound exception is not thrown when we tell the system how to find_spec. But to successfully load a module, a loader loader is also needed.</p>
<p>The loader is a property of the ModuleSpec object that determines how a module is loaded and executed. In the loader, you can decide exactly how to load and execute a module. The decision here is not just to load and execute the module itself, you can even modify a module:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">ModuleType</span>
<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">ModuleSpec</span>
<span class="kn">from</span> <span class="nn">importlib.abc</span> <span class="kn">import</span> <span class="n">MetaPathFinder</span><span class="p">,</span> <span class="n">Loader</span>


<span class="k">class</span> <span class="nc">Module</span><span class="p">(</span><span class="n">ModuleType</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">ExampleLoader</span><span class="p">(</span><span class="n">Loader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Module</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exec_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="n">module</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>


<span class="k">class</span> <span class="nc">ExampleFinder</span><span class="p">(</span><span class="n">MetaPathFinder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">find_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ModuleSpec</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">ExampleLoader</span><span class="p">())</span>


<span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">ExampleFinder</span><span class="p">()]</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">module</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see from the above example, a loader usually has two important methods create_module and exec_module that need to be implemented. If the exec_module method is implemented, then create_module is required. If this import mechanism is initiated by an import statement, then the variables corresponding to the module object returned by the create_module method will be bound to the current local variables. If a module is thus successfully loaded, it will be cached in sys.modules, and if the module is loaded again, the sys.modules cache will be referenced directly.</p>
<p>Note that before Python 3.4 finder would return the loader directly instead of the module spec, which actually already contains the loader.</p>
<h3 id="import-hook">import hook</h3>
<p>For simplicity, we did not mention the import mechanism hook in the flowchart above, but you can actually add a hook to change sys.meta_path or sys.path to change the behavior of the import mechanism. In the example above, we modified sys.meta_path directly, but you can actually do that with a hook.</p>
<p>The import hook is used to extend the import mechanism, and it comes in two types.</p>
<ul>
<li>The meta hook is called at the very beginning of the import (after looking for cached modules), where you can overload the handling of sys.path, frozen module and even built-in modules. Just add a new finder to sys.meta_path to register the meta_hook.</li>
<li>import path hooks are called when path (or package.<strong>path</strong>) is processed and they take care of the entries in sys.path. Just add a new callable to sys.path_hooks to register the import path hook.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">ModuleType</span>
<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">ModuleSpec</span>
<span class="kn">from</span> <span class="nn">importlib.abc</span> <span class="kn">import</span> <span class="n">MetaPathFinder</span><span class="p">,</span> <span class="n">Loader</span>


<span class="k">class</span> <span class="nc">Module</span><span class="p">(</span><span class="n">ModuleType</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">ExampleLoader</span><span class="p">(</span><span class="n">Loader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Module</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exec_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="n">module</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>


<span class="k">class</span> <span class="nc">ExampleFinder</span><span class="p">(</span><span class="n">MetaPathFinder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">find_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ModuleSpec</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">ExampleLoader</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">example_hook</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="c1"># some conditions here</span>
    <span class="k">return</span> <span class="n">ExampleFinder</span><span class="p">()</span>


<span class="n">sys</span><span class="o">.</span><span class="n">path_hooks</span> <span class="o">=</span> <span class="p">[</span><span class="n">example_hook</span><span class="p">]</span>
<span class="c1"># force to use the hook</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">module</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="meta-path-finder">meta path finder</h3>
<p>The job of the meta path finder is to see if the module can be found. These finders are stored in sys.meta_path for Python to traverse (they can also be returned via the import hook, of course). Each finder must implement the find_spec method. If a finder knows what to do with the module to be introduced, find_spec will return a ModuleSpec object otherwise it returns None.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Take the foo.bar.baz module as an example to illustrate find_spec</p>
<p>Parameter description.</p>
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>fullname</td>
<td>Fully qualified name of the module being imported</td>
<td>foo.bar.baz</td>
</tr>
<tr>
<td>path</td>
<td>A list of paths to use for the search. For top-level modules, this value is None; for child packages, this value is the value of the parent package&rsquo;s <code>__path__</code> property</td>
<td>foo.bar.<code>__path__</code></td>
</tr>
<tr>
<td>target</td>
<td>Existing module objects used as targets for later loading, this value will only be passed in when reloading the module</td>
<td>None</td>
</tr>
</tbody>
</table>
<p>For a single import request that may traverse the meta_path multiple times, the modules added to the example are not yet cached, so each finder (named after mpf) will be called in turn</p>
<ul>
<li>find_spec(&ldquo;foo&rdquo;, None, None)</li>
<li>find_spec(&ldquo;foo.bar&rdquo;, foo.<strong>path</strong>, None)</li>
<li>find_spec(&ldquo;foo.bar.baz&rdquo;, foo.bar.<strong>path</strong>, None)</li>
</ul>
<p>Python 3.4 onwards finder&rsquo;s find_module() has been replaced by find_spec() and deprecated.</p>
<h3 id="path-based-finder">path based finder</h3>
<p>As mentioned above, Python comes with several meta path finders by default: the built-in module finder, the frozen module finder, and the path based finder. Here we will focus on the path based finder.) It is used to search for a series of import paths, each of which is used to find if there is a corresponding module that can be loaded. The default path finder implements all the functions for finding modules in special files on the filesystem, including Python source files (.py files), Python post-compiled code files (.pyc files), and shared library files (.so files). If the Python standard library contains zip imports, then the associated files can also be used to find modules that can be introduced.</p>
<p>The path finder is not limited to files on the filesystem; it can also look up URL databases, or any other address that can be represented as a string. You can use the Hook provided in the previous section to implement module lookups for the same type of address. For example, if you want to import a module by URL, then you can write an import hook to parse the URL and return a path finder.</p>
<p>PathBasedFinder will use three variables that will provide additional paths to the custom import mechanism, including.</p>
<ul>
<li>path</li>
<li>path_hooks</li>
<li>path_importer_cache</li>
</ul>
<p>The <code>__path__</code> attribute of a package is also used.</p>
<p>sys.path is a list of strings that provides a search location for modules and packages. Its entries can come from filesystem directories, zip files, or other &ldquo;locations&rdquo; where modules can potentially be found (see site modules).</p>
<p>Since PathBasedFinder is a meta path finder, it must implement the find_spec() method. The import mechanism searches for import path by calling this method (by passing in the path parameter - it is a list of traversable strings).</p>
<p>Inside find_spec(), it iterates over each entry of path and looks for the PathEntryFinder corresponding to the entry each time. but since this operation can be resource intensive, the PathBasedFinder maintains a cache &ndash; sys.path_ importer_caceh to store the mapping between path entries and finder. Then as long as the entry has been found once the finder will not be matched again.</p>
<p>If there is no key corresponding to a path entry in the cache, each callable object in sys.path_hooks is iterated over. Each of these callable objects accepts a path argument and returns a PathEntryFinder or throws an ImportError exception.</p>
<p>If the entire sys.path_hooks callable does not return a PathEntryFinder, the find_spec() method deposits None in the sys.path_importer_cache and returns None, indicating that the PathBasedFinder could not find the module.</p>
<p>The general flow is shown in the figure.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/20/c727ade22f7849e3aaf24ce0f385141d.png" alt=""></p>
<p>Note that a path finder is different from a meta-path finder. The latter is used in sys.meta_path to be traversed by Python, while the former refers specifically to a path-based finder. The finder doesn&rsquo;t actually know how to do import; its job is just to iterate over each entry on the import path, associating them with some path entry finder that knows how to handle a particular type of path. According to the glossary, the path entry finder is returned by the callable object in the sys.path_hook list (provided it knows how to find the module based on a particular path entry). One can think of PathEntryFinder as a concrete implementation of PathBasedFinder. In fact, if the PathBasedFinder is removed from sys.meta_path, no PathEntryFinder will be called.</p>
<p>Since the PathEntryFinder is responsible for importing modules, initializing packages, and building portions for namespace packages, it also needs to implement the find_spec() method, which takes the following form.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>where.</p>
<ul>
<li>fullname: the fully qualified name of the module</li>
<li>target: optional target module</li>
</ul>
<p>Python 3.4 onwards find_spec() replaces find_loader() and find_module(), the latter two being deprecated.</p>
<p>Note that if the module is a fraction of a namespace package, PathEntryFinder sets the loader in the returned spec object to None and sets submodule_search_locations to a list containing this fraction, to account for it to the import mechanism.</p>
<h3 id="module-spec-object">module spec object</h3>
<p>Each meta path finder must implement the find_spec method, which returns a ModuleSpec object if the finder knows if the module to be introduced is being processed. This object has two properties worth mentioning, one is the name of the module, while the other is the finder. If the finder of a ModuleSpec object is None, then an exception like ImportError: missing loader will be thrown. The finder will be used to create and execute a module.</p>
<p>The module spec has two main roles.</p>
<ul>
<li>Passing &ndash; state information can be passed between different components of the import system, such as finder and loader</li>
<li>template building &ndash; the import mechanism can perform template loading based on module spec, which the loader would have to do without module spec.</li>
</ul>
<p>The module spec is exposed through the <code>__spec__</code> attribute of the module object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">__spec__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>return</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">ModuleSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="n">loader</span><span class="o">=&lt;</span><span class="n">_frozen_importlib_external</span><span class="o">.</span><span class="n">SourceFileLoader</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000019BDAB12148</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">CodeHub</span><span class="se">\\</span><span class="s1">LearnPython</span><span class="se">\\</span><span class="s1">venv</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">site-packages</span><span class="se">\\</span><span class="s1">requests</span><span class="se">\\</span><span class="s1">__init__.py&#39;</span><span class="p">,</span> <span class="n">submodule_search_locations</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">CodeHub</span><span class="se">\\</span><span class="s1">LearnPython</span><span class="se">\\</span><span class="s1">venv</span><span class="se">\\</span><span class="s1">lib</span><span class="se">\\</span><span class="s1">site-packages</span><span class="se">\\</span><span class="s1">requests&#39;</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="loader-object">loader object</h3>
<p>loader is an instance of mportlib.abc.Loader and is responsible for providing the most critical loading functionality: module execution. Its exec_module() method accepts a single argument &ndash; the module object &ndash; and all its return values are ignored.</p>
<p>The loader must satisfy the following conditions.</p>
<ul>
<li>If the module is a Python module (as distinguished from built-in modules and dynamically loaded extensions), the loader should execute the module code in the module&rsquo;s global namespace (<code>__dict__</code>).</li>
<li>If the loader cannot execute the module, an ImportError exception should be thrown.</li>
</ul>
<p>Two changes in Python 3.4.</p>
<ul>
<li>The loader provides create_module() to create a module object (accepts a module spec object and returns the module object). If None is returned, the import mechanism creates the module itself. This is because the module object must exist in modules before the module can be executed.</li>
<li>The load_module() method is replaced by the exec_module() method. For forward compatibility, the import mechanism uses the load_module() method only if load_module() exists and exec_module is not implemented.</li>
</ul>
<h3 id="import-the-relevant-module-properties">Import the relevant module properties</h3>
<p>In the _init_module_attrs step, the import mechanism populates the module object according to the module spec (this process happens before the loader executes the module).</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>__name__</code></td>
<td>Fully qualified name of the module</td>
</tr>
<tr>
<td><code>__loader__</code></td>
<td>The loader object used when the module is loaded, mainly for introspection</td>
</tr>
<tr>
<td><code>__package__</code></td>
<td>Replaces <code>__name__</code> for handling relative imports, must be set! When importing packages, this value is the same as <code>__name__</code>; when importing child packages, it is their parent&rsquo;s name; when it is a top-level module, it should be the empty string</td>
</tr>
<tr>
<td><code>__spec__</code></td>
<td>The module spec object to use when importing</td>
</tr>
<tr>
<td><code>__path__</code></td>
<td>If the module is a package, it must be set! This value is an iterable object and can be null if there is no further use for it, otherwise the iteration result should be a string</td>
</tr>
<tr>
<td><code>__file__</code></td>
<td>Optional, only built-in modules can be set without the <code>__file__</code> attribute</td>
</tr>
<tr>
<td><code>__cached__</code></td>
<td>is the path to the compiled bytecode file, which is independent of the existence of <code>__file__</code>.</td>
</tr>
</tbody>
</table>
<p>Before namespace packages came out, if you wanted to implement namespace package functionality, you generally modified its <code>__path__</code> attribute in the package&rsquo;s <code>__init__</code>.py. With the introduction of PEP420, namespace packages can no longer require this operation in <code>__init__</code>.py.</p>
<h2 id="pep-302-new-import-hook">PEP 302: New import hook</h2>
<p>Please see <a href="https://www.python.org/dev/peps/pep-0302/">https://www.python.org/dev/peps/pep-0302/</a></p>
<h2 id="resource-imports">Resource Imports</h2>
<p>Sometimes you will have code that depends on data files or other resources. In a small script, this is not a problem - you can specify the path to the data file and go on! However, if the resource file is important to your package and you want to distribute your package to other users, a number of challenges arise.</p>
<ul>
<li>You will have no control over the path to the resources, as it depends on your user&rsquo;s settings and how the package is distributed and installed. You can try to figure out the resource path based on your package <code>__file__</code> or <code>__path__</code> attribute, but this may not always work as expected.</li>
<li>Your package may be located in a ZIP file or an old .egg file, in which case the resource will not even be a physical file on the user&rsquo;s system.</li>
</ul>
<p>There have been multiple attempts to address these challenges, including setuptools.pkg_resources. However, with the introduction of the Python 3.7 importlib.resources standard library, there is now a standard way to handle resource files.</p>
<h3 id="introduction-to-importlibresources">Introduction to importlib.resources</h3>
<p>importlib.resources allows access to the resources inside the package. In this case, the resources are any file located in the importable package. The file may or may not correspond to a physical file on the file system. This has several advantages. By reusing the import system, you get a more consistent way to work with the files in the package. It also allows you to access resource files in other packages more easily. If you can import a package, you can access the resources in that package.</p>
<p>importlib.resources became part of the Python 3.7 standard library. However, on older versions of Python, it can be installed by installing importlib_resources.</p>
<p>There is one requirement for using importlib.resources: your resource files must be available in the regular package. Namespace packages are not supported. In practice, this means that the files must be located in the directory containing the <code>__init__</code>.py file.</p>
<p>As a first example, suppose you have resources in a package, as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">books/
│
├── __init__.py
├── alice_in_wonderland.png
└── alice_in_wonderland.txt
</code></pre></td></tr></table>
</div>
</div><p><code>__init__</code>.py is just an empty file that needs to specify books as a regular package.</p>
<p>You can open text and binary files using open_text() and open_binary(), respectively.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">resources</span>

<span class="k">with</span> <span class="n">resources</span><span class="o">.</span><span class="n">open_text</span><span class="p">(</span><span class="s2">&#34;books&#34;</span><span class="p">,</span> <span class="s2">&#34;alice_in_wonderland.txt&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
    <span class="n">alice</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alice</span><span class="p">[:</span><span class="mi">7</span><span class="p">]))</span>

<span class="k">with</span> <span class="n">resources</span><span class="o">.</span><span class="n">open_binary</span><span class="p">(</span><span class="s2">&#34;books&#34;</span><span class="p">,</span> <span class="s2">&#34;alice_in_wonderland.png&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
    <span class="n">cover</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cover</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>open_text() and open_binary() are equivalent to the built-in open() with the described mode parameter sets rt and rb respectively. The convenient function to read text or binary files directly is also available as read_text() and read_binary().</p>
<p>To import on older Python versions you can use the following methods.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">resources</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">importlib_resources</span> <span class="k">as</span> <span class="nn">resources</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="import-tips-and-tricks">Import Tips and Tricks</h2>
<h3 id="handling-packages-across-python-versions">Handling packages across Python versions</h3>
<p>Sometimes you need to handle packages with different names depending on the Python version. As long as the different versions of the package are compatible, you can rename the package to as.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">resources</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">importlib_resources</span> <span class="k">as</span> <span class="nn">resources</span>
</code></pre></td></tr></table>
</div>
</div><p>In the rest of the code, you can refer to resources without worrying that you are using importlib.resources or importlib_resources.</p>
<p>It is usually easiest to use the try&hellip;except statement to determine which version to use. Another option is to check the version of the Python interpreter. However, this may add some maintenance costs if you need to update the version number.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">resources</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">importlib_resources</span> <span class="k">as</span> <span class="nn">resources</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="handling-lost-packages-using-alternative-methods">Handling lost packages: using alternative methods</h3>
<p>Suppose there is a compatible re-implementation of a package. The re-implementation is better optimized, so you want to use it when it is available. However, the original package is more readily available and also offers acceptable performance.</p>
<p>One such example is quicktions, which is an optimized version of fractions from the standard library. You can handle these preferences as you did before with different package names.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">quicktions</span> <span class="kn">import</span> <span class="n">Fraction</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>
</code></pre></td></tr></table>
</div>
</div><p>Another similar example is the UltraJSON package, an ultra-fast JSON encoder and decoder that can be used as a replacement in the json standard library at</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ujson</span> <span class="k">as</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
</code></pre></td></tr></table>
</div>
</div><p>By renaming ujson to json, you don&rsquo;t have to worry about which package is actually being imported.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-10/python-error-unable-to-find-vcvarsall-bat/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python error Unable to find vcvarsall.bat</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-10/python-generator-iterator-iterable/">
            <span class="next-text nav-default">Python Iterators and Generators</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
