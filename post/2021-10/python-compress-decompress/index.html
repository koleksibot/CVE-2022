<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Compressing and Decompressing with Python - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="In your daily work, in addition to using Python to process text files, sometimes you will also be involved in processing compressed files. The compression file formats that are usually involved are rar: the more used compression under Windows environment, the more famous GUI tool is winrar tar: a packaging tool for Linux systems, only packaging, not compression gz: or gzip, usually can only compress one file. Combined with tar," /><meta name="keywords" content="python, Compress, Decompress" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-10/python-compress-decompress/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Compressing and Decompressing with Python" />
<meta property="og:description" content="In your daily work, in addition to using Python to process text files, sometimes you will also be involved in processing compressed files. The compression file formats that are usually involved are rar: the more used compression under Windows environment, the more famous GUI tool is winrar tar: a packaging tool for Linux systems, only packaging, not compression gz: or gzip, usually can only compress one file. Combined with tar," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-10/python-compress-decompress/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-25T21:49:46+08:00" />
<meta property="article:modified_time" content="2021-10-25T21:49:46+08:00" />

<meta itemprop="name" content="Compressing and Decompressing with Python">
<meta itemprop="description" content="In your daily work, in addition to using Python to process text files, sometimes you will also be involved in processing compressed files. The compression file formats that are usually involved are rar: the more used compression under Windows environment, the more famous GUI tool is winrar tar: a packaging tool for Linux systems, only packaging, not compression gz: or gzip, usually can only compress one file. Combined with tar,"><meta itemprop="datePublished" content="2021-10-25T21:49:46+08:00" />
<meta itemprop="dateModified" content="2021-10-25T21:49:46+08:00" />
<meta itemprop="wordCount" content="1470">
<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Compressing and Decompressing with Python"/>
<meta name="twitter:description" content="In your daily work, in addition to using Python to process text files, sometimes you will also be involved in processing compressed files. The compression file formats that are usually involved are rar: the more used compression under Windows environment, the more famous GUI tool is winrar tar: a packaging tool for Linux systems, only packaging, not compression gz: or gzip, usually can only compress one file. Combined with tar,"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Compressing and Decompressing with Python</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-10-25 21:49:46 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1470 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#zip-file">zip file</a></li>
        <li><a href="#targz-file">tar.gz file</a></li>
        <li><a href="#rar-file">rar file</a></li>
        <li><a href="#7z-file">7z file</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>In your daily work, in addition to using Python to process text files, sometimes you will also be involved in processing compressed files.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/25/d0e60decb3a247ff8aa84b99de064d60.png" alt=""></p>
<p>The compression file formats that are usually involved are</p>
<ul>
<li>rar: the more used compression under Windows environment, the more famous GUI tool is winrar</li>
<li>tar: a packaging tool for Linux systems, only packaging, not compression</li>
<li>gz: or gzip, usually can only compress one file. Combined with tar, it can be packaged first, then compressed.</li>
<li>tgz: that is, gz. first pack with tar, then compress with gz to get the file.</li>
<li>zip: different from gzip, although using a similar algorithm, you can package and compress multiple files, but compress the files separately, the compression rate is lower than tar</li>
<li>7z: a format supported by 7zip compression software, with higher compression efficiency.</li>
</ul>
<p>Of course, in addition to using Python, you can also choose to use compression and decompression software or command dynamic processing.</p>
<h2 id="zip-file">zip file</h2>
<p>zipfile is a module used to compress and decompress zip files in Python. zipfile has two very important classes: ZipFile and ZipInfo. zipFile is the main class used to create and read zip files, while ZipInfo stores information about each file in the zip file.</p>
<p>Sample code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">zipfile</span>


<span class="c1"># 压缩</span>
<span class="k">def</span> <span class="nf">make_zip</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">):</span>
    <span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">pre_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">source_dir</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">source_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pathfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">arcname</span> <span class="o">=</span> <span class="n">pathfile</span><span class="p">[</span><span class="n">pre_len</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>  <span class="c1"># 相对路径</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pathfile</span><span class="p">,</span> <span class="n">arcname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="n">zipf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c1"># 解压缩</span>
<span class="k">def</span> <span class="nf">un_zip</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;unzip zip file&#34;&#34;&#34;</span>
    <span class="n">zip_file</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s2">&#34;_files&#34;</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s2">&#34;_files&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
        <span class="n">zip_file</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&#34;_files/&#34;</span><span class="p">)</span>
    <span class="n">zip_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">make_zip</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;E:\python_sample\libs\test_tar_files\libs&#34;</span><span class="p">,</span> <span class="s2">&#34;test.zip&#34;</span><span class="p">)</span>
    <span class="n">un_zip</span><span class="p">(</span><span class="s2">&#34;test.zip&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="targz-file">tar.gz file</h2>
<p>The tarfile module can be used to read and write tar archives, including archives compressed with gzip, bz2 and lzma. The mode must be understood when using tarfile.</p>
<p>mode must be a string of the form &lsquo;filemode[:compression]&rsquo;, whose default value is &lsquo;r&rsquo;. The following is a complete list of mode combinations:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'r' or 'r:*'</code></td>
<td>Open and read using transparent compression (recommended).</td>
</tr>
<tr>
<td><code>'r:'</code></td>
<td>Open and read without compression.</td>
</tr>
<tr>
<td><code>'r:gz'</code></td>
<td>Open and read with gzip compression.</td>
</tr>
<tr>
<td><code>'r:bz2'</code></td>
<td>Open and read with bzip2 compression.</td>
</tr>
<tr>
<td><code>'r:xz'</code></td>
<td>Open and read using lzma compression.</td>
</tr>
<tr>
<td><code>'x' or 'x:'</code></td>
<td>Create tarfile without compression. If the file already exists, a FileExistsError exception is thrown.</td>
</tr>
<tr>
<td><code>'x:gz'</code></td>
<td>Create a tarfile using gzip compression. throw a FileExistsError if the file already exists.</td>
</tr>
<tr>
<td><code>'x:bz2'</code></td>
<td>Create a tarfile using bzip2 compression, or throw a FileExistsError if the file already exists.</td>
</tr>
<tr>
<td><code>'x:xz'</code></td>
<td>Create a tarfile using lzma compression.</td>
</tr>
<tr>
<td><code>'a' or 'a:'</code></td>
<td>Open to append without compression. If the file does not exist, create it.</td>
</tr>
<tr>
<td><code>'w' or 'w:'</code></td>
<td>Open for uncompressed writing.</td>
</tr>
<tr>
<td><code>'w:gz'</code></td>
<td>Open for gzip-compressed writes.</td>
</tr>
<tr>
<td><code>'w:bz2'</code></td>
<td>Open for bzip2 compressed writes.</td>
</tr>
<tr>
<td><code>'w:xz'</code></td>
<td>Turn on writing for lzma compression.</td>
</tr>
</tbody>
</table>
<p>For special purposes, a second mode format exists: &lsquo;filemode|[compression]&rsquo;. tarfile.open() will return a TarFile object that treats its data as a stream of data blocks.</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>‘r/*’</code></td>
<td>打开 tar 块的 流 以进行透明压缩读取。</td>
</tr>
<tr>
<td><code>‘r/’</code></td>
<td>打开一个未压缩的 tar 块的 stream 用于读取。</td>
</tr>
<tr>
<td><code>‘r/gz’</code></td>
<td>打开一个 gzip 压缩的 stream 用于读取。</td>
</tr>
<tr>
<td><code>‘r/bz2’</code></td>
<td>打开一个 bzip2 压缩的 stream 用于读取。</td>
</tr>
<tr>
<td><code>‘r/xz’</code></td>
<td>打开一个 lzma 压缩 stream 用于读取。</td>
</tr>
<tr>
<td><code>‘w/’</code></td>
<td>打开一个未压缩的 stream 用于写入。</td>
</tr>
<tr>
<td><code>‘w/gz’</code></td>
<td>打开一个 gzip 压缩的 stream 用于写入。</td>
</tr>
<tr>
<td><code>‘w/bz2’</code></td>
<td>打开一个 bzip2 压缩的 stream 用于写入。</td>
</tr>
<tr>
<td><code>‘w/xz’</code></td>
<td>打开一个 lzma 压缩的 stream 用于写入。</td>
</tr>
</tbody>
</table>
<p>Code example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">gzip</span>


<span class="c1"># 一次性打包整个根目录。空子目录会被打包。</span>
<span class="c1"># 如果只打包不压缩，将&#34;w:gz&#34;参数改为&#34;w:&#34;或&#34;w&#34;即可。</span>
<span class="k">def</span> <span class="nf">make_targz</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s2">&#34;w:gz&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">source_dir</span><span class="p">))</span>


<span class="c1"># 逐个添加文件打包，未打包空子目录。可过滤文件。</span>
<span class="c1"># 如果只打包不压缩，将&#34;w:gz&#34;参数改为&#34;w:&#34;或&#34;w&#34;即可。</span>
<span class="k">def</span> <span class="nf">make_targz_one_by_one</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">):</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s2">&#34;w:gz&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">source_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">pathfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pathfile</span><span class="p">)</span>
    <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">un_gz</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;ungz zip file&#34;&#34;&#34;</span>
    <span class="n">f_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;.gz&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
    <span class="c1"># 获取文件的名称，去掉</span>
    <span class="n">g_file</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="c1"># 创建gzip对象</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">f_name</span><span class="p">,</span> <span class="s2">&#34;wb+&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">g_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="c1"># gzip对象用read()打开后，写入open()建立的文件里。</span>
    <span class="n">g_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># 关闭gzip对象</span>


<span class="k">def</span> <span class="nf">un_tar</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="c1"># untar zip file</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s2">&#34;_files&#34;</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s2">&#34;_files&#34;</span><span class="p">)</span>
    <span class="c1"># 由于解压后是许多文件，预先建立同名文件夹</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&#34;_files/&#34;</span><span class="p">)</span>
    <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">make_targz</span><span class="p">(</span><span class="s1">&#39;test.tar.gz&#39;</span><span class="p">,</span> <span class="s2">&#34;E:\python_sample\libs&#34;</span><span class="p">)</span>
    <span class="n">make_targz_one_by_one</span><span class="p">(</span><span class="s1">&#39;test01.tgz&#39;</span><span class="p">,</span> <span class="s2">&#34;E:\python_sample\libs&#34;</span><span class="p">)</span>
    <span class="n">un_gz</span><span class="p">(</span><span class="s2">&#34;test.tar.gz&#34;</span><span class="p">)</span>
    <span class="n">un_tar</span><span class="p">(</span><span class="s2">&#34;test.tar&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="rar-file">rar file</h2>
<p>We can use rarfile to decompress .rar files, but rarfile is not supported to compress rar files. rarfile follows the unrar component, but after installing it using pip install unrar, the following error is reported.</p>
<p>Couldn&rsquo;t find path to unrar library&hellip;</p>
<p>This is because unrar under Python also relies on the <a href="https://www.rarlab.com/rar_add.htm">official RAR library</a>.</p>
<p><strong>Installation for Windows</strong></p>
<ul>
<li>Go to RARLab and download the official library file, <a href="https://www.rarlab.com/rar/UnRARDLL.exe">https://www.rarlab.com/rar/UnRARDLL.exe</a>, and install it.</li>
<li>Installation is best to choose the default path, usually under C:\Program Files (x86)\UnrarDLL\ directory.</li>
<li>Add environment variables, create a new variable name UNRAR_LIB_PATH in the system variable, if it is a 64-bit system, enter C:\Program Files (x86)\UnrarDLL\x64\UnRAR64.dll, if it is a 32-bit system is C:\Program Files (x86)\ UnrarDLL\UnRAR.dll.</li>
<li>After making sure to save the environment variables, do the pip install unrar installation, and then the code will not report an error when you run it again.</li>
</ul>
<p><strong>Installation of Linux</strong></p>
<ul>
<li>Download the rar source file: <a href="https://www.rarlab.com/rar/rarlinux-6.0.0.tar.gz">https://www.rarlab.com/rar/rarlinux-6.0.0.tar.gz</a></li>
<li>Unzip the installation package, enter the installation package directory, compile and install, generate the so file</li>
<li>Configure the environment variables, and when you are done, do the pip install unrar installation</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># cd /usr/local/src/</span>
<span class="c1"># wget https://www.rarlab.com/rar/unrarsrc-6.0.3.tar.gz</span>
<span class="c1"># tar zxvf unrarsrc-6.0.3.tar.gz</span>
<span class="c1"># cd unrar</span>
<span class="c1"># make lib</span>
<span class="c1"># make install-lib  //生成libunrar.so 文件</span>
<span class="c1"># vim /etc/profile</span>
<span class="n">export</span> <span class="n">UNRAR_LIB_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libunrar</span><span class="o">.</span><span class="n">so</span>
<span class="c1"># source /etc/profile</span>
</code></pre></td></tr></table>
</div>
</div><p>Code example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">rarfile</span>


<span class="k">def</span> <span class="nf">unrar</span><span class="p">(</span><span class="n">rar_file</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">):</span>
    <span class="c1"># rarfile需要unrar支持, linux下pip install unrar, windows下在winrar文件夹找到unrar,加到path里</span>
    <span class="n">rarobj</span> <span class="o">=</span> <span class="n">rarfile</span><span class="o">.</span><span class="n">RarFile</span><span class="p">(</span><span class="n">rar_file</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="n">rarobj</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">dir_name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7z-file">7z file</h2>
<p>To compress and decompress .7z files you need to use py7zr component. Code example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">py7zr</span>

<span class="c1"># 压缩</span>
<span class="k">with</span> <span class="n">py7zr</span><span class="o">.</span><span class="n">SevenZipFile</span><span class="p">(</span><span class="s2">&#34;Archive.7z&#34;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">archive</span><span class="p">:</span>
    <span class="n">archive</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&#34;/tmp&#34;</span><span class="p">)</span>

<span class="c1"># 解压缩</span>
<span class="k">with</span> <span class="n">py7zr</span><span class="o">.</span><span class="n">SevenZipFile</span><span class="p">(</span><span class="s2">&#34;Archive.7z&#34;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">archive</span><span class="p">:</span>
    <span class="n">archive</span><span class="o">.</span><span class="n">writeall</span><span class="p">(</span><span class="s2">&#34;target/&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-10/python-break-continue-pass/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">The difference between break/continue/pass in Python</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-10/jpuyter-pyspark-hive/">
            <span class="next-text nav-default">Connecting to Hive using PySpark in Jupyter</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
