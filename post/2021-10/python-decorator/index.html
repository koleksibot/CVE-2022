<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to understand Python decorators - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Introduction to Decorators A decorator is a high-level Python syntax. It can be used to process a function, method, or class. In Python, we have several ways to process functions and classes. Compared to other ways, decorator syntax is simple and the code is highly readable. As a result, decorators have a wide range of applications in Python projects. Decorators are often used in scenarios with tangential requirements, some classic" /><meta name="keywords" content="python, decorator" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-10/python-decorator/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="How to understand Python decorators" />
<meta property="og:description" content="Introduction to Decorators A decorator is a high-level Python syntax. It can be used to process a function, method, or class. In Python, we have several ways to process functions and classes. Compared to other ways, decorator syntax is simple and the code is highly readable. As a result, decorators have a wide range of applications in Python projects. Decorators are often used in scenarios with tangential requirements, some classic" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-10/python-decorator/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-19T22:17:39+08:00" />
<meta property="article:modified_time" content="2021-10-19T22:17:39+08:00" />

<meta itemprop="name" content="How to understand Python decorators">
<meta itemprop="description" content="Introduction to Decorators A decorator is a high-level Python syntax. It can be used to process a function, method, or class. In Python, we have several ways to process functions and classes. Compared to other ways, decorator syntax is simple and the code is highly readable. As a result, decorators have a wide range of applications in Python projects. Decorators are often used in scenarios with tangential requirements, some classic"><meta itemprop="datePublished" content="2021-10-19T22:17:39+08:00" />
<meta itemprop="dateModified" content="2021-10-19T22:17:39+08:00" />
<meta itemprop="wordCount" content="4194">
<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to understand Python decorators"/>
<meta name="twitter:description" content="Introduction to Decorators A decorator is a high-level Python syntax. It can be used to process a function, method, or class. In Python, we have several ways to process functions and classes. Compared to other ways, decorator syntax is simple and the code is highly readable. As a result, decorators have a wide range of applications in Python projects. Decorators are often used in scenarios with tangential requirements, some classic"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How to understand Python decorators</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-10-19 22:17:39 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 4194 words </span>
          <span class="more-meta"> 9 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction-to-decorators">Introduction to Decorators</a></li>
        <li><a href="#the-rationale-behind-decorators">The rationale behind decorators</a>
          <ul>
            <li><a href="#pythons-functions-are-objects">Python&rsquo;s functions are objects</a></li>
            <li><a href="#functions-references">Functions references</a></li>
          </ul>
        </li>
        <li><a href="#decorators-in-action">Decorators in action</a>
          <ul>
            <li><a href="#handmade-decorators">Handmade decorators</a></li>
            <li><a href="#syntactic-sugar-for-decorators">Syntactic sugar for decorators</a></li>
            <li><a href="#passing-parameters-to-decorator-functions">Passing parameters to decorator functions</a></li>
            <li><a href="#decorators-with-parameters">Decorators with parameters</a></li>
            <li><a href="#decorating-methods-in-classes">Decorating &ldquo;methods in classes&rdquo;</a></li>
            <li><a href="#decoration-class">Decoration class</a></li>
          </ul>
        </li>
        <li><a href="#built-in-decorators">Built-in decorators</a>
          <ul>
            <li><a href="#property-decorator">property Decorator</a></li>
            <li><a href="#staticmethod-decorator">staticmethod decorator</a></li>
            <li><a href="#classmethod-decorator">classmethod Decorator</a></li>
            <li><a href="#wraps-decorators">wraps decorators</a></li>
          </ul>
        </li>
        <li><a href="#decorator-summary">Decorator Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="introduction-to-decorators">Introduction to Decorators</h2>
<p>A decorator is a high-level Python syntax. It can be used to process a function, method, or class. In Python, we have several ways to process functions and classes. Compared to other ways, decorator syntax is simple and the code is highly readable. As a result, decorators have a wide range of applications in Python projects. Decorators are often used in scenarios with tangential requirements, some classic ones are inserting logs, performance testing, transaction processing, web permission checking, Cache, etc.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/19/adbfcd1d90e746c7b123acb2d6f64899.png" alt=""></p>
<p>The advantage of decorators is that they can extract a large amount of code from functions that are not related to the function itself and continue to reuse it. That is, functions can be &ldquo;modified&rdquo; to behave completely differently, effectively orthogonalizing the business logic. In a nutshell, the role of a decorator is to add additional functionality to an already existing object. For example, for logging, you need to log some functions. The dumb way, adding code to each function, is sad if the code changes. The decorator approach, define a decorator that specializes in logging and decorate the functions that need it.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/19/edd399a6f0c748b68438ae7729767031.png" alt=""></p>
<p>Python&rsquo;s Decorator is very similar to Java/C#&rsquo;s Annotation in that it adds a @XXX annotation in front of the method name to decorate the method with something. However, Java/C#&rsquo;s Annotation is also prohibitive, and you need to understand a bunch of Annotation library documentation before you can use it, which makes it feel like you&rsquo;re learning another language. Python uses a very elegant approach compared to Decorator Pattern and Annotation, which doesn&rsquo;t require you to master any complex OO model or Annotation&rsquo;s various library rules, it&rsquo;s all about language level play: a functional programming technique.</p>
<h2 id="the-rationale-behind-decorators">The rationale behind decorators</h2>
<p>In Python, decorator implementations are very convenient. Here&rsquo;s why: functions can be thrown around.</p>
<h3 id="pythons-functions-are-objects">Python&rsquo;s functions are objects</h3>
<p>To understand decorators, you must first know that in Python, functions are objects. It&rsquo;s important to understand this, and let&rsquo;s see why with an example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">shout</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">&#34;yes&#34;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">shout</span><span class="p">())</span>
<span class="c1"># outputs : &#39;Yes!&#39;</span>

<span class="c1"># 作为一个对象，你可以像其他对象一样把函数赋值给其他变量</span>
<span class="n">scream</span> <span class="o">=</span> <span class="n">shout</span>

<span class="c1"># 注意我们没有用括号：我们不是在调用函数，</span>
<span class="c1"># 而是把函数&#39;shout&#39;的值绑定到&#39;scream&#39;这个变量上</span>
<span class="c1"># 这也意味着你可以通过&#39;scream&#39;这个变量来调用&#39;shout&#39;函数</span>

<span class="nb">print</span><span class="p">(</span><span class="n">scream</span><span class="p">())</span>
<span class="c1"># outputs : &#39;Yes!&#39;</span>

<span class="c1"># 不仅如此，这也还意味着你可以把原来的名字&#39;shout&#39;删掉，</span>
<span class="c1"># 而这个函数仍然可以通过&#39;scream&#39;来访问</span>
<span class="k">del</span> <span class="n">shout</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">shout</span><span class="p">())</span>
<span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1"># outputs: &#34;name &#39;shout&#39; is not defined&#34;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">scream</span><span class="p">())</span>
<span class="c1"># outputs: &#39;Yes!&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>Another interesting feature of Python functions is that they can be defined within another function body.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">talk</span><span class="p">():</span>
    <span class="c1"># 你可以在 &#39;talk&#39; 里动态的(on the fly)定义一个函数...</span>
    <span class="k">def</span> <span class="nf">whisper</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">&#34;yes&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;...&#34;</span>

    <span class="c1"># ... 然后马上调用它！</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">whisper</span><span class="p">())</span>


<span class="c1"># 每当调用&#39;talk&#39;，都会定义一次&#39;whisper&#39;，然后&#39;whisper&#39;在&#39;talk&#39;里被调用</span>
<span class="n">talk</span><span class="p">()</span>
<span class="c1"># outputs:</span>
<span class="c1"># &#34;yes...&#34;</span>

<span class="c1"># 但是&#34;whisper&#34; 在 &#34;talk&#34;外并不存在:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">whisper</span><span class="p">())</span>
<span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1"># outputs : &#34;name &#39;whisper&#39; is not defined&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="functions-references">Functions references</h3>
<p>As you just learned, Python functions are also objects, so.</p>
<ul>
<li>can be assigned to a variable</li>
<li>can be defined inside another function</li>
</ul>
<p>So, this means that a function can return another function that.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">get_talk</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&#34;shout&#34;</span><span class="p">):</span>
    <span class="c1"># 我们先动态定义一些函数</span>
    <span class="k">def</span> <span class="nf">shout</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">&#34;yes&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span>

    <span class="k">def</span> <span class="nf">whisper</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">&#34;yes&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;...&#34;</span>

    <span class="c1"># 然后返回其中一个</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&#34;shout&#34;</span><span class="p">:</span>
        <span class="c1"># 注意：我们是在返回函数对象，而不是调用函数，所以不要用到括号 &#34;()&#34;</span>
        <span class="k">return</span> <span class="n">shout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">whisper</span>


<span class="c1"># 那你改如何使用d呢？</span>
<span class="c1"># 先把函数赋值给一个变量</span>
<span class="n">talk</span> <span class="o">=</span> <span class="n">get_talk</span><span class="p">()</span>
<span class="c1"># 你可以发现 &#34;talk&#34; 其实是一个函数对象:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">talk</span><span class="p">)</span>
<span class="c1"># outputs : &lt;function shout at 0xb7ea817c&gt;</span>

<span class="c1"># 这个对象就是 get_talk 函数返回的:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">talk</span><span class="p">())</span>
<span class="c1"># outputs : Yes!</span>

<span class="c1"># 你甚至还可以直接这样使用:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_talk</span><span class="p">(</span><span class="s2">&#34;whisper&#34;</span><span class="p">)())</span>
<span class="c1"># outputs : yes...</span>
</code></pre></td></tr></table>
</div>
</div><p>Since it is possible to return a function, it is also possible to pass it as a parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">shout</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">&#34;yes&#34;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span>


<span class="n">scream</span> <span class="o">=</span> <span class="n">shout</span>


<span class="k">def</span> <span class="nf">do_something_before</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I do something before then I call the function you gave me&#34;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>


<span class="n">do_something_before</span><span class="p">(</span><span class="n">scream</span><span class="p">)</span>
<span class="c1"># outputs:</span>
<span class="c1"># I do something before then I call the function you gave me</span>
<span class="c1"># Yes!</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="decorators-in-action">Decorators in action</h2>
<p>All the basics of understanding decorators are now available. Decorators are also known as wrappers, they allow you to execute other code before or after the execution of the decorated function, and they do not require modifications to the function itself.</p>
<h3 id="handmade-decorators">Handmade decorators</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># 一个装饰器是一个需要另一个函数作为参数的函数</span>
<span class="k">def</span> <span class="nf">my_shiny_new_decorator</span><span class="p">(</span><span class="n">a_function_to_decorate</span><span class="p">):</span>
    <span class="c1"># 在装饰器内部动态定义一个函数：wrapper(原意：包装纸).</span>
    <span class="c1"># 这个函数将被包装在原始函数的四周</span>
    <span class="c1"># 因此就可以在原始函数之前和之后执行一些代码.</span>
    <span class="k">def</span> <span class="nf">the_wrapper_around_the_original_function</span><span class="p">():</span>
        <span class="c1"># 把想要在调用原始函数前运行的代码放这里</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Before the function runs&#34;</span><span class="p">)</span>

        <span class="c1"># 调用原始函数（需要带括号）</span>
        <span class="n">a_function_to_decorate</span><span class="p">()</span>

        <span class="c1"># 把想要在调用原始函数后运行的代码放这里</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;After the function runs&#34;</span><span class="p">)</span>

    <span class="c1"># 直到现在，&#34;a_function_to_decorate&#34;还没有执行过 (HAS NEVER BEEN EXECUTED).</span>
    <span class="c1"># 我们把刚刚创建的 wrapper 函数返回.</span>
    <span class="c1"># wrapper 函数包含了这个函数，还有一些需要提前后之后执行的代码，</span>
    <span class="c1"># 可以直接使用了（It&#39;s ready to use!）</span>
    <span class="k">return</span> <span class="n">the_wrapper_around_the_original_function</span>


<span class="c1"># Now imagine you create a function you don&#39;t want to ever touch again.</span>
<span class="k">def</span> <span class="nf">a_stand_alone_function</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I am a stand alone function, don&#39;t you dare modify me&#34;</span><span class="p">)</span>


<span class="n">a_stand_alone_function</span><span class="p">()</span>
<span class="c1"># outputs: I am a stand alone function, don&#39;t you dare modify me</span>

<span class="c1"># 现在，你可以装饰一下来修改它的行为.</span>
<span class="c1"># 只要简单的把它传递给装饰器，后者能用任何你想要的代码动态的包装</span>
<span class="c1"># 而且返回一个可以直接使用的新函数:</span>

<span class="n">a_stand_alone_function_decorated</span> <span class="o">=</span> <span class="n">my_shiny_new_decorator</span><span class="p">(</span><span class="n">a_stand_alone_function</span><span class="p">)</span>
<span class="n">a_stand_alone_function_decorated</span><span class="p">()</span>
<span class="c1"># outputs:</span>
<span class="c1"># Before the function runs</span>
<span class="c1"># I am a stand alone function, don&#39;t you dare modify me</span>
<span class="c1"># After the function runs</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="syntactic-sugar-for-decorators">Syntactic sugar for decorators</h3>
<p>Let&rsquo;s rewrite the previous example using the syntax of a decorator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># 一个装饰器是一个需要另一个函数作为参数的函数</span>
<span class="k">def</span> <span class="nf">my_shiny_new_decorator</span><span class="p">(</span><span class="n">a_function_to_decorate</span><span class="p">):</span>
    <span class="c1"># 在装饰器内部动态定义一个函数：wrapper(原意：包装纸).</span>
    <span class="c1"># 这个函数将被包装在原始函数的四周</span>
    <span class="c1"># 因此就可以在原始函数之前和之后执行一些代码.</span>
    <span class="k">def</span> <span class="nf">the_wrapper_around_the_original_function</span><span class="p">():</span>
        <span class="c1"># 把想要在调用原始函数前运行的代码放这里</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Before the function runs&#34;</span><span class="p">)</span>

        <span class="c1"># 调用原始函数（需要带括号）</span>
        <span class="n">a_function_to_decorate</span><span class="p">()</span>

        <span class="c1"># 把想要在调用原始函数后运行的代码放这里</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;After the function runs&#34;</span><span class="p">)</span>

    <span class="c1"># 直到现在，&#34;a_function_to_decorate&#34;还没有执行过 (HAS NEVER BEEN EXECUTED).</span>
    <span class="c1"># 我们把刚刚创建的 wrapper 函数返回.</span>
    <span class="c1"># wrapper 函数包含了这个函数，还有一些需要提前后之后执行的代码，</span>
    <span class="c1"># 可以直接使用了（It&#39;s ready to use!）</span>
    <span class="k">return</span> <span class="n">the_wrapper_around_the_original_function</span>


<span class="nd">@my_shiny_new_decorator</span>
<span class="k">def</span> <span class="nf">another_stand_alone_function</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Leave me alone&#34;</span><span class="p">)</span>


<span class="n">another_stand_alone_function</span><span class="p">()</span>
<span class="c1"># outputs:</span>
<span class="c1"># Before the function runs</span>
<span class="c1"># Leave me alone</span>
<span class="c1"># After the function runs</span>
</code></pre></td></tr></table>
</div>
</div><p>Yes, that&rsquo;s it, it&rsquo;s that simple. @decorator is just a shortcut of the following statement (shortcut).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">another_stand_alone_function</span> <span class="o">=</span> <span class="n">my_shiny_new_decorator</span><span class="p">(</span><span class="n">another_stand_alone_function</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Decorator syntactic sugar is actually a Python-ified variant of the decorator pattern. To facilitate development, Python has several classic design patterns built in, such as iterators. Of course, you can also use decorators in a stack:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">bread</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;&#34;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&lt;\______/&gt;&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">ingredients</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;#tomatoes#&#34;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;~salad~&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="s2">&#34;--ham--&#34;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>


<span class="n">sandwich</span><span class="p">()</span>
<span class="c1"># outputs: --ham--</span>
<span class="n">sandwich</span> <span class="o">=</span> <span class="n">bread</span><span class="p">(</span><span class="n">ingredients</span><span class="p">(</span><span class="n">sandwich</span><span class="p">))</span>
<span class="n">sandwich</span><span class="p">()</span>
<span class="c1"># outputs:</span>
<span class="c1"># &lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;</span>
<span class="c1"># #tomatoes#</span>
<span class="c1"># --ham--</span>
<span class="c1"># ~salad~</span>
<span class="c1"># &lt;\______/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Expressed in Python&rsquo;s decorator syntax.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">bread</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;&#34;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&lt;\______/&gt;&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">ingredients</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;#tomatoes#&#34;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;~salad~&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@bread</span>
<span class="nd">@ingredients</span>
<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="s2">&#34;--ham--&#34;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>


<span class="n">sandwich</span><span class="p">()</span>
<span class="c1"># outputs:</span>
<span class="c1"># &lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;</span>
<span class="c1"># #tomatoes#</span>
<span class="c1"># --ham--</span>
<span class="c1"># ~salad~</span>
<span class="c1"># &lt;\______/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>The order in which the decorators are placed is also important:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">bread</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;&#34;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&lt;\______/&gt;&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">ingredients</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;#tomatoes#&#34;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;~salad~&#34;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@ingredients</span>
<span class="nd">@bread</span>
<span class="k">def</span> <span class="nf">strange_sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="s2">&#34;--ham--&#34;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>


<span class="n">strange_sandwich</span><span class="p">()</span>
<span class="c1"># outputs:</span>
<span class="c1">##tomatoes#</span>
<span class="c1"># &lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;</span>
<span class="c1"># --ham--</span>
<span class="c1"># &lt;\______/&gt;</span>
<span class="c1"># ~salad~</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="passing-parameters-to-decorator-functions">Passing parameters to decorator functions</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># 这不是什么黑色魔法(black magic)，你只是必须让wrapper传递参数:</span>
<span class="k">def</span> <span class="nf">a_decorator_passing_arguments</span><span class="p">(</span><span class="n">function_to_decorate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">a_wrapper_accepting_arguments</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I got args! Look:&#34;</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
        <span class="n">function_to_decorate</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a_wrapper_accepting_arguments</span>


<span class="c1"># 当你调用装饰器返回的函数式，你就在调用wrapper，而给wrapper的</span>
<span class="c1"># 参数传递将会让它把参数传递给要装饰的函数</span>
<span class="nd">@a_decorator_passing_arguments</span>
<span class="k">def</span> <span class="nf">print_full_name</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;My name is&#34;</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>


<span class="n">print_full_name</span><span class="p">(</span><span class="s2">&#34;Peter&#34;</span><span class="p">,</span> <span class="s2">&#34;Venkman&#34;</span><span class="p">)</span>
<span class="c1"># outputs:</span>
<span class="c1"># I got args! Look: Peter Venkman</span>
<span class="c1"># My name is Peter Venkman</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="decorators-with-parameters">Decorators with parameters</h3>
<p>In the above decorator call, such as @decorator, the decorator defaults to the function that follows it as the only argument. The decorator syntax allows us to call decorator with other arguments, such as @decorator(a). This provides more flexibility in the writing and use of decorators.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># a new wrapper layer</span>
<span class="k">def</span> <span class="nf">pre_str</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="c1"># old decorator</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">new_F</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&#34; input&#34;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">F</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_F</span>

    <span class="k">return</span> <span class="n">decorator</span>


<span class="c1"># get square sum</span>
<span class="nd">@pre_str</span><span class="p">(</span><span class="s1">&#39;^_^&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">square_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span>


<span class="c1"># get square diff</span>
<span class="nd">@pre_str</span><span class="p">(</span><span class="s1">&#39;T_T&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">square_diff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span>


<span class="nb">print</span><span class="p">(</span><span class="n">square_sum</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">square_diff</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># outputs:</span>
<span class="c1"># (&#39;^_^ input&#39;, 3, 4)</span>
<span class="c1"># 25</span>
<span class="c1"># (&#39;T_T input&#39;, 3, 4)</span>
<span class="c1"># -7</span>
</code></pre></td></tr></table>
</div>
</div><p>The pre_str above is a decorator that allows parameters. It is actually a function wrapper around the original decorator and returns a decorator. We can think of it as a closure with environment parameters. When we call it with @pre_str('^_^'), Python is able to discover this layer of wrapping and pass the arguments to the decorator&rsquo;s environment. The call is equivalent to.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">square_sum</span> <span class="o">=</span> <span class="n">pre_str</span><span class="p">(</span><span class="s1">&#39;^_^&#39;</span><span class="p">)</span> <span class="p">(</span><span class="n">square_sum</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="decorating-methods-in-classes">Decorating &ldquo;methods in classes&rdquo;</h3>
<p>One of the great things about Python is that methods and functions are really the same, except that the first argument to a method should be a reference to the current object (i.e. self). This also means that you can create decorators for methods in the same way, as long as you remember to take self into account.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">method_friendly_decorator</span><span class="p">(</span><span class="n">method_to_decorate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="p">):</span>
        <span class="n">lie</span> <span class="o">=</span> <span class="n">lie</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># very friendly, decrease age even more :-)</span>
        <span class="k">return</span> <span class="n">method_to_decorate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">Lucy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">32</span>

    <span class="nd">@method_friendly_decorator</span>
    <span class="k">def</span> <span class="nf">say_your_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I am </span><span class="si">%s</span><span class="s2">, what did you think?&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="n">lie</span><span class="p">))</span>


<span class="n">l</span> <span class="o">=</span> <span class="n">Lucy</span><span class="p">()</span>
<span class="n">l</span><span class="o">.</span><span class="n">say_your_age</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># outputs: I am 26, what did you think?</span>
</code></pre></td></tr></table>
</div>
</div><p>Of course, if you want to write a very generic decorator that can be used to decorate arbitrary functions and methods, you can ignore the specific arguments and just use *args, **kwargs.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">a_decorator_passing_arbitrary_arguments</span><span class="p">(</span><span class="n">function_to_decorate</span><span class="p">):</span>
    <span class="c1"># The wrapper accepts any arguments</span>
    <span class="k">def</span> <span class="nf">a_wrapper_accepting_arbitrary_arguments</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Do I have args?:&#34;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Then you unpack the arguments, here *args, **kwargs</span>
        <span class="c1"># If you are not familiar with unpacking, check:</span>
        <span class="c1"># http://www.saltycrane.com/blog/2008/01/how-to-use-args-and-kwargs-in-python/</span>
        <span class="n">function_to_decorate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a_wrapper_accepting_arbitrary_arguments</span>


<span class="nd">@a_decorator_passing_arbitrary_arguments</span>
<span class="k">def</span> <span class="nf">function_with_no_argument</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Python is cool, no argument here.&#34;</span><span class="p">)</span>


<span class="n">function_with_no_argument</span><span class="p">()</span>
<span class="c1"># outputs</span>
<span class="c1"># Do I have args?:</span>
<span class="c1"># ()</span>
<span class="c1"># {}</span>
<span class="c1"># Python is cool, no argument here.</span>

<span class="nd">@a_decorator_passing_arbitrary_arguments</span>
<span class="k">def</span> <span class="nf">function_with_arguments</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>


<span class="n">function_with_arguments</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># outputs</span>
<span class="c1"># Do I have args?:</span>
<span class="c1"># (1, 2, 3)</span>
<span class="c1"># {}</span>
<span class="c1"># 1 2 3</span>

<span class="nd">@a_decorator_passing_arbitrary_arguments</span>
<span class="k">def</span> <span class="nf">function_with_named_arguments</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">platypus</span><span class="o">=</span><span class="s2">&#34;Why not ?&#34;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Do </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> like platypus? </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">platypus</span><span class="p">))</span>


<span class="n">function_with_named_arguments</span><span class="p">(</span><span class="s2">&#34;Bill&#34;</span><span class="p">,</span> <span class="s2">&#34;Linus&#34;</span><span class="p">,</span> <span class="s2">&#34;Steve&#34;</span><span class="p">,</span> <span class="n">platypus</span><span class="o">=</span><span class="s2">&#34;Indeed!&#34;</span><span class="p">)</span>
<span class="c1"># outputs</span>
<span class="c1"># Do I have args ? :</span>
<span class="c1"># (&#39;Bill&#39;, &#39;Linus&#39;, &#39;Steve&#39;)</span>
<span class="c1"># {&#39;platypus&#39;: &#39;Indeed!&#39;}</span>
<span class="c1"># Do Bill, Linus and Steve like platypus? Indeed!</span>


<span class="k">class</span> <span class="nc">Mary</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">31</span>

    <span class="nd">@a_decorator_passing_arbitrary_arguments</span>
    <span class="k">def</span> <span class="nf">say_your_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="o">=-</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># You can now add a default value</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I am </span><span class="si">%s</span><span class="s2">, what did you think ?&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="n">lie</span><span class="p">))</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">Mary</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">say_your_age</span><span class="p">()</span>
<span class="c1"># outputs</span>
<span class="c1"># Do I have args?:</span>
<span class="c1"># (&lt;__main__.Mary object at 0xb7d303ac&gt;,)</span>
<span class="c1"># {}</span>
<span class="c1"># I am 28, what did you think?</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="decoration-class">Decoration class</h3>
<p>In the above example, the decorator takes a function and returns a function, thus having the effect of processing the function. In Python 2.6 onwards, decorators are extended to classes. A decorator can take a class and return a class, thus having the effect of processing the class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">aClass</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">newClass</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_display</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped</span> <span class="o">=</span> <span class="n">aClass</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_display</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;total display&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_display</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">newClass</span>


<span class="nd">@decorator</span>
<span class="k">class</span> <span class="nc">Bird</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;My age is&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>


<span class="n">eagleLord</span> <span class="o">=</span> <span class="n">Bird</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">eagleLord</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>In the decorator, we return a new class, newClass, in which we record the objects generated by the original class (self.wrapped) and attach a new attribute, total_display, to record the number of calls to display. We also changed the display method at the same time. With this change, our Bird class can now display the number of calls to display.</p>
<h2 id="built-in-decorators">Built-in decorators</h2>
<p>Python has three types of decorators that we often use, property, staticmethod, and classmethod, and they all have one thing in common: they act on top of class methods.</p>
<h3 id="property-decorator">property Decorator</h3>
<p>property decorators are used for functions in classes, allowing us to access the return value of a function in the same way as a property.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">class</span> <span class="nc">XiaoMing</span><span class="p">:</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;明&#39;</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;小&#39;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>
<span class="n">xiaoming</span> <span class="o">=</span> <span class="n">XiaoMing</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xiaoming</span><span class="o">.</span><span class="n">full_name</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>In the example, we get the return value of the full_name method like a property, which is the point of using property decorators, both to get the value like a property and to do some operations while getting the value.</p>
<h3 id="staticmethod-decorator">staticmethod decorator</h3>
<p>The staticmethod decorator is also used for methods in classes, which means that the method will be a static method, meaning that the method can be called directly without instantiation, but it also means that it has no self argument and no access to the instantiated object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">class</span> <span class="nc">XiaoMing</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;同学你好&#39;</span><span class="p">)</span>


<span class="n">XiaoMing</span><span class="o">.</span><span class="n">say_hello</span><span class="p">()</span>

<span class="c1"># 实例化调用也是同样的效果</span>
<span class="c1"># 有点多此一举</span>
<span class="n">xiaoming</span> <span class="o">=</span> <span class="n">XiaoMing</span><span class="p">()</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">say_hello</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="classmethod-decorator">classmethod Decorator</h3>
<p>classmethod is still a method used in a class, which means that it will be a class method, meaning that it can be called directly without instantiation, but it also means that it does not have a self argument and cannot access the instantiated object. The difference compared to staticmethod is that it takes a cls argument to the class itself.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">class</span> <span class="nc">XiaoMing</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;小明&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;同学你好， 我是&#39;</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

<span class="n">XiaoMing</span><span class="o">.</span><span class="n">say_hello</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="wraps-decorators">wraps decorators</h3>
<p>A function has not only its execution statement, but also attributes such as <code>__name__</code>(function name), <code>__doc__</code> (description document), etc., which our previous example will cause to change.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;doc of wrapper&#34;&#34;&#34;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@decorator</span>
<span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
    <span class="s2">&#34;&#34;&#34;doc of say hello&#34;&#34;&#34;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;同学你好&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">say_hello</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">say_hello</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Since the decorator returns the wrapper function to replace the say_hello function, the function name and help documentation becomes the wrapper function. The solution to this problem is to use the wraps decorator under the functools module.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;doc of wrapper&#34;&#34;&#34;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@decorator</span>
<span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
    <span class="s2">&#34;&#34;&#34;doc of say hello&#34;&#34;&#34;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;同学你好&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">say_hello</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">say_hello</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="decorator-summary">Decorator Summary</h2>
<p>The core role of decorators is name binding. this syntax is another manifestation of Python&rsquo;s multi-programming paradigm. Most Python users don&rsquo;t really need to define decorators, but are likely to use them. Given the widespread use of decorators in Python projects, it is useful to understand this syntax.</p>
<p><strong>Common error: &ldquo;decorator&rdquo; = &ldquo;decorator pattern&rdquo;</strong></p>
<p>Design patterns are a big word in the computer world. If you&rsquo;re a Java programmer and you don&rsquo;t know anything about design patterns, I bet you&rsquo;ll have a tough time getting a job interview.</p>
<p>But when writing Python, we rarely talk about &ldquo;design patterns&rdquo;. Although Python is also an object-oriented programming language, its <a href="https://en.wikipedia.org/wiki/Duck_typing">duck type</a> design and excellent dynamics dictate that most design patterns are not necessary for us. So many Python programmers may not really apply several design patterns after working with them for a long time.</p>
<p>The exception is <a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>. Because Python&rsquo;s &ldquo;decorator&rdquo; and &ldquo;decorator pattern&rdquo; have the same exact name, I&rsquo;ve heard more than once that people treat them as the same thing and think that using &ldquo;decorator &quot; is practicing the &ldquo;decorator pattern&rdquo;. But in fact, they are two completely different things.</p>
<p>&ldquo;The Decorator Pattern is a programming technique based entirely on Object-Orientation. It has several key components: a unified interface definition, a number of classes that follow the interface, and a layer of wrapping between classes. Together, they create a &ldquo;decorative&rdquo; effect.</p>
<p>The &ldquo;decorator&rdquo; in Python has no direct connection to &ldquo;object-oriented&rdquo;, and **it can be a trick that happens between functions and functions. In fact, a &ldquo;decorator&rdquo; doesn&rsquo;t provide some irreplaceable functionality; it&rsquo;s just a <a href="https://en.wikipedia.org/wiki/Syntactic_sugar">&ldquo;syntactic sugar&rdquo;</a>. Here is the code that uses a decorator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nd">@log_time</span>
<span class="nd">@cache_result</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span> <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div><p>Essentially the exact equivalent of.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span> <span class="k">pass</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">log_time</span><span class="p">(</span><span class="n">cache_result</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p>The biggest credit to decorators is that they allow us to write more intuitive, easy-to-read code for certain scenarios. It is just a &ldquo;candy&rdquo;, not a complex programming pattern for some object-oriented domain.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-10/deploy-kafka-ha-on-k8s/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Running a highly available Kafka cluster on Kubernetes</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-10/redis-large-cluster/">
            <span class="next-text nav-default">Redis Large Cluster Scaling Performance Optimization Practices</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
