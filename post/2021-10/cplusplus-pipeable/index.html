<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Pipeable Programming in C&#43;&#43; - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Pipeable Pipeable is perhaps a rather controversial way of programming C&#43;&#43;.
There is pipeable in Boost: pipeable - Boost.HigherOrderFunctions 0.6 documentation - master. It is a part of the hof library
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  #include &amp;lt;boost/hof.hpp&amp;gt;#include &amp;lt;cassert&amp;gt;using namespace boost::hof; struct sum { template&amp;lt;class T, class U&amp;gt; T operator()(T x, U y) const { return x&#43;y; } }; int main() { assert(3 == (1 | pipable(sum())(2))); assert(3 == pipable(sum())(1, 2)); }   The HOF library stands for Higher-order functions for C&#43;&#43;, and its author Paul Fultz II is also a celebrity." /><meta name="keywords" content="c&#43;&#43;, Pipeable" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-10/cplusplus-pipeable/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Pipeable Programming in C&#43;&#43;" />
<meta property="og:description" content="Pipeable Pipeable is perhaps a rather controversial way of programming C&#43;&#43;.
There is pipeable in Boost: pipeable - Boost.HigherOrderFunctions 0.6 documentation - master. It is a part of the hof library
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  #include &lt;boost/hof.hpp&gt;#include &lt;cassert&gt;using namespace boost::hof; struct sum { template&lt;class T, class U&gt; T operator()(T x, U y) const { return x&#43;y; } }; int main() { assert(3 == (1 | pipable(sum())(2))); assert(3 == pipable(sum())(1, 2)); }   The HOF library stands for Higher-order functions for C&#43;&#43;, and its author Paul Fultz II is also a celebrity." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-10/cplusplus-pipeable/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-05T16:46:28+08:00" />
<meta property="article:modified_time" content="2021-10-05T16:46:28+08:00" />

<meta itemprop="name" content="Pipeable Programming in C&#43;&#43;">
<meta itemprop="description" content="Pipeable Pipeable is perhaps a rather controversial way of programming C&#43;&#43;.
There is pipeable in Boost: pipeable - Boost.HigherOrderFunctions 0.6 documentation - master. It is a part of the hof library
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  #include &lt;boost/hof.hpp&gt;#include &lt;cassert&gt;using namespace boost::hof; struct sum { template&lt;class T, class U&gt; T operator()(T x, U y) const { return x&#43;y; } }; int main() { assert(3 == (1 | pipable(sum())(2))); assert(3 == pipable(sum())(1, 2)); }   The HOF library stands for Higher-order functions for C&#43;&#43;, and its author Paul Fultz II is also a celebrity."><meta itemprop="datePublished" content="2021-10-05T16:46:28+08:00" />
<meta itemprop="dateModified" content="2021-10-05T16:46:28+08:00" />
<meta itemprop="wordCount" content="2190">
<meta itemprop="keywords" content="c&#43;&#43;," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pipeable Programming in C&#43;&#43;"/>
<meta name="twitter:description" content="Pipeable Pipeable is perhaps a rather controversial way of programming C&#43;&#43;.
There is pipeable in Boost: pipeable - Boost.HigherOrderFunctions 0.6 documentation - master. It is a part of the hof library
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  #include &lt;boost/hof.hpp&gt;#include &lt;cassert&gt;using namespace boost::hof; struct sum { template&lt;class T, class U&gt; T operator()(T x, U y) const { return x&#43;y; } }; int main() { assert(3 == (1 | pipable(sum())(2))); assert(3 == pipable(sum())(1, 2)); }   The HOF library stands for Higher-order functions for C&#43;&#43;, and its author Paul Fultz II is also a celebrity."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Pipeable Programming in C&#43;&#43;</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-10-05 16:46:28 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 2190 words </span>
          <span class="more-meta"> 11 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#pipeable">Pipeable</a>
          <ul>
            <li><a href="#fundamentals">Fundamentals</a></li>
            <li><a href="#slightly-improved">Slightly improved</a></li>
          </ul>
        </li>
        <li><a href="#successor">successor</a>
          <ul>
            <li><a href="#ranges">ranges</a></li>
            <li><a href="#other-languages">Other Languages</a></li>
            <li><a href="#about-the-controversy-i-mentioned">About the controversy I mentioned</a></li>
            <li><a href="#about-extension-method">About Extension Method</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="pipeable">Pipeable</h2>
<p><code>Pipeable</code> is perhaps a rather controversial way of programming C++.</p>
<p>There is pipeable in Boost: <a href="https://www.boost.org/doc/libs/master/libs/hof/doc/html/include/boost/hof/pipable.html">pipeable - Boost.HigherOrderFunctions 0.6 documentation - master</a>. It is a part of the <a href="https://www.boost.org/doc/libs/release/libs/hof/">hof library</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;boost/hof.hpp&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cassert&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">boost</span><span class="o">::</span><span class="n">hof</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">sum</span>
<span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">U</span><span class="o">&gt;</span>
    <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span> <span class="n">x</span><span class="p">,</span> <span class="n">U</span> <span class="n">y</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="mi">3</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span> <span class="o">|</span> <span class="n">pipable</span><span class="p">(</span><span class="n">sum</span><span class="p">())(</span><span class="mi">2</span><span class="p">)));</span>
    <span class="n">assert</span><span class="p">(</span><span class="mi">3</span> <span class="o">==</span> <span class="n">pipable</span><span class="p">(</span><span class="n">sum</span><span class="p">())(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The HOF library stands for Higher-order functions for C++, and its author <a href="http://pfultz2.com/blog/">Paul Fultz II</a> is also a celebrity. There are two Posts in his blog related to the topic of this article.</p>
<ol>
<li><a href="http://pfultz2.com/blog/2014/09/05/pipable-functions/">Pipable functions in C++14</a></li>
<li><a href="http://pfultz2.com/blog/2013/02/14/extensions/">Extension methods in C++</a></li>
</ol>
<p>Similarly, there are <a href="https://www.boost.org/doc/libs/master/libs/hof/doc/html/doc/src/more_examples.html#extension-">Extension methods</a> in Boost. methods).</p>
<h3 id="fundamentals">Fundamentals</h3>
<p>We note that the origin of Pipeable programming comes from pipe operations in the OS Shell, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">cat 1.txt <span class="p">|</span> grep <span class="s1">&#39;best of&#39;</span> <span class="p">|</span> uniq -c <span class="p">|</span> head -10
</code></pre></td></tr></table>
</div>
</div><p>In particular, when the C++ operator ' ' (logical or) can also be overloaded, everything seems to fall into place.</p>
<p>The key C++ idea is to do ' ' operator overloading as well as &lsquo;()&rsquo; operator overloading.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nc">pipe_closure</span> <span class="o">:</span> <span class="n">F</span>
<span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="err">... </span><span class="nc">Xs</span><span class="o">&gt;</span>
    <span class="n">pipe_closure</span><span class="p">(</span><span class="n">Xs</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">xs</span><span class="p">)</span> <span class="o">:</span> <span class="n">F</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Xs</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xs</span><span class="p">)...)</span>
    <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
<span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">pipe_closure</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;&amp;</span> <span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nf">p</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The user class F can then have the ability to operate with &lsquo;|&rsquo; under the pipe_closure decoration (provided that F also implements the &lsquo;()&rsquo; operator overload.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="k">struct</span> <span class="nc">add_one_f</span>
<span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
    <span class="k">auto</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="c1">// `T const &amp;x` is better
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>Then the pipeable tandem operation looks like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="k">const</span> <span class="n">pipe_closure</span><span class="o">&lt;</span><span class="n">add_one_f</span><span class="o">&gt;</span> <span class="n">add_one</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>
<span class="kt">int</span> <span class="n">number_3</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">add_one</span> <span class="o">|</span> <span class="n">add_one</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">number_3</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that the &lsquo;()&rsquo; operator accepts the generic class T as an input, so that it receives the lhs element forwarded by <code>pip_closure&lt;F&gt;::operator |</code>, the left-hand operand of the &quot; &quot; operator. In this way, the result of the lhs expression is piped to the rhs operand in <code>operator ()&lt;T&gt;()</code>, thus completing the pipeline operation.</p>
<h3 id="slightly-improved">Slightly improved</h3>
<p>Obviously this idea can be further embellished.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="k">namespace</span> <span class="n">hicc</span><span class="o">::</span><span class="n">pipeable</span> <span class="p">{</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
    <span class="k">struct</span> <span class="nc">pipeable</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="n">F</span> <span class="n">f</span><span class="p">;</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">pipeable</span><span class="p">(</span><span class="n">F</span> <span class="o">&amp;&amp;</span><span class="n">f</span><span class="p">)</span>
            <span class="o">:</span> <span class="n">f</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

        <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="err">... </span><span class="nc">Xs</span><span class="o">&gt;</span>
        <span class="k">auto</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Xs</span> <span class="o">&amp;&amp;</span><span class="p">...</span><span class="n">xs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Xs</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xs</span><span class="p">)...))</span> <span class="k">const</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Xs</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xs</span><span class="p">)...);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
    <span class="n">pipeable</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span> <span class="n">piped</span><span class="p">(</span><span class="n">F</span> <span class="o">&amp;&amp;</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pipeable</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">)};</span> <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
    <span class="k">auto</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">T</span> <span class="o">&amp;&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">F</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">f</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span> <span class="c1">// namespace hicc::pipeable
</span></code></pre></td></tr></table>
</div>
</div><p>Then, to be able to have a more elegant presentation of.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">void</span> <span class="nf">test_piped</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">hicc</span><span class="o">::</span><span class="n">pipeable</span><span class="p">;</span>

    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">add</span> <span class="o">=</span> <span class="n">piped</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span> <span class="p">});</span>
        <span class="k">auto</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">piped</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span> <span class="p">});</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">|</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">mul</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">hicc_print</span><span class="p">(</span><span class="s">&#34;    y = %d&#34;</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">y2</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">|</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">piped</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span> <span class="p">})(</span><span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">piped</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">})();</span>
        <span class="c1">// Output: 36
</span><span class="c1"></span>        <span class="n">hicc_print</span><span class="p">(</span><span class="s">&#34;    y2 = %d&#34;</span><span class="p">,</span> <span class="n">y2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above pipeable class and piped(&hellip;) are from <a href="http://vitiy.info/functional-pipeline-in-c11/">Functional pipeline in C++11 - Victor Laskin&rsquo;s Blog</a>, his implementation is more meaningful, so we like it a bit more.</p>
<blockquote>
<p>ACK: the following image is from his blog</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/10/05/b5966053a9b845598a503a68f0344945.png" alt=""></p>
<p>Paul Fultz II&rsquo;s motivation is more of a priority, I just never really use boost, it&rsquo;s too large and complete to be used in engineering at all. I prefer something relatively lightweight, yet relatively complete.</p>
<p>If you&rsquo;re interested in Paul Fultz II&rsquo;s implementation, in addition to boost::hof::pipeable, he also made the open source Linq: <a href="https://github.com/pfultz2/Linq">pfultz2/Linq: Linq for list comprehension in C++</a>. This is a C++ implementation of the C# Linq technology, which is amazing and crazy.</p>
<h2 id="successor">successor</h2>
<p>Here is the extended reading time.</p>
<h3 id="ranges">ranges</h3>
<p>Of course, it is also important to mention the <a href="https://zh.cppreference.com/w/cpp/ranges">std::ranges range library</a>, which is one of the changes brought by C++20, but the C++20 specification has not been released for long enough for engineering applications to be realistic.</p>
<p>ranges also has an incubation project of the same name <a href="https://github.com/ericniebler/range-v3">ericniebler/range-v3: Range library for C++14/17/20, basis for C++20&rsquo;s std::ranges</a>, which can be used if you don&rsquo;t want to enable c++20 right away, requires clang 3.6+ or gcc 4.9.1, so older projects say no pressure.</p>
<p>In general, ranges provide a filtering tool that allows you to filter, sort, mapreduce, etc. on top of a pipeline filter.</p>
<p>But range v3 is also a mixed bag.</p>
<h4 id="how-to-understand-the-scope-library">How to understand the scope library</h4>
<p>In fact, this guy is just as inexplicable as other terms like protocol, concept, etc. Do you know what a concept is?</p>
<p>Do you know what a concept is? iykyk, I&rsquo;m a real Chinese person who doesn&rsquo;t have any idea about concepts.</p>
<p>However, C++20&rsquo;s std::concept is a weird thing.</p>
<p>Their actual meanings have to go into the etymology of the English roots, so they are hard for Chinese people to understand intuitively.</p>
<p>Here, let&rsquo;s ignore the ranges etymology and use std::ranges::view to understand it. In other words, a ranges library is a cross-section of a set, a view that can be observed, and then a view that can be multiplied or added, or the mean can be calculated, or other aggregation operations can be done, or sorting can be done, or map reduce can be done.</p>
<p>The question of what you can do is not a question of ranges, but how you are going to do it on the view provided by ranges. So to make good use of the ranges library, you should have a good understanding of functional programming. For those who have an understanding of C# Linq techniques, RxJava can easily understand the core of std::ranges.</p>
<h4 id="use">Use</h4>
<p>As for using ranges, refer to the examples they provide.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;range/v3/view/filter.hpp&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;range/v3/view/transform.hpp&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">vi</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">};</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">ranges</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">vi</span> <span class="o">|</span> <span class="n">views</span><span class="o">::</span><span class="n">filter</span><span class="p">([](</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="p">})</span> <span class="o">|</span>
               <span class="n">views</span><span class="o">::</span><span class="n">transform</span><span class="p">([](</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="p">});</span>
    <span class="c1">// prints: [2,4,6,8,10]
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rng</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s hard to say if this is progress.</p>
<h3 id="other-languages">Other Languages</h3>
<p>Kotlin</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kt" data-lang="kt"><span class="k">val</span> <span class="py">animals</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s2">&#34;raccoon&#34;</span><span class="p">,</span> <span class="s2">&#34;reindeer&#34;</span><span class="p">,</span> <span class="s2">&#34;cow&#34;</span><span class="p">,</span> <span class="s2">&#34;camel&#34;</span><span class="p">,</span> <span class="s2">&#34;giraffe&#34;</span><span class="p">,</span> <span class="s2">&#34;goat&#34;</span><span class="p">)</span>

<span class="c1">// grouping by first char and collect only max of contains vowels
</span><span class="c1"></span><span class="k">val</span> <span class="py">compareByVowelCount</span> <span class="p">=</span> <span class="n">compareBy</span> <span class="p">{</span> <span class="n">s</span><span class="p">:</span> <span class="n">String</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">count</span> <span class="p">{</span> <span class="k">it</span> <span class="k">in</span> <span class="s2">&#34;aeiou&#34;</span> <span class="p">}</span> <span class="p">}</span>

<span class="k">val</span> <span class="py">maxVowels</span> <span class="p">=</span> <span class="n">animals</span><span class="p">.</span><span class="n">groupingBy</span> <span class="p">{</span> <span class="k">it</span><span class="p">.</span><span class="n">first</span><span class="p">()</span> <span class="p">}.</span><span class="n">reduce</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">maxOf</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">compareByVowelCount</span><span class="p">)</span> <span class="p">}</span>

<span class="n">println</span><span class="p">(</span><span class="n">maxVowels</span><span class="p">)</span> <span class="c1">// {r=reindeer, c=camel, g=giraffe}
</span></code></pre></td></tr></table>
</div>
</div><p>Kotlin would look better if it were RxJava</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kt" data-lang="kt"><span class="n">Observable</span><span class="p">.</span><span class="n">just</span><span class="p">(</span><span class="s2">&#34;Apple&#34;</span><span class="p">,</span> <span class="s2">&#34;Orange&#34;</span><span class="p">,</span> <span class="s2">&#34;Banana&#34;</span><span class="p">)</span>
<span class="p">.</span><span class="n">subscribe</span><span class="p">(</span>
  <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s2">&#34;Received: </span><span class="si">$value</span><span class="s2">&#34;</span><span class="p">)</span> <span class="p">},</span> <span class="c1">// onNext
</span><span class="c1"></span>  <span class="p">{</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s2">&#34;Error: </span><span class="si">$error</span><span class="s2">&#34;</span><span class="p">)</span> <span class="p">},</span>    <span class="c1">// onError
</span><span class="c1"></span>  <span class="p">{</span> <span class="n">println</span><span class="p">(</span><span class="s2">&#34;Completed!&#34;</span><span class="p">)</span> <span class="p">}</span>                 <span class="c1">// onComplete
</span><span class="c1"></span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>If Kotlin didn&rsquo;t always come with a JVM, I would be completely and utterly bored.</p>
<p>Of course, Rx also has a c++ version, RxCpp, which tastes like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&#34;rxcpp/rx.hpp&#34;</span><span class="cp">
</span><span class="cp"></span><span class="k">namespace</span> <span class="n">Rx</span> <span class="p">{</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">rxcpp</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">rxcpp</span><span class="o">::</span><span class="n">sources</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">rxcpp</span><span class="o">::</span><span class="n">operators</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">rxcpp</span><span class="o">::</span><span class="n">util</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Rx</span><span class="p">;</span>

<span class="cp">#include</span> <span class="cpf">&lt;regex&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">random_device</span> <span class="n">rd</span><span class="p">;</span>   <span class="c1">// non-deterministic generator
</span><span class="c1"></span>    <span class="n">mt19937</span> <span class="n">gen</span><span class="p">(</span><span class="n">rd</span><span class="p">());</span>
    <span class="n">uniform_int_distribution</span><span class="o">&lt;&gt;</span> <span class="n">dist</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>

    <span class="c1">// for testing purposes, produce byte stream that from lines of text
</span><span class="c1"></span>    <span class="k">auto</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span>
        <span class="n">flat_map</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">int</span> <span class="n">i</span><span class="p">){</span>
            <span class="k">auto</span> <span class="n">body</span> <span class="o">=</span> <span class="n">from</span><span class="p">((</span><span class="kt">uint8_t</span><span class="p">)(</span><span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span> <span class="o">|</span>
                <span class="n">repeat</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">gen</span><span class="p">))</span> <span class="o">|</span>
                <span class="n">as_dynamic</span><span class="p">();</span>
            <span class="k">auto</span> <span class="n">delim</span> <span class="o">=</span> <span class="n">from</span><span class="p">((</span><span class="kt">uint8_t</span><span class="p">)</span><span class="sc">&#39;\r&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">from</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">delim</span><span class="p">)</span> <span class="o">|</span> <span class="n">concat</span><span class="p">();</span>
        <span class="p">})</span> <span class="o">|</span>
        <span class="n">window</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">|</span>
        <span class="n">flat_map</span><span class="p">([](</span><span class="n">observable</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">w</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">w</span> <span class="o">|</span>
                <span class="n">reduce</span><span class="p">(</span>
                    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(),</span>
                    <span class="p">[](</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">b</span><span class="p">){</span>
                        <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
                        <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
                    <span class="p">})</span> <span class="o">|</span>
                <span class="n">as_dynamic</span><span class="p">();</span>
        <span class="p">})</span> <span class="o">|</span>
        <span class="n">tap</span><span class="p">([](</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span> <span class="n">v</span><span class="p">){</span>
            <span class="c1">// print input packet of bytes
</span><span class="c1"></span>            <span class="n">copy</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">));</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="p">});</span>

    <span class="c1">// ...
</span><span class="c1"></span>		<span class="c1">// full codes at: https://github.com/ReactiveX/RxCpp
</span><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>What can only be said, bad is bad in [&hellip;] (&hellip;) { &hellip; } is an outrageous and rather unattractive lambda function body. When compared to kotlin&rsquo;s lambda, it&rsquo;s a retreat.</p>
<p>In fact, this has been the case with all the changes since C++11, creating a lot of weird and unintuitive stuff. I&rsquo;m afraid it would be dead if not for some new goodies and history.</p>
<h3 id="about-the-controversy-i-mentioned">About the controversy I mentioned</h3>
<p>First of all on the one hand, C++ anonymous functions are in terrible shape. See <a href="https://kfsone.wordpress.com/2010/06/27/c0x-lambdas-suck/">C++0x lambdas suck</a>, C++ lambda ugly, etc.</p>
<p>On the other hand, we have to see that this is also historical, not to mention that C++&rsquo;s functional style originally had its own style, and ranges of things like standards came too late, too many different implementations caused confusion, and standards, well, always late.</p>
<p>With C# closures, Java 8 closures, and Kotlin closures in the foreground, C++ can&rsquo;t win this battle under the preconceptions.</p>
<h3 id="about-extension-method">About Extension Method</h3>
<p>This concept, is part of Protocol-oriented Progamming (PPP).</p>
<h4 id="swift">Swift</h4>
<p>In Swift language, you can extend any class by means of <a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html">Protocol</a> (<a href="https://docs.swift.org/swift-book/LanguageGuide/Extensions.html">Extensions</a>). It behaves somewhat like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="n">let</span> <span class="n">pythons</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#34;Eric&#34;</span><span class="p">,</span> <span class="s">&#34;Graham&#34;</span><span class="p">,</span> <span class="s">&#34;John&#34;</span><span class="p">,</span> <span class="s">&#34;Michael&#34;</span><span class="p">,</span> <span class="s">&#34;Terry&#34;</span><span class="p">,</span> <span class="s">&#34;Terry&#34;</span><span class="p">]</span>
<span class="n">let</span> <span class="n">beatles</span> <span class="o">=</span> <span class="n">Set</span><span class="p">([</span><span class="s">&#34;John&#34;</span><span class="p">,</span> <span class="s">&#34;Paul&#34;</span><span class="p">,</span> <span class="s">&#34;George&#34;</span><span class="p">,</span> <span class="s">&#34;Ringo&#34;</span><span class="p">])</span>

<span class="n">extension</span> <span class="n">Collection</span> <span class="p">{</span>
    <span class="n">func</span> <span class="nf">summarize</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&#34;There are \(count) of us:&#34;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="n">in</span> <span class="n">self</span> <span class="p">{</span>
            <span class="n">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Both Array and Set will now have that method, so we can try it out
</span><span class="c1"></span><span class="n">pythons</span><span class="p">.</span><span class="n">summarize</span><span class="p">()</span>
<span class="n">beatles</span><span class="p">.</span><span class="n">summarize</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>Another example, adding a reverse() method to the String class (note: String has a native method reversed()).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="n">import</span> <span class="n">Foundation</span>

<span class="n">extension</span> <span class="n">String</span> <span class="p">{</span>
    <span class="n">func</span> <span class="nf">reverse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">word</span> <span class="o">=</span> <span class="p">[</span><span class="n">Character</span><span class="p">]()</span>
        <span class="k">for</span> <span class="kt">char</span> <span class="n">in</span> <span class="n">self</span> <span class="p">{</span>
            <span class="n">word</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span> <span class="nl">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">String</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">var</span> <span class="n">bobobo</span> <span class="o">=</span> <span class="s">&#34;reversing&#34;</span>
<span class="n">print</span><span class="p">(</span><span class="n">bobobo</span><span class="p">.</span><span class="n">reverse</span><span class="p">())</span>
<span class="c1">// gnisrever
</span></code></pre></td></tr></table>
</div>
</div><p>The examples above do not make use of protocol constraints, so they only show the ability to extend existing classes. You can extend a generic class that meets a specific protocol constraint, thus giving that group of generic classes an additional method. This is too large to expand on here.</p>
<h4 id="kotlin">Kotlin</h4>
<p>Kotlin provides the means for Extension Function, which can be considered a disruptive and innovative design for Java.</p>
<p>This time the example is slightly different.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kt" data-lang="kt"><span class="k">fun</span> <span class="nf">String</span><span class="p">.</span><span class="n">reverseCaseOfString</span><span class="p">():</span> <span class="n">String</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">inputCharArr</span> <span class="p">=</span> <span class="n">toCharArray</span><span class="p">()</span>
    <span class="k">var</span> <span class="py">output</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">inputCharArr</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="k">if</span> <span class="p">(</span><span class="n">inputCharArr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isUpperCase</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">inputCharArr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">toLowerCase</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">inputCharArr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">toUpperCase</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">output</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This adds the reverseCaseOfString() method to the String class, which is no different from String.length().</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="n">print</span><span class="p">(</span><span class="s">&#34;CaseSensitive&#34;</span><span class="p">.</span><span class="n">reverseCaseOfString</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><p>Those of you who are mobile developers should be familiar with this capability of Swift and Kotlin.</p>
<h4 id="in-c">In C++</h4>
<p>I&rsquo;ve been studying and dreaming for a long time (several years, spanning a decade) to be able to do the same thing in C++. But even at c++23 this is still not possible.</p>
<p>As for creating an equivalent C++ class library, the conclusion, after many failed attempts, is that it is still not possible.</p>
<p>A less-than-perfect way to extend the functionality of existing classes through C++ is through the <a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>, which is the most standardized solution, but is badly shaped and cumbersome:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">struct</span> <span class="nc">Shape</span> <span class="p">{</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="n">Shape</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="nf">Resize</span><span class="p">(</span><span class="kt">float</span> <span class="n">factor</span><span class="p">)</span> <span class="p">{</span> <span class="n">radius</span> <span class="o">*=</span> <span class="n">factor</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&#34;A circle of radius &#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">radius</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">float</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">10.0f</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">ColoredShape</span> <span class="o">:</span> <span class="n">Shape</span> <span class="p">{</span>
  <span class="n">ColoredShape</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">color</span><span class="p">,</span> <span class="n">Shape</span><span class="o">*</span> <span class="n">shape</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">color</span><span class="p">(</span><span class="n">color</span><span class="p">),</span> <span class="n">shape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">shape</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34; which is colored &#34;</span> <span class="o">+</span> <span class="n">color</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">color</span><span class="p">;</span>
  <span class="n">Shape</span><span class="o">*</span> <span class="n">shape</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Circle</span> <span class="n">circle</span><span class="p">;</span>
  <span class="n">ColoredShape</span> <span class="n">colored_shape</span><span class="p">(</span><span class="s">&#34;red&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">circle</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">colored_shape</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Using the decorate pattern, you can either decorate the implementation of existing methods or add new ones (CIrcle.Resize()), but you need to display the construction to the decorator class to do so (<code>ColoredShape colored_shape(&quot;red&quot;, &amp;circle)</code>). An improvement would be to use the template class for mixin, but that would be a limited improvement.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/c&#43;&#43;/">c&#43;&#43;</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-10/yarn-and-npm/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Talking about package managers yarn and npm</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-10/cplusplus-17-visitor-pattern/">
            <span class="next-text nav-default">Cplusplus 17 Visitor Pattern</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
