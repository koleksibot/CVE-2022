<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Container tool without Daemon process: Podman - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="What is a container Linux container technology A Linux container is a process with specific isolation provided by the Linux Kernel. Linux container technology allows you to package or isolate your application and its entire runtime environment (including all required files) together. This allows users to easily migrate applications between environments while retaining the full functionality of the application. Docker&amp;rsquo;s problem Docker is a famous open source container engine, which" /><meta name="keywords" content="podman, docker" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-03/podman/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Container tool without Daemon process: Podman" />
<meta property="og:description" content="What is a container Linux container technology A Linux container is a process with specific isolation provided by the Linux Kernel. Linux container technology allows you to package or isolate your application and its entire runtime environment (including all required files) together. This allows users to easily migrate applications between environments while retaining the full functionality of the application. Docker&rsquo;s problem Docker is a famous open source container engine, which" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-03/podman/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-14T09:19:53+08:00" />
<meta property="article:modified_time" content="2022-03-14T09:19:53+08:00" />

<meta itemprop="name" content="Container tool without Daemon process: Podman">
<meta itemprop="description" content="What is a container Linux container technology A Linux container is a process with specific isolation provided by the Linux Kernel. Linux container technology allows you to package or isolate your application and its entire runtime environment (including all required files) together. This allows users to easily migrate applications between environments while retaining the full functionality of the application. Docker&rsquo;s problem Docker is a famous open source container engine, which"><meta itemprop="datePublished" content="2022-03-14T09:19:53+08:00" />
<meta itemprop="dateModified" content="2022-03-14T09:19:53+08:00" />
<meta itemprop="wordCount" content="1874">
<meta itemprop="keywords" content="podman,docker," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Container tool without Daemon process: Podman"/>
<meta name="twitter:description" content="What is a container Linux container technology A Linux container is a process with specific isolation provided by the Linux Kernel. Linux container technology allows you to package or isolate your application and its entire runtime environment (including all required files) together. This allows users to easily migrate applications between environments while retaining the full functionality of the application. Docker&rsquo;s problem Docker is a famous open source container engine, which"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Container tool without Daemon process: Podman</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-03-14 09:19:53 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1874 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-is-a-container">What is a container</a>
          <ul>
            <li><a href="#linux-container-technology">Linux container technology</a></li>
            <li><a href="#dockers-problem">Docker&rsquo;s problem</a></li>
            <li><a href="#what-is-podman">What is Podman</a></li>
          </ul>
        </li>
        <li><a href="#installation">Installation</a>
          <ul>
            <li><a href="#macos">MacOS</a></li>
            <li><a href="#fedora-centos">Fedora, CentOS</a></li>
            <li><a href="#ubuntudevelopment-versions">Ubuntu(development versions)</a></li>
          </ul>
        </li>
        <li><a href="#use">Use</a>
          <ul>
            <li><a href="#pulling-images">Pulling images</a></li>
            <li><a href="#starting-containers">Starting containers</a></li>
            <li><a href="#build-images">Build images</a></li>
          </ul>
        </li>
        <li><a href="#problem">Problem</a>
          <ul>
            <li><a href="#restart-issues">Restart issues</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="what-is-a-container">What is a container</h2>
<h3 id="linux-container-technology">Linux container technology</h3>
<p>A Linux container is a process with specific isolation provided by the Linux Kernel. Linux container technology allows you to package or isolate your application and its entire runtime environment (including all required files) together. This allows users to easily migrate applications between environments while retaining the full functionality of the application.</p>
<h3 id="dockers-problem">Docker&rsquo;s problem</h3>
<p>Docker is a famous open source container engine, which has become almost synonymous with containers now that container technology is gradually gaining popularity.</p>
<p>Docker itself is also a packaging of Linux container technology, through and provide users with a simple interface, so that users are very convenient to package and use containers.</p>
<p>As the mainstream container engine, Docker has a wealth of scenarios and solutions, but also has some problems.</p>
<ol>
<li>Docker needs to run a daemon, and all containers are children of the daemon</li>
<li>Docker needs <code>root</code> identity to run the daemon</li>
</ol>
<p>This may seem like a no-brainer, but if you try to use Docker at scale you will find that</p>
<ol>
<li>daemons are not as stable as you might think</li>
<li>the OOM of one container is likely to drag down the parent process and affect neighboring containers</li>
<li>The Docker process tree has some oddities, and you can&rsquo;t be sure if it&rsquo;s a Docker bug or something the Kernel has done</li>
<li>The Docker container is the process started by <code>root</code>.</li>
</ol>
<p>If we go in a different direction, is the daemon really necessary?</p>
<h3 id="what-is-podman">What is Podman</h3>
<p>Podman was once part of the CRI-O project, but was later spun off as a separate project: <a href="https://github.com/containers/libpod">libpod</a>. Podman&rsquo;s goal is to provide a Container CLI similar to Docker (even the official direct It is recommended to use: <code>alias docker=podman</code>).</p>
<h2 id="installation">Installation</h2>
<p>Installing Podman is very easy, the installation documentation: <a href="https://github.com/containers/libpod/blob/master/install.md">https://github.com/containers/libpod/blob/master/install.md</a></p>
<h3 id="macos">MacOS</h3>
<p>Using <a href="https://brew.sh/">Homebrew</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">brew cask install podman
</code></pre></td></tr></table>
</div>
</div><h3 id="fedora-centos">Fedora, CentOS</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo yum -y install podman
</code></pre></td></tr></table>
</div>
</div><h3 id="ubuntudevelopment-versions">Ubuntu(development versions)</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get update -qq
sudo apt-get install -qq -y software-properties-common uidmap
sudo add-apt-repository -y ppa:projectatomic/ppa
sudo apt-get update -qq
sudo apt-get -qq -y install podman
</code></pre></td></tr></table>
</div>
</div><h2 id="use">Use</h2>
<p>The following experiments are based on Podman V1.4.4.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># podman version</span>
Version:            1.4.4
RemoteAPI Version:  <span class="m">1</span>
Go Version:         go1.10.3
OS/Arch:            linux/amd64
</code></pre></td></tr></table>
</div>
</div><h3 id="pulling-images">Pulling images</h3>
<p>Podman will pull the <code>registry.access.redhat.com</code> image first by default. If the pull fails, Podman will try the <code>docker.io</code> image again.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># podman pull nginx</span>
Trying to pull registry.access.redhat.com/nginx...ERRO<span class="o">[</span>0001<span class="o">]</span> Error pulling image ref //registry.access.redhat.com/nginx:latest: Error initializing <span class="nb">source</span> docker://registry.access.redhat.com/nginx:latest: Error reading manifest latest in registry.access.redhat.com/nginx: name unknown: Repo not found
Failed
Trying to pull docker.io/library/nginx...Getting image <span class="nb">source</span> signatures
Copying blob 7acba7289aa3 <span class="k">done</span>
Copying blob b8f262c62ec6 <span class="k">done</span>
Copying blob e9218e8f93b1 <span class="k">done</span>
Copying config f949e7d76d <span class="k">done</span>
Writing manifest to image destination
Storing signatures
f949e7d76d63befffc8eec2cbf8a6f509780f96fb3bacbdc24068d594a77f043
</code></pre></td></tr></table>
</div>
</div><p>Podman&rsquo;s data path is under <code>/var/lib/containers</code>, similar to Docker, which holds data such as layers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm lib<span class="o">]</span><span class="c1"># tree /var/lib/containers/ -L 2</span>
/var/lib/containers/
├── cache
│   └── blob-info-cache-v1.boltdb
└── storage
    ├── libpod
    ├── mounts
    ├── overlay
    ├── overlay-containers
    ├── overlay-images
    ├── overlay-layers
    ├── storage.lock
    └── tmp
</code></pre></td></tr></table>
</div>
</div><p>You can see the information of the images you just pulled.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm lib<span class="o">]</span><span class="c1"># cat /var/lib/containers/storage/overlay-images/images.json | python -m json.tool</span>
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">&#34;big-data-digests&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;manifest&#34;</span>: <span class="s2">&#34;sha256:066edc156bcada86155fd80ae03667cf3811c499df73815a2b76e43755ebbc76&#34;</span>,
            <span class="s2">&#34;manifest-sha256:066edc156bcada86155fd80ae03667cf3811c499df73815a2b76e43755ebbc76&#34;</span>: <span class="s2">&#34;sha256:066edc156bcada86155fd80ae03667cf3811c499df73815a2b76e43755ebbc76&#34;</span>,
            <span class="s2">&#34;sha256:f949e7d76d63befffc8eec2cbf8a6f509780f96fb3bacbdc24068d594a77f043&#34;</span>: <span class="s2">&#34;sha256:f949e7d76d63befffc8eec2cbf8a6f509780f96fb3bacbdc24068d594a77f043&#34;</span>
        <span class="o">}</span>,
        <span class="s2">&#34;big-data-names&#34;</span>: <span class="o">[</span>
            <span class="s2">&#34;sha256:f949e7d76d63befffc8eec2cbf8a6f509780f96fb3bacbdc24068d594a77f043&#34;</span>,
            <span class="s2">&#34;manifest-sha256:066edc156bcada86155fd80ae03667cf3811c499df73815a2b76e43755ebbc76&#34;</span>,
            <span class="s2">&#34;manifest&#34;</span>
        <span class="o">]</span>,
        <span class="s2">&#34;big-data-sizes&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;manifest&#34;</span>: 948,
            <span class="s2">&#34;manifest-sha256:066edc156bcada86155fd80ae03667cf3811c499df73815a2b76e43755ebbc76&#34;</span>: 948,
            <span class="s2">&#34;sha256:f949e7d76d63befffc8eec2cbf8a6f509780f96fb3bacbdc24068d594a77f043&#34;</span>: <span class="m">6669</span>
        <span class="o">}</span>,
        <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;2019-09-24T23:33:17.034191345Z&#34;</span>,
        <span class="s2">&#34;digest&#34;</span>: <span class="s2">&#34;sha256:066edc156bcada86155fd80ae03667cf3811c499df73815a2b76e43755ebbc76&#34;</span>,
        <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;f949e7d76d63befffc8eec2cbf8a6f509780f96fb3bacbdc24068d594a77f043&#34;</span>,
        <span class="s2">&#34;layer&#34;</span>: <span class="s2">&#34;ea345052c98934e4e4673b2d359b5000a9ff1cc7f0332df0d406980f172deea6&#34;</span>,
        <span class="s2">&#34;metadata&#34;</span>: <span class="s2">&#34;{}&#34;</span>,
        <span class="s2">&#34;names&#34;</span>: <span class="o">[</span>
            <span class="s2">&#34;docker.io/library/nginx:latest&#34;</span>
        <span class="o">]</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="starting-containers">Starting containers</h3>
<p>Most of Podman&rsquo;s commands are compatible with Docker, so you can start containers in a similar way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># podman run -p 80:80 --name=web -d nginx</span>
9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02

<span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># podman ps</span>
CONTAINER ID  IMAGE                           COMMAND               CREATED         STATUS             PORTS               NAMES
9d284597eeed  docker.io/library/nginx:latest  nginx -g daemon o...  <span class="m">48</span> seconds ago  Up <span class="m">48</span> seconds ago  0.0.0.0:80-&gt;80/tcp  web
</code></pre></td></tr></table>
</div>
</div><p>Try checking the processes of nginx.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># ps -ef | grep nginx</span>
root      <span class="m">2518</span>  <span class="m">2508</span>  <span class="m">0</span> 12:01 ?        00:00:00 nginx: master process nginx -g daemon off<span class="p">;</span>
<span class="m">101</span>       <span class="m">2529</span>  <span class="m">2518</span>  <span class="m">0</span> 12:01 ?        00:00:00 nginx: worker process
root      <span class="m">2637</span>  <span class="m">1259</span>  <span class="m">0</span> 12:10 pts/0    00:00:00 grep --color<span class="o">=</span>auto nginx
</code></pre></td></tr></table>
</div>
</div><p>Then view the process tree based on the pid.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># pstree -H 2518</span>
systemd─┬─NetworkManager─┬─2*<span class="o">[</span>dhclient<span class="o">]</span>
        │                └─2*<span class="o">[{</span>NetworkManager<span class="o">}]</span>
        ├─anacron
        ├─auditd───<span class="o">{</span>auditd<span class="o">}</span>
        ├─conmon─┬─nginx───nginx
        │        └─<span class="o">{</span>conmon<span class="o">}</span>
        ├─crond
        ├─dbus-daemon───<span class="o">{</span>dbus-daemon<span class="o">}</span>
        ├─firewalld───<span class="o">{</span>firewalld<span class="o">}</span>
        ├─login───bash
        ├─lvmetad
        ├─master─┬─pickup
        │        └─qmgr
        ├─polkitd───5*<span class="o">[{</span>polkitd<span class="o">}]</span>
        ├─rsyslogd───2*<span class="o">[{</span>rsyslogd<span class="o">}]</span>
        ├─sshd───sshd───bash───pstree
        ├─systemd-journal
        ├─systemd-logind
        ├─systemd-udevd
        └─tuned───4*<span class="o">[{</span>tuned<span class="o">}]</span>
</code></pre></td></tr></table>
</div>
</div><p>View the parent process based on ppid.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># ps -ef | grep 2508</span>
root      <span class="m">2508</span>     <span class="m">1</span>  <span class="m">0</span> 12:01 ?        00:00:00 /usr/libexec/podman/conmon -s -c 9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02 -u 9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02 -n web -r /usr/bin/runc -b /var/lib/containers/storage/overlay-containers/9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02/userdata -p /var/run/containers/storage/overlay-containers/9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02/userdata/pidfile --exit-dir /var/run/libpod/exits --exit-command /usr/bin/podman --exit-command-arg --root --exit-command-arg /var/lib/containers/storage --exit-command-arg --runroot --exit-command-arg /var/run/containers/storage --exit-command-arg --log-level --exit-command-arg error --exit-command-arg --cgroup-manager --exit-command-arg systemd --exit-command-arg --tmpdir --exit-command-arg /var/run/libpod --exit-command-arg --runtime --exit-command-arg runc --exit-command-arg --storage-driver --exit-command-arg overlay --exit-command-arg container --exit-command-arg cleanup --exit-command-arg 9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02 --socket-dir-path /var/run/libpod/socket -l k8s-file:/var/lib/containers/storage/overlay-containers/9d284597eeedbbdfb4df933e063fe1035cbd39f1e712173f7a8a3652773eac02/userdata/ctr.log --log-level error
root      <span class="m">2518</span>  <span class="m">2508</span>  <span class="m">0</span> 12:01 ?        00:00:00 nginx: master process nginx -g daemon off<span class="p">;</span>
root      <span class="m">2639</span>  <span class="m">1259</span>  <span class="m">0</span> 12:10 pts/0    00:00:00 grep --color<span class="o">=</span>auto <span class="m">2508</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, podman starts the container through podman/conmon, and this process is hooked under pid 1, which is systemd.</p>
<p>podman/conmon is Podman&rsquo;s initiator and is responsible for two main functions: monitoring runc and managing containers with runc&rsquo;s capabilities, and establishing communication with Podman and passing instructions for container operations.</p>
<blockquote>
<p>Podman does not communicate with using the CRI protocol. Instead, Podman creates containers using runc, and manages storage using containers/storage. Technically, Podman launches conmon which launches and monitors the OCI Runtime (runc). Podman can exit and later reconnect to conmon to talk to the container. Runc stops running once the container starts.</p>
<p>《Crictl Vs Podman》：<a href="https://blog.openshift.com/crictl-vs-podman/">https://blog.openshift.com/crictl-vs-podman/</a></p>
</blockquote>
<h3 id="build-images">Build images</h3>
<p>Podman can be built directly using Dockerfile.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># git clone https://github.com/DaoCloud/dao-2048.git</span>
正克隆到 <span class="s1">&#39;dao-2048&#39;</span>...
remote: Enumerating objects: 116, <span class="k">done</span>.
remote: Total <span class="m">116</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused <span class="m">116</span>
接收对象中: 100% <span class="o">(</span>116/116<span class="o">)</span>, 304.76 KiB <span class="p">|</span> 60.00 KiB/s, <span class="k">done</span>.
处理 delta 中: 100% <span class="o">(</span>40/40<span class="o">)</span>, <span class="k">done</span>.
<span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># podman build dao-2048/</span>
STEP 1: FROM daocloud.io/nginx:1.11-alpine
Getting image <span class="nb">source</span> signatures
Copying blob ed383a1b82df <span class="k">done</span>
Copying blob c92260fe6357 <span class="k">done</span>
Copying blob 4b21d71b440a <span class="k">done</span>
Copying blob <span class="m">709515475419</span> <span class="k">done</span>
Copying config bedece1f06 <span class="k">done</span>
Writing manifest to image destination
Storing signatures
STEP 2: MAINTAINER Golfen Guo &lt;golfen.guo@daocloud.io&gt;
711d32f788782528ad36a0c12ae895993474b168f7f2d65158e531a924b3dd55
STEP 3: COPY . /usr/share/nginx/html
b859763deeb7eaab39fd8c34a8c8af18e8de74c80e98f9fcb1e0c694881c5e9c
STEP 4: EXPOSE <span class="m">80</span>
eedb1a66c8316a309546b21a5c687f3e3611927b54a7fa0f4dbd3f175eeb253c
STEP 5: CMD sed -i <span class="s2">&#34;s/ContainerID: /ContainerID: &#34;</span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&#34;/g&#34;</span> /usr/share/nginx/html/index.html <span class="o">&amp;&amp;</span> nginx -g <span class="s2">&#34;daemon off;&#34;</span>
STEP 6: COMMIT
fda5a2d14a918c3eb088c28dc0d8e89e66b061923a82e8722d9e2a62c994422d

<span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># podman images</span>
REPOSITORY                TAG           IMAGE ID       CREATED          SIZE
&lt;none&gt;                    &lt;none&gt;        fda5a2d14a91   <span class="m">22</span> seconds ago   56.9 MB
docker.io/library/nginx   latest        f949e7d76d63   <span class="m">4</span> days ago       <span class="m">130</span> MB
daocloud.io/nginx         1.11-alpine   bedece1f06cc   <span class="m">2</span> years ago      55.9 MB
</code></pre></td></tr></table>
</div>
</div><p>Dockerfile：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="o">[</span>root@podman-test-vm ~<span class="o">]</span><span class="c1"># cat dao-2048/Dockerfile</span><span class="err">
</span><span class="err"></span><span class="c"># Using a compact OS</span><span class="err">
</span><span class="err"></span><span class="k">FROM</span><span class="s"> daocloud.io/nginx:1.11-alpine</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> Golfen Guo &lt;golfen.guo@daocloud.io&gt;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># Add 2048 stuff into Nginx server</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> . /usr/share/nginx/html<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># Start Nginx and keep it running background and start php</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> sed -i <span class="s2">&#34;s/ContainerID: /ContainerID: &#34;</span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&#34;/g&#34;</span> /usr/share/nginx/html/index.html<span class="err">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="problem">Problem</h2>
<p>Podman is committed to removing the daemon, which means that Podman cannot do the tasks that need to be done by the daemon.</p>
<h3 id="restart-issues">Restart issues</h3>
<p>In Docker, you can specify a restart policy with the <code>-restart</code> command, so that when a node restarts, the container with the restart policy will recover itself as long as dockerd is up.</p>
<p>Since Podman entrusts the management of containers to systemd, the official advice is to use systemd to <a href="https://podman.io/blogs/2018/09/13/systemd.html">solve this problem</a>. describe the boot method and restart policy.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ vim /etc/systemd/system/nginx_container.service 
 
<span class="o">[</span>Unit<span class="o">]</span> 
<span class="nv">Description</span><span class="o">=</span>Podman Nginx Service 
<span class="nv">After</span><span class="o">=</span>network.target 
<span class="nv">After</span><span class="o">=</span>network-online.target 
 
<span class="o">[</span>Service<span class="o">]</span> 
<span class="nv">Type</span><span class="o">=</span>simple 
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/podman start -a nginx 
<span class="nv">ExecStop</span><span class="o">=</span>/usr/bin/podman stop -t <span class="m">10</span> nginx 
<span class="nv">Restart</span><span class="o">=</span>always 
 
<span class="o">[</span>Install<span class="o">]</span> 
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target 
</code></pre></td></tr></table>
</div>
</div><p>Although some trouble (and feel a bit against the trend), but if you think about it, this is not the more recommended way to manage services on Linux. Secondly, although Docker supports container self-starting, it does not support sequential startup according to dependencies, but using systemd&rsquo;s ability to make startup dependencies through <code>After</code>, you can better manage the startup order instead.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/podman/">podman</a>
          <a href="/tags/docker/">docker</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-03/kubernetes-task/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">How Kubernetes implements timed tasks</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-03/chartmuseum-helm-chart/">
            <span class="next-text nav-default">Manage Helm Chart with chartmuseum</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
