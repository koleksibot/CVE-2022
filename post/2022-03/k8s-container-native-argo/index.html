<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Kubernetes container-native workflow engine: Argo - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article is based on Argo v2.7.6, Kubernetes v1.18
 Argo is a workflow engine based on Kubernetes CRD implementation, providing container-native workflows for Kubernetes, i.e. each workflow node is running a task as a container.
Installation Since it is based on the Kubernetes CRD implementation, it is composed of CRD &#43; Controller.
Installing Argo is as simple as creating an argo namespace and applying an official yaml.
1 2  kubectl create namespace argokubectl apply -n argo -f https://raw." /><meta name="keywords" content="kubernetes,  container-native workflow, Argo" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-03/k8s-container-native-argo/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Kubernetes container-native workflow engine: Argo" />
<meta property="og:description" content="This article is based on Argo v2.7.6, Kubernetes v1.18
 Argo is a workflow engine based on Kubernetes CRD implementation, providing container-native workflows for Kubernetes, i.e. each workflow node is running a task as a container.
Installation Since it is based on the Kubernetes CRD implementation, it is composed of CRD &#43; Controller.
Installing Argo is as simple as creating an argo namespace and applying an official yaml.
1 2  kubectl create namespace argokubectl apply -n argo -f https://raw." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-03/k8s-container-native-argo/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-10T13:40:26+08:00" />
<meta property="article:modified_time" content="2022-03-10T13:40:26+08:00" />

<meta itemprop="name" content="Kubernetes container-native workflow engine: Argo">
<meta itemprop="description" content="This article is based on Argo v2.7.6, Kubernetes v1.18
 Argo is a workflow engine based on Kubernetes CRD implementation, providing container-native workflows for Kubernetes, i.e. each workflow node is running a task as a container.
Installation Since it is based on the Kubernetes CRD implementation, it is composed of CRD &#43; Controller.
Installing Argo is as simple as creating an argo namespace and applying an official yaml.
1 2  kubectl create namespace argokubectl apply -n argo -f https://raw."><meta itemprop="datePublished" content="2022-03-10T13:40:26+08:00" />
<meta itemprop="dateModified" content="2022-03-10T13:40:26+08:00" />
<meta itemprop="wordCount" content="1092">
<meta itemprop="keywords" content="kubernetes," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kubernetes container-native workflow engine: Argo"/>
<meta name="twitter:description" content="This article is based on Argo v2.7.6, Kubernetes v1.18
 Argo is a workflow engine based on Kubernetes CRD implementation, providing container-native workflows for Kubernetes, i.e. each workflow node is running a task as a container.
Installation Since it is based on the Kubernetes CRD implementation, it is composed of CRD &#43; Controller.
Installing Argo is as simple as creating an argo namespace and applying an official yaml.
1 2  kubectl create namespace argokubectl apply -n argo -f https://raw."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Kubernetes container-native workflow engine: Argo</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-03-10 13:40:26 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1092 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#how-it-works">How it works</a>
          <ul>
            <li><a href="#architecture">Architecture</a></li>
            <li><a href="#argo-server">argo server</a></li>
            <li><a href="#workflow">Workflow</a></li>
          </ul>
        </li>
        <li><a href="#getting-started">Getting Started</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>This article is based on Argo v2.7.6, Kubernetes v1.18</p>
</blockquote>
<p>Argo is a workflow engine based on Kubernetes CRD implementation, providing container-native workflows for Kubernetes, i.e. each workflow node is running a task as a container.</p>
<h2 id="installation">Installation</h2>
<p>Since it is based on the Kubernetes CRD implementation, it is composed of CRD + Controller.</p>
<p>Installing Argo is as simple as creating an argo namespace and applying an official yaml.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">kubectl create namespace argo</span><span class="w">
</span><span class="w"></span><span class="l">kubectl apply -n argo -f https://raw.githubusercontent.com/argoproj/argo/stable/manifests/install.yaml</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Once installed, you can see several CRDs and a Controller and its RBAC resources installed in the K8s cluster.</p>
<p>In addition to using kubectl to use argo workflow, you can also use argo cli.</p>
<p>To install on a Mac environment.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">brew install argoproj/tap/argo
</code></pre></td></tr></table>
</div>
</div><p>Installation in a Linux environment.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Download the binary</span>
curl -sLO https://github.com/argoproj/argo/releases/download/v2.7.6/argo-linux-amd64

<span class="c1"># Make binary executable</span>
chmod +x argo-linux-amd64

<span class="c1"># Move binary to path</span>
mv ./argo-linux-amd64 /usr/local/bin/argo

<span class="c1"># Test installation</span>
argo version
</code></pre></td></tr></table>
</div>
</div><h2 id="how-it-works">How it works</h2>
<p>Then we&rsquo;ll start by looking at how Argo works.</p>
<h3 id="architecture">Architecture</h3>
<p>The official Argo website provides a diagram of the Argo architecture after version v2.5, as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/03/10/b907dd90e1234cf09151cf5d7fe4bb46.png" alt="Argo Architecture"></p>
<p>The argo server provides api services to argo cli. When receiving requests from argo cli, argo server calls K8s Api to manipulate resources; and Controller to respond to resource changes from CRD.</p>
<h3 id="argo-server">argo server</h3>
<p>There are two modes of argo server: Hosted and Local. The difference between the two is that the Hosted mode server runs inside the K8s cluster, while the Local mode server runs outside the K8s cluster (mostly locally).</p>
<p>To start the argo server locally.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ argo server
INFO<span class="o">[</span>0000<span class="o">]</span>                                               <span class="nv">authMode</span><span class="o">=</span>server <span class="nv">baseHRef</span><span class="o">=</span>/ <span class="nv">managedNamespace</span><span class="o">=</span> <span class="nv">namespace</span><span class="o">=</span>default
INFO<span class="o">[</span>0000<span class="o">]</span> config map                                    <span class="nv">name</span><span class="o">=</span>workflow-controller-configmap
INFO<span class="o">[</span>0000<span class="o">]</span> Starting Argo Server                          <span class="nv">version</span><span class="o">=</span>v2.7.6+70facdb.dirty
INFO<span class="o">[</span>0000<span class="o">]</span> Argo Server started successfully on address :2746
</code></pre></td></tr></table>
</div>
</div><p>Once started, access the local port 2746 and you will see a ui interface provided by the Argo server.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/03/10/df3825c270fb485f9052d9a3d4df1d68.png" alt="argo ui"></p>
<h3 id="workflow">Workflow</h3>
<p>One of Argo&rsquo;s most important CRD&rsquo;s is Workflow, first look at its Spec definition.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">WorkflowSpec</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Templates is a list of workflow templates used in a workflow
</span><span class="c1"></span>	<span class="c1">// +patchStrategy=merge
</span><span class="c1"></span>	<span class="c1">// +patchMergeKey=name
</span><span class="c1"></span>	<span class="nx">Templates</span> <span class="p">[]</span><span class="nx">Template</span> <span class="s">`json:&#34;templates&#34; patchStrategy:&#34;merge&#34; patchMergeKey:&#34;name&#34; protobuf:&#34;bytes,1,opt,name=templates&#34;`</span>

	<span class="c1">// Entrypoint is a template reference to the starting point of the workflow.
</span><span class="c1"></span>	<span class="nx">Entrypoint</span> <span class="kt">string</span> <span class="s">`json:&#34;entrypoint,omitempty&#34; protobuf:&#34;bytes,2,opt,name=entrypoint&#34;`</span>

	<span class="c1">// Arguments contain the parameters and artifacts sent to the workflow entrypoint
</span><span class="c1"></span>	<span class="c1">// Parameters are referencable globally using the &#39;workflow&#39; variable prefix.
</span><span class="c1"></span>	<span class="c1">// e.g. {{workflow.parameters.myparam}}
</span><span class="c1"></span>	<span class="nx">Arguments</span> <span class="nx">Arguments</span> <span class="s">`json:&#34;arguments,omitempty&#34; protobuf:&#34;bytes,3,opt,name=arguments&#34;`</span>

	<span class="o">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Three of the most important parameters.</p>
<ul>
<li>Templates: all workflow template definitions.</li>
<li>Entrypoint: the entry point of the workflow template, i.e. specifying a template name from which the workflow starts.</li>
<li>Arguments: you can define the entry and product information of the workflow, if the arguments are prefixed with &lsquo;workflow&rsquo;, it means the whole workflow is available globally.</li>
</ul>
<h4 id="template">Template</h4>
<p>Let&rsquo;s look at the definition of Template.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Template is a reusable and composable unit of execution in a workflow
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Template</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Name is the name of the template
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;name&#34; protobuf:&#34;bytes,1,opt,name=name&#34;`</span>

	<span class="c1">// Inputs describe what inputs parameters and artifacts are supplied to this template
</span><span class="c1"></span>	<span class="nx">Inputs</span> <span class="nx">Inputs</span> <span class="s">`json:&#34;inputs,omitempty&#34; protobuf:&#34;bytes,5,opt,name=inputs&#34;`</span>

	<span class="c1">// Outputs describe the parameters and artifacts that this template produces
</span><span class="c1"></span>	<span class="nx">Outputs</span> <span class="nx">Outputs</span> <span class="s">`json:&#34;outputs,omitempty&#34; protobuf:&#34;bytes,6,opt,name=outputs&#34;`</span>

	<span class="c1">// Metdata sets the pods&#39;s metadata, i.e. annotations and labels
</span><span class="c1"></span>	<span class="nx">Metadata</span> <span class="nx">Metadata</span> <span class="s">`json:&#34;metadata,omitempty&#34; protobuf:&#34;bytes,9,opt,name=metadata&#34;`</span>

	<span class="c1">// Steps define a series of sequential/parallel workflow steps
</span><span class="c1"></span>	<span class="nx">Steps</span> <span class="p">[]</span><span class="nx">ParallelSteps</span> <span class="s">`json:&#34;steps,omitempty&#34; protobuf:&#34;bytes,11,opt,name=steps&#34;`</span>

	<span class="c1">// Container is the main container image to run in the pod
</span><span class="c1"></span>	<span class="nx">Container</span> <span class="o">*</span><span class="nx">apiv1</span><span class="p">.</span><span class="nx">Container</span> <span class="s">`json:&#34;container,omitempty&#34; protobuf:&#34;bytes,12,opt,name=container&#34;`</span>

	<span class="o">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, Template is reusable throughout the workflow. Several important parameters are Inputs and Outputs; Metadata of the pod on which the template runs; definition of the Container on which the template runs; parallel Steps defined in the template, etc.</p>
<p>A workflow can define an entry template (specified by Entrypoint). The relationship between Template and Step is shown in the figure below, and multiple parallel Steps can be defined in a template to form a workflow; and Step can refer to other templates, each running a pod for work.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/03/10/200e0f676dc74a9bb9c4d4b07bdc8cec.png" alt="argo workflow tempalte"></p>
<h4 id="step">Step</h4>
<p>Look again at the definition of Step.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">ParallelSteps</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Steps</span> <span class="p">[]</span><span class="nx">WorkflowStep</span> <span class="s">`protobuf:&#34;bytes,1,rep,name=steps&#34;`</span>
<span class="p">}</span>

<span class="c1">// WorkflowStep is a reference to a template to execute in a series of step
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">WorkflowStep</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Name of the step
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;name,omitempty&#34; protobuf:&#34;bytes,1,opt,name=name&#34;`</span>

	<span class="c1">// Template is the name of the template to execute as the step
</span><span class="c1"></span>	<span class="nx">Template</span> <span class="kt">string</span> <span class="s">`json:&#34;template,omitempty&#34; protobuf:&#34;bytes,2,opt,name=template&#34;`</span>

	<span class="c1">// Arguments hold arguments to the template
</span><span class="c1"></span>	<span class="nx">Arguments</span> <span class="nx">Arguments</span> <span class="s">`json:&#34;arguments,omitempty&#34; protobuf:&#34;bytes,3,opt,name=arguments&#34;`</span>

	<span class="c1">// WithItems expands a step into multiple parallel steps from the items in the list
</span><span class="c1"></span>	<span class="nx">WithItems</span> <span class="p">[]</span><span class="nx">Item</span> <span class="s">`json:&#34;withItems,omitempty&#34; protobuf:&#34;bytes,5,rep,name=withItems&#34;`</span>

	<span class="o">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ParallelSteps contains a set of WorkflowSteps, forming a parallel Step; WorkflowStep references a template, which can then specify ParallelSteps, with this string of parallel Steps, Argo can achieve any form of workflow customization.</p>
<p>The Arguments in the Step are also used to set the input and product information in the Step; WithItems extends a Step to multiple parallel Steps.</p>
<h2 id="getting-started">Getting Started</h2>
<p>After understanding how Argo works, let&rsquo;s put it into practice, using an example provided by the Argo website.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">argo submit --watch https://raw.githubusercontent.com/argoproj/argo/master/examples/loops-maps.yaml
</code></pre></td></tr></table>
</div>
</div><p>First, let&rsquo;s look at the yaml definition of Workflow.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">argoproj.io/v1alpha1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Workflow</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">generateName</span><span class="p">:</span><span class="w"> </span><span class="l">loops-maps-</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="l">loop-map-example</span><span class="w">
</span><span class="w">  </span><span class="nt">templates</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">loop-map-example</span><span class="w">
</span><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- - <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-linux</span><span class="w">
</span><span class="w">        </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l">cat-os-release</span><span class="w">
</span><span class="w">        </span><span class="nt">arguments</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{item.image}}&#34;</span><span class="w">
</span><span class="w">          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tag</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{item.tag}}&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">withItems</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- {<span class="w"> </span><span class="nt">image: &#39;debian&#39;, tag</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;9.1&#39;</span><span class="w"> </span>}<span class="w">
</span><span class="w">        </span>- {<span class="w"> </span><span class="nt">image: &#39;debian&#39;, tag</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;8.9&#39;</span><span class="w"> </span>}<span class="w">
</span><span class="w">        </span>- {<span class="w"> </span><span class="nt">image: &#39;alpine&#39;, tag</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.6&#39;</span><span class="w"> </span>}<span class="w">
</span><span class="w">        </span>- {<span class="w"> </span><span class="nt">image: &#39;ubuntu&#39;, tag</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;17.10&#39;</span><span class="w"> </span>}<span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cat-os-release</span><span class="w">
</span><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tag</span><span class="w">
</span><span class="w">    </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{inputs.parameters.image}}:{{inputs.parameters.tag}}&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">cat]</span><span class="w">
</span><span class="w">      </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">/etc/os-release]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>The entry template for Worflow is loop-map-example; this template defines four Step executions in parallel, whose execution parameters are entered separately.</p>
<p>Since the watch interface is open, we can see the workflow running in the terminal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">Name:                loops-maps-qzv56
Namespace:           default
ServiceAccount:      default
Status:              Succeeded
Created:             Tue May <span class="m">05</span> 03:42:58 +0800 <span class="o">(</span><span class="m">4</span> seconds ago<span class="o">)</span>
Started:             Tue May <span class="m">05</span> 03:42:58 +0800 <span class="o">(</span><span class="m">4</span> seconds ago<span class="o">)</span>
Finished:            Tue May <span class="m">05</span> 03:43:02 +0800 <span class="o">(</span>now<span class="o">)</span>
Duration:            <span class="m">4</span> seconds

STEP                                         TEMPLATE          PODNAME                      DURATION  MESSAGE
 ✔ loops-maps-qzv56                          loop-map-example
 └-·-✔ test-linux<span class="o">(</span>0:image:debian,tag:9.1<span class="o">)</span>    cat-os-release    loops-maps-qzv56-2106556403  2s
   ├-✔ test-linux<span class="o">(</span>1:image:debian,tag:8.9<span class="o">)</span>    cat-os-release    loops-maps-qzv56-2252793177  3s
   ├-✔ test-linux<span class="o">(</span>2:image:alpine,tag:3.6<span class="o">)</span>    cat-os-release    loops-maps-qzv56-3723288758  3s
   └-✔ test-linux<span class="o">(</span>3:image:ubuntu,tag:17.10<span class="o">)</span>  cat-os-release    loops-maps-qzv56-3710784351  2s
</code></pre></td></tr></table>
</div>
</div><p>You can visualize the workflow running in Argo UI.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/03/10/1d9d2235c39645b89fa72f7bfea1317a.png" alt="workflow running in Argo UI"></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">kubernetes</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-03/how-kubernetes-controller-manager-works/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">How Kubernetes Controller Manager works</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-03/memory-virtualization/">
            <span class="next-text nav-default">Operating system memory virtualization</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
