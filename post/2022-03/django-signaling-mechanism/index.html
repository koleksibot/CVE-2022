<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Django&#39;s signaling mechanism - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Django describes signal as a &amp;ldquo;signal dispatcher&amp;rdquo; that triggers multiple applications, mainly in the form of signals. This article will explain how signals work in Django and how to use them from the perspective of source code analysis. Signal class The most common scenario for signal is notifications. For example, if your blog has comments, the system will have a notification mechanism to push the comments to you. If you" /><meta name="keywords" content="django, Signaling, Mechanism" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-03/django-signaling-mechanism/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Django&#39;s signaling mechanism" />
<meta property="og:description" content="Django describes signal as a &ldquo;signal dispatcher&rdquo; that triggers multiple applications, mainly in the form of signals. This article will explain how signals work in Django and how to use them from the perspective of source code analysis. Signal class The most common scenario for signal is notifications. For example, if your blog has comments, the system will have a notification mechanism to push the comments to you. If you" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-03/django-signaling-mechanism/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-12T11:02:18+08:00" />
<meta property="article:modified_time" content="2022-03-12T11:02:18+08:00" />

<meta itemprop="name" content="Django&#39;s signaling mechanism">
<meta itemprop="description" content="Django describes signal as a &ldquo;signal dispatcher&rdquo; that triggers multiple applications, mainly in the form of signals. This article will explain how signals work in Django and how to use them from the perspective of source code analysis. Signal class The most common scenario for signal is notifications. For example, if your blog has comments, the system will have a notification mechanism to push the comments to you. If you"><meta itemprop="datePublished" content="2022-03-12T11:02:18+08:00" />
<meta itemprop="dateModified" content="2022-03-12T11:02:18+08:00" />
<meta itemprop="wordCount" content="1401">
<meta itemprop="keywords" content="django," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Django&#39;s signaling mechanism"/>
<meta name="twitter:description" content="Django describes signal as a &ldquo;signal dispatcher&rdquo; that triggers multiple applications, mainly in the form of signals. This article will explain how signals work in Django and how to use them from the perspective of source code analysis. Signal class The most common scenario for signal is notifications. For example, if your blog has comments, the system will have a notification mechanism to push the comments to you. If you"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Django&#39;s signaling mechanism</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-03-12 11:02:18 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1401 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#signal-class">Signal class</a>
          <ul>
            <li><a href="#receiver">receiver</a></li>
            <li><a href="#sender">sender</a></li>
            <li><a href="#how-to-use-signal">How to use signal</a></li>
          </ul>
        </li>
        <li><a href="#djangos-built-in-signals">Django&rsquo;s built-in signals</a>
          <ul>
            <li><a href="#model-related">Model-related</a></li>
            <li><a href="#request-related">Request related</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Django describes signal as a &ldquo;signal dispatcher&rdquo; that triggers multiple applications, mainly in the form of signals. This article will explain how signals work in Django and how to use them from the perspective of source code analysis.</p>
<h2 id="signal-class">Signal class</h2>
<p>The most common scenario for signal is notifications. For example, if your blog has comments, the system will have a notification mechanism to push the comments to you. If you use signal, you only need to trigger the signal notification when the comment is posted, instead of putting the notification logic after the comment is posted, which greatly reduces the program coupling and facilitates the maintenance of the system later.</p>
<p>Django implements a Signal class, which is used to implement the function of &ldquo;signal dispatcher&rdquo;. The working mechanism is shown in the figure below, which is divided into two parts: first, each callback function that needs to be dispatched is registered to signal, and second, the event triggers <code>sender</code> to send the signal.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/03/12/ea0de0996af34a0487e19f1762979724.png" alt="Django&rsquo;s signaling mechanism"></p>
<h3 id="receiver">receiver</h3>
<p>The signal maintains a list <code>receiver</code> of callback functions and their <code>id</code>s that connect to the signal. Each <code>receiver</code> must be a callback function and accepts the keyword argument <code>**kwarg</code>, and the signal&rsquo;s <code>connect</code> method is used to connect the callback function to the signal.</p>
<p>Let&rsquo;s take a look at the source code of <code>connect</code>, as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">class</span> <span class="nc">Signal</span><span class="p">:</span>

    <span class="o">...</span>
    
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

        <span class="c1"># If DEBUG is on, check that we got a good receiver</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">configured</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="s2">&#34;Signal receivers must be callable.&#34;</span>

            <span class="c1"># Check for **kwargs</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_accepts_kwargs</span><span class="p">(</span><span class="n">receiver</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Signal receivers must accept keyword arguments (**kwargs).&#34;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">weak</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span>
            <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span>
            <span class="c1"># Check for bound methods</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakMethod</span>
                <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">.</span><span class="vm">__self__</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>
            <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">receiver_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_receiver</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">r_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lookup_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>The code is very clean and is divided into four parts: checking parameters, getting the ID of <code>receiver</code>, <code>receiver</code> weak references, and locking. Here we mainly look at the last two parts.</p>
<h4 id="receiver-weak-reference">receiver weak reference</h4>
<p><strong>Preparatory Knowledge.</strong></p>
<p>Weak references: Python&rsquo;s approach to garbage collection is to mark references, and the role of weak references is to avoid memory leaks caused by circular references. The main principle is that when a weak reference is made to an object, the number of references is not added to the reference mark, so when the strong reference to the object is 0, the system still reclaims it, and the weak reference fails.</p>
<p>method and function: Python&rsquo;s functions are the same as those of other languages, including function names and function bodies, and supporting formal parameters; compared to functions, methods have an additional layer of class relationships, that is, they are functions defined in classes. This function is used to configure <code>method</code> step by step, see an excerpt of the source code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="n">PyObject</span> <span class="o">*</span>
<span class="nf">PyMethod_New</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">func</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">self</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">klass</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
        
    <span class="n">im</span><span class="o">-&gt;</span><span class="n">im_weakreflist</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">Py_INCREF</span><span class="p">(</span><span class="n">func</span><span class="p">);</span>
        
    <span class="n">im</span><span class="o">-&gt;</span><span class="n">im_func</span> <span class="o">=</span> <span class="n">func</span><span class="p">;</span>
    <span class="n">Py_XINCREF</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="n">im</span><span class="o">-&gt;</span><span class="n">im_self</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="n">Py_XINCREF</span><span class="p">(</span><span class="n">klass</span><span class="p">);</span>
    <span class="n">im</span><span class="o">-&gt;</span><span class="n">im_class</span> <span class="o">=</span> <span class="n">klass</span><span class="p">;</span>
    <span class="n">_PyObject_GC_TRACK</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="p">)</span><span class="n">im</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In addition to the function attribute <code>im_func</code>, there is an <code>im_self</code> attribute table <code>self</code> and an <code>im_class</code> attribute table <code>class</code> in <code>method</code>.</p>
<p>Bound Method and Unbound Method: Methods can be divided into <code>bound</code> methods and <code>unbound</code> methods. The difference is that <code>bound</code> methods have an additional layer of instance binding, i.e., <code>bound method</code> invokes a method through an instance, while <code>unbound method</code> invokes a method directly through a class.</p>
<p><strong>Weak references in signal:</strong></p>
<p>Anyone familiar with Python garbage collection should know that Python only garbage collects an object when its reference count is 0. Therefore, all references to callback functions in signal are weakly referenced by default to avoid memory leaks.</p>
<p>First, the <code>weak</code> argument to <code>connect</code> indicates whether to use a weak reference, and the default is <code>True</code>; <code>receiver</code> can be either a function or a method, and the reference to <code>bound method</code> is short-lived, in line with the lifetime of the instance, so the standard weak reference is not enough to keep it, and <code>weakref. WeakMethod</code> to emulate the weak reference of <code>bound method</code>; finally the <code>weakref.finalize</code> method returns a callable terminator object that is called when <code>receiver</code> is garbage collected, unlike normal weak references, the terminator will always be alive before it is called and die after it is called, thus greatly simplifying life cycle management.</p>
<h4 id="locking">Locking</h4>
<p>Locks exist to achieve thread safety, which means that when multiple threads are present at the same time, the result still meets expectations. Obviously, the <code>receiver</code> registration process in signal is not inherently thread-safe; the thread-safe method in signal is locking to achieve atomic operation of the <code>connect</code> method.</p>
<p>Locks are defined in the signal&rsquo;s <code>__init__</code> method, using <code>Lock</code> from the standard library.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>signal encapsulates the three operations of cleaning up weakly referenced objects in the <code>receiver</code> list, adding elements to the <code>receiver</code> list, and cleaning up the global cache dictionary into atomic operations using thread locks, as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lookup_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="sender">sender</h3>
<p>To be precise, the <code>sender</code> in signal is an identifier to record &ldquo;who&rdquo; triggered the signal, what really works is the <code>send</code> method, which is used in the <code>event</code> to trigger the signal to all <code>receivers</code> &ldquo;in <code>event</code>. Here is the source code for <code>send</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">class</span> <span class="nc">Signal</span><span class="p">:</span>

    <span class="o">...</span>
    
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
        <span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>It is easy to see that the process of triggering all the recorded callback functions is synchronous, so signal is not suitable for handling large batches of tasks, but we can rewrite it as asynchronous tasks.</p>
<h3 id="how-to-use-signal">How to use signal</h3>
<p>The use of signal requires only two configurations, one is the registration of the callback function, and the other is the event triggering.</p>
<p>There are two ways to register callback functions, one is the regular <code>signal.connect()</code>; the other is that Django signal provides a decorator <code>receiver</code>, which can be decorated by passing in which signal it is, or you can specify <code>sender</code>, and if you don&rsquo;t specify it, you receive all the information sent by <code>sender</code>. Event triggering is done by calling <code>&lt;your_signal&gt;.send()</code> where it can be triggered. A demo is given below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">receiver</span>

<span class="n">signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>


<span class="nd">@receiver</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&#34;main&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_receiver</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;here is my receiver.&#34;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;hello sender: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;begin...&#34;</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="s2">&#34;main&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Output.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">begin</span><span class="o">...</span>
<span class="n">here</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">receiver</span><span class="o">.</span>
<span class="n">hello</span> <span class="n">sender</span><span class="p">:</span> <span class="n">main</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="djangos-built-in-signals">Django&rsquo;s built-in signals</h2>
<p>Django has a number of built-in signals that we can use directly.</p>
<h3 id="model-related">Model-related</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">pre_init</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;instance&#34;</span><span class="p">,</span> <span class="s2">&#34;args&#34;</span><span class="p">,</span> <span class="s2">&#34;kwargs&#34;</span><span class="p">],</span> <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># 对象初始化前</span>
<span class="n">post_init</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;instance&#34;</span><span class="p">],</span> <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1">#对象初始化后</span>

<span class="n">pre_save</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;instance&#34;</span><span class="p">,</span> <span class="s2">&#34;raw&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">,</span> <span class="s2">&#34;update_fields&#34;</span><span class="p">],</span>
                       <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># 对象保存修改前</span>
<span class="n">post_save</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;instance&#34;</span><span class="p">,</span> <span class="s2">&#34;raw&#34;</span><span class="p">,</span> <span class="s2">&#34;created&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">,</span> <span class="s2">&#34;update_fields&#34;</span><span class="p">],</span> <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1">#对象保存修改后</span>

<span class="n">pre_delete</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;instance&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">],</span> <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1">#对象删除前</span>
<span class="n">post_delete</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;instance&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">],</span> <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1">#对象删除后</span>

<span class="n">m2m_changed</span> <span class="o">=</span> <span class="n">ModelSignal</span><span class="p">(</span>
    <span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;action&#34;</span><span class="p">,</span> <span class="s2">&#34;instance&#34;</span><span class="p">,</span> <span class="s2">&#34;reverse&#34;</span><span class="p">,</span> <span class="s2">&#34;model&#34;</span><span class="p">,</span> <span class="s2">&#34;pk_set&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">],</span>
    <span class="n">use_caching</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1">#ManyToManyField 字段更新后触发</span>

<span class="n">pre_migrate</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;app_config&#34;</span><span class="p">,</span> <span class="s2">&#34;verbosity&#34;</span><span class="p">,</span> <span class="s2">&#34;interactive&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">,</span> <span class="s2">&#34;apps&#34;</span><span class="p">,</span> <span class="s2">&#34;plan&#34;</span><span class="p">])</span>  <span class="c1">#数据迁移前</span>
<span class="n">post_migrate</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;app_config&#34;</span><span class="p">,</span> <span class="s2">&#34;verbosity&#34;</span><span class="p">,</span> <span class="s2">&#34;interactive&#34;</span><span class="p">,</span> <span class="s2">&#34;using&#34;</span><span class="p">,</span> <span class="s2">&#34;apps&#34;</span><span class="p">,</span> <span class="s2">&#34;plan&#34;</span><span class="p">])</span>  <span class="c1">#数据迁移后</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="request-related">Request related</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">request_started</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;environ&#34;</span><span class="p">])</span>  <span class="c1">#request 请求前</span>
<span class="n">request_finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>  <span class="c1">#request 请求后</span>
<span class="n">got_request_exception</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;request&#34;</span><span class="p">])</span>  <span class="c1">#request 请求出错后</span>
<span class="n">setting_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;setting&#34;</span><span class="p">,</span> <span class="s2">&#34;value&#34;</span><span class="p">,</span> <span class="s2">&#34;enter&#34;</span><span class="p">])</span>  <span class="c1">#request 请求某些设置被修改后</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/django/">django</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-03/kubernetes-knowledge-base/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Getting Started with Kubernetes - A Knowledge Base</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-03/k8s-pod/">
            <span class="next-text nav-default">Getting Started with Kubernetes - Pods Explained</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
