<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>When JS WeakMap should be used - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="When does WeakMap work? First of all, we must understand that even without WeakMap, the world of JS is also running as usual, WeakMap in the JS world, and its name is the same - &amp;ldquo;weak&amp;rdquo;, weak. Belong to the kind of role, but not in the key position to do great things, somewhat similar to some CSS function selector, although simpler and more convenient to use, but usually use" /><meta name="keywords" content="javascript,WeakMap" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-08/js-weakmap-es6/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="When JS WeakMap should be used" />
<meta property="og:description" content="When does WeakMap work? First of all, we must understand that even without WeakMap, the world of JS is also running as usual, WeakMap in the JS world, and its name is the same - &ldquo;weak&rdquo;, weak. Belong to the kind of role, but not in the key position to do great things, somewhat similar to some CSS function selector, although simpler and more convenient to use, but usually use" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-08/js-weakmap-es6/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-08-15T19:31:10+08:00" />
<meta property="article:modified_time" content="2021-08-15T19:31:10+08:00" />

<meta itemprop="name" content="When JS WeakMap should be used">
<meta itemprop="description" content="When does WeakMap work? First of all, we must understand that even without WeakMap, the world of JS is also running as usual, WeakMap in the JS world, and its name is the same - &ldquo;weak&rdquo;, weak. Belong to the kind of role, but not in the key position to do great things, somewhat similar to some CSS function selector, although simpler and more convenient to use, but usually use"><meta itemprop="datePublished" content="2021-08-15T19:31:10+08:00" />
<meta itemprop="dateModified" content="2021-08-15T19:31:10+08:00" />
<meta itemprop="wordCount" content="1743">
<meta itemprop="keywords" content="javascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="When JS WeakMap should be used"/>
<meta name="twitter:description" content="When does WeakMap work? First of all, we must understand that even without WeakMap, the world of JS is also running as usual, WeakMap in the JS world, and its name is the same - &ldquo;weak&rdquo;, weak. Belong to the kind of role, but not in the key position to do great things, somewhat similar to some CSS function selector, although simpler and more convenient to use, but usually use"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">When JS WeakMap should be used</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-08-15 19:31:10 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 1743 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#when-does-weakmap-work">When does WeakMap work?</a>
          <ul>
            <li><a href="#usage-scenarios">Usage Scenarios</a></li>
            <li><a href="#summary">Summary</a></li>
          </ul>
        </li>
        <li><a href="#back-to-the-weakmap-syntax-itself">Back to the WeakMap syntax itself</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="when-does-weakmap-work">When does WeakMap work?</h2>
<p>First of all, we must understand that even without WeakMap, the world of JS is also running as usual, WeakMap in the JS world, and its name is the same - &ldquo;weak&rdquo;, weak.</p>
<p>Belong to the kind of role, but not in the key position to do great things, somewhat similar to some CSS function selector, although simpler and more convenient to use, but usually use JS to achieve a pretty good interactive effect, so it is not so popular and popular.</p>
<p>WeakMap is the role of more effective garbage collection, release memory.</p>
<p>We usually develop Web applications are so simple, even if the code is very garbage, eat a lot of memory, so what, the page is still smooth, the user as usual no perception.</p>
<p>So, for most developers and applications, the business value of WeakMap is very low.</p>
<p>So it seems that WeakMap is nothing to learn.</p>
<p>But it&rsquo;s not.</p>
<p>If it is a mega-application, or a product with a large user base, or a server with a high load scenario, the requirements for memory management are very high, and the advantages of WeakMap can be reflected at this time.</p>
<p>This is actually a bit of a paradox in the flavor.</p>
<p>All the above scenarios that need to use WeakMap must be scenarios that require senior front-end development, and if you don&rsquo;t even know WeakMap, you can&rsquo;t talk about seniority.</p>
<p>That is, you learn WeakMap and similar JS knowledge points, only to have the opportunity to participate in the project must use these JS features, to complete the proof of self-worth and contribution.</p>
<p>So, there is no knowledge is useless, just a matter of timing, the so-called thick and thin, is such a meaning.</p>
<p>Garbage? Memory?</p>
<p>As far as memory management is concerned, JS developers can be grouped into the following categories.</p>
<ol>
<li>memory? What memory? I can write whatever I want in JS, and it runs just fine! Anyway, the browser page is closed and nothing is left. 2.</li>
<li>well, after this object is useless, I can set it to null. awareness is good, set also set, but whether the memory is released or not is unknown, see the luck. 3.</li>
<li>here set null can not, because the object is also referenced in other places, other references to the place to delete, belong to a deeper understanding of the JS basic skills are very solid.</li>
</ol>
<p>To give an example that is easier for everyone to understand, the page is known to have a DOM element, the HTML structure is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;img&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://bookcover.yuewen.com/qdbimg/349573/1027030348/180&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, this DOM element needs to be deleted, and this is how Xiaoming handles it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p>Is there anything wrong with this treatment?</p>
<p>In terms of effect, it completely solves the need.</p>
<p>But in fact, although the image element in the page is deleted, the DOM object in memory still exists.</p>
<p>Let&rsquo;s test it like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">eleImage</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>You will see that the image is deleted (as in the following GIF recording), and then it appears on the page again after 2 seconds, because the eleImage is still in memory, not cleared, and will not be recycled.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/15/eddd81ee2c3f42d2ab56f22306e91d60.gif" alt=" "></p>
<p>So, if you determine that the eleImage is no longer needed, you need to execute one more sentence while setting it to null.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="nx">eleImage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>This way, when JS performs garbage collection, it will take back the garbage that is eleImage and release the memory.</p>
<p>You can see if you are the type of JS developer who doesn&rsquo;t care about memory, or the type of JS developer who pays attention to freeing up unwanted memory.</p>
<p>OK, it&rsquo;s not over yet. Sometimes, setting eleImage to null doesn&rsquo;t really reclaim memory.</p>
<p>Practical development, for example, sometimes requires remembering the initial outerHTML characters for easy restoration. In order to associate with the original DOM, some developments manage DOM elements and outerHTML strings in the same array:.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">storage</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">arrDom</span><span class="o">:</span> <span class="p">[</span><span class="nx">eleImage</span><span class="p">,</span> <span class="nx">eleImage</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">]</span>
<span class="p">};</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="nx">eleImage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>At this point, the eleImage DOM object is still in memory. Because eleImage is referenced by storage.arrDom, even if eleImage is set to null, the memory cannot be completely freed.</p>
<p>Test.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">storage</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">arrDom</span><span class="o">:</span> <span class="p">[</span><span class="nx">eleImage</span><span class="p">,</span> <span class="nx">eleImage</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">]</span>
<span class="p">};</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="nx">eleImage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">storage</span><span class="p">.</span><span class="nx">arrDom</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Again, you can see that the image was deleted and then reappeared 2 seconds later.</p>
<p>At this point, to completely free the memory of the image, the following line still needs to be executed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">storage</span><span class="p">.</span><span class="nx">arrDom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Imagine if you could free up memory to do this? If you can, then you can be categorized as a senior JS front-end developer.</p>
<p>However, it is too tiring to manually identify which areas of memory to release purely by technical means. Even if people who know how to do this sometimes don&rsquo;t bother to manage it, is there any means by which I can just set the variable to null and have all the memory in the referenced places automatically released?</p>
<p>This can be considered using WeakMap.</p>
<h3 id="usage-scenarios">Usage Scenarios</h3>
<p>What would the above example look like if implemented back using WeakMap?</p>
<p>Code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">storeMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WeakMap</span><span class="p">();</span>
<span class="nx">storeMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">eleImage</span><span class="p">,</span> <span class="nx">eleImage</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">);</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="nx">eleImage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>The same is true for caching the outerHTML data of the image, but here a WeakMap object is used, with eleImage as a weak key, so that once eleImage is set to null, all related data will be freed.</p>
<p>Whether the memory is freed or not, the above example is not good to test, one is to use tools, and the other is that the memory change is too small to see.</p>
<p>However, we can use Map object to compare, if it is a Map object, eleImage as a key, that is a strong reference, is always in memory, for example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">eleImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">storeMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
<span class="nx">storeMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">eleImage</span><span class="p">,</span> <span class="nx">eleImage</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">);</span>
<span class="nx">eleImage</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="nx">eleImage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">storeMap</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, although the eleImage is removed and set to null, it is still in memory and can be appended to the page.</p>
<p>Based on the above analysis and description, we can draw the following conclusion.</p>
<h3 id="summary">Summary</h3>
<p>When we need to temporarily store data on an object, use WeakMap, especially for developers who don&rsquo;t have a deep understanding of JS, because it saves them from worrying about the &ldquo;memory leak&rdquo; problem that is often talked about.</p>
<p>Because when the time comes to delete the object, all the relevant references and associated memory will be released.</p>
<p>That is, although I can not understand how the code is executed, but I write so that the performance is good, the style is high!</p>
<h2 id="back-to-the-weakmap-syntax-itself">Back to the WeakMap syntax itself</h2>
<p>Having said that, it&rsquo;s time to introduce the WeakMap syntax.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">myWm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WeakMap</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>At this point, myWm is a new WeakMap object that includes the following methods.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// delete key
</span><span class="c1"></span><span class="nx">myWm</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="c1">// set key &amp; value
</span><span class="c1"></span><span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="c1">// Does it contain a key
</span><span class="c1"></span><span class="nx">myWm</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="c1">// Get the value corresponding to the key
</span><span class="c1"></span><span class="nx">myWm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Description</p>
<ul>
<li>key can only be an object, not a primitive data type (string, number, true or false, null, undefined, symbol, etc.)</li>
<li>keys in WeakMap are not enumerable</li>
</ul>
<p>The key can only be an object</p>
<p>The following uses are all possible.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">([],</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="s1">&#39;鑫空间&#39;</span><span class="p">);</span>
<span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">(()=&gt;{},</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;by-zhangxinxu&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>But if the key is not an object, but a basic type like a string, it will report an error, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// An exception will be thrown
</span><span class="c1">// “TypeError: Invalid value used as weak map key
</span><span class="c1"></span><span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;css新世界&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Therefore, WeakMap is suitable for scenarios where data is temporarily cached on objects.</p>
<p>key cannot be enumerated</p>
<p>Unlike Map objects, Map objects can be enumerated and have <code>keys()</code>, <code>values()</code>, <code>entries()</code> methods, and can be traversed using <code>forEach</code>.</p>
<p>But WeakMap cannot be enumerated, and this feature of WeakMap can also be used to simulate private properties.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">myWm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WeakMap</span><span class="p">();</span>
<span class="kr">class</span> <span class="nx">Fish</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myWm</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span> 
            <span class="nx">_fishbone</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;草鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;鲫鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;青鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;鲤鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;鲢鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;鳙鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;鳊鱼&#39;</span><span class="p">,</span> <span class="s1">&#39;翘嘴&#39;</span><span class="p">,</span> <span class="s1">&#39;餐条&#39;</span><span class="p">],</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">isBone</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">myWm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">_fishbone</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 测试，买了两条鱼
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">fish1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fish</span><span class="p">(</span><span class="s1">&#39;草鱼&#39;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">fish2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fish</span><span class="p">(</span><span class="s1">&#39;回鱼&#39;</span><span class="p">);</span>

<span class="c1">// 返回 true，有刺
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fish1</span><span class="p">.</span><span class="nx">isBone</span><span class="p">());</span>
<span class="c1">// 返回 false，没有肌间刺
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fish2</span><span class="p">.</span><span class="nx">isBone</span><span class="p">());</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above code, _fishbone is associated with Fish object, but it can&rsquo;t be obtained directly through Fish object.</p>
<p>If the name is not known, it cannot be traversed by myWm.</p>
<p>For more detailed syntax and illustration of WeakMap, please refer to MDN document: MDN WeakMap</p>
<hr>
<p>Reference <code>https://www.zhangxinxu.com/wordpress/2021/08/js-weakmap-es6/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascript/">javascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-08/git-cherry-pick/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">git cherry-pick tutorial</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-08/github-deprecates-passwords-for-git-operations/">
            <span class="next-text nav-default">GitHub has deprecated password-based authentication for Git operations</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
