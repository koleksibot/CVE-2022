<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>GoReplay Manual - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="1. Installation GoReplay is written in Go and has a single executable file, which can be downloaded from the official Release page and placed in the PATH directory.
1 2 3  wget https://github.com/buger/goreplay/releases/download/v1.2.0/gor_v1.2.0_x64.tar.gz tar -zxvf gor_v1.2.0_x64.tar.gz mv gor /usr/local/bin   2. Basic Use The overall use of the GoReplay command line is to specify the input and input side, and then GoReplay copies the traffic from the input side to the output side." /><meta name="keywords" content="GoReplay" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-08/go-replay-manual/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="GoReplay Manual" />
<meta property="og:description" content="1. Installation GoReplay is written in Go and has a single executable file, which can be downloaded from the official Release page and placed in the PATH directory.
1 2 3  wget https://github.com/buger/goreplay/releases/download/v1.2.0/gor_v1.2.0_x64.tar.gz tar -zxvf gor_v1.2.0_x64.tar.gz mv gor /usr/local/bin   2. Basic Use The overall use of the GoReplay command line is to specify the input and input side, and then GoReplay copies the traffic from the input side to the output side." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-08/go-replay-manual/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-08-07T12:56:19+08:00" />
<meta property="article:modified_time" content="2021-08-07T12:56:19+08:00" />

<meta itemprop="name" content="GoReplay Manual">
<meta itemprop="description" content="1. Installation GoReplay is written in Go and has a single executable file, which can be downloaded from the official Release page and placed in the PATH directory.
1 2 3  wget https://github.com/buger/goreplay/releases/download/v1.2.0/gor_v1.2.0_x64.tar.gz tar -zxvf gor_v1.2.0_x64.tar.gz mv gor /usr/local/bin   2. Basic Use The overall use of the GoReplay command line is to specify the input and input side, and then GoReplay copies the traffic from the input side to the output side."><meta itemprop="datePublished" content="2021-08-07T12:56:19+08:00" />
<meta itemprop="dateModified" content="2021-08-07T12:56:19+08:00" />
<meta itemprop="wordCount" content="1420">
<meta itemprop="keywords" content="GoReplay,golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GoReplay Manual"/>
<meta name="twitter:description" content="1. Installation GoReplay is written in Go and has a single executable file, which can be downloaded from the official Release page and placed in the PATH directory.
1 2 3  wget https://github.com/buger/goreplay/releases/download/v1.2.0/gor_v1.2.0_x64.tar.gz tar -zxvf gor_v1.2.0_x64.tar.gz mv gor /usr/local/bin   2. Basic Use The overall use of the GoReplay command line is to specify the input and input side, and then GoReplay copies the traffic from the input side to the output side."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">GoReplay Manual</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-08-07 12:56:19 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/tools/"> tools </a>
            </div>
          <span class="more-meta"> 1420 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-installation">1. Installation</a></li>
        <li><a href="#2-basic-use">2. Basic Use</a>
          <ul>
            <li><a href="#21-real-time-traffic-replication">2.1. Real-time traffic replication</a></li>
            <li><a href="#22-traffic-crawling-and-replay">2.2. Traffic crawling and replay</a></li>
            <li><a href="#23-data-loss-and-buffers">2.3. Data Loss and Buffers</a></li>
            <li><a href="#24-speed-limit">2.4. Speed limit</a></li>
            <li><a href="#25-request-filtering">2.5. Request Filtering</a></li>
            <li><a href="#26-request-rewrite">2.6. Request Rewrite</a></li>
          </ul>
        </li>
        <li><a href="#3-other-advanced-configurations">3. Other advanced configurations</a>
          <ul>
            <li><a href="#31-relay-server">3.1. Relay server</a></li>
            <li><a href="#32-output-to-elasticsearch">3.2. Output to ElasticSearch</a></li>
            <li><a href="#33-kafka-docking">3.3. Kafka Docking</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-installation">1. Installation</h2>
<p>GoReplay is written in Go and has a single executable file, which can be downloaded from the official <a href="https://github.com/buger/goreplay/releases">Release</a> page and placed in the <code>PATH</code> directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">wget https://github.com/buger/goreplay/releases/download/v1.2.0/gor_v1.2.0_x64.tar.gz
tar -zxvf gor_v1.2.0_x64.tar.gz
mv gor /usr/local/bin
</code></pre></td></tr></table>
</div>
</div><h2 id="2-basic-use">2. Basic Use</h2>
<p>The overall use of the GoReplay command line is to specify the input and input side, and then GoReplay copies the traffic from the input side to the output side.</p>
<h3 id="21-real-time-traffic-replication">2.1. Real-time traffic replication</h3>
<p>The GoReplay input can specify a tcp address, and GoReplay will then copy the traffic from that port to the output; the following example shows copying traffic from <code>127.0.0.0:8000</code> and outputting it to the console.</p>
<p>First start an HTTP Server, here we use the <code>python</code> HTTP Server directly</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/57b07a5a4d0b4368b3c11f9da58e3964.png" alt=" "></p>
<p><strong>then have gor listen to the same port, <code>--output-stdout</code> specifying the output as the console</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/b8954931cd9d4b34b085d7e17614e0d4.png" alt=" "></p>
<p><strong>At this point, accessing <code>python</code>&rsquo;s HTTP Server via <code>curl</code> shows that gor copies the HTTP request and outputs it to the console</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/eca3572897fa4566a8af48ad6716f813.png" alt=" "></p>
<p>Also if we specify the output side as another HTTP Server with the <code>-output-http</code> option, then gor will synchronize the request and send it to the output HTTP Server.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/8d02a68bcb7344248a119adc4b602f6c.png" alt=" "></p>
<h3 id="22-traffic-crawling-and-replay">2.2. Traffic crawling and replay</h3>
<h4 id="221--basic-use">2.2.1.  Basic use</h4>
<p>GoReplay can save traffic to a file by specifying the output as a file, and then GoReplay reads that saved traffic file and redeploys it to the specified HTTP Server.</p>
<p><strong>First save the request to a file with the <code>-outpu-file</code> option</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/19af407f7dc440eabfa00d7b87af7406.png" alt=" "></p>
<p><strong>Read the traffic information using the <code>-input-file</code> option and then redirect it to the target server using the <code>-output-http</code> option</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/b2e210c8d45d46e0a7b2d2fa3d4fa0ca.png" alt=" "></p>
<h4 id="222-extended-options">2.2.2. Extended Options</h4>
<p>When saving traffic to a file, by default GoReplay writes to the file in blocks and each block will generate a separate file name ( <code>test_0.gor</code> ), if you want to write all blocks of traffic to one file, <strong>you can set <code>--output-file-append</code> to <code>true</code>.</strong></p>
<p>Also, GoReplay output file names support date placeholders, e.g. <code>--output-file %Y%m%d.gor</code> will generate a file name like <code>20210801.gor</code>; all available date placeholders are as follows:</p>
<ul>
<li><code>%Y</code> : year including the century (at least 4 digits)</li>
<li><code>%m</code> : month of the year (01..12)</li>
<li><code>%d</code> : Day of the month (01..31)</li>
<li><code>%H</code> : Hour of the day, 24-hour clock (00..23)</li>
<li><code>%M</code> : Minute of the hour (00..59)</li>
<li><code>%S</code> : Second of the minute (00..60)</li>
</ul>
<p>When there are many requests, saving the traffic to a file may result in a large file, so you can use the .gz ending as the file name, and GoReplay will automatically compress it with GZip when it reads the .gz suffix.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gor --input-raw :8000 --output-file test.gor.gz
</code></pre></td></tr></table>
</div>
</div><p>If you need to replay multiple files in aggregate, just specify multiple files and GoReplay will automatically keep the request order during replay:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gor --input-file *.gor --output-http http://127.0.0.1:8080
</code></pre></td></tr></table>
</div>
</div><p>When using file input, GoReplay also supports stress tests, where GoReplay will replay requests at twice the rate for file names specified by test.gor|200%:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Replay from file on 2x speed </span>
gor --input-file <span class="s2">&#34;requests.gor|200%&#34;</span> --output-http <span class="s2">&#34;staging.com&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="23-data-loss-and-buffers">2.3. Data Loss and Buffers</h3>
<p>GoReplay uses a relatively low-level packet interception technique, where the kernel GoReplay intercepts a TCP packet when it arrives; however, packets can arrive out of order, and then the kernel needs to rebuild the TCP stream to ensure that upper-layer applications can read TCP packets in the correct order, at which point the kernel has a buffer of packets; by default, Linux systems have a buffer of By default, Linux systems have a buffer of 2M and Windiws have a buffer of 1M. When a particular HTTP request packet exceeds the buffer, GoReplay cannot intercept it properly (because GoReplay needs a complete HTTP request packet for saving to a file or replaying), and it may cause problems such as lost requests, corrupted requests, etc.</p>
<p>To solve this problem, GoReplay provides <code>-input-raw-buffer-size</code> option to adjust the buffer size, for example <code>-input-raw-buffer-size 10485760</code> option will adjust the buffer to 10M.</p>
<h3 id="24-speed-limit">2.4. Speed limit</h3>
<p>In some cases, for debugging purposes, we may capture traffic in the production environment and mirror it to the test environment for replay; however, we may not need such a large request rate due to the high volume of traffic in the production environment, so we can let GoReplay control the number of requests for us through rate limiting.</p>
<p><strong>Absolute number limit:</strong> With parameters of the form <code>-output-http &quot;ADDRESS|N&quot;</code>, GoReplay guarantees that the mirrored traffic will not exceed &ldquo;N&rdquo; requests per second.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># staging.server will not get more than ten requests per second</span>
gor --input-tcp :28020 --output-http <span class="s2">&#34;http://staging.com|10&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Percent limit restriction:</strong> With parameters of the form <code>-output-http &quot;ADDRESS|N%&quot;</code>, GoReplay ensures that mirrored traffic is maintained at &ldquo;N%&rdquo; of the total traffic.</p>
<h3 id="25-request-filtering">2.5. Request Filtering</h3>
<p>At some point we only expect to redirect specific traffic from the production environment to the test environment, or to disallow some traffic from being redirected to the test environment, at which point we can use GoReplay&rsquo;s filtering capabilities; GoReplay provides the following options to provide filtering capabilities:</p>
<ul>
<li><code>-http-allow-header</code> : HTTP header to allow replay (regular support)</li>
<li><code>-http-allow-method</code> : HTTP methods that are allowed to be replayed</li>
<li><code>--http-allow-url</code> : URL to allow replay (regular support)</li>
<li><code>--http-disallow-header</code> : HTTP headers that are not allowed (regularity supported)</li>
<li><code>--http-disallow-url</code> : disallowed HTTP URLs (regular support)</li>
</ul>
<p>Here is a sample of the official command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># only forward requests being sent to the /api endpoint</span>
gor --input-raw :8080 --output-http staging.com --http-allow-url /api

<span class="c1"># only forward requests NOT being sent to the /api... endpoint</span>
gor --input-raw :8080 --output-http staging.com --http-disallow-url /api

<span class="c1"># only forward requests with an api version of 1.0x</span>
gor --input-raw :8080 --output-http staging.com --http-allow-header api-version:^1<span class="se">\.</span>0<span class="se">\d</span>

<span class="c1"># only forward requests NOT containing User-Agent header value &#34;Replayed by Gor&#34;</span>
gor --input-raw :8080 --output-http staging.com --http-disallow-header <span class="s2">&#34;User-Agent: Replayed by Gor&#34;</span>

gor --input-raw :80 --output-http <span class="s2">&#34;http://staging.server&#34;</span> <span class="se">\
</span><span class="se"></span>    --http-allow-method GET <span class="se">\
</span><span class="se"></span>    --http-allow-method OPTIONS
</code></pre></td></tr></table>
</div>
</div><h3 id="26-request-rewrite">2.6. Request Rewrite</h3>
<p>Sometimes the URL path of the test environment may be completely different from the production environment, so if you replay the traffic from the production environment in the test environment directly, it may lead to the wrong request path and so on; for this reason GoReplay provides URL rewriting, parameter setting, request header setting and other functions.</p>
<p><strong>URL rewriting via <code>-http-rewrite-url</code> option</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Rewrites all `/v1/user/&lt;user_id&gt;/ping` requests to `/v2/user/&lt;user_id&gt;/ping`</span>
gor --input-raw :8080 --output-http staging.com --http-rewrite-url /v1/user/<span class="o">([</span>^<span class="se">\\</span>/<span class="o">]</span>+<span class="o">)</span>/ping:/v2/user/<span class="nv">$1</span>/ping
</code></pre></td></tr></table>
</div>
</div><h4 id="set-url-parameters">Set URL parameters</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gor --input-raw :8080 --output-http staging.com --http-set-param <span class="nv">api_key</span><span class="o">=</span><span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>Set the request header</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gor --input-raw :80 --output-http <span class="s2">&#34;http://staging.server&#34;</span> <span class="se">\
</span><span class="se"></span>    --http-header <span class="s2">&#34;User-Agent: Replayed by Gor&#34;</span> <span class="se">\
</span><span class="se"></span>    --http-header <span class="s2">&#34;Enable-Feature-X: true&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Host header is a special request header, by default GoReplay will automatically set it to the domain name of the target replay address, if you want to turn off this default behavior use the <code>-http-original-host</code> option</strong></p>
<h2 id="3-other-advanced-configurations">3. Other advanced configurations</h2>
<h3 id="31-relay-server">3.1. Relay server</h3>
<p>GoReplay can use a relay server to chain traffic. To use a relay server, simply set the output side to TCP mode and the input side of the relay server to TCP mode:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Run on servers where you want to catch traffic. You can run it on each `web` machine.</span>
gor --input-raw :80 --output-tcp replay.local:28020

<span class="c1"># Replay server (replay.local).</span>
gor --input-tcp replay.local:28020 --output-http http://staging.com
</code></pre></td></tr></table>
</div>
</div><p>If there are multiple relay servers, you can use the <code>-split-output</code> option to have each GoReplay that grabs traffic send traffic to each relay server using a polling algorithm:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gor --input-raw :80 --split-output --output-tcp replay1.local:28020 --output-tcp replay2.local:28020
</code></pre></td></tr></table>
</div>
</div><h3 id="32-output-to-elasticsearch">3.2. Output to ElasticSearch</h3>
<p>GoReplay supports setting the output side to ElasticSearch:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">./gor --input-raw :8000 --output-http http://staging.com --output-http-elasticsearch localhost:9200/gor
</code></pre></td></tr></table>
</div>
</div><p>There is no need to create indexes before exporting to ES, GoReplay will do it automatically and the data structure after exporting to ES is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">ESRequestResponse</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">ReqURL</span>               <span class="kt">string</span> <span class="s">`json:&#34;Req_URL&#34;`</span>
	<span class="nx">ReqMethod</span>            <span class="kt">string</span> <span class="s">`json:&#34;Req_Method&#34;`</span>
	<span class="nx">ReqUserAgent</span>         <span class="kt">string</span> <span class="s">`json:&#34;Req_User-Agent&#34;`</span>
	<span class="nx">ReqAcceptLanguage</span>    <span class="kt">string</span> <span class="s">`json:&#34;Req_Accept-Language,omitempty&#34;`</span>
	<span class="nx">ReqAccept</span>            <span class="kt">string</span> <span class="s">`json:&#34;Req_Accept,omitempty&#34;`</span>
	<span class="nx">ReqAcceptEncoding</span>    <span class="kt">string</span> <span class="s">`json:&#34;Req_Accept-Encoding,omitempty&#34;`</span>
	<span class="nx">ReqIfModifiedSince</span>   <span class="kt">string</span> <span class="s">`json:&#34;Req_If-Modified-Since,omitempty&#34;`</span>
	<span class="nx">ReqConnection</span>        <span class="kt">string</span> <span class="s">`json:&#34;Req_Connection,omitempty&#34;`</span>
	<span class="nx">ReqCookies</span>           <span class="kt">string</span> <span class="s">`json:&#34;Req_Cookies,omitempty&#34;`</span>
	<span class="nx">RespStatus</span>           <span class="kt">string</span> <span class="s">`json:&#34;Resp_Status&#34;`</span>
	<span class="nx">RespStatusCode</span>       <span class="kt">string</span> <span class="s">`json:&#34;Resp_Status-Code&#34;`</span>
	<span class="nx">RespProto</span>            <span class="kt">string</span> <span class="s">`json:&#34;Resp_Proto,omitempty&#34;`</span>
	<span class="nx">RespContentLength</span>    <span class="kt">string</span> <span class="s">`json:&#34;Resp_Content-Length,omitempty&#34;`</span>
	<span class="nx">RespContentType</span>      <span class="kt">string</span> <span class="s">`json:&#34;Resp_Content-Type,omitempty&#34;`</span>
	<span class="nx">RespTransferEncoding</span> <span class="kt">string</span> <span class="s">`json:&#34;Resp_Transfer-Encoding,omitempty&#34;`</span>
	<span class="nx">RespContentEncoding</span>  <span class="kt">string</span> <span class="s">`json:&#34;Resp_Content-Encoding,omitempty&#34;`</span>
	<span class="nx">RespExpires</span>          <span class="kt">string</span> <span class="s">`json:&#34;Resp_Expires,omitempty&#34;`</span>
	<span class="nx">RespCacheControl</span>     <span class="kt">string</span> <span class="s">`json:&#34;Resp_Cache-Control,omitempty&#34;`</span>
	<span class="nx">RespVary</span>             <span class="kt">string</span> <span class="s">`json:&#34;Resp_Vary,omitempty&#34;`</span>
	<span class="nx">RespSetCookie</span>        <span class="kt">string</span> <span class="s">`json:&#34;Resp_Set-Cookie,omitempty&#34;`</span>
	<span class="nx">Rtt</span>                  <span class="kt">int64</span>  <span class="s">`json:&#34;RTT&#34;`</span>
	<span class="nx">Timestamp</span>            <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="33-kafka-docking">3.3. Kafka Docking</h3>
<p>In addition to exporting to ES, GoReplay also supports exporting to Kafka and reading data from Kafka:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gor --input-raw :8080 --output-kafka-host <span class="s1">&#39;192.168.0.1:9092,192.168.0.2:9092&#39;</span> --output-kafka-topic <span class="s1">&#39;kafka-log&#39;</span>

gor --input-kafka-host <span class="s1">&#39;192.168.0.1:9092,192.168.0.2:9092&#39;</span> --input-kafka-topic <span class="s1">&#39;kafka-log&#39;</span> --output-stdout
</code></pre></td></tr></table>
</div>
</div><hr>
<p>Reference <code>https://mritd.com/2021/08/03/use-goreplay-to-record-your-live-traffic/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/goreplay/">GoReplay</a>
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-08/cracking-recaptcha/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Cracking ReCaptcha with YesCaptcha</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-08/apache-parquet/">
            <span class="next-text nav-default">Introduction to Apache Parquet column-oriented Storage Format</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
