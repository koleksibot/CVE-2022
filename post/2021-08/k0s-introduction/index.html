<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>K0s Introduction - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="I&amp;rsquo;ve been using kubeadm to deploy kubernetes clusters for the last two years, and it&amp;rsquo;s generally convenient to work with some of my own small scripts and some automation tools; however, I&amp;rsquo;m really worried about the stability of full containerization, and I&amp;rsquo;ve encountered inexplicable certificate expiration errors, and finally rebooted to solve such problems; so I&amp;rsquo;m also exploring more convenient binary deployment methods, such as this k0s. 1. k0s Introduction" /><meta name="keywords" content="k0s,kubernetes" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-08/k0s-introduction/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="K0s Introduction" />
<meta property="og:description" content="I&rsquo;ve been using kubeadm to deploy kubernetes clusters for the last two years, and it&rsquo;s generally convenient to work with some of my own small scripts and some automation tools; however, I&rsquo;m really worried about the stability of full containerization, and I&rsquo;ve encountered inexplicable certificate expiration errors, and finally rebooted to solve such problems; so I&rsquo;m also exploring more convenient binary deployment methods, such as this k0s. 1. k0s Introduction" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-08/k0s-introduction/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-08-06T18:49:13+08:00" />
<meta property="article:modified_time" content="2021-08-06T18:49:13+08:00" />

<meta itemprop="name" content="K0s Introduction">
<meta itemprop="description" content="I&rsquo;ve been using kubeadm to deploy kubernetes clusters for the last two years, and it&rsquo;s generally convenient to work with some of my own small scripts and some automation tools; however, I&rsquo;m really worried about the stability of full containerization, and I&rsquo;ve encountered inexplicable certificate expiration errors, and finally rebooted to solve such problems; so I&rsquo;m also exploring more convenient binary deployment methods, such as this k0s. 1. k0s Introduction"><meta itemprop="datePublished" content="2021-08-06T18:49:13+08:00" />
<meta itemprop="dateModified" content="2021-08-06T18:49:13+08:00" />
<meta itemprop="wordCount" content="3061">
<meta itemprop="keywords" content="kubernetes,k0s," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="K0s Introduction"/>
<meta name="twitter:description" content="I&rsquo;ve been using kubeadm to deploy kubernetes clusters for the last two years, and it&rsquo;s generally convenient to work with some of my own small scripts and some automation tools; however, I&rsquo;m really worried about the stability of full containerization, and I&rsquo;ve encountered inexplicable certificate expiration errors, and finally rebooted to solve such problems; so I&rsquo;m also exploring more convenient binary deployment methods, such as this k0s. 1. k0s Introduction"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">K0s Introduction</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-08-06 18:49:13 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/tools/"> tools </a>
            </div>
          <span class="more-meta"> 3061 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1--k0s-introduction">1.  k0s Introduction</a></li>
        <li><a href="#2-use-k0sctl">2. use k0sctl</a>
          <ul>
            <li><a href="#21-k0sctl-install-cluster">2.1. k0sctl install cluster</a></li>
            <li><a href="#22-the-way-k0sctl-is-extended">2.2. The way k0sctl is extended</a></li>
            <li><a href="#23-k0sctl-using-offline-image-package">2.3. k0sctl using offline image package</a></li>
            <li><a href="#24-switching-cni-plug-ins">2.4. Switching CNI plug-ins</a></li>
            <li><a href="#25-upload-k0s-binary-file">2.5. Upload k0s binary file</a></li>
            <li><a href="#26-replace-mirror-version">2.6. Replace mirror version</a></li>
            <li><a href="#27-adjusting-master-component-parameters">2.7. Adjusting master component parameters</a></li>
          </ul>
        </li>
        <li><a href="#3-k0s-ha-build">3. k0s HA build</a>
          <ul>
            <li><a href="#31-external-load-balancer">3.1. External Load Balancer</a></li>
            <li><a href="#32-build-an-ha-cluster">3.2. Build an HA cluster</a></li>
            <li><a href="#33-certificate-renewal-and-management">3.3. Certificate renewal and management</a></li>
          </ul>
        </li>
        <li><a href="#4-cluster-backup-and-recovery">4. Cluster Backup and Recovery</a></li>
        <li><a href="#5-other-advanced-features">5. Other advanced features</a>
          <ul>
            <li><a href="#51-etcd-replacement">5.1. Etcd Replacement</a></li>
            <li><a href="#52-cluster-user-management">5.2. Cluster user management</a></li>
            <li><a href="#53-containerd-placement">5.3. Containerd Placement</a></li>
          </ul>
        </li>
        <li><a href="#6-summary">6. Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>I&rsquo;ve been using kubeadm to deploy kubernetes clusters for the last two years, and it&rsquo;s generally convenient to work with some of my own small scripts and some automation tools; however, I&rsquo;m really worried about the stability of full containerization, and I&rsquo;ve encountered inexplicable certificate expiration errors, and finally rebooted to solve such problems; so I&rsquo;m also exploring more convenient binary deployment methods, such as this k0s.</p>
<h2 id="1--k0s-introduction">1.  k0s Introduction</h2>
<blockquote>
<p>The Simple, Solid &amp; Certified Kubernetes Distribution.</p>
</blockquote>
<p>k0s can be thought of as a downstream Kubernetes distribution. Compared to native Kubernetes, k0s does not neuter a lot of Kubernetes functionality; the only major part of k0s that is neutered is basically the <strong>in-tree Cloud provider</strong>, the rest is the same as native Kubernetes.</p>
<p><strong>k0s compiles its own Kubernetes source code to generate Kubernetes binaries, and then releases the binaries to the host after installation before starting; in this case, all features are almost identical to native Kubernetes.</strong></p>
<h2 id="2-use-k0sctl">2. use k0sctl</h2>
<p>k0sctl is a tool provided by k0s to facilitate quick deployment of clusters, somewhat similar to kubeadm, but much more scalable than kubeadm. In a multi-node scenario, k0sctl initializes the cluster by linking the target host via ssh and then following the steps to release files and start Kubernetes-related services.</p>
<h3 id="21-k0sctl-install-cluster">2.1. k0sctl install cluster</h3>
<p>The installation process will automatically download the relevant image, how to install offline is explained later. Before installation, make sure the hostname of the target machine is in non-domain name form, otherwise some problems may occur. The following is a simple example of starting a cluster:</p>
<p>First install k0sctl</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># install k0sctl</span>
wget https://github.com/k0sproject/k0sctl/releases/download/v0.9.0/k0sctl-linux-x64
chmod +x k0sctl-linux-x64
mv k0sctl-linux-x64 /usr/local/bin/k0sctl
</code></pre></td></tr></table>
</div>
</div><p>Then write the k0sctl.yaml configuration file</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0sctl.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s-cluster</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.12</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.13</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.14</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.15</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w">  </span><span class="nt">k0s</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.21.2</span><span class="l">+k0s.1</span><span class="w">
</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0s.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s</span><span class="w">
</span><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">api</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6443</span><span class="w">
</span><span class="w">          </span><span class="nt">k0sApiPort</span><span class="p">:</span><span class="w"> </span><span class="m">9443</span><span class="w">
</span><span class="w">          </span><span class="nt">sans</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.12</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.13</span><span class="w">
</span><span class="w">        </span><span class="nt">storage</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">etcd</span><span class="w">
</span><span class="w">          </span><span class="nt">etcd</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">peerAddress</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">        </span><span class="nt">network</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">kubeProxy</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">disabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">            </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">ipvs</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Finally, execute the <code>apply</code> command to install, and make sure your operating machine can <code>ssh</code> securely log in to all target machines before installing:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">➜  tmp k0sctl apply -c bak.yaml

⠀⣿⣿⡇⠀⠀⢀⣴⣾⣿⠟⠁⢸⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀█████████ █████████ ███
⠀⣿⣿⡇⣠⣶⣿⡿⠋⠀⠀⠀⢸⣿⡇⠀⠀⠀⣠⠀⠀⢀⣠⡆⢸⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀███          ███    ███
⠀⣿⣿⣿⣿⣟⠋⠀⠀⠀⠀⠀⢸⣿⡇⠀⢰⣾⣿⠀⠀⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀███          ███    ███
⠀⣿⣿⡏⠻⣿⣷⣤⡀⠀⠀⠀⠸⠛⠁⠀⠸⠋⠁⠀⠀⣿⣿⡇⠈⠉⠉⠉⠉⠉⠉⠉⠉⢹⣿⣿⠀███          ███    ███
⠀⣿⣿⡇⠀⠀⠙⢿⣿⣦⣀⠀⠀⠀⣠⣶⣶⣶⣶⣶⣶⣿⣿⡇⢰⣶⣶⣶⣶⣶⣶⣶⣶⣾⣿⣿⠀█████████    ███    ██████████

k0sctl 0.0.0 Copyright 2021, k0sctl authors.
Anonymized telemetry of usage will be sent to the authors.
By continuing to use k0sctl you agree to these terms:
https://k0sproject.io/licenses/eula
INFO ==&gt; Running phase: Connect to hosts
INFO [ssh] 10.0.0.15:22: connected
INFO [ssh] 10.0.0.11:22: connected
INFO [ssh] 10.0.0.12:22: connected
INFO [ssh] 10.0.0.14:22: connected
INFO [ssh] 10.0.0.13:22: connected
INFO ==&gt; Running phase: Detect host operating systems
INFO [ssh] 10.0.0.11:22: is running Ubuntu 20.04.2 LTS
INFO [ssh] 10.0.0.12:22: is running Ubuntu 20.04.2 LTS
INFO [ssh] 10.0.0.14:22: is running Ubuntu 20.04.2 LTS
INFO [ssh] 10.0.0.13:22: is running Ubuntu 20.04.2 LTS
INFO [ssh] 10.0.0.15:22: is running Ubuntu 20.04.2 LTS
INFO ==&gt; Running phase: Prepare hosts
INFO ==&gt; Running phase: Gather host facts
INFO [ssh] 10.0.0.11:22: discovered ens33 as private interface
INFO [ssh] 10.0.0.13:22: discovered ens33 as private interface
INFO [ssh] 10.0.0.12:22: discovered ens33 as private interface
INFO ==&gt; Running phase: Download k0s on hosts
INFO [ssh] 10.0.0.11:22: downloading k0s 1.21.2+k0s.1
INFO [ssh] 10.0.0.13:22: downloading k0s 1.21.2+k0s.1
INFO [ssh] 10.0.0.12:22: downloading k0s 1.21.2+k0s.1
INFO [ssh] 10.0.0.15:22: downloading k0s 1.21.2+k0s.1
INFO [ssh] 10.0.0.14:22: downloading k0s 1.21.2+k0s.1
......
</code></pre></td></tr></table>
</div>
</div><p>After a few moments the cluster with three Masters and two Nodes will be installed:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"># Note: The target machine hostname should not be in the form of a domain name, the sample here is a fix for this problem
k1.node ➜ ~ k0s kubectl get node -o wide
NAME      STATUS   ROLES    AGE   VERSION       INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
k1.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.11     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6
k2.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.12     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6
k3.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.13     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6
k4.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.14     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6
k5.node   Ready    &lt;none&gt;   10m   v1.21.2+k0s   10.0.0.15     &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6
</code></pre></td></tr></table>
</div>
</div><h3 id="22-the-way-k0sctl-is-extended">2.2. The way k0sctl is extended</h3>
<p>Unlike kubeadm, k0sctl provides customizable options for almost all installation details, which are extended by three behaviors:</p>
<ul>
<li><strong>File Uploads:</strong> k0sctl allows to define file uploads before installation. k0sctl will upload all relevant files already defined to the target host before installation, including but not limited to k0s own binaries, offline image packages, other installation files, other helper scripts, etc.</li>
<li><strong>Manifests and Helm:</strong> When specific files are uploaded to the <code>/var/lib/k0s/manifests</code> directory of the master node, k0s automatically applies these configurations during installation, similar to the static pod of a kubelet, except that k0s allows all resources (including but not limited to deployment, daemonset, namespace, etc.); you can also add Helm configuration directly to <code>k0sctl.yaml</code> and k0s will manage it for you in the same way.</li>
<li><strong>Assistant scripts:</strong> You can configure the <code>hooks</code> option under each host to execute some specific scripts (not in the documentation, you need to see the source code) to do some trolling in specific situations.</li>
</ul>
<h3 id="23-k0sctl-using-offline-image-package">2.3. k0sctl using offline image package</h3>
<p>Based on the above extensions, k0s also conveniently integrates automatic import of offline image packages for us. We just need to define a file upload, upload the image package to the <code>/var/lib/k0s/images/</code> directory and k0s will automatically dump it into containerd without our manual intervention:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0sctl.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s-cluster</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    </span><span class="c"># The files configuration will upload the relevant files to the target host before installation</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image-bundle</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/bundle_file</span><span class="w">
</span><span class="w">      </span><span class="c"># The image archive in this directory will be automatically imported into containerd</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/images/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="l">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><strong>Please refer to the official <a href="https://docs.k0sproject.io/v1.21.2+k0s.1/airgap-install/">Airgap install</a> documentation on how to download the image archive (bundle_file) and customize it yourself.</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/06cf7fd080c7491f9a33194ccd560453.png" alt=" "></p>
<h3 id="24-switching-cni-plug-ins">2.4. Switching CNI plug-ins</h3>
<p>By default k0s integrates two CNI plugins: calico and kube-router; if we use other CNI plugins like flannel, we just need to set the default CNI plugin to <code>custom</code> and upload the flannel deployment yaml to a master&rsquo;s <code>/var/lib/ k0s/manifests</code> directory of a master, and k0s will automatically perform the <code>apply -f xxxx.yaml</code> operation for us.</p>
<p>The following is a sample of switching to flannel. Note that the official flannel image will not install the CNI binaries for you, we need to install them ourselves with the help of a file upload (<a href="https://github.com/containernetworking/plugins/releases">CNI GitHub plugin download address</a>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0sctl.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s-cluster</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># Put the flannel yaml in manifests (you need to create a separate directory)</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/kube-flannel.yaml</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/manifests/flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0644</span><span class="w">
</span><span class="w">    </span><span class="c"># Install the CNI plug-in yourself</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cni-plugins</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/cni-plugins/*</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/cni/bin/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">  </span><span class="nt">k0s</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1.21.2+k0s.1</span><span class="w">
</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0s.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s</span><span class="w">
</span><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">api</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6443</span><span class="w">
</span><span class="w">          </span><span class="nt">k0sApiPort</span><span class="p">:</span><span class="w"> </span><span class="m">9443</span><span class="w">
</span><span class="w">          </span><span class="nt">sans</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.12</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.13</span><span class="w">
</span><span class="w">        </span><span class="nt">storage</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">etcd</span><span class="w">
</span><span class="w">        </span><span class="nt">network</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">podCIDR</span><span class="p">:</span><span class="w"> </span><span class="m">10.244.0.0</span><span class="l">/16</span><span class="w">
</span><span class="w">          </span><span class="nt">serviceCIDR</span><span class="p">:</span><span class="w"> </span><span class="m">10.96.0.0</span><span class="l">/12</span><span class="w">
</span><span class="w">          </span><span class="c"># Specify CNI as custom so that k0s does not install calico/kube-router</span><span class="w">
</span><span class="w">          </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l">custom</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="25-upload-k0s-binary-file">2.5. Upload k0s binary file</h3>
<p>By default k0sctl will download the k0s binaries on the target machine when installing the cluster, in addition to normal files, image archives, etc.; of course in an offline environment this step can also be uploaded offline with a simple configuration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0sctl.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s-cluster</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    </span><span class="c"># Declare that you need to upload a binary file</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="c"># Specify the binary file location</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/kube-flannel.yaml</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/manifests/flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0644</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="l">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="26-replace-mirror-version">2.6. Replace mirror version</h3>
<p>By default, k0s version numbers are consistent with Kubernetes, but if you expect a component to use a specific version, you can directly configure the image names of these built-in components:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0sctl.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s-cluster</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/kube-flannel.yaml</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/manifests/flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0644</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="l">...</span><span class="w">
</span><span class="w">  </span><span class="nt">k0s</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1.21.2+k0s.1</span><span class="w">
</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0s.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s</span><span class="w">
</span><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">api</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6443</span><span class="w">
</span><span class="w">          </span><span class="nt">k0sApiPort</span><span class="p">:</span><span class="w"> </span><span class="m">9443</span><span class="w">
</span><span class="w">          </span><span class="nt">sans</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.12</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.13</span><span class="w">
</span><span class="w">        </span><span class="c"># Specify the version of the image used for internal components</span><span class="w">
</span><span class="w">        </span><span class="nt">images</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="c">#konnectivity:</span><span class="w">
</span><span class="w">          </span><span class="c">#  image: us.gcr.io/k8s-artifacts-prod/kas-network-proxy/proxy-agent</span><span class="w">
</span><span class="w">          </span><span class="c">#  version: v0.0.21</span><span class="w">
</span><span class="w">          </span><span class="c">#metricsserver:</span><span class="w">
</span><span class="w">          </span><span class="c">#  image: gcr.io/k8s-staging-metrics-server/metrics-server</span><span class="w">
</span><span class="w">          </span><span class="c">#  version: v0.3.7</span><span class="w">
</span><span class="w">          </span><span class="nt">kubeproxy</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">k8s.gcr.io/kube-proxy</span><span class="w">
</span><span class="w">            </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1.21.3</span><span class="w">
</span><span class="w">          </span><span class="c">#coredns:</span><span class="w">
</span><span class="w">          </span><span class="c">#  image: docker.io/coredns/coredns</span><span class="w">
</span><span class="w">          </span><span class="c">#  version: 1.7.0</span><span class="w">
</span><span class="w">          </span><span class="c">#calico:</span><span class="w">
</span><span class="w">          </span><span class="c">#  cni:</span><span class="w">
</span><span class="w">          </span><span class="c">#    image: docker.io/calico/cni</span><span class="w">
</span><span class="w">          </span><span class="c">#    version: v3.18.1</span><span class="w">
</span><span class="w">          </span><span class="c">#  node:</span><span class="w">
</span><span class="w">          </span><span class="c">#    image: docker.io/calico/node</span><span class="w">
</span><span class="w">          </span><span class="c">#    version: v3.18.1</span><span class="w">
</span><span class="w">          </span><span class="c">#  kubecontrollers:</span><span class="w">
</span><span class="w">          </span><span class="c">#    image: docker.io/calico/kube-controllers</span><span class="w">
</span><span class="w">          </span><span class="c">#    version: v3.18.1</span><span class="w">
</span><span class="w">          </span><span class="c">#kuberouter:</span><span class="w">
</span><span class="w">          </span><span class="c">#  cni:</span><span class="w">
</span><span class="w">          </span><span class="c">#    image: docker.io/cloudnativelabs/kube-router</span><span class="w">
</span><span class="w">          </span><span class="c">#    version: v1.2.1</span><span class="w">
</span><span class="w">          </span><span class="c">#  cniInstaller:</span><span class="w">
</span><span class="w">          </span><span class="c">#    image: quay.io/k0sproject/cni-node</span><span class="w">
</span><span class="w">          </span><span class="c">#    version: 0.1.0</span><span class="w">
</span><span class="w">          </span><span class="nt">default_pull_policy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span><span class="w">          </span><span class="c">#default_pull_policy: Never</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="27-adjusting-master-component-parameters">2.7. Adjusting master component parameters</h3>
<p>If you are familiar with Kubernetes, you should know that the three main components on the master: apiserver, controller, and scheduler control the whole cluster; the k0sctl installation of the cluster also allows you to customize the parameters of these components, which is done by modifying the <code>k0sctl.yaml</code> configuration file used.</p>
<ul>
<li><code>spec.api.extraArgs</code> : custom parameters (kv map) for customizing the kube-apiserver</li>
<li><code>spec.scheduler.extraArgs</code> : custom parameters (kv map) for custom kube-scheduler</li>
<li><code>spec.controllerManager.extraArgs</code> : custom arguments for kube-controller-manager (kv map)</li>
<li><code>spec.workerProfiles</code> : used to override the configuration in kubelet-config.yaml, which will eventually be merged with the default kubelet-config.yaml</li>
</ul>
<p>There is also an <code>InstallFlags</code> configuration in the <code>Host</code> configuration to pass additional configuration options for the k0s installation.</p>
<h2 id="3-k0s-ha-build">3. k0s HA build</h2>
<blockquote>
<p>In fact, the second part above is mainly to introduce some basic functions of k0sctl, in order to pave the way for the following part of HA production level deployment.</p>
</blockquote>
<p>For now, k0s HA only supports a standalone load balancer HA architecture; that is, there needs to be a highly available Layer 4 load balancer externally, and all other Node nodes link to this load balancer to achieve high availability of the master. Building an HA cluster is as simple as adding an external load balancer address using the k0sctl command; here is a complete, fully offline HA cluster build configuration.</p>
<h3 id="31-external-load-balancer">3.1. External Load Balancer</h3>
<p>Before we build it we assume that there is already an external highly available Layer 4 load balancer and that the load balancer is already loaded with the following ports:</p>
<ul>
<li><code>6443 (for Kubernetes API)</code> : load balancer 6443 Load 6443 of all master nodes</li>
<li><code>9443 (for controller join API)</code> : load balancer 9443 load all master nodes 9443</li>
<li><code>8132 (for Konnectivity agent)</code> : load balancer 8132 load all master nodes of 8132</li>
<li><code>8133 (for Konnectivity server)</code> : load balancer 8133 load all master nodes 8133</li>
</ul>
<p>The following is a sample nginx 4-tier proxy:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">error_log</span> <span class="s">syslog:server=unix:/dev/log</span> <span class="s">notice</span><span class="p">;</span>

<span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
<span class="k">events</span> <span class="p">{</span>
	<span class="kn">multi_accept</span> <span class="no">on</span><span class="p">;</span>
	<span class="kn">use</span> <span class="s">epoll</span><span class="p">;</span>
	<span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">stream</span> <span class="p">{</span>
    <span class="kn">upstream</span> <span class="s">kube_apiserver</span> <span class="p">{</span>
        <span class="kn">least_conn</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.11</span><span class="p">:</span><span class="mi">6443</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.12</span><span class="p">:</span><span class="mi">6443</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.13</span><span class="p">:</span><span class="mi">6443</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">upstream</span> <span class="s">konnectivity_agent</span> <span class="p">{</span>
        <span class="kn">least_conn</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.11</span><span class="p">:</span><span class="mi">8132</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.12</span><span class="p">:</span><span class="mi">8132</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.13</span><span class="p">:</span><span class="mi">8132</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">upstream</span> <span class="s">konnectivity_server</span> <span class="p">{</span>
        <span class="kn">least_conn</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.11</span><span class="p">:</span><span class="mi">8133</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.12</span><span class="p">:</span><span class="mi">8133</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.13</span><span class="p">:</span><span class="mi">8133</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">upstream</span> <span class="s">controller_join_api</span> <span class="p">{</span>
        <span class="kn">least_conn</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.11</span><span class="p">:</span><span class="mi">9443</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.12</span><span class="p">:</span><span class="mi">9443</span><span class="p">;</span>
        <span class="kn">server</span> <span class="n">10.0.0.13</span><span class="p">:</span><span class="mi">9443</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span>        <span class="n">0.0.0.0</span><span class="p">:</span><span class="mi">6443</span><span class="p">;</span>
        <span class="kn">proxy_pass</span>    <span class="s">kube_apiserver</span><span class="p">;</span>
        <span class="kn">proxy_timeout</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">1s</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span>        <span class="n">0.0.0.0</span><span class="p">:</span><span class="mi">8132</span><span class="p">;</span>
        <span class="kn">proxy_pass</span>    <span class="s">konnectivity_agent</span><span class="p">;</span>
        <span class="kn">proxy_timeout</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">1s</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span>        <span class="n">0.0.0.0</span><span class="p">:</span><span class="mi">8133</span><span class="p">;</span>
        <span class="kn">proxy_pass</span>    <span class="s">konnectivity_server</span><span class="p">;</span>
        <span class="kn">proxy_timeout</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">1s</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span>        <span class="n">0.0.0.0</span><span class="p">:</span><span class="mi">9443</span><span class="p">;</span>
        <span class="kn">proxy_pass</span>    <span class="s">controller_join_api</span><span class="p">;</span>
        <span class="kn">proxy_timeout</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">1s</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="32-build-an-ha-cluster">3.2. Build an HA cluster</h3>
<p>The following is a sample HA + offline deployment configuration for k0sctl:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0sctl.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s-cluster</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.11</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="c"># role 支持的值</span><span class="w">
</span><span class="w">    </span><span class="c"># &#39;controller&#39; 单 master</span><span class="w">
</span><span class="w">    </span><span class="c"># &#39;worker&#39; 单 worker</span><span class="w">
</span><span class="w">    </span><span class="c"># &#39;controller+worker&#39; master 和 worker 都运行 </span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c"># 从本地 上传 k0s bin 文件，不要在目标机器下载</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c"># 上传其他文件</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 上传 flannel 配置，使用自定的 flannel 替换内置的 calico</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/kube-flannel.yaml</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/manifests/flannel</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0644</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c"># 上传打包好的 image 镜像包，k0s 会自动导入到 containerd</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image-bundle</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/bundle_file</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/images/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c"># 使用 flannel 后每个机器要上传对应的 CNI 插件</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cni-plugins</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/cni-plugins/*</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/cni/bin/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.12</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image-bundle</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/bundle_file</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/images/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cni-plugins</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/cni-plugins/*</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/cni/bin/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.13</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">controller+worker</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image-bundle</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/bundle_file</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/images/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cni-plugins</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/cni-plugins/*</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/cni/bin/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.14</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image-bundle</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/bundle_file</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/images/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cni-plugins</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/cni-plugins/*</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/cni/bin/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">  </span>- <span class="nt">ssh</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.15</span><span class="w">
</span><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w">      </span><span class="nt">keyPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/.ssh/id_rsa</span><span class="w">
</span><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w">    </span><span class="nt">uploadBinary</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">k0sBinaryPath</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/k0s</span><span class="w">
</span><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">image-bundle</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/bundle_file</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/k0s/images/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cni-plugins</span><span class="w">
</span><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">/Users/bleem/tmp/cni-plugins/*</span><span class="w">
</span><span class="w">      </span><span class="nt">dstDir</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/cni/bin/</span><span class="w">
</span><span class="w">      </span><span class="nt">perm</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span><span class="w">  </span><span class="nt">k0s</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1.21.2+k0s.1</span><span class="w">
</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0s.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s</span><span class="w">
</span><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">api</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="c"># This is the address of the external load balancer to which all kubelets will link</span><span class="w">
</span><span class="w">          </span><span class="nt">externalAddress</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.20</span><span class="w">
</span><span class="w">          </span><span class="c"># Don&#39;t forget to add the SAN of api certificate for external load balancer</span><span class="w">
</span><span class="w">          </span><span class="nt">sans</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.11</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.12</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.13</span><span class="w">
</span><span class="w">          </span>- <span class="m">10.0.0.20</span><span class="w">
</span><span class="w">        </span><span class="c"># Storage type uses etcd, etcd clusters are automatically managed by k0s</span><span class="w">
</span><span class="w">        </span><span class="nt">storage</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">etcd</span><span class="w">
</span><span class="w">        </span><span class="nt">network</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">podCIDR</span><span class="p">:</span><span class="w"> </span><span class="m">10.244.0.0</span><span class="l">/16</span><span class="w">
</span><span class="w">          </span><span class="nt">serviceCIDR</span><span class="p">:</span><span class="w"> </span><span class="m">10.96.0.0</span><span class="l">/12</span><span class="w">
</span><span class="w">          </span><span class="c"># The network plugin uses custom and then lets the flannel take over</span><span class="w">
</span><span class="w">          </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l">custom</span><span class="w">
</span><span class="w">          </span><span class="nt">kubeProxy</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">disabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">            </span><span class="c"># Turn on ipvs mode for kubelet</span><span class="w">
</span><span class="w">            </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">ipvs</span><span class="w">
</span><span class="w">        </span><span class="c"># Do not send any anonymous statistical information</span><span class="w">
</span><span class="w">        </span><span class="nt">telemetry</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">        </span><span class="nt">images</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">default_pull_policy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Finally, you only need to execute <code>k0sctl apply -c k0sctl.yaml</code> and wait a few minutes for the cluster to be set up, and you can see the upload process of the relevant files during the installation:</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/08/06/c2b9b8ecda854ef0a96dd8ef07073eaa.png" alt=" "></p>
<h3 id="33-certificate-renewal-and-management">3.3. Certificate renewal and management</h3>
<p>The default certificate validity of kubeadm cluster is one year, and it has to be re-signed by kubeadm when it expires; k0s cluster is almost the same, but the difference is that k0s cluster is more violent; <strong>As long as the CA (default 10 years) is not lost, k0s will force to regenerate the certificate with one year validity every time it restarts, so in HA environment, just restart the k0s service when it is about to expire.</strong></p>
<p><strong>k0sctl installed cluster has only one <code>k0scontroller.service</code> service by default, all services on master and node are started by this service, so just <code>systemctl restart k0scontroller.service</code> before expiration.</strong></p>
<h2 id="4-cluster-backup-and-recovery">4. Cluster Backup and Recovery</h2>
<p>k0sctl provides cluster backup and recovery functions. By default, you only need to execute <code>k0sctl backup</code> to complete the cluster backup, which will generate a <code>k0s_backup_TIMESTAMP.tar.gz</code> backup file in the current directory.</p>
<p>When you need to restore the cluster, use <code>k0sctl apply --restore-from k0s_backup_TIMESTAMP.tar.gz</code> to restore it; note that the restore command is equivalent to reinstalling the cluster on a new machine, so there is some risk.</p>
<p>After two days of testing, I feel that this backup and recovery function is not reliable, and I recommend using Velero to backup the cluster</p>
<h2 id="5-other-advanced-features">5. Other advanced features</h2>
<h3 id="51-etcd-replacement">5.1. Etcd Replacement</h3>
<p>In small-scale clustering scenarios, Etcd may not be needed as storage. k0s can use traditional databases such as SQLite or MySQL as cluster storage with the help of the kine library; if you want to switch storage, just adjust the <code>k0sctl.yaml</code> configuration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">k0s.k0sproject.io/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k0s</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">storage</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">kine</span><span class="w">
</span><span class="w">    </span><span class="nt">kine</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">dataSource</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;sqlite:///var/lib/k0s/db/state.db?more=rwc&amp;_journal=WAL&amp;cache=shared&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="52-cluster-user-management">5.2. Cluster user management</h3>
<p>A cluster built with k0sctl can easily add users to the cluster with the k0s command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">k0s kubeconfig create --groups <span class="s2">&#34;system:masters&#34;</span> testUser &gt; k0s.config
</code></pre></td></tr></table>
</div>
</div><h3 id="53-containerd-placement">5.3. Containerd Placement</h3>
<p>If you need to define your own special configuration, you can upload the Containerd configuration file to <code>/etc/k0s/containerd.toml</code> during installation, which will be read and used by the k0s startup Containerd. The configuration will be read and used by the k0s-started Containerd.</p>
<h2 id="6-summary">6. Summary</h2>
<p>k0s is a good project for binary hosts to deploy Kubernetes clusters is very convenient, because its direct use of Kubernetes binaries to start, so basically no feature neutering, and k0sctl for automated installation provides a good scalability, so it is worth a try. However, k0s still has some flaws in the details, such as the <code>konnectivity</code> service cannot be optionally closed during installation, etc. k0s is a good tool overall, and it is also recommended to look at the source code, which has a lot of novel designs and is good for understanding the cluster boot process.</p>
<hr>
<p>Reference <code>https://mritd.com/2021/07/29/test-the-k0s-cluster/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">kubernetes</a>
          <a href="/tags/k0s/">k0s</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-08/slice-principle-analysis/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Slice Principle Analysis</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-07/javascript-this-principle/">
            <span class="next-text nav-default">JavaScript&#39;s this Principle</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
