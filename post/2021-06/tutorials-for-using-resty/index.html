<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Tutorials for using resty - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="resty is an HTTP client library for the Go language. resty is powerful and feature-rich. It supports almost all HTTP methods (GET/POST/PUT/DELETE/OPTION/HEAD/PATCH, etc.) and provides an easy-to-use API.
Quick Use  The code in this article uses Go Modules.
 Create the directory and initialize.
1 2  $ mkdir resty &amp;amp;&amp;amp; cd resty $ go mod init github.com/darjun/go-daily-lib/resty   Install the resty library.
1  $ go get -u github." /><meta name="keywords" content="resty,golang,http" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-06/tutorials-for-using-resty/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Tutorials for using resty" />
<meta property="og:description" content="resty is an HTTP client library for the Go language. resty is powerful and feature-rich. It supports almost all HTTP methods (GET/POST/PUT/DELETE/OPTION/HEAD/PATCH, etc.) and provides an easy-to-use API.
Quick Use  The code in this article uses Go Modules.
 Create the directory and initialize.
1 2  $ mkdir resty &amp;&amp; cd resty $ go mod init github.com/darjun/go-daily-lib/resty   Install the resty library.
1  $ go get -u github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-06/tutorials-for-using-resty/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-29T11:35:39+08:00" />
<meta property="article:modified_time" content="2021-06-29T11:35:39+08:00" />

<meta itemprop="name" content="Tutorials for using resty">
<meta itemprop="description" content="resty is an HTTP client library for the Go language. resty is powerful and feature-rich. It supports almost all HTTP methods (GET/POST/PUT/DELETE/OPTION/HEAD/PATCH, etc.) and provides an easy-to-use API.
Quick Use  The code in this article uses Go Modules.
 Create the directory and initialize.
1 2  $ mkdir resty &amp;&amp; cd resty $ go mod init github.com/darjun/go-daily-lib/resty   Install the resty library.
1  $ go get -u github."><meta itemprop="datePublished" content="2021-06-29T11:35:39+08:00" />
<meta itemprop="dateModified" content="2021-06-29T11:35:39+08:00" />
<meta itemprop="wordCount" content="2468">
<meta itemprop="keywords" content="golang,resty," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tutorials for using resty"/>
<meta name="twitter:description" content="resty is an HTTP client library for the Go language. resty is powerful and feature-rich. It supports almost all HTTP methods (GET/POST/PUT/DELETE/OPTION/HEAD/PATCH, etc.) and provides an easy-to-use API.
Quick Use  The code in this article uses Go Modules.
 Create the directory and initialize.
1 2  $ mkdir resty &amp;&amp; cd resty $ go mod init github.com/darjun/go-daily-lib/resty   Install the resty library.
1  $ go get -u github."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Tutorials for using resty</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-06-29 11:35:39 </span>
        <div class="post-category">
            <a href="/categories/tools/"> tools </a>
            </div>
          <span class="more-meta"> 2468 words </span>
          <span class="more-meta"> 12 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#quick-use">Quick Use</a></li>
        <li><a href="#automatic-unmarshal">Automatic Unmarshal</a></li>
        <li><a href="#request-information">Request Information</a>
          <ul>
            <li><a href="#demo">Demo</a></li>
          </ul>
        </li>
        <li><a href="#trace">Trace</a></li>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#reference">Reference</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://github.com/go-resty/resty">resty</a> is an <code>HTTP client</code> library for the <code>Go</code> language. <code>resty</code> is powerful and feature-rich. It supports almost all <code>HTTP</code> methods (GET/POST/PUT/DELETE/OPTION/HEAD/PATCH, etc.) and provides an easy-to-use <code>API</code>.</p>
<h2 id="quick-use">Quick Use</h2>
<blockquote>
<p>The code in this article uses Go Modules.</p>
</blockquote>
<p>Create the directory and initialize.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ mkdir resty <span class="o">&amp;&amp;</span> <span class="nb">cd</span> resty
$ go mod init github.com/darjun/go-daily-lib/resty
</code></pre></td></tr></table>
</div>
</div><p>Install the resty library.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ go get -u github.com/go-resty/resty/v2
</code></pre></td></tr></table>
</div>
</div><p>Here we get the information on the first page of Baidu.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;fmt&#34;</span>
  <span class="s">&#34;log&#34;</span>

  <span class="s">&#34;github.com/go-resty/resty/v2&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">client</span> <span class="o">:=</span> <span class="nx">resty</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>

  <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;https://baidu.com&#34;</span><span class="p">)</span>

  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Response Info:&#34;</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Status Code:&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">StatusCode</span><span class="p">())</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Status:&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Status</span><span class="p">())</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Proto:&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Proto</span><span class="p">())</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Time:&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Time</span><span class="p">())</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Received At:&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">ReceivedAt</span><span class="p">())</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Size:&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Size</span><span class="p">())</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Headers:&#34;</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Header</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="s">&#34;=&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Cookies:&#34;</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">cookie</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Cookies</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;cookie%d: name:%s value:%s\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Resty is relatively simple to use.</p>
<ul>
<li>First, call a resty.New() to create a client object.</li>
<li>call the R() method of the client object to create a request object.</li>
<li>Call the Get()/Post() methods of the request object, pass in the parameter URL, and you can send an HTTP request to the corresponding URL. Returning a response object.</li>
<li>The response object provides a number of methods to check the status of the response, header, cookies, and other information.</li>
</ul>
<p>In the above program we have obtained.</p>
<ul>
<li><code>StatusCode()</code>: status code, e.g. 200</li>
<li><code>Status()</code>: status code and status information, e.g. 200 OK.</li>
<li><code>Proto()</code>: protocol, e.g. HTTP/1.1.</li>
<li><code>Time()</code>: the time from sending the request to receiving the response.</li>
<li><code>ReceivedAt()</code>: the moment when the response was received.</li>
<li><code>Size()</code>: the size of the response.</li>
<li><code>Header()</code>: the response header information, returned as http.Header type, i.e. map[string][]string.</li>
<li><code>Cookies()</code>: the cookie information set by the server via the Set-Cookie header.</li>
</ul>
<p>Basic information about the response output from running the program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Response Info:
Status Code: 200
Status: 200 OK
Proto: HTTP/1.1
Time: 415.774352ms
Received At: 2021-06-26 11:42:45.307157 +0800 CST m=+0.416547795
Size: 302456
</code></pre></td></tr></table>
</div>
</div><p>header information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Headers:
Server = [BWS/1.1]
Date = [Sat, 26 Jun 2021 03:42:45 GMT]
Connection = [keep-alive]
Bdpagetype = [1]
Bdqid = [0xf5a61d240003b218]
Vary = [Accept-Encoding Accept-Encoding]
Content-Type = [text/html;charset=utf-8]
Set-Cookie = [BAIDUID=BF2EE47AAAF7A20C6971F1E897ABDD43:FG=1; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com BIDUPSID=BF2EE47AAAF7A20C6971F1E897ABDD43; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com PSTM=1624678965; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com BAIDUID=BF2EE47AAAF7A20C716E90B86906D6B0:FG=1; max-age=31536000; expires=Sun, 26-Jun-22 03:42:45 GMT; domain=.baidu.com; path=/; version=1; comment=bd BDSVRTM=0; path=/ BD_HOME=1; path=/ H_PS_PSSID=34099_31253_34133_34072_33607_34135_26350; path=/; domain=.baidu.com]
Traceid = [1624678965045126810617700867425882583576]
P3p = [CP=&#34; OTI DSP COR IVA OUR IND COM &#34; CP=&#34; OTI DSP COR IVA OUR IND COM &#34;]
X-Ua-Compatible = [IE=Edge,chrome=1]
</code></pre></td></tr></table>
</div>
</div><p>Note that there is a Set-Cookie Header, which appears in the Cookie section.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Cookies:
cookie0: name:BAIDUID value:BF2EE47AAAF7A20C6971F1E897ABDD43:FG=1
cookie1: name:BIDUPSID value:BF2EE47AAAF7A20C6971F1E897ABDD43
cookie2: name:PSTM value:1624678965
cookie3: name:BAIDUID value:BF2EE47AAAF7A20C716E90B86906D6B0:FG=1
cookie4: name:BDSVRTM value:0
cookie5: name:BD_HOME value:1
cookie6: name:H_PS_PSSID value:34099_31253_34133_34072_33607_34135_26350
</code></pre></td></tr></table>
</div>
</div><h2 id="automatic-unmarshal">Automatic Unmarshal</h2>
<p>Many sites now provide <code>API</code> interfaces that return structured data in <code>JSON/XML</code> format, etc. <code>resty</code> can automatically <code>Unmarshal</code> the response data into the corresponding structured object. To see an example, we know that many <code>js</code> files are hosted on <code>cdn</code> and we can get the basic information of these libraries through <code>api.cdnjs.com/libraries</code> and return a <code>JSON</code> data in the following format.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/c61b506d47194f6da54ea58bfb7d8101.png" alt=" "></p>
<p>Next, we define the <code>struct</code> and then use <code>resty</code> to pull information, automatically <code>Unmarshal</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Library</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Name</span>   <span class="kt">string</span>
  <span class="nx">Latest</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Libraries</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Results</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Library</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">client</span> <span class="o">:=</span> <span class="nx">resty</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>

  <span class="nx">libraries</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Libraries</span><span class="p">{}</span>
  <span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span><span class="nf">SetResult</span><span class="p">(</span><span class="nx">libraries</span><span class="p">).</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;https://api.cdnjs.com/libraries&#34;</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d libraries\n&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">libraries</span><span class="p">.</span><span class="nx">Results</span><span class="p">))</span>

  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">lib</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">libraries</span><span class="p">.</span><span class="nx">Results</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;first library:&#34;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;name:%s latest:%s\n&#34;</span><span class="p">,</span> <span class="nx">lib</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">lib</span><span class="p">.</span><span class="nx">Latest</span><span class="p">)</span>
    <span class="k">break</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see, we just need to create a result type object and call the <code>SetResult()</code> method of the request object, and <code>resty</code> will automatically <code>Unmarshal</code> the response data into the incoming object. Here the request information is set using a chain call approach, i.e., multiple settings are done in one line.</p>
<p>Run</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go run main.go
<span class="m">4040</span> libraries
first library:
name:vue latest:https://cdnjs.cloudflare.com/ajax/libs/vue/3.1.2/vue.min.js
</code></pre></td></tr></table>
</div>
</div><p>There are <code>4040</code> libraries in total and the first one is <code>Vue</code> ✌️. We can get the details of <code>Vue</code> by requesting <code>https://api.cdnjs.com/libraries/vue</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/a6a5c6ab2f8640eaad1fb58357967167.png" alt=" "></p>
<p>Interested in pulling this information yourself with <code>resty</code>.</p>
<p>Normally with a request, <code>resty</code> will infer the data format based on the <code>Content-Type</code> in the response. But sometimes the response has no <code>Content-Type</code> header or is not in the same format as the content, we can force <code>resty</code> to parse the response in a specific format by calling <code>ForceContentType()</code> on the request object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetResult</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span>
  <span class="nf">ForceContentType</span><span class="p">(</span><span class="s">&#34;application/json&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="request-information">Request Information</h2>
<p><code>resty</code> provides a rich set of methods for setting request information. We can set the query string in two ways. One is to call <code>SetQueryString()</code> of the request object to set our spliced query string.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetQueryString</span><span class="p">(</span><span class="s">&#34;name=dj&amp;age=18&#34;</span><span class="p">).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>The other is to call <code>SetQueryParams()</code> on the request object, pass in <code>map[string]string</code>, and let <code>resty</code> do the splicing for us. Obviously this is more convenient.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetQueryParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
    <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;dj&#34;</span><span class="p">,</span>
    <span class="s">&#34;age&#34;</span><span class="p">:</span> <span class="s">&#34;18&#34;</span><span class="p">,</span>
  <span class="p">}).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>resty</code> also provides a very useful interface for setting path parameters, we call <code>SetPathParams()</code> and pass in the <code>map[string]string</code> parameter, then the keys in this <code>map</code> can be used later in the <code>URL</code> path.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetPathParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
    <span class="s">&#34;user&#34;</span><span class="p">:</span> <span class="s">&#34;dj&#34;</span><span class="p">,</span>
  <span class="p">}).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="s">&#34;/v1/users/{user}/details&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that the keys in the path need to be wrapped with <code>{}</code>.</p>
<p>Set Header.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Set the request body.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">).</span>
  <span class="nf">SetBody</span><span class="p">(</span><span class="s">`{&#34;name&#34;: &#34;dj&#34;, &#34;age&#34;:18}`</span><span class="p">).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>The message body can be of various types: <code>string</code>, <code>[]byte</code>, <code>struct</code>, <code>map[string]interface{}</code>, etc.</p>
<p>Set to carry <code>Content-Length</code> header, resty automatically calculates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetBody</span><span class="p">(</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="s">&#34;dj&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span><span class="mi">18</span><span class="p">}).</span>
  <span class="nf">SetContentLength</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Some sites need to get a <code>token</code> before they can access its <code>API</code>. To set the <code>token</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
  <span class="nf">SetAuthToken</span><span class="p">(</span><span class="s">&#34;youdontknow&#34;</span><span class="p">).</span>
  <span class="nf">Get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="demo">Demo</h3>
<p>Finally, let&rsquo;s string together all of the above with a case study. Now we want to get the organization&rsquo;s repository information through the <code>API</code> provided by <code>GitHub</code>, see the link after the article for the <code>API</code> documentation. The <code>GitHub API</code> request address is <code>https://api.github.com</code>, and the request format for getting repository information is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /orgs/{org}/repos
</code></pre></td></tr></table>
</div>
</div><p>We can also set these parameters as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/97c73381856541cc8e37371b81468580.png" alt=" "></p>
<ul>
<li><code>accept</code>: Header, this is required and needs to be set to <code>application/vnd.github.v3+json</code>.</li>
<li><code>org</code>: Organization name, path parameter.</li>
<li><code>type</code>: repository type, query parameters, e.g. public/private/forks (fork&rsquo;s repository), etc.</li>
<li><code>sort</code>: sorting rule of the repository, query parameters, e.g. created/updated/pushed/full_name, etc. default sort by creation time.</li>
<li><code>direction</code>: ascending asc or descending dsc, query parameters.</li>
<li><code>per_page</code>: how many entries per page, max 100, default 30, query parameter.</li>
<li><code>page</code>: current request page number, with per_page for paging management, default 1, query parameter.</li>
</ul>
<p>The <code>GitHub API</code> must be set up with a <code>token</code> to access it. Log in to your <code>GitHub</code> account, click on your avatar in the top right corner, and select <code>Settings</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/812e94c406c64aa599aa7e81a6c896dc.png" alt=" "></p>
<p>Then, select <code>Developer settings</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/2618bf12b76947b68556027760a08448.png" alt=" "></p>
<p>Select <code>Personal access tokens</code>, then click <code>Generate new token</code> in the upper right corner.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/886e17af5e5b4368b8267cfdf78cba0a.png" alt=" "></p>
<p>Fill in <code>Note</code> to indicate the purpose of the <code>token</code>, this can be filled in according to your situation. The following checkboxes are used to select which permissions the <code>token</code> has, and are not required here.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/c6c2557952464c0ca196967651b0637e.png" alt=" "></p>
<p>Click the <code>Generate token</code> button below to generate a <code>token</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/1b228d3cc32549bc89b073f8f48e0744.png" alt=" "></p>
<p>Note that this <code>token</code> can only be seen now, close the page and you won&rsquo;t be able to see it next time you enter. So save it, and don&rsquo;t use my <code>token</code>, I will delete the <code>token</code> after testing the program 😭.</p>
<p>The <code>JSON</code> format data in the response is shown below.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/29/129db5e130ae4f9786bec7978a96aa98.png" alt=" "></p>
<p>There are so many fields that for the sake of convenience I will deal with only a few here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Repository</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">ID</span>              <span class="kt">int</span>        <span class="s">`json:&#34;id&#34;`</span>
  <span class="nx">NodeID</span>          <span class="kt">string</span>     <span class="s">`json:&#34;node_id&#34;`</span>
  <span class="nx">Name</span>            <span class="kt">string</span>     <span class="s">`json:&#34;name&#34;`</span>
  <span class="nx">FullName</span>        <span class="kt">string</span>     <span class="s">`json:&#34;full_name&#34;`</span>
  <span class="nx">Owner</span>           <span class="o">*</span><span class="nx">Developer</span> <span class="s">`json:&#34;owner&#34;`</span>
  <span class="nx">Private</span>         <span class="kt">bool</span>       <span class="s">`json:&#34;private&#34;`</span>
  <span class="nx">Description</span>     <span class="kt">string</span>     <span class="s">`json:&#34;description&#34;`</span>
  <span class="nx">Fork</span>            <span class="kt">bool</span>       <span class="s">`json:&#34;fork&#34;`</span>
  <span class="nx">Language</span>        <span class="kt">string</span>     <span class="s">`json:&#34;language&#34;`</span>
  <span class="nx">ForksCount</span>      <span class="kt">int</span>        <span class="s">`json:&#34;forks_count&#34;`</span>
  <span class="nx">StargazersCount</span> <span class="kt">int</span>        <span class="s">`json:&#34;stargazers_count&#34;`</span>
  <span class="nx">WatchersCount</span>   <span class="kt">int</span>        <span class="s">`json:&#34;watchers_count&#34;`</span>
  <span class="nx">OpenIssuesCount</span> <span class="kt">int</span>        <span class="s">`json:&#34;open_issues_count&#34;`</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Developer</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Login</span>      <span class="kt">string</span> <span class="s">`json:&#34;login&#34;`</span>
  <span class="nx">ID</span>         <span class="kt">int</span>    <span class="s">`json:&#34;id&#34;`</span>
  <span class="nx">NodeID</span>     <span class="kt">string</span> <span class="s">`json:&#34;node_id&#34;`</span>
  <span class="nx">AvatarURL</span>  <span class="kt">string</span> <span class="s">`json:&#34;avatar_url&#34;`</span>
  <span class="nx">GravatarID</span> <span class="kt">string</span> <span class="s">`json:&#34;gravatar_id&#34;`</span>
  <span class="nx">Type</span>       <span class="kt">string</span> <span class="s">`json:&#34;type&#34;`</span>
  <span class="nx">SiteAdmin</span>  <span class="kt">bool</span>   <span class="s">`json:&#34;site_admin&#34;`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then use <code>resty</code> to set the path parameters, query parameters, Header, Token, etc., and initiate the request.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">client</span> <span class="o">:=</span> <span class="nx">resty</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>

  <span class="kd">var</span> <span class="nx">result</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Repository</span>
  <span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span>
    <span class="nf">SetAuthToken</span><span class="p">(</span><span class="s">&#34;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&#34;</span><span class="p">).</span>
    <span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Accept&#34;</span><span class="p">,</span> <span class="s">&#34;application/vnd.github.v3+json&#34;</span><span class="p">).</span>
    <span class="nf">SetQueryParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
      <span class="s">&#34;per_page&#34;</span><span class="p">:</span>  <span class="s">&#34;3&#34;</span><span class="p">,</span>
      <span class="s">&#34;page&#34;</span><span class="p">:</span>      <span class="s">&#34;1&#34;</span><span class="p">,</span>
      <span class="s">&#34;sort&#34;</span><span class="p">:</span>      <span class="s">&#34;created&#34;</span><span class="p">,</span>
      <span class="s">&#34;direction&#34;</span><span class="p">:</span> <span class="s">&#34;asc&#34;</span><span class="p">,</span>
    <span class="p">}).</span>
    <span class="nf">SetPathParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
      <span class="s">&#34;org&#34;</span><span class="p">:</span> <span class="s">&#34;golang&#34;</span><span class="p">,</span>
    <span class="p">}).</span>
    <span class="nf">SetResult</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">).</span>
    <span class="nf">Get</span><span class="p">(</span><span class="s">&#34;https://api.github.com/orgs/{org}/repos&#34;</span><span class="p">)</span>

  <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">repo</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">result</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;repo%d: name:%s stars:%d forks:%d\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">StargazersCount</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">ForksCount</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above procedure pulls the 3 repositories in ascending order of creation time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">$ go run main.go
repo1: name:gddo stars:1097 forks:289
repo2: name:lint stars:3892 forks:518
repo3: name:glog stars:2738 forks:775
</code></pre></td></tr></table>
</div>
</div><h2 id="trace">Trace</h2>
<p>After introducing the main features of <code>resty</code>, let&rsquo;s take a look at a secondary feature provided by resty: <code>trace</code>. We enable <code>trace</code> by calling the <code>EnableTrace()</code> method on the request object. Enabling <code>trace</code> records the time taken and other information about each step of the request. <code>resty</code> supports chained calls, which means we can create the request, enable trace, and initiate the request all in one line: <code>trace</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">.</span><span class="nf">R</span><span class="p">().</span><span class="nf">EnableTrace</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;https://baidu.com&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>After completing the request, we get the information by calling the <code>TraceInfo()</code> method of the request object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">ti</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">TraceInfo</span><span class="p">()</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Request Trace Info:&#34;</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;DNSLookup:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">DNSLookup</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ConnTime:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">ConnTime</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;TCPConnTime:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">TCPConnTime</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;TLSHandshake:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">TLSHandshake</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ServerTime:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">ServerTime</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ResponseTime:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">ResponseTime</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;TotalTime:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">TotalTime</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;IsConnReused:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">IsConnReused</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;IsConnWasIdle:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">IsConnWasIdle</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ConnIdleTime:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">ConnIdleTime</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;RequestAttempt:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">RequestAttempt</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;RemoteAddr:&#34;</span><span class="p">,</span> <span class="nx">ti</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><p>We have access to the following information.</p>
<ul>
<li><code>DNSLookup</code>: the DNS lookup time, if a domain name is provided instead of an IP, the corresponding IP needs to be looked up in the DNS system before subsequent operations can be performed.</li>
<li><code>ConnTime</code>: the elapsed time to obtain a connection, which may be obtained from a connection pool or newly created.</li>
<li><code>TCPConnTime</code>: the time taken for a TCP connection, from the end of the DNS query to the establishment of the TCP connection.</li>
<li><code>TLSHandshake</code>: TLS handshake elapsed time.</li>
<li><code>ServerTime</code>: server processing elapsed time, calculating the time interval from connection establishment to the time the client receives the first byte.</li>
<li><code>ResponseTime</code>: response elapsed time, the time interval between the reception of the first response byte and the reception of the complete response.</li>
<li><code>TotalTime</code>: the elapsed time of the whole process.</li>
<li><code>IsConnReused</code>: whether the TCP connection is multiplexed or not.</li>
<li><code>IsConnWasIdle</code>: whether the connection was fetched from an idle connection pool.</li>
<li><code>ConnIdleTime</code>: the connection idle time.</li>
<li><code>RequestAttempt</code>: the number of requests in the request execution process, including the number of retries.</li>
<li><code>RemoteAddr</code>: the service address of the remote, in IP:PORT format.</li>
</ul>
<p><code>resty</code> makes a very fine distinction between these. In fact <code>resty</code> also uses the functionality provided by the standard library <code>net/http/httptrace</code>. <code>httptrace</code> provides a structure where we can set the callback functions for each stage.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/net/http/httptrace.go
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">ClientTrace</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">GetConn</span> <span class="kd">func</span><span class="p">(</span><span class="nx">hostPort</span> <span class="kt">string</span><span class="p">)</span>
  <span class="nx">GotConn</span> <span class="kd">func</span><span class="p">(</span><span class="nx">GotConnInfo</span><span class="p">)</span>
  <span class="nx">PutIdleConn</span> <span class="kd">func</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
  <span class="nx">GotFirstResponseByte</span> <span class="kd">func</span><span class="p">()</span>
  <span class="nx">Got100Continue</span> <span class="kd">func</span><span class="p">()</span>
  <span class="nx">Got1xxResponse</span> <span class="kd">func</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">header</span> <span class="nx">textproto</span><span class="p">.</span><span class="nx">MIMEHeader</span><span class="p">)</span> <span class="kt">error</span> <span class="c1">// Go 1.11
</span><span class="c1"></span>  <span class="nx">DNSStart</span> <span class="kd">func</span><span class="p">(</span><span class="nx">DNSStartInfo</span><span class="p">)</span>
  <span class="nx">DNSDone</span> <span class="kd">func</span><span class="p">(</span><span class="nx">DNSDoneInfo</span><span class="p">)</span>
  <span class="nx">ConnectStart</span> <span class="kd">func</span><span class="p">(</span><span class="nx">network</span><span class="p">,</span> <span class="nx">addr</span> <span class="kt">string</span><span class="p">)</span>
  <span class="nx">ConnectDone</span> <span class="kd">func</span><span class="p">(</span><span class="nx">network</span><span class="p">,</span> <span class="nx">addr</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
  <span class="nx">TLSHandshakeStart</span> <span class="kd">func</span><span class="p">()</span> <span class="c1">// Go 1.8
</span><span class="c1"></span>  <span class="nx">TLSHandshakeDone</span> <span class="kd">func</span><span class="p">(</span><span class="nx">tls</span><span class="p">.</span><span class="nx">ConnectionState</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="c1">// Go 1.8
</span><span class="c1"></span>  <span class="nx">WroteHeaderField</span> <span class="kd">func</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">value</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="c1">// Go 1.11
</span><span class="c1"></span>  <span class="nx">WroteHeaders</span> <span class="kd">func</span><span class="p">()</span>
  <span class="nx">Wait100Continue</span> <span class="kd">func</span><span class="p">()</span>
  <span class="nx">WroteRequest</span> <span class="kd">func</span><span class="p">(</span><span class="nx">WroteRequestInfo</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can get a brief idea of what the callbacks mean from the field names. <code>resty</code> sets the following callbacks when <code>trace</code> is enabled.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/go-resty/resty/trace.go
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">clientTrace</span><span class="p">)</span> <span class="nf">createContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httptrace</span><span class="p">.</span><span class="nf">WithClientTrace</span><span class="p">(</span>
    <span class="nx">ctx</span><span class="p">,</span>
    <span class="o">&amp;</span><span class="nx">httptrace</span><span class="p">.</span><span class="nx">ClientTrace</span><span class="p">{</span>
      <span class="nx">DNSStart</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">_</span> <span class="nx">httptrace</span><span class="p">.</span><span class="nx">DNSStartInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">dnsStart</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="nx">DNSDone</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">_</span> <span class="nx">httptrace</span><span class="p">.</span><span class="nx">DNSDoneInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">dnsDone</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="nx">ConnectStart</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">dnsDone</span><span class="p">.</span><span class="nf">IsZero</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">t</span><span class="p">.</span><span class="nx">dnsDone</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">dnsStart</span><span class="p">.</span><span class="nf">IsZero</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">t</span><span class="p">.</span><span class="nx">dnsStart</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">dnsDone</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">ConnectDone</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">net</span><span class="p">,</span> <span class="nx">addr</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">connectDone</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="nx">GetConn</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">_</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">getConn</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="nx">GotConn</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ci</span> <span class="nx">httptrace</span><span class="p">.</span><span class="nx">GotConnInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">gotConn</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">gotConnInfo</span> <span class="p">=</span> <span class="nx">ci</span>
      <span class="p">},</span>
      <span class="nx">GotFirstResponseByte</span><span class="p">:</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">gotFirstResponseByte</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="nx">TLSHandshakeStart</span><span class="p">:</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">tlsHandshakeStart</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="nx">TLSHandshakeDone</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">_</span> <span class="nx">tls</span><span class="p">.</span><span class="nx">ConnectionState</span><span class="p">,</span> <span class="nx">_</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">tlsHandshakeDone</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, when fetching <code>TraceInfo</code>, the elapsed time is calculated based on each time point.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// src/github.com/go-resty/resty/request.go
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Request</span><span class="p">)</span> <span class="nf">TraceInfo</span><span class="p">()</span> <span class="nx">TraceInfo</span> <span class="p">{</span>
  <span class="nx">ct</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">clientTrace</span>

  <span class="k">if</span> <span class="nx">ct</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">TraceInfo</span><span class="p">{}</span>
  <span class="p">}</span>

  <span class="nx">ti</span> <span class="o">:=</span> <span class="nx">TraceInfo</span><span class="p">{</span>
    <span class="nx">DNSLookup</span><span class="p">:</span>      <span class="nx">ct</span><span class="p">.</span><span class="nx">dnsDone</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">dnsStart</span><span class="p">),</span>
    <span class="nx">TLSHandshake</span><span class="p">:</span>   <span class="nx">ct</span><span class="p">.</span><span class="nx">tlsHandshakeDone</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">tlsHandshakeStart</span><span class="p">),</span>
    <span class="nx">ServerTime</span><span class="p">:</span>     <span class="nx">ct</span><span class="p">.</span><span class="nx">gotFirstResponseByte</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">gotConn</span><span class="p">),</span>
    <span class="nx">IsConnReused</span><span class="p">:</span>   <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConnInfo</span><span class="p">.</span><span class="nx">Reused</span><span class="p">,</span>
    <span class="nx">IsConnWasIdle</span><span class="p">:</span>  <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConnInfo</span><span class="p">.</span><span class="nx">WasIdle</span><span class="p">,</span>
    <span class="nx">ConnIdleTime</span><span class="p">:</span>   <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConnInfo</span><span class="p">.</span><span class="nx">IdleTime</span><span class="p">,</span>
    <span class="nx">RequestAttempt</span><span class="p">:</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Attempt</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConnInfo</span><span class="p">.</span><span class="nx">Reused</span> <span class="p">{</span>
    <span class="nx">ti</span><span class="p">.</span><span class="nx">TotalTime</span> <span class="p">=</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">endTime</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">getConn</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">ti</span><span class="p">.</span><span class="nx">TotalTime</span> <span class="p">=</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">endTime</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">dnsStart</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">!</span><span class="nx">ct</span><span class="p">.</span><span class="nx">connectDone</span><span class="p">.</span><span class="nf">IsZero</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ti</span><span class="p">.</span><span class="nx">TCPConnTime</span> <span class="p">=</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">connectDone</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">dnsDone</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">!</span><span class="nx">ct</span><span class="p">.</span><span class="nx">gotConn</span><span class="p">.</span><span class="nf">IsZero</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ti</span><span class="p">.</span><span class="nx">ConnTime</span> <span class="p">=</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConn</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">getConn</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">!</span><span class="nx">ct</span><span class="p">.</span><span class="nx">gotFirstResponseByte</span><span class="p">.</span><span class="nf">IsZero</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ti</span><span class="p">.</span><span class="nx">ResponseTime</span> <span class="p">=</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">endTime</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">ct</span><span class="p">.</span><span class="nx">gotFirstResponseByte</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConnInfo</span><span class="p">.</span><span class="nx">Conn</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">ti</span><span class="p">.</span><span class="nx">RemoteAddr</span> <span class="p">=</span> <span class="nx">ct</span><span class="p">.</span><span class="nx">gotConnInfo</span><span class="p">.</span><span class="nx">Conn</span><span class="p">.</span><span class="nf">RemoteAddr</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">ti</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Run output.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">$ go run main.go
Request Trace Info:
DNSLookup: 2.815171ms
ConnTime: 941.635171ms
TCPConnTime: 269.069692ms
TLSHandshake: 669.276011ms
ServerTime: 274.623991ms
ResponseTime: 112.216µs
TotalTime: 1.216276906s
IsConnReused: false
IsConnWasIdle: false
ConnIdleTime: 0s
RequestAttempt: 1
RemoteAddr: 18.235.124.214:443
</code></pre></td></tr></table>
</div>
</div><p>We see that TLS consumes almost half of the time.</p>
<h2 id="summary">Summary</h2>
<p>In this article I introduce <code>HTTP Client</code>, a very handy and easy to use library for the <code>Go</code> language. <code>resty</code> provides a very useful and rich <code>API</code>. Chain calls, automatic <code>Unmarshal</code>, request parameters/path settings are very convenient and useful, so that we can do our work with less effort. Due to the limitation of space, many advanced features can not be introduced one by one, such as submit form, upload files, etc., etc.. We can only leave it to those who are interested to explore it. 😄</p>
<h2 id="reference">Reference</h2>
<ul>
<li>resty GitHub：<a href="github.com/go-resty/resty">github.com/go-resty/resty</a></li>
<li>GitHub API：<a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api">https://docs.github.com/en/rest/overview/resources-in-the-rest-api</a></li>
</ul>
<hr>
<p>Reference <code>https://darjun.github.io/2021/06/26/godailylib/resty</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          <a href="/tags/resty/">resty</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-06/pitfalls-of-os.popen-function-and-pipe-in-python/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Pitfalls of os.popen function and Pipe in Python</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-06/golang-number-of-threads-in-the-running-program/">
            <span class="next-text nav-default">Golang - Number of Threads in the Running Program</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
