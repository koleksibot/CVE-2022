<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Angular or Ionic Exception Handling ErrorHandler - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Exception handling is very important in front-end, including client-side and server-side exceptions. Previously, exception handling was to add err handling for each asynchronous function, which not only increased the workload, but also easily missed some exceptions. Fortunately, Angular6 provides ErrorHandler to handle exceptions (Ionic4 for IonicErrorHandler), the default ErrorHandler handling exceptions is to output it on the console, which obviously can not meet the demand, so you need to implement" /><meta name="keywords" content="angular,ionic" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-06/angular-or-ionic-exception-handling-errorhandler/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Angular or Ionic Exception Handling ErrorHandler" />
<meta property="og:description" content="Exception handling is very important in front-end, including client-side and server-side exceptions. Previously, exception handling was to add err handling for each asynchronous function, which not only increased the workload, but also easily missed some exceptions. Fortunately, Angular6 provides ErrorHandler to handle exceptions (Ionic4 for IonicErrorHandler), the default ErrorHandler handling exceptions is to output it on the console, which obviously can not meet the demand, so you need to implement" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-06/angular-or-ionic-exception-handling-errorhandler/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-13T20:17:46+08:00" />
<meta property="article:modified_time" content="2021-06-13T20:17:46+08:00" />

<meta itemprop="name" content="Angular or Ionic Exception Handling ErrorHandler">
<meta itemprop="description" content="Exception handling is very important in front-end, including client-side and server-side exceptions. Previously, exception handling was to add err handling for each asynchronous function, which not only increased the workload, but also easily missed some exceptions. Fortunately, Angular6 provides ErrorHandler to handle exceptions (Ionic4 for IonicErrorHandler), the default ErrorHandler handling exceptions is to output it on the console, which obviously can not meet the demand, so you need to implement"><meta itemprop="datePublished" content="2021-06-13T20:17:46+08:00" />
<meta itemprop="dateModified" content="2021-06-13T20:17:46+08:00" />
<meta itemprop="wordCount" content="1032">
<meta itemprop="keywords" content="angular,ionic," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Angular or Ionic Exception Handling ErrorHandler"/>
<meta name="twitter:description" content="Exception handling is very important in front-end, including client-side and server-side exceptions. Previously, exception handling was to add err handling for each asynchronous function, which not only increased the workload, but also easily missed some exceptions. Fortunately, Angular6 provides ErrorHandler to handle exceptions (Ionic4 for IonicErrorHandler), the default ErrorHandler handling exceptions is to output it on the console, which obviously can not meet the demand, so you need to implement"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Angular or Ionic Exception Handling ErrorHandler</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-06-13 20:17:46 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/frontend/"> frontend </a>
            </div>
          <span class="more-meta"> 1032 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#why-use-errorhandler-to-unify-exception-handling">Why use ErrorHandler to unify exception handling</a></li>
        <li><a href="#concrete-implementation-of-catching-exceptions-with-errorhandler">Concrete implementation of catching exceptions with ErrorHandler</a>
          <ul>
            <li><a href="#step-1-create-errorservice-and-loggingservice-to-get-exception-information-and-record-exception-logs">Step 1: Create <code>ErrorService</code> and <code>LoggingService</code> to get exception information and record exception logs</a></li>
            <li><a href="#step-2-create-globalerrorhandler">Step 2: Create GlobalErrorHandler</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Exception handling is very important in front-end, including client-side and server-side exceptions. Previously, exception handling was to add err handling for each asynchronous function, which not only increased the workload, but also easily missed some exceptions. Fortunately, Angular6 provides ErrorHandler to handle exceptions (Ionic4 for IonicErrorHandler), the default ErrorHandler handling exceptions is to output it on the console, which obviously can not meet the demand, so you need to implement a GlobalErrorHandler.</p>
<h2 id="why-use-errorhandler-to-unify-exception-handling">Why use ErrorHandler to unify exception handling</h2>
<ul>
<li>Improve efficiency (for example, before for each asynchronous function need to pass err parameters to handle, now use ErrorHandler unified processing) The previous code for asynchronous exception handling is the following, just see so many err will feel dizzy, not to mention the logic code above, of course, for multiple asynchronous requests this is not the best way to handle, here only discuss exceptions.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js">         <span class="p">(</span><span class="nx">err</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">),</span> <span class="p">(</span><span class="nx">err</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
              <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
            <span class="p">};</span>
          <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">},</span>
        <span class="p">(</span><span class="nx">err</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Exceptions that are not easily reproducible can be caught, especially problems that are not easily reproducible on the client side. If a client has a problem that cannot be reproduced locally and happens to forget to catch the exception, it would be very bad. Unified processing can input the exception information into the log and can quickly locate the problem.</p>
</li>
<li>
<p>It is also very bad to handle uncommon exceptions or runtime exceptions, and to prompt the user in a timely manner without crashing the program or exposing the exception directly to the user by not catching it.</p>
</li>
<li>
<p>For the user, a uniform, friendly exception message prompt can be displayed, creating a unique system style. For some exceptions, it is even possible to explain to the user why the exception is thrown and guide the user behavior to eliminate the exception. For example, if the user throws an insufficient balance exception when making a payment, the user should be prompted that the balance is insufficient, in addition to displaying a recharge portal (if the current system supports recharge) or prompting the user where to recharge.</p>
</li>
</ul>
<h2 id="concrete-implementation-of-catching-exceptions-with-errorhandler">Concrete implementation of catching exceptions with ErrorHandler</h2>
<h3 id="step-1-create-errorservice-and-loggingservice-to-get-exception-information-and-record-exception-logs">Step 1: Create <code>ErrorService</code> and <code>LoggingService</code> to get exception information and record exception logs</h3>
<p>ErrorService: Get the exception information and stack of client side, exception information and status code of server side.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpErrorResponse</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">ErrorService</span> <span class="p">{</span>

    <span class="nx">getClientMessage</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span> <span class="nb">Error</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;暂无网络，请检查网络&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="o">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="o">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">getClientStack</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span> <span class="nb">Error</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">getServerMessage</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">getServerStatus</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span><span class="o">:</span> <span class="nx">number</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>LoggingService: Send exception information to the backend through <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Beacon_API">Beacon API</a> and record exception logs, including current logged-in user, exception occurrence time, exception information, etc.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">DatePipe</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">GlobalProvider</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../globalprovider&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@env/environment&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">URL</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../url&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">LoggingService</span> <span class="p">{</span>

    <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">global</span><span class="o">:</span> <span class="nx">GlobalProvider</span><span class="p">,</span>
        <span class="kr">private</span> <span class="nx">datePipe</span><span class="o">:</span> <span class="nx">DatePipe</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">logError</span><span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">stack</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">currentUser</span> <span class="o">=</span> <span class="s1">&#39;notLogin&#39;</span><span class="p">;</span>
        <span class="k">if</span>  <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">isLogin</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">currentUser</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="sb">`{user: </span><span class="si">${</span><span class="nx">currentUser</span><span class="si">}</span><span class="sb">, logtime: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">datePipe</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="s1">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">, content: </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb">, stack: </span><span class="si">${</span><span class="nx">stack</span><span class="si">}</span><span class="sb">}`</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="nx">environment</span><span class="p">.</span><span class="nx">SERVER_URL</span> <span class="o">+</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Beacon is not supported
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">SERVER_URL</span> <span class="o">+</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="step-2-create-globalerrorhandler">Step 2: Create GlobalErrorHandler</h3>
<ul>
<li>Create global-error-handler.ts</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ErrorHandler</span><span class="p">,</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">Injector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpErrorResponse</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">GlobalErrorHandler</span> <span class="kr">implements</span> <span class="nx">ErrorHandler</span> <span class="p">{</span>

    <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">injector</span><span class="o">:</span> <span class="nx">Injector</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">handleError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span> <span class="nb">Error</span> <span class="o">|</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Add to app.module.ts</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">providers</span><span class="o">:</span>  <span class="p">[</span>
<span class="p">...</span>
 <span class="p">{</span> <span class="nx">provide</span><span class="o">:</span> <span class="nx">ErrorHandler</span><span class="p">,</span> <span class="nx">useClass</span><span class="o">:</span> <span class="nx">GlobalErrorHandler</span><span class="p">},</span>
<span class="p">...</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Add exception handling logic
<ul>
<li>The current framework used is Ant Design, so the user prompts use NzMessageService.</li>
<li>When an exception occurs in the program, the handleError hook is automatically called, which can determine whether the exception is from the client or from the server.</li>
<li>In practical projects, it may be necessary to provide Services that display exception messages to satisfy the display of different exception messages.</li>
<li>For exception logging, it can be filtered according to the content of exceptions, and it is not necessary to log every exception.</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ErrorHandler</span><span class="p">,</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">Injector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpErrorResponse</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">LoggingService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./services/logging.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ErrorService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./services/error.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">NzMessageService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ng-zorro-antd&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">GlobalErrorHandler</span> <span class="kr">implements</span> <span class="nx">ErrorHandler</span> <span class="p">{</span>

    <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">injector</span><span class="o">:</span> <span class="nx">Injector</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">handleError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span> <span class="nb">Error</span> <span class="o">|</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span> <span class="p">{</span>

        <span class="kr">const</span> <span class="nx">errorService</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">ErrorService</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">LoggingService</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">NzMessageService</span><span class="p">);</span>

        <span class="kd">let</span> <span class="nx">message</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">status</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">stackTrace</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">message</span> <span class="o">=</span> <span class="nx">errorService</span><span class="p">.</span><span class="nx">getServerMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="nx">errorService</span><span class="p">.</span><span class="nx">getServerStatus</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
           <span class="c1">// Prompt for exception messages
</span><span class="c1"></span>            <span class="nx">msg</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">message</span> <span class="o">=</span> <span class="nx">errorService</span><span class="p">.</span><span class="nx">getClientMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="nx">stackTrace</span> <span class="o">=</span> <span class="nx">errorService</span><span class="p">.</span><span class="nx">getClientStack</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
           <span class="c1">// Prompt for exception messages
</span><span class="c1"></span>            <span class="nx">msg</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Record daily logs
</span><span class="c1"></span>        <span class="nx">logger</span><span class="p">.</span><span class="nx">logError</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">stackTrace</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Note: Many people previously handled exceptions in the Interceptor, Interceptor can only handle HttpErrorResponse type of error, if handled here, then ErrorHandler will not capture. So in the Interceptor, encounter HttpErrorResponse error needs to be thrown.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">catchError</span><span class="p">((</span><span class="nx">error</span><span class="o">:</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Jump to login page or refresh token
</span><span class="c1"></span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">throwError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
 <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>Reference <code>https://blog.dteam.top/posts/2020-02/angular%E6%88%96ionic-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86errorhandler.html</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/angular/">angular</a>
          <a href="/tags/ionic/">ionic</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-06/jdbc-batch-insert-mybatis-postgresql/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Jdbc Batch Insert Mybatis Postgresql</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-06/exploring-the-react-native-startup-version-checking-mechanism/">
            <span class="next-text nav-default">Exploring the React Native Startup Version Checking Mechanism</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
