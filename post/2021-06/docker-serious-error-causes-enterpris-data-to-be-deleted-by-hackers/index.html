<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Docker Serious Error Causes Enterpris Data to Be Deleted by Hackers - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Be cautious of popular technologies that promise to make work easy - they often cut corners, and security is often one of them.
A few days ago, the database of NewsBlur (a web-based RSS reader) was deleted by a hacker due to a bug that existed in Docker for years.
In a blog post this week, NewsBlur founder Samuel Clay detailed his ordeal: during a migration of a MongoDB cluster to a Docker container, a hacker gained access to the NewsBlur database, deleted 250GB of raw data, and demanded a 0." /><meta name="keywords" content="docker,security,hackers" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-06/docker-serious-error-causes-enterpris-data-to-be-deleted-by-hackers/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Docker Serious Error Causes Enterpris Data to Be Deleted by Hackers" />
<meta property="og:description" content="Be cautious of popular technologies that promise to make work easy - they often cut corners, and security is often one of them.
A few days ago, the database of NewsBlur (a web-based RSS reader) was deleted by a hacker due to a bug that existed in Docker for years.
In a blog post this week, NewsBlur founder Samuel Clay detailed his ordeal: during a migration of a MongoDB cluster to a Docker container, a hacker gained access to the NewsBlur database, deleted 250GB of raw data, and demanded a 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-06/docker-serious-error-causes-enterpris-data-to-be-deleted-by-hackers/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-30T18:17:41+08:00" />
<meta property="article:modified_time" content="2021-06-30T18:17:41+08:00" />

<meta itemprop="name" content="Docker Serious Error Causes Enterpris Data to Be Deleted by Hackers">
<meta itemprop="description" content="Be cautious of popular technologies that promise to make work easy - they often cut corners, and security is often one of them.
A few days ago, the database of NewsBlur (a web-based RSS reader) was deleted by a hacker due to a bug that existed in Docker for years.
In a blog post this week, NewsBlur founder Samuel Clay detailed his ordeal: during a migration of a MongoDB cluster to a Docker container, a hacker gained access to the NewsBlur database, deleted 250GB of raw data, and demanded a 0."><meta itemprop="datePublished" content="2021-06-30T18:17:41+08:00" />
<meta itemprop="dateModified" content="2021-06-30T18:17:41+08:00" />
<meta itemprop="wordCount" content="1184">
<meta itemprop="keywords" content="docker," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker Serious Error Causes Enterpris Data to Be Deleted by Hackers"/>
<meta name="twitter:description" content="Be cautious of popular technologies that promise to make work easy - they often cut corners, and security is often one of them.
A few days ago, the database of NewsBlur (a web-based RSS reader) was deleted by a hacker due to a bug that existed in Docker for years.
In a blog post this week, NewsBlur founder Samuel Clay detailed his ordeal: during a migration of a MongoDB cluster to a Docker container, a hacker gained access to the NewsBlur database, deleted 250GB of raw data, and demanded a 0."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Docker Serious Error Causes Enterpris Data to Be Deleted by Hackers</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-06-30 18:17:41 </span>
        <div class="post-category">
            <a href="/categories/container/"> container </a>
            <a href="/categories/security/"> security </a>
            </div>
          <span class="more-meta"> 1184 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#how-was-newsblurs-mongodb-server-compromised">How was NewsBlur&rsquo;s MongoDB server compromised?</a></li>
        <li><a href="#what-can-i-do-to-make-sure-this-doesnt-happen-again">What can I do to make sure this doesn&rsquo;t happen again?</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Be cautious of popular technologies that promise to make work easy - they often cut corners, and security is often one of them.</p>
<p>A few days ago, the database of NewsBlur (a web-based RSS reader) was <a href="https://news.ycombinator.com/item?id=27613217">deleted by a hacker</a> due to a bug that existed in Docker for years.</p>
<p>In a <a href="https://blog.newsblur.com/2021/06/28/story-of-a-hacking/">blog</a> post this week, NewsBlur founder Samuel Clay detailed his ordeal: during a migration of a MongoDB cluster to a Docker container, a hacker gained access to the NewsBlur database, deleted 250GB of raw data, and demanded a 0.03 BTC ransom.</p>
<p>Clay blamed the attack on a firewall error that occurred during the database migration: &ldquo;When I containerized MongoDB, Docker helped me open up MongoDB to the world by inserting an allowable rule in iptables.&rdquo;</p>
<p>This issue with Docker was reported to Docker as a <a href="https://github.com/moby/moby/issues/4737">&ldquo;serious bug&rdquo;</a> back in 2014, but has not been resolved.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/30/49a3fa2bc83641eb983918c43fd65f8d.png" alt=" "></p>
<h2 id="how-was-newsblurs-mongodb-server-compromised">How was NewsBlur&rsquo;s MongoDB server compromised?</h2>
<p>Last week, Clay began maintenance work on NewsBlur as he prepared to migrate several of the company&rsquo;s PostgreSQL, MongoDB, Redis, and Elasticsearch databases to Docker containers. In the hours leading up to the attack, he switched the application&rsquo;s MongoDB cluster to the new server and shut down the original server, intending to remove it once the new setup proved stable and available.</p>
<p>About three hours later, the exposed database appeared to have been discovered and deleted by an automated ransomware script. clay said that when he saw the error message on his phone, he understood that this was tantamount to receiving a disaster alert.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/30/6e0aefe758e44cf581a328a038645e8e.png" alt=" "></p>
<p>The error message contained the keyword &ldquo;drop&rdquo;, the SQL command used to delete the database.</p>
<p>When he then logged into the MongoDB machine to check what state the database was in, he found a new empty database named &ldquo;READ__ME_TO_RECOVER_YOUR_DATA&rdquo;. It contained a message left by the hacker: &ldquo;Your data has been deleted, you must pay 0.03 BTC within 48 hours to recover it.&rdquo;</p>
<p>Clay quickly looked at the MongoDB access logs. Analyzing the logs revealed two connections that were made a few seconds apart. Both of these connections from unknown IPs occurred just before the entire database was deleted. By tracing the connection IPs, it was easy to spot the hacker entering the server and deleting it just seconds later.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/30/4ccc0b1f31ad4d69b49bf83f74f1158f.png" alt=" "></p>
<p>But in fact, Clay enabled the UFW firewall and tried to stay on a strict permission list, only for internal servers. But for Docker reasons, it didn&rsquo;t work on the new server.</p>
<p>When he containerized MongoDB, Docker inserted a permissive rule in iptables that opened MongoDB to the world, so when the firewall was &ldquo;active&rdquo;, running sudo iptables -L | grep 27017 showed MongoDB. grep 27017 to show that MongoDB is open.</p>
<p>Fortunately, Clay did not pay the ransom to the hacker, because through analysis he believed that the data was not actually stolen and that he had a backup (copy) of the wiped database. The logs also show that the automated attacker only issued a delete command and did not transfer any data from the MongoDB server.</p>
<p>Another evidence that the data was not transferred is a snapshot of the traffic on the db-mongo1 machine within 24 hours.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/30/e1ef1d28f42b4575919eb7a6e5984a57.png" alt=" "></p>
<p>6:10pm: The new db-mongo1 server is rotated into the MongoDB master server. This machine is the first new, soon-to-be-private cloud machine.</p>
<p>9:35pm: Three hours later, an automated hack attempted to open a connection to the db-mongo1 server, and the database was immediately dropped. Downtime ensues.</p>
<p>10:15pm: Before the previous primary server went into rotation, NewsBlur took a snapshot of the server to ensure that the backup would not self-delete upon reconnection. This process took a few hours of downtime, but saved almost 18 hours of data by not forcing me into a daily backup archive.</p>
<p>3am: Snapshot completed and replication from the original master server to the new db-mongo1 begins.</p>
<p>4:30am: Inbound replication from the old primary server is complete and outbound replication begins on the new secondary server. NewsBlur is now back to normal.</p>
<p>It took over 3 hours from the time the switch was flipped to the time the hacker deleted NewsBlur&rsquo;s MongoDB collection and pretended to redeem about 250GB of data. A few hours later, when the backups were restored, NewsBlur was back online and the vulnerabilities created by Docker were patched.</p>
<h2 id="what-can-i-do-to-make-sure-this-doesnt-happen-again">What can I do to make sure this doesn&rsquo;t happen again?</h2>
<p>For the past seven years, &ldquo;Docker networks bypassing firewalls with no option to disable&rdquo; has been a concern for developers. It was reported to Docker back in 2014, but the problem was never resolved.</p>
<p>While there are various suggestions for solutions in online forums, Clay commented on why Docker didn&rsquo;t choose to just fix it: &ldquo;It&rsquo;s a bit of a trade-off between convenience and security. Here, Docker thinks convenience is more important.&rdquo;</p>
<p>On the other hand, attacks on MongoDB databases in an open state have existed for a long time. After this incident drew widespread developer attention on Riddit, noted security researcher Bob Diachenko <a href="https://twitter.com/MayhemDayOne/status/1409559111059005444">tweeted</a>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/30/f3d342ed4e6a4a5da20452b6514dda06.png" alt=" "></p>
<p>Notably, the MongoDB was insecure online for nearly a month before the &ldquo;hackers&rdquo; cleaned it up.</p>
<p>Professionals believe the attack was automated and part of a ransom trend that began in late 2016. At that time, multiple hacking groups began wiping MongoDB servers and demanding ransom from server owners who had exposed MongoDB instances to the network without passwords. While the hackers claimed they had copied the deleted data, in most cases it was a bluff, expecting victims to pay a small ransom, with ransom demands typically ranging from $200 to $2,000.</p>
<p>These attacks have been around for years and are still active today. The lessons we can learn from this incident are.</p>
<ul>
<li>Migrating data to a VPC, or Virtual Private Cloud, allows critical servers to be accessed only through other servers in a private network. But it was this migration process that was subject to hacking. Ironically, when migrating data to a private network, NewsBlur needs to migrate all data from publicly accessible machines. It is the first step of the process.</li>
<li>Database user authentication mechanism needs to be enabled on all databases. For a long time, NewsBlur relied on firewalls to protect itself from threats, but when the firewalls silently failed, the database was exposed. Today, who can say that if the firewall fails, but because the authentication mechanism already exists, then the hack will be detected. This password needs to be long enough to avoid brute-force cracking, because at the end of the day, an open database that is not protected by a password is likely to be on the list of hackers.</li>
<li>Database users with delete privileges need to be tuned. Most database users should only need read and write permissions. Ideally, only localhost users should be allowed to perform potentially destructive operations.</li>
</ul>
<p>But these are only part of a defense strategy, and a proper defense strategy must not rely on a carefully set up layer alone. For NewsBlur, this layer is a firewall that only allows access.</p>
<p>As always, what&rsquo;s really useful is a &ldquo;backup&rdquo; policy. Regular, tested backups are a necessary part of any web service.</p>
<p>Reference link.</p>
<p><a href="http://blog.newsblur.com/2021/06/28/story-of-a-hacking/">http://blog.newsblur.com/2021/06/28/story-of-a-hacking/</a></p>
<hr>
<p>Reference <code>https://www.infoq.cn/article/QQYuiOLc8xR2zzvdQowb</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/docker/">docker</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-06/a-pitfall-of-comparing-empty-structs-in-golang/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">A pitfall of comparing empty structs in Golang</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-06/finding-the-kth-largest-number-in-a-large-amount-of-unordered-data/">
            <span class="next-text nav-default">Finding the Kth Largest Number in a Large Amount of Unordered Data</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
