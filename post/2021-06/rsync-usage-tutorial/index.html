<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Rsync Usage Tutorial - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="1. Introduction rsync is a commonly used Linux application for file synchronization.
It can synchronize files between the local computer and a remote computer, or between two local directories (but does not support synchronization between two remote computers). It can also be used as a file copying tool, replacing the cp and mv commands.
The r in its name refers to remote, rsync actually means &amp;ldquo;remote synchronization&amp;rdquo;. Unlike other file transfer tools (such as FTP or scp), rsync&amp;rsquo;s main feature is that it checks the existing files of both the sender and the receiver and only transfers the parts that have changed (the default rule is that the file size or modification time has changed)." /><meta name="keywords" content="linux,rsync" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-06/rsync-usage-tutorial/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Rsync Usage Tutorial" />
<meta property="og:description" content="1. Introduction rsync is a commonly used Linux application for file synchronization.
It can synchronize files between the local computer and a remote computer, or between two local directories (but does not support synchronization between two remote computers). It can also be used as a file copying tool, replacing the cp and mv commands.
The r in its name refers to remote, rsync actually means &ldquo;remote synchronization&rdquo;. Unlike other file transfer tools (such as FTP or scp), rsync&rsquo;s main feature is that it checks the existing files of both the sender and the receiver and only transfers the parts that have changed (the default rule is that the file size or modification time has changed)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-06/rsync-usage-tutorial/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-17T19:30:36+08:00" />
<meta property="article:modified_time" content="2021-06-17T19:30:36+08:00" />

<meta itemprop="name" content="Rsync Usage Tutorial">
<meta itemprop="description" content="1. Introduction rsync is a commonly used Linux application for file synchronization.
It can synchronize files between the local computer and a remote computer, or between two local directories (but does not support synchronization between two remote computers). It can also be used as a file copying tool, replacing the cp and mv commands.
The r in its name refers to remote, rsync actually means &ldquo;remote synchronization&rdquo;. Unlike other file transfer tools (such as FTP or scp), rsync&rsquo;s main feature is that it checks the existing files of both the sender and the receiver and only transfers the parts that have changed (the default rule is that the file size or modification time has changed)."><meta itemprop="datePublished" content="2021-06-17T19:30:36+08:00" />
<meta itemprop="dateModified" content="2021-06-17T19:30:36+08:00" />
<meta itemprop="wordCount" content="2252">
<meta itemprop="keywords" content="linux,rsync," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rsync Usage Tutorial"/>
<meta name="twitter:description" content="1. Introduction rsync is a commonly used Linux application for file synchronization.
It can synchronize files between the local computer and a remote computer, or between two local directories (but does not support synchronization between two remote computers). It can also be used as a file copying tool, replacing the cp and mv commands.
The r in its name refers to remote, rsync actually means &ldquo;remote synchronization&rdquo;. Unlike other file transfer tools (such as FTP or scp), rsync&rsquo;s main feature is that it checks the existing files of both the sender and the receiver and only transfers the parts that have changed (the default rule is that the file size or modification time has changed)."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Rsync Usage Tutorial</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-06-17 19:30:36 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            <a href="/categories/tools/"> tools </a>
            </div>
          <span class="more-meta"> 2252 words </span>
          <span class="more-meta"> 11 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-introduction">1. Introduction</a></li>
        <li><a href="#2-installation">2. Installation</a></li>
        <li><a href="#3-basic-usage">3. Basic usage</a>
          <ul>
            <li><a href="#31--r-parameter">3.1 -r parameter</a></li>
            <li><a href="#32--a-parameters">3.2 -a parameters</a></li>
            <li><a href="#33--n-parameter">3.3 -n parameter</a></li>
            <li><a href="#34---delete-parameter">3.4 &ndash;delete parameter</a></li>
          </ul>
        </li>
        <li><a href="#4-excluded-documents">4. Excluded documents</a>
          <ul>
            <li><a href="#41---exclude-parameter">4.1 &ndash;exclude parameter</a></li>
            <li><a href="#42-the---include-parameter">4.2 The &ndash;include parameter</a></li>
          </ul>
        </li>
        <li><a href="#5-remote-synchronization">5. Remote synchronization</a>
          <ul>
            <li><a href="#51-ssh-protocol">5.1 SSH Protocol</a></li>
            <li><a href="#52-rsync-protocol">5.2 rsync protocol</a></li>
          </ul>
        </li>
        <li><a href="#6-incremental-backup">6. Incremental backup</a></li>
        <li><a href="#7-configuration-items">7. Configuration items</a></li>
        <li><a href="#8-reference-links">8. Reference Links</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-introduction">1. Introduction</h2>
<p><code>rsync</code> is a commonly used <code>Linux</code> application for file synchronization.</p>
<p>It can synchronize files between the local computer and a remote computer, or between two local directories (but does not support synchronization between two remote computers). It can also be used as a file copying tool, replacing the <code>cp</code> and <code>mv</code> commands.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/17/190c0ca87a394ff9a0f6eefc8c404bd8.png" alt="rsync"></p>
<p>The <code>r</code> in its name refers to <code>remote</code>, rsync actually means &ldquo;remote synchronization&rdquo;. Unlike other file transfer tools (such as FTP or scp), rsync&rsquo;s main feature is that it checks the existing files of both the sender and the receiver and only transfers the parts that have changed (the default rule is that the file size or modification time has changed).</p>
<h2 id="2-installation">2. Installation</h2>
<p>If rsync is not installed on the local or remote computer, you can use the following command to install it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Debian</span>
$ sudo apt-get install rsync

<span class="c1"># Red Hat</span>
$ sudo yum install rsync

<span class="c1"># Arch Linux</span>
$ sudo pacman -S rsync
</code></pre></td></tr></table>
</div>
</div><p>Note that rsync must be installed on both sides of the transfer.</p>
<h2 id="3-basic-usage">3. Basic usage</h2>
<h3 id="31--r-parameter">3.1 -r parameter</h3>
<p>When using the rsync command locally, it can be used as an alternative to the cp and mv commands to synchronize the source directory to the target directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -r <span class="nb">source</span> destination
</code></pre></td></tr></table>
</div>
</div><p>In the above command, <code>-r</code> means recursive, i.e. contains subdirectories. Note that <code>-r</code> is required, otherwise <code>rsync</code> will not run successfully. The <code>source</code> directory indicates the source directory, and <code>destination</code> indicates the destination directory.</p>
<p>If there are multiple files or directories to be synchronized, you can write it like the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -r source1 source2 destination
</code></pre></td></tr></table>
</div>
</div><p>In the above command, source1 and source2 will be synchronized to the destination directory.</p>
<h3 id="32--a-parameters">3.2 -a parameters</h3>
<p>The <code>-a</code> parameter can be used instead of <code>-r</code> to synchronize meta-information (such as modification time, permissions, etc.) in addition to recursive synchronization. Since rsync uses file size and modification time by default to determine if a file needs to be updated, -a is more useful than -r. The following usage is the common way to write it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -a <span class="nb">source</span> destination
</code></pre></td></tr></table>
</div>
</div><p>If the destination directory <code>destination</code> does not exist, rsync will create it automatically. After executing the above command, the source directory <code>source</code> is copied completely to the destination directory <code>destination</code>, i.e. the directory structure <code>destination/source</code> is formed.</p>
<p>If you want to synchronize only the contents of the source directory <code>source</code> to the destination directory <code>destination</code>, you need to add a slash after the source directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -a source/ destination
</code></pre></td></tr></table>
</div>
</div><p>After the above command is executed, the contents of the <code>source</code> directory will be copied to the <code>destination</code> directory, and no <code>source</code> subdirectory will be created under <code>destination</code>.</p>
<h3 id="33--n-parameter">3.3 -n parameter</h3>
<p>If you are not sure what the result of rsync execution will be, you can first simulate the result with <code>-n</code> or <code>-dry-run</code> arguments.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -anv source/ destination
</code></pre></td></tr></table>
</div>
</div><p>In the above command, the <code>-n</code> parameter simulates the result of the command execution and does not actually execute the command. The -v parameter, on the other hand, outputs the results to the terminal so that you can see what will be synchronized.</p>
<h3 id="34---delete-parameter">3.4 &ndash;delete parameter</h3>
<p>By default, <code>rsync</code> only ensures that all the contents of the source directory (except for explicitly excluded files) are copied to the target directory. It does not make the two directories identical and does not delete files. If you want to make the target directory a mirror copy of the source directory, you must use the <code>--delete</code> parameter, which will delete files that exist only in the target directory and not in the source directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --delete source/ destination
</code></pre></td></tr></table>
</div>
</div><p>The <code>-delete</code> parameter in the above command will make <code>destination</code> a mirror of <code>source</code>.</p>
<h2 id="4-excluded-documents">4. Excluded documents</h2>
<h3 id="41---exclude-parameter">4.1 &ndash;exclude parameter</h3>
<p>Sometimes we want to exclude certain files or directories from synchronization, so we can specify the exclusion mode with the <code>--exclude</code> parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --exclude<span class="o">=</span><span class="s1">&#39;*.txt&#39;</span> source/ destination
<span class="c1"># or</span>
$ rsync -av --exclude <span class="s1">&#39;*.txt&#39;</span> source/ destination
</code></pre></td></tr></table>
</div>
</div><p>The above command excludes all TXT files.</p>
<p>Note that rsync will synchronize hidden files starting with &ldquo;dot&rdquo;, to exclude hidden files, you can write <code>--exclude=&quot;. *&quot;</code>.</p>
<p>If you want to exclude all files inside a directory, but do not want to exclude the directory itself, you can write it like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --exclude <span class="s1">&#39;dir1/*&#39;</span> source/ destination
</code></pre></td></tr></table>
</div>
</div><p>Multiple exclude modes with multiple <code>--exclude</code> parameters.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --exclude <span class="s1">&#39;file1.txt&#39;</span> --exclude <span class="s1">&#39;dir1/*&#39;</span> source/ destination
</code></pre></td></tr></table>
</div>
</div><p>Multiple exclusion patterns can also take advantage of Bash&rsquo;s large expansion number extension with just one <code>-exclude</code> parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --exclude<span class="o">={</span><span class="s1">&#39;file1.txt&#39;</span>,<span class="s1">&#39;dir1/*&#39;</span><span class="o">}</span> source/ destination
</code></pre></td></tr></table>
</div>
</div><p>If there are many exclusion patterns, you can write them to a file, one line per pattern, and then specify this file with the <code>--exclude-from</code> parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --exclude-from<span class="o">=</span><span class="s1">&#39;exclude-file.txt&#39;</span> source/ destination
</code></pre></td></tr></table>
</div>
</div><h3 id="42-the---include-parameter">4.2 The &ndash;include parameter</h3>
<p>The <code>--include</code> parameter is used to specify the file pattern that must be synchronized, often in combination with <code>--exclude</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av --include<span class="o">=</span><span class="s2">&#34;*.txt&#34;</span> --exclude<span class="o">=</span><span class="s1">&#39;*&#39;</span> source/ destination
</code></pre></td></tr></table>
</div>
</div><p>The above command specifies that when synchronizing, all files are excluded, but TXT files will be included.</p>
<h2 id="5-remote-synchronization">5. Remote synchronization</h2>
<h3 id="51-ssh-protocol">5.1 SSH Protocol</h3>
<p>rsync supports synchronization between two local directories as well as remote synchronization. It can synchronize local content, to a remote server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av source/ username@remote_host:destination
</code></pre></td></tr></table>
</div>
</div><p>It is also possible to synchronize remote content to local.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av username@remote_host:source/ destination
</code></pre></td></tr></table>
</div>
</div><p>rsync uses SSH for remote login and data transfer by default.</p>
<p>Since rsync does not use SSH protocol in the early days, you need to specify the protocol with <code>-e</code> parameter, but it was changed later. So, the following <code>-e ssh</code> can be omitted.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av -e ssh source/ user@remote_host:/destination
</code></pre></td></tr></table>
</div>
</div><p>However, if the ssh command has additional parameters, you must specify the SSH command to be executed with the <code>-e</code> parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av -e <span class="s1">&#39;ssh -p 2234&#39;</span> source/ user@remote_host:/destination
</code></pre></td></tr></table>
</div>
</div><p>In the above command, the <code>-e</code> parameter specifies that SSH uses port 2234.</p>
<h3 id="52-rsync-protocol">5.2 rsync protocol</h3>
<p>In addition to using SSH, if another server has the rsync daemon installed and running, you can also transfer using the <code>rsync://protocol</code> (default port 873). This is written with a double colon separating the server from the target directory<code>::</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av source/ 192.168.122.32::module/destination
</code></pre></td></tr></table>
</div>
</div><p>Note that the <code>module</code> in the above address is not an actual pathname, but a resource name assigned by the <code>rsync</code> daemon and assigned by the administrator.</p>
<p>If you want to know the list of all modules assigned by the rsync daemon, you can execute the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync rsync://192.168.122.32
</code></pre></td></tr></table>
</div>
</div><p>In addition to using a double colon, the rsync protocol also allows you to specify the address directly with <code>rsync:// protocol</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -av source/ rsync://192.168.122.32/module/destination
</code></pre></td></tr></table>
</div>
</div><h2 id="6-incremental-backup">6. Incremental backup</h2>
<p>The most important feature of sync is that it can perform incremental backups, i.e. only files that have changed are copied by default.</p>
<p>In addition to direct comparison between the source and target directories, rsync also supports the use of a base directory, i.e. syncing the changes between the source and base directories to the target directory.</p>
<p>The first sync is a full backup, and all files are synchronized in the base directory. Each subsequent sync is an incremental backup, where only the part of the source directory that has changed from the base directory is synced to a new target directory. This new target directory also contains all files, but in fact, only the files that have changed exist in this directory, the other files that have not changed are hard links to the base directory files.</p>
<p>The <code>-link-dest</code> parameter is used to specify the base directory for synchronization.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ rsync -a --delete --link-dest /compare/path /source/path /target/path
</code></pre></td></tr></table>
</div>
</div><p>In the above command, the <code>--link-dest</code> parameter specifies the base directory <code>/compare/path</code>, then the source directory <code>/source/path</code> is compared with the base directory, the changed files are found and copied to the target directory <code>/target/path</code>, and the unchanged files are generated as hard links. The first backup of this command is a full backup, and all subsequent backups are incremental.</p>
<p>Here is an example script that backs up the user&rsquo;s home directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># A script to perform incremental backups using rsync</span>

<span class="nb">set</span> -o errexit
<span class="nb">set</span> -o nounset
<span class="nb">set</span> -o pipefail

<span class="nb">readonly</span> <span class="nv">SOURCE_DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">&#34;</span>
<span class="nb">readonly</span> <span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&#34;/mnt/data/backups&#34;</span>
<span class="nb">readonly</span> <span class="nv">DATETIME</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>date <span class="s1">&#39;+%Y-%m-%d_%H:%M:%S&#39;</span><span class="k">)</span><span class="s2">&#34;</span>
<span class="nb">readonly</span> <span class="nv">BACKUP_PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DATETIME</span><span class="si">}</span><span class="s2">&#34;</span>
<span class="nb">readonly</span> <span class="nv">LATEST_LINK</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">/latest&#34;</span>

mkdir -p <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">&#34;</span>

rsync -av --delete <span class="se">\
</span><span class="se"></span>  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">SOURCE_DIR</span><span class="si">}</span><span class="s2">/&#34;</span> <span class="se">\
</span><span class="se"></span>  --link-dest <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LATEST_LINK</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span><span class="se"></span>  --exclude<span class="o">=</span><span class="s2">&#34;.cache&#34;</span> <span class="se">\
</span><span class="se"></span>  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BACKUP_PATH</span><span class="si">}</span><span class="s2">&#34;</span>

rm -rf <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LATEST_LINK</span><span class="si">}</span><span class="s2">&#34;</span>
ln -s <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BACKUP_PATH</span><span class="si">}</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LATEST_LINK</span><span class="si">}</span><span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>In the above script, each sync generates a new directory <code>${BACKUP_DIR}/${DATETIME}</code> and points the soft link <code>${BACKUP_DIR}/latest</code> to this directory. The next time you backup, use <code>${BACKUP_DIR}/latest</code> as the base directory to generate a new backup directory. Finally, point the soft link <code>${BACKUP_DIR}/latest</code> to the new backup directory again.</p>
<h2 id="7-configuration-items">7. Configuration items</h2>
<p>The <code>-a</code>, <code>--archive</code> parameters indicate archive mode, which saves all metadata such as modification time, permissions, owner, etc., and the soft links are synchronized over.</p>
<p>The <code>--append</code> parameter specifies that the file continues the transfer where it was last interrupted.</p>
<p>The <code>--append-verify</code> parameter is similar to the <code>--append</code> parameter, but it performs a checksum on the completed file after transfer. If the checksum fails, the entire file will be resent.</p>
<p>The <code>-b</code>, <code>-backup</code> parameters specify that when deleting or updating a file that already exists in the target directory, the file is renamed and then backed up, and the default behavior is to delete. The renaming rule adds the file extension specified by the <code>-suffix</code> parameter, the default is <code>~</code>.</p>
<p>The <code>-backup-dir</code> parameter specifies the directory where the files are stored when backing up, e.g. <code>-backup-dir=/path/to/backups</code>.</p>
<p>The <code>-bwlimit</code> parameter specifies the bandwidth limit, the default unit is <code>KB/s</code>, for example <code>--bwlimit=100</code>.</p>
<p>The <code>-c</code>, <code>--checksum</code> parameter changes the way rsync checksums. By default, rsync only checks if the file size and last modified date have changed, and retransmits if they have; after using this parameter, it decides whether to retransmit by determining the checksum of the file content.</p>
<p>The <code>-delete</code> parameter deletes files that exist only in the target directory and not in the source target, i.e. it ensures that the target directory is a mirror of the source target.</p>
<p>The <code>-e</code> parameter specifies that the SSH protocol is used to transfer data.</p>
<p>The <code>--exclude</code> parameter specifies the exclusion of files that are not synchronized, e.g. <code>--exclude=&quot;*.iso&quot;</code>.</p>
<p>The <code>--exclude-from</code> parameter specifies a local file containing the file patterns to be excluded, one line per pattern.</p>
<p>The <code>-existing</code>, <code>-ignore-non-existing</code> parameters indicate that files and directories that do not exist in the target directory are not synchronized.</p>
<p>The <code>-h</code> parameter indicates output in a human-readable format.</p>
<p>The <code>-h</code>, <code>--help</code> arguments return help information.</p>
<p>The <code>-i</code> parameter indicates the output of details of file differences between the source and target directories.</p>
<p>The <code>--ignore-existing</code> parameter indicates that as long as the file already exists in the target directory, skip it and do not synchronize these files again.</p>
<p>The <code>--include</code> parameter specifies the files to be included when synchronizing, and is usually used in combination with <code>--exclude</code>.</p>
<p>The <code>-link-dest</code> parameter specifies the base directory for incremental backups.</p>
<p>The <code>-m</code> parameter specifies that empty directories are not synchronized.</p>
<p>The <code>-max-size</code> parameter sets the size limit of the maximum file to be transferred, e.g. no more than 200KB (<code>-max-size='200k'</code>).</p>
<p>The <code>-min-size</code> parameter sets the size limit of the smallest file to be transferred, e.g. not less than 10KB (<code>-min-size=10k</code>).</p>
<p>The <code>-n</code> parameter or the <code>-dry-run</code> parameter simulates the operation that will be performed without actually performing it. Used with the <code>-v</code> parameter, you can see what will be synchronized over.</p>
<p>The <code>-P</code> parameter is a combination of the <code>-progress</code> and <code>-partial</code> parameters.</p>
<p>The <code>--partial</code> parameter allows resuming an interrupted transfer. When this parameter is not used, <code>rsync</code> will delete the files interrupted halfway through the transfer; when this parameter is used, the files halfway through the transfer will also be synchronized to the target directory, and the interrupted transfer will be resumed the next time the transfer is synchronized. Usually needs to be used with <code>-append</code> or <code>-append-verify</code>.</p>
<p>The <code>--partial-dir</code> parameter specifies that the files transferred to half are saved to a temporary directory, e.g. <code>--partial-dir=.rsync-partial</code>. Usually needs to be used with <code>--append</code> or <code>--append-verify</code>.</p>
<p>The <code>--progress</code> parameter indicates that progress is displayed.</p>
<p>The <code>-r</code> argument indicates recursion, i.e., the inclusion of subdirectories.</p>
<p>The <code>--remove-source-files</code> parameter indicates that the sender&rsquo;s files are removed after a successful transfer.</p>
<p>The <code>--size-only</code> parameter indicates that only files with changes in size are synchronized, regardless of the difference in file modification time.</p>
<p>The <code>-suffix</code> parameter specifies the suffix to be added to the filename when it is backed up, the default is <code>~</code> .</p>
<p>The <code>-u</code>, <code>-update</code> arguments indicate that files with updated modification times in the target directory are skipped when synchronizing, i.e., those files with updated timestamps are not synchronized.</p>
<p>The <code>-v</code> parameter indicates output details. <code>-vv</code> indicates output of more detailed information, and <code>-vvv</code> indicates output of the most detailed information.</p>
<p>The <code>--version</code> argument returns the version of <code>rsync</code>.</p>
<p>The <code>-z</code> parameter specifies to compress the data when synchronizing.</p>
<h2 id="8-reference-links">8. Reference Links</h2>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories-on-a-vps">How To Use Rsync to Sync Local and Remote Directories on a VPS</a>, Justin Ellingwood</li>
<li><a href="https://www.howtoforge.com/mirroring_with_rsync">Mirror Your Web Site With rsync</a>, Falko Timme</li>
<li><a href="https://linuxconfig.org/examples-on-how-to-use-rsync-for-local-and-remote-data-backups-and-synchonization">Examples on how to use Rsync</a>, Egidio Docile</li>
<li><a href="https://linuxconfig.org/how-to-create-incremental-backups-using-rsync-on-linux">How to create incremental backups using rsync on Linux</a>, Egidio Docile</li>
</ul>
<hr>
<p>Reference <code>http://www.ruanyifeng.com/blog/2020/08/rsync.html</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          <a href="/tags/rsync/">rsync</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-06/using-gomock-for-unit-testing-in-go/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Using Gomock for Unit Testing in Go</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-06/hadoop-and-hive-development-environment-build-on-windows10/">
            <span class="next-text nav-default">Hadoop and Hive Development Environment Build on Windows10</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
