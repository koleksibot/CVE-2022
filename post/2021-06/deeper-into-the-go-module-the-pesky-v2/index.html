<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Deeper Into the Go Module - the Pesky V2 - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="The Go module not only follows the semantic version specification 2.0.0, but also goes a step further by giving deeper meaning to the major in the semantic version.
 X.X: For the case where the major version number (major) is 0, it implies that your current API is still in an unstable state, and the new minor version may not be backward compatible. X.X: the current API is in a stable state, the increase of minor only means the increase of new feature, the API is still backward compatible X." /><meta name="keywords" content="golang,module" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-06/deeper-into-the-go-module-the-pesky-v2/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Deeper Into the Go Module - the Pesky V2" />
<meta property="og:description" content="The Go module not only follows the semantic version specification 2.0.0, but also goes a step further by giving deeper meaning to the major in the semantic version.
 X.X: For the case where the major version number (major) is 0, it implies that your current API is still in an unstable state, and the new minor version may not be backward compatible. X.X: the current API is in a stable state, the increase of minor only means the increase of new feature, the API is still backward compatible X." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-06/deeper-into-the-go-module-the-pesky-v2/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-28T18:51:05+08:00" />
<meta property="article:modified_time" content="2021-06-28T18:51:05+08:00" />

<meta itemprop="name" content="Deeper Into the Go Module - the Pesky V2">
<meta itemprop="description" content="The Go module not only follows the semantic version specification 2.0.0, but also goes a step further by giving deeper meaning to the major in the semantic version.
 X.X: For the case where the major version number (major) is 0, it implies that your current API is still in an unstable state, and the new minor version may not be backward compatible. X.X: the current API is in a stable state, the increase of minor only means the increase of new feature, the API is still backward compatible X."><meta itemprop="datePublished" content="2021-06-28T18:51:05+08:00" />
<meta itemprop="dateModified" content="2021-06-28T18:51:05+08:00" />
<meta itemprop="wordCount" content="982">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Deeper Into the Go Module - the Pesky V2"/>
<meta name="twitter:description" content="The Go module not only follows the semantic version specification 2.0.0, but also goes a step further by giving deeper meaning to the major in the semantic version.
 X.X: For the case where the major version number (major) is 0, it implies that your current API is still in an unstable state, and the new minor version may not be backward compatible. X.X: the current API is in a stable state, the increase of minor only means the increase of new feature, the API is still backward compatible X."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Deeper Into the Go Module - the Pesky V2</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-06-28 18:51:05 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 982 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#the-vx-suffix-contaminates-the-package-path">The vX suffix contaminates the package path</a></li>
        <li><a href="#v0-v1-and-v2-data-types-are-not-compatible">v0, v1 and v2 data types are not compatible</a></li>
        <li><a href="#impose-a-significant-burden-on-third-party-library-developers">Impose a significant burden on third-party library developers</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>The Go module not only follows the <a href="https://semver.org/">semantic version specification 2.0.0</a>, but also goes a step further by giving deeper meaning to the <code>major</code> in the semantic version.</p>
<ul>
<li><code>X.X</code>: For the case where the major version number (<code>major</code>) is <code>0</code>, it implies that your current <code>API</code> is still in an unstable state, and the new minor version may not be backward compatible.</li>
<li><code>X.X</code>: the current <code>API</code> is in a stable state, the increase of <code>minor</code> only means the increase of new <code>feature</code>, the <code>API</code> is still backward compatible</li>
<li>X.X: the addition of <code>major</code> means that the <code>API</code> is no longer backward compatible</li>
</ul>
<blockquote>
<p>Question: Do you know which version numbers in the go module imply that the current API is unstable?</p>
</blockquote>
<p>But what sets <code>go module</code> apart from the rest is that once your <code>major</code> is greater than or equal to <code>2</code>, your <code>module path</code> must be suffixed with <code>v2</code> (if <code>tag</code> is <code>v3.X.X</code>, then it is suffixed with <code>v3</code>, and so on).</p>
<p>Also, add <code>v2</code> to the package reference path, e.g. <code>go.etcd.io/etcd/client/v3</code>.</p>
<p>This is an odd way to write it, equivalent to putting a salve on the normal easy-to-understand <code>module path</code> to indicate which version of the library is being introduced?</p>
<p>Why add this <code>v2</code>, <code>v2</code> suffix, there must be some considerations</p>
<p>Most notably, the developer of Go (in this case Russ Cox) pointed out in the <a href="https://research.swtch.com/vgo-import">import compatibility rule</a>:</p>
<blockquote>
<p>If an old package and a new package have the same import path,
the new package must be backwards compatible with the old package.</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/06/28/e251d94e460b4ebcb5b292ba36c9d4c4.png" alt=" "></p>
<p>This idea is a good one. For example, you can use multiple versions of the same library in your project, with <code>v1</code> versions handling previous legacy logic, <code>v2</code> versions handling new logic, and <code>v3</code> versions experimenting with future versions. Different versions of the same set of libraries can coexist and there is no place for version conflicts.</p>
<p>And when programmers see these <code>module paths</code>, it is clear that the versions are not compatible and who is the newer version.</p>
<p>But this way is also very controversial, in practice also brings a lot of problems, I am in the development of <code>rpcx</code> suffer from it, and <code>etcd</code>, for example, you can see its <code>v3.4.X</code> version, is because there is no <code>v3</code> suffix, resulting in <code>go</code> command to download or import (<code>get</code>) these <code>package</code> when it simply can not be downloaded.</p>
<h2 id="the-vx-suffix-contaminates-the-package-path">The vX suffix contaminates the package path</h2>
<p>Originally, the normal <code>package path</code> is generally the repository path + <code>package name</code>, or <code>go module</code> under <code>module path</code> + <code>package</code>, but once the version is greater than or equal to <code>2</code>, you have to add a suffix <code>v2</code>, <code>v3</code>, etc., the meaning of <code>package path</code> has changed.</p>
<p>Of course, we can tolerate it, the big deal is to close our eyes and use it, but the most painful thing is that many <code>Go</code> beginners do not understand this setting, do not know to import the new library version to add the v2 suffix, a face of confusion.</p>
<h2 id="v0-v1-and-v2-data-types-are-not-compatible">v0, v1 and v2 data types are not compatible</h2>
<p>After adding <code>v2</code>, <code>v3</code> and other suffixes to <code>module path</code>, it is assumed that these <code>package</code> are different <code>package</code>, although most of their data types are not changed, or backward compatible, and cannot be assigned directly, but still need to be strongly transferred.</p>
<p>For example, if your project depends on <code>Auth 1.0.0</code> and also depends on <code>Auth 2.0.0</code>, then even if <code>A.Config</code> doesn&rsquo;t change in both versions, you can&rsquo;t assign <code>Auth.Config</code> to <code>Auth/v2.Config</code>, but you need to add the logic of strong transfer in the code, so that the two are transferred to each other. Once <code>v3</code> is released, it&rsquo;s a long <code>switch</code> branch to deal with this situation, and if <code>v4</code> is released, the logic is even more complicated.</p>
<h2 id="impose-a-significant-burden-on-third-party-library-developers">Impose a significant burden on third-party library developers</h2>
<p>Although you think I also release <code>v2</code>, <code>v3</code>, <code>v4</code> and several other versions, the version route is very clear and not complicated to manage, no big deal.</p>
<p>However, if your library is a very popular library and many developers have developed third-party libraries based on your library, it can be very painful</p>
<p>This means that once you release a new version, these third-party developers have to update their libraries in time to release their new <code>v2</code>, <code>v3</code> versions based on your new version. This is like a virus that initially expands. It&rsquo;s a big burden to the developers.</p>
<p>Of course, it is a matter of opinion, these situations may not be encountered by you, or will not bring you trouble, so it is not a problem. I, on the other hand, was deeply hurt by <code>v2</code> when I was developing <code>rpcx</code> or answering some users' questions, and my little mind couldn&rsquo;t bear the weight of <code>v2</code>.</p>
<p>Some open source projects, in order to avoid the version number jump to <code>v2</code>, using some other methods, such as <code>protobuf-go</code>, is doing a new version of the refactoring, the changes are very large, not compatible with the previous version, can be the previous version are <code>v1.X.X</code>, then how to do? Change the <code>module path</code> name.</p>
<ul>
<li><code>github.com/golang/protobuf</code>: support for the previous <code>protobuf go</code>, currently up to version <code>v1.5.2</code></li>
<li><code>google.golang.org/protobuf</code>: new version of <code>module path</code>, current highest version <code>v1.27.0</code>, initial version <code>v1.20.0</code></li>
</ul>
<p>For my <code>rpcx</code> project, because the version number was released to <code>v6.X.X</code> before the <code>go module</code> came out. I want to go back to the old days, but it seems that I can&rsquo;t go back. So I took an extreme approach and rebuilt <code>tag</code> with all the version numbers defined in <code>v1.X.X</code>. Fortunately, it affected fewer users, so no users complained.</p>
<p>My approach is rather extreme, but the reason I didn&rsquo;t cause users to complain is that I always insist on the coexistence of <code>go module</code> and <code>GOPATH</code>. The vast majority of users use the <code>master</code> branch, or <code>fork</code> a new version themselves, so the impact is minimal.</p>
<hr>
<p>Reference <code>https://colobu.com/2021/06/28/dive-into-go-module-2/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-06/golang-number-of-threads-in-the-running-program/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang - Number of Threads in the Running Program</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-06/some-tips-for-using-json-in-go/">
            <span class="next-text nav-default">Some Tips for Using Json in Go</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
