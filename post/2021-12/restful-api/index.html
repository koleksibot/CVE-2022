<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>RESTful API Design Guide - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="What is RESTful API? REST: The full name is Resource Representational State Transfer, or Representational Layer State Transfer. Look at the concept, I guess no one can understand. Explain in a human word: URL to locate resources, using HTTP verbs (GET, POST, PUT, DELETE) to describe the operation.
Resources
A &amp;ldquo;resource&amp;rdquo; is an entity on the Web, or a specific piece of information on the Web. It can be a piece of text, a picture, a song, a service, in short, a concrete reality." /><meta name="keywords" content="Restful" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-12/restful-api/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="RESTful API Design Guide" />
<meta property="og:description" content="What is RESTful API? REST: The full name is Resource Representational State Transfer, or Representational Layer State Transfer. Look at the concept, I guess no one can understand. Explain in a human word: URL to locate resources, using HTTP verbs (GET, POST, PUT, DELETE) to describe the operation.
Resources
A &ldquo;resource&rdquo; is an entity on the Web, or a specific piece of information on the Web. It can be a piece of text, a picture, a song, a service, in short, a concrete reality." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-12/restful-api/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-12-20T20:32:09+08:00" />
<meta property="article:modified_time" content="2021-12-20T20:32:09+08:00" />

<meta itemprop="name" content="RESTful API Design Guide">
<meta itemprop="description" content="What is RESTful API? REST: The full name is Resource Representational State Transfer, or Representational Layer State Transfer. Look at the concept, I guess no one can understand. Explain in a human word: URL to locate resources, using HTTP verbs (GET, POST, PUT, DELETE) to describe the operation.
Resources
A &ldquo;resource&rdquo; is an entity on the Web, or a specific piece of information on the Web. It can be a piece of text, a picture, a song, a service, in short, a concrete reality."><meta itemprop="datePublished" content="2021-12-20T20:32:09+08:00" />
<meta itemprop="dateModified" content="2021-12-20T20:32:09+08:00" />
<meta itemprop="wordCount" content="5895">
<meta itemprop="keywords" content="restful," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="RESTful API Design Guide"/>
<meta name="twitter:description" content="What is RESTful API? REST: The full name is Resource Representational State Transfer, or Representational Layer State Transfer. Look at the concept, I guess no one can understand. Explain in a human word: URL to locate resources, using HTTP verbs (GET, POST, PUT, DELETE) to describe the operation.
Resources
A &ldquo;resource&rdquo; is an entity on the Web, or a specific piece of information on the Web. It can be a piece of text, a picture, a song, a service, in short, a concrete reality."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">RESTful API Design Guide</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-12-20 20:32:09 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 5895 words </span>
          <span class="more-meta"> 28 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-is-restful-api">What is RESTful API?</a>
          <ul>
            <li><a href="#the-basic-principles-of-rest">The basic principles of REST</a></li>
            <li><a href="#restful-api-maturity-levels">Restful API Maturity Levels</a></li>
          </ul>
        </li>
        <li><a href="#restful-api-design-essentials">RESTful API Design Essentials</a>
          <ul>
            <li><a href="#composition-of-urls">Composition of URLs</a></li>
            <li><a href="#use-a-unified-resource-path">Use a unified resource path</a></li>
            <li><a href="#hypermedia-api">Hypermedia API</a></li>
            <li><a href="#correct-use-of-http-verbs">Correct use of HTTP verbs</a></li>
            <li><a href="#using-http-status-codes">Using HTTP status codes</a></li>
            <li><a href="#result-filtering-sorting-and-searching">Result filtering, sorting and searching</a></li>
            <li><a href="#return-useful-error-hints">Return useful error hints</a></li>
            <li><a href="#use-friendly-json-output">Use friendly JSON output</a></li>
            <li><a href="#rate-limiting">Rate Limiting</a></li>
            <li><a href="#caching">Caching</a></li>
            <li><a href="#authentication">Authentication</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="what-is-restful-api">What is RESTful API?</h2>
<p>REST: The full name is Resource Representational State Transfer, or Representational Layer State Transfer. Look at the concept, I guess no one can understand. Explain in a human word: URL to locate resources, using HTTP verbs (GET, POST, PUT, DELETE) to describe the operation.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/12/20/bef5acb3aeef453faa7f287a8c60d3a4.png" alt="image"></p>
<p><strong>Resources</strong></p>
<p>A &ldquo;resource&rdquo; is an entity on the Web, or a specific piece of information on the Web. It can be a piece of text, a picture, a song, a service, in short, a concrete reality. You can point to it with a URI (Uniform Resource Identifier), each resource corresponds to a specific URI. to get this resource, access its URI on it, so the URI becomes the address or unique identifier of each resource.</p>
<ul>
<li>URI: Uniform Resource Identifier</li>
<li>URL: Uniform Resource Location</li>
</ul>
<p>To &ldquo;surf the web&rdquo; is to interact with a series of &ldquo;resources&rdquo; on the Internet by calling its URI.</p>
<p><strong>Representation</strong></p>
<p>A &ldquo;resource&rdquo; is an information entity that can have multiple external representations. We call the specific presentation of a &ldquo;resource&rdquo; its &ldquo;Representation&rdquo;.</p>
<p>For example, text can be represented in txt format, HTML format, XML format, JSON format, or even binary format; images can be represented in JPG format or PNG format.</p>
<p>URI only represents the entity of the resource, not its form. Strictly speaking, the &ldquo;.html&rdquo; suffix at the end of some URLs is unnecessary because it represents the format and belongs to the &ldquo;presentation layer&rdquo;, while the URI should only represent the &ldquo;resource &quot; location. Its specific presentation should be specified in the HTTP request headers with the Accept and Content-Type fields, which are the description of the &ldquo;presentation layer&rdquo;.</p>
<p><strong>State Transfer</strong></p>
<p>Visiting a website represents a process of interaction between the client and the server. In this process, data and state changes are inevitably involved. The Internet communication protocol, HTTP, is a stateless protocol. This means that all state is stored on the server side. Therefore, if the client wants to operate the server, it must, by some means, allow the server side to undergo a &ldquo;state transfer&rdquo; (State Transfer). This transformation is built on top of the presentation layer, so it is called &ldquo;presentation layer state transfer&rdquo;. The means used by the client can only be the HTTP protocol. Specifically, the HTTP protocol has four verbs that indicate the operation: GET, POST, PUT, DELETE, which correspond to four basic operations.</p>
<ul>
<li>GET is used to obtain resources</li>
<li>POST is used to create new resources (can also be used to update resources)</li>
<li>PUT is used to update resources</li>
<li>DELETE is used to delete resources.</li>
</ul>
<h3 id="the-basic-principles-of-rest">The basic principles of REST</h3>
<ul>
<li>C-S architecture: the storage of data on the Server side, the Client side just use it. The two ends are developed separately, without interfering with each other</li>
<li>Stateless: http request itself is stateless, based on the C-S architecture, each request from the client side with sufficient information to enable the server side to identify. The server is able to return the response to the client correctly based on the various parameters of the request, without saving the client&rsquo;s state.</li>
<li>The REST interface constraint is defined as: the resource you want to operate is marked by uri, the operation to be performed is identified by the request action (http method), and the status code is returned to indicate the result of this request. The result of the request is indicated by the status code returned.</li>
<li>Consistent data format: The server returns data in either XML or Json format, or directly as a status code.</li>
<li>Cacheable: On the World Wide Web, the client can cache the response content of the page. Therefore responses should all be implicitly or explicitly defined as cacheable, or if not cacheable to avoid the client responding with old or dirty data after multiple requests.</li>
<li>On-demand coding, customizable code: REST allows clients to extend client-side functionality by downloading and executing some scripting programs from the server. This simplifies the development of client-side functionality, such as common mobile webviews, web mini-games, etc.</li>
</ul>
<h3 id="restful-api-maturity-levels">Restful API Maturity Levels</h3>
<p>In the <a href="https://martinfowler.com/articles/richardsonMaturityModel.html#level0">Richardson Maturity Model</a> model, RESTful is classified into 4 levels.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/12/20/9796922e2aa44e55bbdcac3f9d88d410.png" alt="image"></p>
<p>The 4 levels are.</p>
<ul>
<li>Web services at Level 1 (Level 0) use only HTTP as a transport and are really just a concrete form of Remote Method Call (RPC). both SOAP and XML-RPC fall into this category.</li>
<li>Level 2 (Level 1) Web services introduce the concept of resources. Each resource has a corresponding identifier and expression.</li>
<li>Level 3 (Level 2) Web services use different HTTP methods to perform different operations and use HTTP status codes to represent different results. For example, HTTP GET method to fetch a resource and HTTP DELETE method to delete a resource.</li>
<li>Level 4 (Level 3) Web services use HATEOAS, which includes link information in the representation of resources. The client can discover the actions that can be performed based on the links.</li>
</ul>
<h2 id="restful-api-design-essentials">RESTful API Design Essentials</h2>
<h3 id="composition-of-urls">Composition of URLs</h3>
<p><strong>Protocol</strong></p>
<p>The API provided to the user, try to use HTTPs protocol. The use of HTTPs protocol or HTTP protocol itself is not related to the RESTful API, but it is important to improve the security of the site</p>
<p><strong>Domains</strong></p>
<p>APIs should be deployed under dedicated domains as much as possible.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">https://api.example.com
</code></pre></td></tr></table>
</div>
</div><p>If it is determined that the API is simple and will not be further extended, consider placing it under the main domain.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">https://example.org/api/
</code></pre></td></tr></table>
</div>
</div><p><strong>Version</strong></p>
<p>The API is really not evolvable, then different versions of the API must be provided. version control allows to release incompatible and significantly changed APIs in new versions without breaking the client.</p>
<p>There are two most popular methods of version control.</p>
<ul>
<li>Versioning via URLs</li>
<li>Versioning via Accept HTTP Header (content negotiation)</li>
</ul>
<p>Versioning via URLs</p>
<p>Simply place the version number of the API in the URL of each resource. There is no need to use a secondary version number (&ldquo;v1.2&rdquo;) because you should not have to release API versions too often.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">/v1/epics
</code></pre></td></tr></table>
</div>
</div><p>Pros.</p>
<ul>
<li>Very simple for API developers.</li>
<li>Also very simple for client-side access.</li>
<li>URLs can be copied and pasted.</li>
</ul>
<p>Disadvantages.</p>
<ul>
<li>Not RESTful. (This approach causes URLs to change)</li>
<li>Breaks URLs. Clients must maintain and update URLs.</li>
</ul>
<p>Due to its simplicity, this approach is widely used by major vendors such as Facebook, Twitter, Google/YouTube, Bing, Dropbox, Tumblr, and Disqus.</p>
<p>Version control (content negotiation) via Accept HTTP Header</p>
<p>A more RESTFul approach is to use content negotiation via the Accept HTTP request header.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /epics
Accept: application/vnd.myapi.v2+json
</code></pre></td></tr></table>
</div>
</div><p>Pros.</p>
<ul>
<li>URLs remain the same</li>
<li>RESTFul approach</li>
<li>HATEOAS friendly</li>
</ul>
<p>Disadvantages.</p>
<ul>
<li>Slightly difficult to use. Customers must pay attention to the title.</li>
<li>Can no longer copy and paste URLs.</li>
</ul>
<p>Github uses this approach.</p>
<p>Keep in mind that the API is a public contract between the server and the client. If you make a change to the API on the server and those changes are not backwards compatible, then you break that contract and the client will ask you to support it again. To avoid such a thing, you have to both ensure that the application evolves gradually and keep the client happy. Then you must introduce a new version of the API while keeping the old one still available.</p>
<p>If you are simply adding a new feature to the API, such as a new property on a resource or adding a new endpoint, you don&rsquo;t need to increase the version of the API. Because these don&rsquo;t cause backward compatibility issues, you just need to change the documentation. Over time, you may declare that some older versions of the API are no longer supported. declaring that a feature is not supported does not mean turning it off or breaking it. Rather, it tells the client that the old version of the API will be removed at a specific time and suggests that they use the new version of the API.</p>
<p>As systems evolve, there will always be APIs that fail or migrate, returning 404 not found or 410 gone for failed APIs and 301 redirects for migrated APIs.</p>
<p><strong>Path (Endpoint)</strong></p>
<p>The path, also known as the &ldquo;endpoint&rdquo;, represents the specific URL of the API.</p>
<p>In the RESTful architecture, each URL represents a resource, so there can be no verbs in the URL, only nouns, and the nouns used often correspond to the names of tables in the database. Generally speaking, tables in a database are &ldquo;collections&rdquo; of the same kind of records, so the nouns in the API should also use the plural.</p>
<p>For example, an API that provides information about the zoo, including various animals and employees, would have a path like the following.</p>
<ul>
<li><code>https://api.example.com/v1/zoos</code></li>
<li><code>https://api.example.com/v1/animals</code></li>
<li><code>https://api.example.com/v1/employees</code></li>
</ul>
<p>Reduce path nesting</p>
<p>In some resource data modules with nested parent/child paths, the paths may have very deep nesting relationships, for example:</p>
<ul>
<li>/orgs/{org_id}/apps/{app_id}/dynos/{dyno_id}</li>
</ul>
<p>It is recommended to specify resources under the root path to limit the nesting depth of the path. Use nesting to specify the scope of the resource, for example in the following case, under the dyno attribute app scope and under the app attribute org scope:</p>
<ul>
<li>/orgs/{org_id}</li>
<li>/orgs/{org_id}/apps</li>
<li>/apps/{app_id}</li>
<li>/apps/{app_id}/dynos</li>
<li>/dynos/{dyno_id}</li>
</ul>
<p>Overly deep navigation tends to lead to url bloat that is not easily maintained, e.g. GET /zoos/1/areas/3/animals/4, or you can use query parameters instead of entity navigation in the path, e.g. GET /animals?zoo=1&amp;area=3.</p>
<p><strong>URI specification</strong></p>
<ul>
<li>No capitalization</li>
<li>Use middle bar-no lower bar_</li>
<li>The parameter list should be encoded</li>
</ul>
<h3 id="use-a-unified-resource-path">Use a unified resource path</h3>
<p><strong>Use two URLs per resource</strong></p>
<p>Use one URL for a collection of resources and one URL for a specific resource.</p>
<ul>
<li>/employees #URL of the resource collection</li>
<li>/employees/56 # URL of a specific resource</li>
</ul>
<p><strong>Replaces verbs with nouns for resources</strong></p>
<p>This gives you a cleaner API and a smaller number of URLs. Don&rsquo;t design it like this.</p>
<ul>
<li>/getAllEmployees</li>
<li>/getAllExternalEmployees</li>
<li>/createEmployee</li>
<li>/updateEmployee</li>
</ul>
<p>Better design.</p>
<ul>
<li>GET /employees</li>
<li>GET /employees?state=external</li>
<li>POST /employees</li>
<li>PUT /employees/56</li>
</ul>
<p><strong>Recommended plural nouns</strong></p>
<p>The noun used often corresponds to the table name of the database, which is a collection of records, so the noun in the URL means a collection of resources, so the noun in the URI should be in the plural</p>
<p>Recommended.</p>
<ul>
<li>/employees</li>
<li>/employees/21</li>
</ul>
<p>Not recommended.</p>
<ul>
<li>/employee</li>
<li>/employee/21</li>
</ul>
<p>In fact, it is a matter of personal preference, but the plural form is more common. Also, use the GET method on the resource collection URL, it is more intuitive, especially GET /employees?state=external, POST /employees, PUT /employees/56. But most importantly: avoid mixing plural and singular nouns, which seems very confusing and error-prone.</p>
<p><strong>Non-resource request with verb</strong></p>
<p>Sometimes API calls do not involve resources (e.g., computation, translation, or conversion). Example.</p>
<ul>
<li>GET /translate?from=de_DE&amp;to=en_US&amp;text=Hallo</li>
<li>GET /calculate?para2=23&amp;para2=432</li>
</ul>
<p>In this case, the API response does not return any resources. Instead, it performs an action and returns the result to the client. Therefore, you should use verbs rather than nouns in the URL to clearly distinguish between resource requests and non-resource requests.</p>
<p><strong>Asynchronous tasks</strong></p>
<p>For time-consuming asynchronous tasks, the server side should return a successfully created task resource containing the execution status of the task after accepting the parameters passed by the client. The client can rotate the task to get the latest execution progress.</p>
<p>Submitting tasks.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">POST /batch-publish-msg
[{&#34;from&#34;:0,&#34;to&#34;:1,&#34;text&#34;:&#34;abc&#34;},{},{}...]
</code></pre></td></tr></table>
</div>
</div><p>Response:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">{&#34;taskId&#34;:3,&#34;createBy&#34;:&#34;Anonymous&#34;,&#34;status&#34;:&#34;running&#34;}
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /task/3

{&#34;taskId&#34;:3,&#34;createBy&#34;:&#34;Anonymous&#34;,&#34;status&#34;:&#34;success&#34;}
</code></pre></td></tr></table>
</div>
</div><p>If the execution status of a task includes more information, you can abstract the &ldquo;execution status&rdquo; into a combined resource, and the client can query the status resource to know the execution status of the task.</p>
<p>Submitting a task.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">POST /batch-publish-msg
[{&#34;from&#34;:0,&#34;to&#34;:1,&#34;text&#34;:&#34;abc&#34;},{},{}...]
</code></pre></td></tr></table>
</div>
</div><p>response</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">{&#34;taskId&#34;:3,&#34;createBy&#34;:&#34;Anonymous&#34;}
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /task/3/status

{&#34;progress&#34;:&#34;50%&#34;,&#34;total&#34;:18,&#34;success&#34;:8,&#34;fail&#34;:1}
</code></pre></td></tr></table>
</div>
</div><h3 id="hypermedia-api">Hypermedia API</h3>
<p>RESTful APIs should ideally be Hypermedia, i.e. provide links to other API methods in the returned results, so that the user knows what to do next without checking the documentation.</p>
<p>For example, when a user makes a request to the root of api.example.com, they will get a document like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;link&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;rel&#34;</span><span class="p">:</span> <span class="s2">&#34;collection https://www.example.com/zoos&#34;</span><span class="p">,</span>
        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.example.com/zoos&#34;</span><span class="p">,</span>
        <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;List of zoos&#34;</span><span class="p">,</span>
        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;application/vnd.yourformat+json&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above code indicates that there is a link attribute in the document, which the user reads to know what API to call next. rel indicates the relationship between this API and the current URL (collection relationship, and gives the URL of the collection), href indicates the path of the API, title indicates the title of the API, and type indicates the return type.</p>
<p>The design of the Hypermedia API is called <a href="https://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a>. The Github API is of this design, and visiting api.github.com will give you a list of all available API URLs.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;current_user_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.github.com/user&#34;</span><span class="p">,</span>
    <span class="nt">&#34;authorizations_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.github.com/authorizations&#34;</span><span class="p">,</span>
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see from above, if you want to get information about the current user, you should go to <code>api.github.com/user</code> and then you get the following result.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Requires authentication&#34;</span><span class="p">,</span>
    <span class="nt">&#34;documentation_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://developer.github.com/v3&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The above code indicates that the server gives the prompt message, as well as the URL of the document.</p>
<h3 id="correct-use-of-http-verbs">Correct use of HTTP verbs</h3>
<p>The specific type of operation for a resource is indicated by an HTTP verb.</p>
<p>The following five HTTP verbs are commonly used (the corresponding SQL commands are in parentheses)</p>
<ul>
<li>GET (SELECT): Retrieves a resource (one or more) from the server.</li>
<li>POST (CREATE): Creates a new resource on the server.</li>
<li>PUT (UPDATE): Update a resource at the server (the client provides the complete resource after the change).</li>
<li>PATCH (UPDATE): Update a resource at the server (the client provides the changed attributes).</li>
<li>DELETE (DELETE): Deletes a resource from the server.</li>
</ul>
<p>There are also two less commonly used HTTP verbs.</p>
<ul>
<li>HEAD: Gets the metadata of the resource.</li>
<li>OPTIONS: Gets information about which properties of the resource can be changed by the client.</li>
</ul>
<p>Here are some examples.</p>
<ul>
<li>GET /zoos: list all zoos</li>
<li>POST /zoos: create a new zoo</li>
<li>GET /zoos/ID: Get information about a specific zoo</li>
<li>PUT /zoos/ID: update the information of a specified zoo (provide all the information of that zoo)</li>
<li>PATCH /zoos/ID: update the information of a specified zoo (provides partial information of the zoo)</li>
<li>DELETE /zoos/ID: Deletes a zoo</li>
<li>GET /zoos/ID/animals: lists all animals in a given zoo</li>
<li>DELETE /zoos/ID/animals/ID: Deletes a specified animal from a specified zoo</li>
</ul>
<p>2 URLs multiplied by 4 HTTP methods is a great set of functions. Take a look at this table.</p>
<table>
<thead>
<tr>
<th></th>
<th>POST (create)</th>
<th>GET (read)</th>
<th>PUT (update)</th>
<th>DELETE (delete)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>/employees</td>
<td>Create a new employee</td>
<td>List all employees</td>
<td>Batch update employee information</td>
<td>Delete all employees</td>
<td></td>
</tr>
<tr>
<td>/employees/56</td>
<td>(Error)</td>
<td>Get information about employee #56</td>
<td>Update employee #56</td>
<td>Delete employee #56</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>The difference between POST and GET</strong></p>
<p>There is usually confusion between POST and GET when it comes to web development, the main reason for the confusion is that basically any problem that POST can solve GET can solve, and vice versa.</p>
<p>GET: literally means to get resources</p>
<ul>
<li>GET requests are idempotent by standard (the user should think that the request is safe - the resource will not be modified, so here it should be said that the server side does not guarantee that the resource will not be modified)</li>
<li>GET requests can be cached by the browser; responses can also be cached (based on cache headers)</li>
<li>GET requests can be saved in the browser history and can be distributed or shared as links, and can be bookmarked</li>
<li>The data of the GET request is in the URL, so it can be easily retrieved from the browser (so it cannot carry plaintext data such as passwords)</li>
<li>The length of the GET request is limited (for example, the total path length for IE must be less than 2048 characters)</li>
<li>The data of GET requests can only contain ASCII characters</li>
</ul>
<p>POST: literally means posting a new resource</p>
<ul>
<li>POST requests are not idempotent by standard (users should consider the request as having side effects - may result in resource modification)</li>
<li>POST request URLs can be cached by the browser, but POST data is not cached; responses can be cached (based on cache headers)</li>
<li>POST requests are not easy to distribute or share, as POST data is lost and cannot be bookmarked.</li>
<li>POST requests are not limited in length and can be used for scenarios where the &ldquo;requested data&rdquo; is large (as long as it does not exceed the server-side processing capacity)</li>
<li>POST request data is not limited to ASCII characters and can contain binary data</li>
</ul>
<p>The above explanation of the difference between the two may not be very well understood, idempotent (idempotent, idempotence) is actually a mathematical or computer science concept, commonly found in abstract algebra. Idempotency is expressed concretely as follows</p>
<ul>
<li>For monomial operations, an operation is said to be idempotent if the result of performing it multiple times for all the numbers in the range is the same as the result of performing it once. An example of this is the absolute value operation, where in the set of real numbers there is abs(a) = abs(abs(a)).</li>
<li>For binomial operations, it is required that when the two values involved in the operation are equal, the operation is said to be idempotent if it satisfies the result of the operation is equal to the two values involved, such as the function to find the maximum of two numbers, i.e. max(x,x) = x.</li>
</ul>
<p>In layman&rsquo;s terms idempotent means that multiple requests for the same URL should return the same result. But it is not really very strict, for example, the front page of a news site is constantly updated. Although a second request will return a different batch of news, the operation is still considered and idempotent, since it always returns the current news. Essentially, if the goal is that when a user opens a link, he can be sure that no resources have changed from his point of view.</p>
<p>Early Web MVC framework designers did not consciously view and design URLs as abstract resources, so it led to a more serious problem that traditional Web MVC frameworks basically support only two HTTP methods, GET and POST, and do not support PUT and DELETE methods.</p>
<p><strong>Allows overriding HTTP methods</strong></p>
<p>Some proxies only support POST and GET methods, in order to use these limited methods to support the RESTful API, a way to override the original methods of http is needed.</p>
<p>Use the custom HTTP header X-HTTP-Method-Override to override the POST method.</p>
<h3 id="using-http-status-codes">Using HTTP status codes</h3>
<p>The RESTful Web Service shall use the appropriate <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP status code</a> to respond to the client&rsquo;s request.</p>
<ul>
<li>2xx - Success - Everything is fine.</li>
<li>4xx - Client Error - If there is a failure of the client (e.g., the client sent an invalid request or was unauthorized)</li>
<li>5xx - Server error - fault on the server side (error while trying to process the request, e.g. database failure, dependent service unavailable, coding error or status that should not happen)</li>
</ul>
<p>Note that Http status codes provide more than 70 status codes, and using all too many HTTP status codes may be confusing for API users. So you should keep using a streamlined set of HTTP status codes. Commonly used status codes are as follows.</p>
<ul>
<li>2xx: Success, operation was successfully received and processed
<ul>
<li>200: The request was successful. Generally used for GET and POST requests</li>
<li>201: Created. The request was successful and a new resource was created</li>
</ul>
</li>
<li>3xx: Redirected, further actions are required to complete the request
<ul>
<li>301: Permanently moved. The requested resource has been permanently moved to the new URI, the return message will include the new URI, and the browser will automatically redirect to the new URI. any future new requests should use the new URI instead</li>
<li>304: unmodified. The requested resource is unmodified and no resources will be returned when the server returns this status code. Clients typically cache accessed resources by providing a header indicating that the client expects only resources modified after the specified date to be returned</li>
</ul>
</li>
<li>4xx: client error, the request contains a syntax error or the request could not be completed
<ul>
<li>400: Client request has a syntax error that the server cannot understand</li>
<li>401: The request requires the user&rsquo;s identity</li>
<li>403: The server understood the request from the requesting client, but refused to execute the request</li>
<li>404: The server was unable to find the resource (web page) based on the client&rsquo;s request. With this code, the web designer can set a personalized page with &ldquo;The resource you requested could not be found&rdquo;.</li>
<li>410: The resource requested by the client no longer exists. 410 is different from 404, if the resource was there before and is now permanently deleted, use the code 410, the site designer can specify the new location of the resource with the code 301</li>
</ul>
</li>
<li>5xx: server error, an error occurred while the server was processing the request
<ul>
<li>500: internal server error, the request could not be completed</li>
</ul>
</li>
</ul>
<p>Do not overuse 404. be as precise as possible in your use of status codes. If the resource is available but access is forbidden to the user, return 403. if the resource used to exist but has been removed or deactivated, use 410.</p>
<h3 id="result-filtering-sorting-and-searching">Result filtering, sorting and searching</h3>
<p>It is best to keep basic resource URLs as simple as possible. Complex result filters, sorting requirements, and advanced searches (when limited to a single type of resource) can be easily implemented as query parameters on top of the base URL.</p>
<p><strong>Filtering Filters</strong></p>
<p>Filtering using a unique query parameter.</p>
<ul>
<li>GET /cars?color=red Returns red cars</li>
<li>GET /cars?sees&lt;=2 Returns the set of cars with less than two seats</li>
</ul>
<p>Alternatively, the JSON API can be used to filter.</p>
<ul>
<li>GET /employees?filter[state]=internal&amp;filter[title]=senior</li>
<li>GET /employees?filter[id]=1,2</li>
</ul>
<p><strong>Sorting sorting</strong></p>
<p>Allow sorting against multiple fields</p>
<ul>
<li>GET /cars?sort=-manufactorer,+model</li>
</ul>
<p>This returns a collection of cars sorted in descending order by producer and ascending order by model</p>
<p><strong>Paging pagination</strong></p>
<p>The two popular paging methods are.</p>
<ul>
<li>Offset-based paging</li>
<li>Keyset-based paging, also known as continuation tokens, also known as cursors (recommended)</li>
</ul>
<p>Offset-based paging</p>
<p>The general approach to paging is to use the parameters offset and limit to.</p>
<ul>
<li>/epics?offset=30&amp;limit=15 # Return epics from 30 to 45</li>
</ul>
<p>If the parameters are not filled in, the default values (offset=0, limit=100) can be used.</p>
<ul>
<li>/epics # Returns epics from 0 to 100</li>
</ul>
<p>It is also possible to provide links to the previous and next pages in the response data.</p>
<p>Request.</p>
<ul>
<li>/epics?offset=30&amp;limit=15 # Returns epics from 30 to 45</li>
</ul>
<p>Response.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;pagination&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nt">&#34;limit&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="nt">&#34;total&#34;</span><span class="p">:</span> <span class="mi">3465</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">//...
</span><span class="c1"></span>    <span class="p">],</span>
    <span class="nt">&#34;links&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;next&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.domain.com/epics?offset=30&amp;limit=10&#34;</span><span class="p">,</span>
        <span class="nt">&#34;prev&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.domain.com/epics?offset=10&amp;limit=10&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In order to send the total to the client, use the customized HTTP header: X-Total-Count.</p>
<p>The link to the next or previous page can be set in the Link setting of the HTTP header, following the Link setting:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Link: &lt;https://blog.mwaysolutions.com/sample/api/v1/cars?offset=15&amp;limit=5&gt;; rel=&#34;next&#34;,&lt;https://blog.mwaysolutions.com/sample/api/v1/cars?offset=50&amp;limit=3&gt;; rel=&#34;last&#34;,&lt;https://blog.mwaysolutions.com/sample/api/v1/cars?offset=0&amp;limit=5&gt;; rel=&#34;first&#34;,&lt;https://blog.mwaysolutions.com/sample/api/v1/cars?offset=5&amp;limit=5&gt;; rel=&#34;prev&#34;,
</code></pre></td></tr></table>
</div>
</div><p>Offset-based paging is simple to implement, but has two drawbacks.</p>
<ul>
<li>Slow query. SQL offset clause execution can be slow when there is a large amount of data.</li>
<li>Insecure. Changes during paging.</li>
</ul>
<p>Key set based paging, also known as continue tokens, also known as cursors (recommended)</p>
<p>Simply put, paging is done using an index column. Suppose epic has an index column data_created, we can use data_created for paging.</p>
<ul>
<li>GET /epics?pageSize=100 # The client accepts the top 100 epic messages, sorted using the data_created field</li>
<li>GET /epics?pageSize=100&amp;createdSince=1504224000000 # The dataCreated` field value of the oldest epic for this paging is 1504224000000 (= Sep 1, 2017 12:00:00 AM), and the client requests 100 epics data after 1504224000000.</li>
</ul>
<p>The top epic of this paging was created on 1506816000000. this paging approach solves many of the drawbacks of offset-based paging, but is less convenient for the caller.</p>
<p>A better way to improve reliability and efficiency is to create a so-called continuation token by adding additional information (such as id) to the date. In addition, dedicated fields should be provided to the payload of this token so that the client does not have to look through the elements to figure it out. Even further, a link to the next page can be provided.</p>
<p>So a GET /epics?pageSize=100 request would return the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;pagination&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;continuationToken&#34;</span><span class="p">:</span> <span class="s2">&#34;1504224000000_10&#34;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// ...
</span><span class="c1"></span>        <span class="c1">// last element:
</span><span class="c1"></span>        <span class="p">{</span>
            <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nt">&#34;dateCreated&#34;</span><span class="p">:</span> <span class="mi">1504224000000</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&#34;links&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;next&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.domain.com/epics?pageSize=100&amp;continue=1504224000000_10&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Next page links make the API truly RESTful style, as clients can view collections simply by following these links (HATEOAS). In addition, the server side can simply change the URL structure without breaking the client, ensuring the evolution of the interface.</p>
<p><strong>Field selection</strong></p>
<p>Mobile is able to display some of these fields, and they don&rsquo;t actually need all the fields of a resource, giving API consumers the ability to select fields, which will reduce network traffic and improve API availability.</p>
<ul>
<li>GET /cars?fields=manufacturer,model,id,color</li>
</ul>
<p><strong>Search Search</strong></p>
<p>Sometimes basic filtering doesn&rsquo;t cut it, and that&rsquo;s when you need the power of full-text search. Perhaps you are already using <a href="http://www.elasticsearch.org/">ElasticSearch</a> or other search technologies based on <a href="http://lucene.apache.org/">Lucene</a>. When full-text search is used as a mechanism to obtain a resource instance of a particular resource, it can be exposed in the API as a query parameter to the resource endpoint, which we call &ldquo;q&rdquo;. Search-type queries should be given directly to the search engine, and the output of the API should have the same format, with a common list as the result.</p>
<p>Putting these together, we can create some of the following queries:</p>
<ul>
<li>GET /tickets?sort=-updated_at - get the most recently updated tickets</li>
<li>GET /tickets?state=closed&amp;sort=-updated_at - Get tickets that were recently updated and have a status of closed.</li>
<li>GET /tickets?q=return&amp;state=open&amp;sort=-priority,created_at - Get tickets with the highest priority, created first, with the status open, and with the &lsquo;return&rsquo; character.</li>
</ul>
<p><strong>Bookmarker shortcuts</strong></p>
<ul>
<li>Frequently used, complex queries are labeled to reduce maintenance costs.</li>
<li>e.g. GET /trades?status=closed&amp;sort=created,desc</li>
<li>Shortcut: GET /trades#recently-closed</li>
<li>Or: GET /trades/recently-closed</li>
</ul>
<h3 id="return-useful-error-hints">Return useful error hints</h3>
<p>In addition to the appropriate status codes, useful error hints and detailed descriptions should be provided in the body of the HTTP response. Here is an example. Request.</p>
<ul>
<li>GET /employees?state=super</li>
</ul>
<p>Response.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="c1">// 400 Bad Request 
</span><span class="c1"></span><span class="p">{</span>
    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;You submitted an invalid state. Valid state values are &#39;internal&#39; or &#39;external&#39;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;errorCode&#34;</span><span class="p">:</span> <span class="mi">352</span><span class="p">,</span>
    <span class="nt">&#34;additionalInformation&#34;</span><span class="p">:</span><span class="s2">&#34;http://www.domain.com/rest/errorcode/352&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Error validation for PUT, PATCH and POST requests will require a field decomposition. The following is probably the best pattern: use a fixed top-level error code to validate the error and provide detailed error information in additional fields, like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>

    <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Validation Failed&#34;</span><span class="p">,</span>
    <span class="nt">&#34;errors&#34;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span>
            <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;first_name&#34;</span><span class="p">,</span>
            <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;First name cannot have fancy characters&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">5622</span><span class="p">,</span>
            <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;password&#34;</span><span class="p">,</span>
            <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Password cannot be blank&#34;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="use-friendly-json-output">Use friendly JSON output</h3>
<p>JSON is better visualized and more traffic efficient than XML, so try not to use XML.</p>
<p><strong>JSON-P</strong></p>
<p>If there is a parameter callback in any GET request with a non-empty string value, then the interface will return data in the following format</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ curl http://api.example.com/#<span class="o">{</span>RESOURCE_URI<span class="o">}</span>?callback<span class="o">=</span>foo

foo<span class="o">({</span>
    <span class="s2">&#34;meta&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;status&#34;</span>: 200,
        <span class="s2">&#34;X-Total-Count&#34;</span>: 542,
        <span class="s2">&#34;Link&#34;</span>: <span class="o">[{</span>
                <span class="s2">&#34;href&#34;</span>: <span class="s2">&#34;http://api.example.com/#{RESOURCE_URI}?cursor=0&amp;count=100&#34;</span>,
                <span class="s2">&#34;rel&#34;</span>: <span class="s2">&#34;first&#34;</span>
            <span class="o">}</span>,
            <span class="o">{</span>
                <span class="s2">&#34;href&#34;</span>: <span class="s2">&#34;http://api.example.com/#{RESOURCE_URI}?cursor=90&amp;count=100&#34;</span>,
                <span class="s2">&#34;rel&#34;</span>: <span class="s2">&#34;prev&#34;</span>
            <span class="o">}</span>,
            <span class="o">{</span>
                <span class="s2">&#34;href&#34;</span>: <span class="s2">&#34;http://api.example.com/#{RESOURCE_URI}?cursor=120&amp;count=100&#34;</span>,
                <span class="s2">&#34;rel&#34;</span>: <span class="s2">&#34;next&#34;</span>
            <span class="o">}</span>,
            <span class="o">{</span>
                <span class="s2">&#34;href&#34;</span>: <span class="s2">&#34;http://api.example.com/#{RESOURCE_URI}?cursor=200&amp;count=100&#34;</span>,
                <span class="s2">&#34;rel&#34;</span>: <span class="s2">&#34;last&#34;</span>
            <span class="o">}</span>
        <span class="o">]</span>
    <span class="o">}</span>,
    <span class="s2">&#34;data&#34;</span>: // data
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Use small-hump nomenclature</strong></p>
<p>Use the small-hump nomenclature as an attribute identifier.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">{</span> <span class="s2">&#34;yearOfBirth&#34;</span>: <span class="m">1982</span>  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Do not use underscores (year_of_birth) or big-hump nomenclature (YearOfBirth). Typically, RESTful web services will be used by clients written in JavaScript. The client will convert the JSON response to a JavaScript object (by calling var person = JSON.parse(response)) and then call its properties. Therefore, it is best to follow the JavaScript code common specification.</p>
<p>For comparison.</p>
<ul>
<li>year_of_birth // not recommended, violates the JavaScript code general specification</li>
<li>yearOfBirth // Not recommended, JavaScript constructor naming</li>
<li>yearOfBirth // Recommended</li>
</ul>
<p><strong>Null fields</strong></p>
<p>The interface follows the &ldquo;input is tolerant, output is strict&rdquo; principle, the value of the null field in the output data structure is always null</p>
<p><strong>Ensures nice printing and gzip support by default</strong></p>
<p>An API that provides whitespace-compressed output is not aesthetically pleasing to view from a browser. While some ordered query parameters (such as ?pretty=true) can be provided to enable pretty printing, an API that does pretty printing by default is more approachable. The cost of additional data transfer is negligible, especially when you compare the cost of not performing gzip compression.</p>
<p>Consider some use cases: Suppose analyzing an API consumer is debugging and has their own code to print out the data received from the API - this should be readable by default. Or, if the consumer grabs the URL generated by their code and accesses it directly from a browser - by default this should be readable. These are the little things. Doing the little things right will make an API more enjoyable to use!</p>
<p>Let&rsquo;s look at a practical example. I&rsquo;ve pulled some data from the GitHub API, and by default this data uses pretty print. I&rsquo;ll also do some GZIP compression for comparison.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ curl https://api.github.com/users/veesahni &gt; with-whitespace.txt
$ ruby -r json -e <span class="s1">&#39;puts JSON JSON.parse(STDIN.read)&#39;</span> &lt; with-whitespace.txt &gt; without-whitespace.txt
$ gzip -c with-whitespace.txt &gt; with-whitespace.txt.gz
$ gzip -c without-whitespace.txt ? without-whitespace.txt.gz
</code></pre></td></tr></table>
</div>
</div><p>The size of the output file is as follows.</p>
<ul>
<li>without-whitespace.txt - 1252 bytes</li>
<li>with-whitespace.txt - 1369 bytes</li>
<li>without-whitespace.txt.gz - 496 bytes</li>
<li>with-whitespace.txt.gz - 509 bytes</li>
</ul>
<p>In this example, spaces increase the extra output size by 8.5% when GZIP compression is not enabled, compared to 2.6% when GZIP compression is enabled. On the other hand, GZIP compression saves 60% of the bandwidth. Since the cost of pretty printing is relatively small, it is best to use pretty printing by default and make sure that GZIP compression is supported.</p>
<h3 id="rate-limiting">Rate Limiting</h3>
<p>To prevent abuse, it is standard practice to add some type of rate limit to the API. An HTTP status code <a href="http://tools.ietf.org/html/rfc6585#section-4">429 too many requests</a> is introduced in <a href="http://tools.ietf.org/html/rfc6585">RFC 6585</a> to do this. You can use the <a href="http://en.wikipedia.org/wiki/Token_bucket">token bucket algorithm</a> technique to quantify the request limit.</p>
<p>In any case, it is useful to inform users of the existence of a limit before they are actually subject to it. This is an area where standards are still lacking, but there are already some popular and common ways of using HTTP response headers.</p>
<p>At a minimum, the following headers are included (using Twitter&rsquo;s <a href="https://dev.twitter.com/docs/rate-limiting/1.1">naming convention</a> for headers, usually without capitalization of the middle word):</p>
<ul>
<li>X-Rate-Limit-Limit - the number of requests allowed in the current period</li>
<li>X-Rate-Limit-Remaining - the number of requests remaining for the current period</li>
<li>X-Rate-Limit-Ret - the number of seconds remaining in the current period</li>
</ul>
<p><strong>Why don&rsquo;t you use timestamps instead of seconds for X-Rate-Limit-Ret?</strong></p>
<p>A timestamp contains a variety of information, such as date and time zone, but they are not required. An API user really just wants to know when a request can be initiated again, and for them a second number answers that question with minimal extra processing. It also circumvents the problem of <a href="http://en.wikipedia.org/wiki/Clock_skew">clock deviation</a>.</p>
<p>Some APIs give X-Rate-Limit-Reset using UNIX timestamps (number of seconds since epoch). Don&rsquo;t do this!</p>
<p><strong>Why is it bad practice to use UNIX timestamps for X-Rate-Limit-Reset?</strong></p>
<p>The <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.txt">HTTP specification</a> already <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.3">specifies</a> to use <a href="http://www.ietf.org/rfc/rfc1123.txt">RFC 1123 date format</a> (currently used in <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.18">date</a>, <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.25">If -Modified-Since</a> &amp; <a href="http://www.w3.org/Protocols/">Last-Modified</a> rfc2616/rfc2616-sec14.html#sec14.29) in the HTTP header information). If we intend to specify a new HTTP header that uses some form of timestamp, we should follow RFC 1123 and not use UNIX timestamps.</p>
<h3 id="caching">Caching</h3>
<p>HTTP provides a built-in set of caching frameworks! All you have to do is include some additional outbound response headers and do a little bit of checksum work when you receive some inbound request headers.</p>
<p>There are two ways to do this: <a href="http://en.wikipedia.org/wiki/HTTP_ETag">ETag</a> and [Last-Modified](<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#</a> sec14.29)</p>
<ul>
<li><strong>ETag</strong>: When a request is generated, it contains an HTTP header in which the ETag is placed with a hash or checksum value corresponding to the content of the expression. This value should change as the content of the expression changes. Now, if an inbound HTTP request contains an If-None-Match header and a matching ETag value, the API should return a 304 unmodified status code instead of the requested resource.</li>
<li><strong>Last-Modified</strong>: basically works like an ETag, except that it uses a timestamp. In the response header, Last-Modified contains a timestamp in <a href="http://www.ietf.org/rfc/rfc1123.txt">RFC 1123</a> format, which uses If-Modified-Since for validation. Note that the HTTP specification already has <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.3">3 different acceptable date formats</a> and the server should be ready to receive any of them.</li>
</ul>
<p><strong>Track each request with an id</strong></p>
<p>Include a Request-Id header in every API response, usually with a unique identifier UUID. It is helpful to debug and track our network requests if both the server and the client print out their Request-Id.</p>
<h3 id="authentication">Authentication</h3>
<p>A RESTful API should be stateless. This means that authentication requests should not rely on cookies or sessions; instead, each request should carry some type of authentication credentials.</p>
<p>Since SSL is always used, authentication credentials can be reduced to a randomly generated access token passed in with a user name field using HTTP Basic Auth. The great advantage of this is that it is fully browser detectable - if the browser receives a 401 unauthorized status code from the server, it only needs a popup box to request the credentials.</p>
<p>However, this authentication method, based on a basic authentication token, is only available when the following scenario is met, i.e., the user can copy the token from an administrative interface to an API user environment. When this is not possible, OAuth 2 should be used to generate security tokens and pass them to third parties. OAuth 2 uses <a href="http://tools.ietf.org/html/rfc6750">Bearer tokens</a> and relies on SSL for the underlying transport encryption.</p>
<p>An API that needs to support JSONP will require a third authentication method, as JSONP requests cannot send HTTP Basic Auth credentials or Bearer tokens. In this case, a special query parameter access_token can be used. note that there is an inherent security problem with using the query parameter token, namely that most web servers log the query parameter to the service log.</p>
<p>It is worthwhile to note that all three methods above are just ways of passing tokens across both ends of the API boundary. The actual underlying tokens themselves may all be the same.</p>
<p><strong>Token and Sign</strong></p>
<p>The API needs to be designed to be stateless, so the client needs to provide a valid Token and Sign at each request, which in my opinion are used for the following purposes respectively.</p>
<ul>
<li>Token is used to prove the user to which the request belongs, generally the server generates a random string (UUID) after login and binds it to the logged-in user, and then returns it to the client. The other is to keep the Token alive for a fixed period of time, but return a Token for refreshing, so that when the Token expires it can be refreshed instead of logging in again.</li>
<li>The Sign is used to prove that the request is reasonable, so generally the client will stitch the request parameters and encrypt them as the Sign to the server, so that even if the packet is caught, the other party only modifies the parameters but cannot generate the corresponding Sign, it will be detected by the server. Of course, the timestamp, request address and Token can also be mixed into the Sign, so that the Sign also has the owner, timeliness and destination.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/restful/">restful</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-12/github-cli-tool-usage/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Using the GitHub CLI Command Line Tools</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-12/serverless/">
            <span class="next-text nav-default">With high hopes for Serverless, have the controversies and issues been resolved?</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
