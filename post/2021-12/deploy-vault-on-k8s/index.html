<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Deploying Vault on Kubernetes - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Many times we may directly expose private information such as application passwords or API Token in the source code, which is obviously not a good way to expose such private information. The Kubernetes system provides a Secret object to store private data, but it is only a simple Base64 encoding, which is better than exposing it directly, but it is still not enough to use Secret directly for applications with" /><meta name="keywords" content="k8s, Vault" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-12/deploy-vault-on-k8s/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Deploying Vault on Kubernetes" />
<meta property="og:description" content="Many times we may directly expose private information such as application passwords or API Token in the source code, which is obviously not a good way to expose such private information. The Kubernetes system provides a Secret object to store private data, but it is only a simple Base64 encoding, which is better than exposing it directly, but it is still not enough to use Secret directly for applications with" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-12/deploy-vault-on-k8s/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-12-17T15:09:31+08:00" />
<meta property="article:modified_time" content="2021-12-17T15:09:31+08:00" />

<meta itemprop="name" content="Deploying Vault on Kubernetes">
<meta itemprop="description" content="Many times we may directly expose private information such as application passwords or API Token in the source code, which is obviously not a good way to expose such private information. The Kubernetes system provides a Secret object to store private data, but it is only a simple Base64 encoding, which is better than exposing it directly, but it is still not enough to use Secret directly for applications with"><meta itemprop="datePublished" content="2021-12-17T15:09:31+08:00" />
<meta itemprop="dateModified" content="2021-12-17T15:09:31+08:00" />
<meta itemprop="wordCount" content="2153">
<meta itemprop="keywords" content="k8s,vault," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Deploying Vault on Kubernetes"/>
<meta name="twitter:description" content="Many times we may directly expose private information such as application passwords or API Token in the source code, which is obviously not a good way to expose such private information. The Kubernetes system provides a Secret object to store private data, but it is only a simple Base64 encoding, which is better than exposing it directly, but it is still not enough to use Secret directly for applications with"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Deploying Vault on Kubernetes</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-12-17 15:09:31 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 2153 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction-to-vault">Introduction to Vault</a></li>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#usage">Usage</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Many times we may directly expose private information such as application passwords or API Token in the source code, which is obviously not a good way to expose such private information. The Kubernetes system provides a Secret object to store private data, but it is only a simple Base64 encoding, which is better than exposing it directly, but it is still not enough to use Secret directly for applications with high security requirements. In this article, we will introduce how to use <a href="https://www.vaultproject.io/">HashiCorp Vault</a> for secret key management in Kubernetes clusters.</p>
<h2 id="introduction-to-vault">Introduction to Vault</h2>
<p><a href="https://www.vaultproject.io/">Vault</a> is a central management service for handling and encrypting secret keys across the infrastructure. Vault manages all secret keys through a secret engine. Vault has a set of secret engines that can be used.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/12/17/8d4d50e9b70c47b1a29632314301dafb.png" alt=""></p>
<p>There are many advantages of using Vault.</p>
<ul>
<li>The secret key management service can simply be seen as 1Password in the back-end domain. first of all, it will ensure the security of the secret key storage, no matter who gets the landed data file of the secret key management service, it still cannot be decrypted without the secret key.</li>
<li>To get the previously configured passwords, secret keys and other key data from Vault, the administrator will need to assign Token, and for these assigned Token, the administrator can make various security policies including expiration, revocation, update and permission management, etc.</li>
<li>The security level of Vault can provide services open to the public network, so it can provide a developer&rsquo;s Vault for the development environment, and it can be very convenient to develop at home or off-site.</li>
<li>Administrators can update c-security passwords or keys for individual data services at any time through Vault, and can withdraw or modify permissions for specific Tokens at any time. This is useful when Rolling out updates</li>
<li>Using Vault forces code to obtain various data connection passwords or secret keys through the Vault interface. This prevents developers from inadvertently obtaining and using secret key passwords in their code. And because of the way Vault is managed, we can manage separate Vaults for different development stages, even though there is only one copy of the code. It is even possible to have only one person with Vault management privileges in a production environment and not feel overwhelmed with maintenance</li>
<li>All secret key access and modification are logged. This can be used as evidence after the fact as a clue for intrusion</li>
<li>Database and API keys are no longer scattered all over the code</li>
</ul>
<h2 id="installation">Installation</h2>
<p>Again for convenience we will use Helm3 here to install Vault on the Kubernetes cluster, corresponding to the environment version shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ helm version
version.BuildInfo<span class="o">{</span>Version:<span class="s2">&#34;v3.0.1&#34;</span>, GitCommit:<span class="s2">&#34;7c22ef9ce89e0ebeb7125ba2ebf7d421f3e82ffa&#34;</span>, GitTreeState:<span class="s2">&#34;clean&#34;</span>, GoVersion:<span class="s2">&#34;go1.13.4&#34;</span><span class="o">}</span>
$ kubectl version                          
Client Version: version.Info<span class="o">{</span>Major:<span class="s2">&#34;1&#34;</span>, Minor:<span class="s2">&#34;14&#34;</span>, GitVersion:<span class="s2">&#34;v1.14.2&#34;</span>, GitCommit:<span class="s2">&#34;66049e3b21efe110454d67df4fa62b08ea79a19b&#34;</span>, GitTreeState:<span class="s2">&#34;clean&#34;</span>, BuildDate:<span class="s2">&#34;2019-05-16T18:55:03Z&#34;</span>, GoVersion:<span class="s2">&#34;go1.12.5&#34;</span>, Compiler:<span class="s2">&#34;gc&#34;</span>, Platform:<span class="s2">&#34;darwin/amd64&#34;</span><span class="o">}</span>
Server Version: version.Info<span class="o">{</span>Major:<span class="s2">&#34;1&#34;</span>, Minor:<span class="s2">&#34;16&#34;</span>, GitVersion:<span class="s2">&#34;v1.16.2&#34;</span>, GitCommit:<span class="s2">&#34;c97fe5036ef3df2967d086711e6c0c405941e14b&#34;</span>, GitTreeState:<span class="s2">&#34;clean&#34;</span>, BuildDate:<span class="s2">&#34;2019-10-15T19:09:08Z&#34;</span>, GoVersion:<span class="s2">&#34;go1.12.10&#34;</span>, Compiler:<span class="s2">&#34;gc&#34;</span>, Platform:<span class="s2">&#34;linux/amd64&#34;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Here you can install it directly using the official chart package provided by Vault: <a href="https://github.com/hashicorp/vault-helm">https://github.com/hashicorp/vault-helm</a>. The package is not uploaded to the chart repository, so we can directly clone the code to the client where Helm3 is located and install it directly, or of course, you can install it directly by specifying Release package can also be installed by using the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ helm install vault --namespace kube-system <span class="se">\
</span><span class="se"></span>    --set <span class="s2">&#34;server.dev.enabled=true&#34;</span> <span class="se">\
</span><span class="se"></span>    https://github.com/hashicorp/vault-helm/archive/v0.3.3.tar.gz
NAME: vault
LAST DEPLOYED: Wed Feb <span class="m">19</span> 10:50:42 <span class="m">2020</span>
NAMESPACE: kube-system
STATUS: deployed
REVISION: <span class="m">1</span>
TEST SUITE: None
NOTES:
Thank you <span class="k">for</span> installing HashiCorp Vault!

Now that you have deployed Vault, you should look over the docs on using
Vault with Kubernetes available here:

https://www.vaultproject.io/docs/


Your release is named vault. To learn more about the release, try:

  $ helm status vault
  $ helm get vault
</code></pre></td></tr></table>
</div>
</div><p>The above command will install a Helm release named vault under the kube-system namespace.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ helm ls -n kube-system
NAME 	NAMESPACE  	REVISION	UPDATED                             	STATUS  	CHART      	APP VERSION
vault	kube-system	<span class="m">1</span>       	2020-02-19 10:50:42.449755 +0800 CST	deployed	vault-0.3.3
$ $ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
......
vault-0                                 1/1     Running   <span class="m">0</span>          6m26s
vault-agent-injector-584db8849f-x6wsv   1/1     Running   <span class="m">0</span>          6m27s
</code></pre></td></tr></table>
</div>
</div><p>Seeing the above two Vault-related Pods running successfully proves that they have been installed successfully, so the installation is very easy, so let&rsquo;s focus on how to use them.</p>
<h2 id="usage">Usage</h2>
<p>If you want Vault to store the database username and password under the <code>internal/database/config</code> path of the application, you need to create the secret by opening the kv secret engine and putting the username and password in the specified path.</p>
<p>To access the command line interactive terminal of the <code>vault-0</code> container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl <span class="nb">exec</span> -it vault-0 /bin/sh -n kube-system
/ $ 
</code></pre></td></tr></table>
</div>
</div><p>Enable the <code>kv-v2</code> secrets engine under the <code>internal</code> path.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">/ $ vault secrets <span class="nb">enable</span> -path<span class="o">=</span>internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
</code></pre></td></tr></table>
</div>
</div><p>Then add a username and password secret key under the <code>internal/exampleapp/config</code> path.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">/ $ vault kv put internal/database/config <span class="nv">username</span><span class="o">=</span><span class="s2">&#34;db-readonly-username&#34;</span> <span class="nv">password</span><span class="o">=</span><span class="s2">&#34;db-secret-password&#34;</span>
Key              Value
---              -----
created_time     2020-02-19T02:58:54.06574878Z
deletion_time    n/a
destroyed        <span class="nb">false</span>
version          <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>Once created, the secret created above can be verified with the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">/ $ vault kv get internal/database/config
====== Metadata ======
Key              Value
---              -----
created_time     2020-02-19T02:58:54.06574878Z
deletion_time    n/a
destroyed        false
version          1

====== Data ======
Key         Value
---         -----
password    db-secret-password
username    db-readonly-username
</code></pre></td></tr></table>
</div>
</div><p>This stores the username and password information in the Vault, which provides a <a href="https://www.vaultproject.io/docs/auth/kubernetes.html">Kubernetes authentication</a> method that allows clients to authenticate by using the Kubernetes ServiceAccount for authentication.</p>
<p>To enable Kubernetes authentication.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">/ $ vault auth <span class="nb">enable</span> kubernetes
Success! Enabled kubernetes auth method at: kubernetes/
</code></pre></td></tr></table>
</div>
</div><p>Vault accepts Service Token from any client in the Kubernetes cluster, and during authentication, Vault verifies the ServiceAccount&rsquo;s Token information with the configured Kubernetes address. Configure the Kubernetes authentication method with the ServiceAccount&rsquo;s Token, Kubernetes address, and CA certificate information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">/ $ vault write auth/kubernetes/config <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">token_reviewer_jwt</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>cat /var/run/secrets/kubernetes.io/serviceaccount/token<span class="k">)</span><span class="s2">&#34;</span> <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">kubernetes_host</span><span class="o">=</span><span class="s2">&#34;https://</span><span class="nv">$KUBERNETES_PORT_443_TCP_ADDR</span><span class="s2">:443&#34;</span> <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">kubernetes_ca_cert</span><span class="o">=</span>@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt
Success! Data written to: auth/kubernetes/config
</code></pre></td></tr></table>
</div>
</div><p>Both <code>token_reviewer_jwt</code> and <code>kubernetes_ca_cert</code> are injected into the Pod by default by Kubernetes, and the environment variable <code>KUBERNETES_PORT_443_TCP_ADDR</code> is also built-in to represent the Kubernetes APIServer&rsquo;s intranet address of the Kubernetes APIServer. In order for the client to read the secret data defined in the previous step under the <code>internal/database/config</code> path, you also need to grant the <code>read</code> permission to that path.</p>
<p>Here we create a policy name <code>internal-app</code> that will enable read access to the secret in the path <code>internal/database/config</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">/ $ vault policy write internal-app - <span class="s">&lt;&lt;EOH
</span><span class="s">&gt; path &#34;internal/data/database/config&#34; {
</span><span class="s">&gt;   capabilities = [&#34;read&#34;]
</span><span class="s">&gt; }
</span><span class="s">&gt; EOH</span>
Success! Uploaded policy: internal-app
</code></pre></td></tr></table>
</div>
</div><p>Then create a Kubernetes authentication role named <code>internal-app</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ / $ vault write auth/kubernetes/role/internal-app <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">bound_service_account_names</span><span class="o">=</span>internal-app <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">bound_service_account_namespaces</span><span class="o">=</span>default <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">policies</span><span class="o">=</span>internal-app <span class="se">\
</span><span class="se"></span>&gt;         <span class="nv">ttl</span><span class="o">=</span>24h
Success! Data written to: auth/kubernetes/role/internal-app
</code></pre></td></tr></table>
</div>
</div><p>This role connects a ServiceAccount named <code>internal-app</code> under the Kubernetes default namespace to Vault&rsquo;s <code>internal-app</code> policy, and the Token returned after authentication has a 24-hour validity period. Finally, we exit <code>vault-0</code> directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">/ $ <span class="nb">exit</span>
$
</code></pre></td></tr></table>
</div>
</div><p>Now that the Vault-related preparations are done, the next step is how to read our Secret data above in Kubernetes. Above we defined a ServiceAccount named <code>internal-app</code> under the default namespace, which does not exist yet, so first create: (vault-sa.yaml)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">apiVersion: v1
kind: ServiceAccount
metadata:
  name: internal-app  <span class="c1"># 需要和上面的 bound_service_account_names 一致</span>
  namespace: default  <span class="c1"># 需要和上面的 bound_service_account_namespaces 一致</span>
</code></pre></td></tr></table>
</div>
</div><p>Just create directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl apply -f vault-sa.yaml
serviceaccount/internal-app created
$ kubectl get sa
NAME                     SECRETS   AGE
internal-app             <span class="m">1</span>         91m
......
</code></pre></td></tr></table>
</div>
</div><p>Then we use the sa object created above in our application: (vault-demo.yaml)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">vault-demo</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">vault-demo</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">vault-demo</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">vault-demo</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">internal-app </span><span class="w"> </span><span class="c"># 使用上面创建的 serviceaccount 对象</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">vault</span><span class="w">
</span><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/vault-demo:0.0.1</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>One of the more important things is that the <code>spec.template.spec.serviceAccountName</code> field needs to use the ServiceAccount resource object called <code>internal-app</code> that we created above, again directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl apply -f vault-demo.yaml
deployment.apps/vault-demo created
$ kubectl get pods
NAME                                      READY   STATUS    RESTARTS   AGE
vault-demo-7fb8449d7b-x8bft               1/1     Running   <span class="m">0</span>          10m
......
$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
vault-0                                 1/1     Running   <span class="m">0</span>          112m
vault-agent-injector-584db8849f-x6wsv   1/1     Running   <span class="m">0</span>          112m
......
</code></pre></td></tr></table>
</div>
</div><p>The normal case is that the <code>vault-agent-injector</code> program in our deployed Vault will look up the <code>annotations</code> property of the deployed application in the Kubernetes cluster for processing. -7fb8449d7b-x8bft` pod is not getting any secret data, which can be verified by the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl <span class="nb">exec</span> -it vault-demo-7fb8449d7b-x8bft -- ls /vault/secrets
ls: /vault/secrets: No such file or directory
<span class="nb">command</span> terminated with <span class="nb">exit</span> code <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>You can see that there is no corresponding secret data in the container. At this point we need to add some instructions for getting the secret data via <code>annotations</code>: (vault-inject.yaml)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">vault.hashicorp.com/agent-inject</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">vault.hashicorp.com/role</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;internal-app&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">vault.hashicorp.com/agent-inject-secret-database-config.txt</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;internal/data/database/config&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>The <a href="https://www.vaultproject.io/docs/platform/k8s/injector/index.html#annotations">annotations</a> above defines some of the vault-related information, all starting with the prefix <code>vault.hashicorp .com</code> prefix.</p>
<ul>
<li><code>agent-inject</code> identifies that the Vault Agent injection service is enabled</li>
<li><code>role</code> indicates the Vault Kubernetes authentication role</li>
<li><code>agent-inject-secret-FILEPATH</code> prefixes the path to the file <code>database-config.txt</code> that is written to <code>/vault/secrets</code>, corresponding to the secret data storage path defined in Vault.</li>
</ul>
<p>Use the annotations defined above directly to patch the Deployment above.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl patch deployment vault-demo --patch <span class="s2">&#34;</span><span class="k">$(</span>cat vault-inject.yaml<span class="k">)</span><span class="s2">&#34;</span>
deployment.apps/vault-demo patched
$ kubectl get pods
NAME                                      READY   STATUS    RESTARTS   AGE
vault-demo-574d67ff98-2dsqh               2/2     Running   <span class="m">0</span>          3m14s
</code></pre></td></tr></table>
</div>
</div><p>The new Pod will now contain two containers, the vault-demo container we defined and a Vault Agent container called <code>vault-agent</code>. Automatically adding a <code>vault-agent</code> Sidecar container to the Pod is actually done using the Mutating Admission Webhook, the same mechanism implemented by Istio.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/12/17/f13825d1fc774a5486cb77b05a8e134e.png" alt=""></p>
<p>We can now view the logs of the <code>vault-agent</code> container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl logs -f vault-demo-574d67ff98-2dsqh vault-agent
2020-02-19T11:24:26.127+0800 <span class="o">[</span>INFO<span class="o">]</span>  sink.file: creating file sink
2020-02-19T11:24:26.128+0800 <span class="o">[</span>INFO<span class="o">]</span>  sink.file: file sink configured: <span class="nv">path</span><span class="o">=</span>/home/vault/.token <span class="nv">mode</span><span class="o">=</span>-rw-r-----
2020-02-19T11:24:26.129+0800 <span class="o">[</span>INFO<span class="o">]</span>  auth.handler: starting auth handler
2020-02-19T11:24:26.129+0800 <span class="o">[</span>INFO<span class="o">]</span>  auth.handler: authenticating
2020-02-19T11:24:26.129+0800 <span class="o">[</span>INFO<span class="o">]</span>  template.server: starting template server
2020/02/19 03:24:26.129648 <span class="o">[</span>INFO<span class="o">]</span> <span class="o">(</span>runner<span class="o">)</span> creating new runner <span class="o">(</span>dry: false, once: <span class="nb">false</span><span class="o">)</span>
2020/02/19 03:24:26.130647 <span class="o">[</span>INFO<span class="o">]</span> <span class="o">(</span>runner<span class="o">)</span> creating watcher
2020-02-19T11:24:26.130+0800 <span class="o">[</span>INFO<span class="o">]</span>  sink.server: starting sink <span class="nv">server</span>
<span class="o">==</span>&gt; Vault server started! Log data will stream in below:

<span class="o">==</span>&gt; Vault agent configuration:

                     Cgo: disabled
               Log Level: info
                 Version: Vault v1.3.1

2020-02-19T11:24:26.155+0800 <span class="o">[</span>INFO<span class="o">]</span>  auth.handler: authentication successful, sending token to sinks
2020-02-19T11:24:26.155+0800 <span class="o">[</span>INFO<span class="o">]</span>  auth.handler: starting renewal process
2020-02-19T11:24:26.155+0800 <span class="o">[</span>INFO<span class="o">]</span>  sink.file: token written: <span class="nv">path</span><span class="o">=</span>/home/vault/.token
2020-02-19T11:24:26.155+0800 <span class="o">[</span>INFO<span class="o">]</span>  template.server: template server received new token
2020/02/19 03:24:26.155649 <span class="o">[</span>INFO<span class="o">]</span> <span class="o">(</span>runner<span class="o">)</span> stopping
2020/02/19 03:24:26.155649 <span class="o">[</span>INFO<span class="o">]</span> <span class="o">(</span>runner<span class="o">)</span> creating new runner <span class="o">(</span>dry: false, once: <span class="nb">false</span><span class="o">)</span>
2020-02-19T11:24:26.166+0800 <span class="o">[</span>INFO<span class="o">]</span>  auth.handler: renewed auth token
2020/02/19 03:24:26.176648 <span class="o">[</span>INFO<span class="o">]</span> <span class="o">(</span>runner<span class="o">)</span> creating watcher
2020/02/19 03:24:26.176648 <span class="o">[</span>INFO<span class="o">]</span> <span class="o">(</span>runner<span class="o">)</span> starting
</code></pre></td></tr></table>
</div>
</div><p>The <code>vault-agent</code> container manages the entire Token lifecycle and secret data retrieval, and the secret data we define is added to the application container under the <code>/vault/secrets/database-config.txt</code> path.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ kubectl <span class="nb">exec</span> -it vault-demo-574d67ff98-2dsqh -c vault -- cat /vault/secrets/database-config.txt
data: map<span class="o">[</span>password:db-secret-password username:db-readonly-username<span class="o">]</span>
metadata: map<span class="o">[</span>created_time:2020-02-19T02:58:54.06574878Z deletion_time: destroyed:false version:1<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Here the secret data is successfully stored in our application container, but for practical applications we can read the corresponding secret data directly through the SDK provided by Vault. For example, the following is an example of reading dynamic authentication data through the Vault SDK.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;io/ioutil&#34;</span>

	<span class="nx">vaultApi</span> <span class="s">&#34;github.com/hashicorp/vault/api&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="p">(</span>
	<span class="nx">vaultHost</span>           <span class="kt">string</span>
	<span class="nx">vaultCAPath</span>         <span class="kt">string</span>
	<span class="nx">vaultServiceAccount</span> <span class="kt">string</span>
	<span class="nx">vaultJWTPath</span>        <span class="kt">string</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">vaultJWTPath</span> <span class="p">=</span> <span class="s">&#34;/var/run/secrets/kubernetes.io/serviceaccount/token&#34;</span>
	<span class="nx">vaultServiceAccount</span> <span class="p">=</span> <span class="s">&#34;internal-app&#34;</span>

	<span class="nx">tlsConfig</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">vaultApi</span><span class="p">.</span><span class="nx">TLSConfig</span><span class="p">{</span>
		<span class="nx">CACert</span><span class="p">:</span>   <span class="nx">vaultCAPath</span><span class="p">,</span>
		<span class="nx">Insecure</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="p">}</span>

    <span class="nx">config</span> <span class="o">:=</span> <span class="nx">vaultApi</span><span class="p">.</span><span class="nf">DefaultConfig</span><span class="p">()</span>
    <span class="c1">// todo，配置 vault 地址
</span><span class="c1"></span>	<span class="nx">config</span><span class="p">.</span><span class="nx">Address</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;https://%s&#34;</span><span class="p">,</span> <span class="nx">vaultHost</span><span class="p">)</span>
	<span class="nx">config</span><span class="p">.</span><span class="nf">ConfigureTLS</span><span class="p">(</span><span class="nx">tlsConfig</span><span class="p">)</span>

	<span class="nx">client</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">vaultApi</span><span class="p">.</span><span class="nf">NewClient</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
	<span class="nx">buf</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">vaultJWTPath</span><span class="p">)</span>
	<span class="nx">jwt</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>

	<span class="nx">options</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
		<span class="s">&#34;jwt&#34;</span><span class="p">:</span>  <span class="nx">jwt</span><span class="p">,</span>
		<span class="s">&#34;role&#34;</span><span class="p">:</span> <span class="nx">vaultServiceAccount</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">loginSecret</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Logical</span><span class="p">().</span><span class="nf">Write</span><span class="p">(</span><span class="s">&#34;auth/kubernetes/login&#34;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
	<span class="nx">client</span><span class="p">.</span><span class="nf">SetToken</span><span class="p">(</span><span class="nx">loginSecret</span><span class="p">.</span><span class="nx">Auth</span><span class="p">.</span><span class="nx">ClientToken</span><span class="p">)</span>

	<span class="nx">secret</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Logical</span><span class="p">().</span><span class="nf">Read</span><span class="p">(</span><span class="s">&#34;internal/data/database/config&#34;</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">secret</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>It is also important to note that the authentication role we defined above only has 24 hours to expire, so you can perform a renew operation before it expires.</p>
<p>For more information on the use of Vault in conjunction with Kubernetes, check out the official documentation at <a href="https://learn.hashicorp.com/vault/getting-started-k8s/k8s-intro">https://learn.hashicorp.com/vault/getting-started-k8s/k8s-intro</a>.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/k8s/">k8s</a>
          <a href="/tags/vault/">vault</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-12/deploy-spinnaker-on-k8s/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Deploying Spinnaker on Kubernetes</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-12/struct-compare/">
            <span class="next-text nav-default">Golang&#39;s approach to comparing two structs of the same type and its performance</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
