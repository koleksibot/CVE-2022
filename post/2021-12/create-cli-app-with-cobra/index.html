<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Creating CLI Applications with Cobra in Golang - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Although most of the software we use today is visual and easy to use, that doesn&amp;rsquo;t mean that CLI (command line) applications are useless, especially for developers who deal with CLI applications on a regular basis. Golang is perfect for building CLI applications, and we will introduce how to build a CLI application in Golang in the following. For developers, there are a lot of CLI tools like npm, node," /><meta name="keywords" content="golang, cobra, cli" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2021-12/create-cli-app-with-cobra/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Creating CLI Applications with Cobra in Golang" />
<meta property="og:description" content="Although most of the software we use today is visual and easy to use, that doesn&rsquo;t mean that CLI (command line) applications are useless, especially for developers who deal with CLI applications on a regular basis. Golang is perfect for building CLI applications, and we will introduce how to build a CLI application in Golang in the following. For developers, there are a lot of CLI tools like npm, node," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2021-12/create-cli-app-with-cobra/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-12-11T15:19:48+08:00" />
<meta property="article:modified_time" content="2021-12-11T15:19:48+08:00" />

<meta itemprop="name" content="Creating CLI Applications with Cobra in Golang">
<meta itemprop="description" content="Although most of the software we use today is visual and easy to use, that doesn&rsquo;t mean that CLI (command line) applications are useless, especially for developers who deal with CLI applications on a regular basis. Golang is perfect for building CLI applications, and we will introduce how to build a CLI application in Golang in the following. For developers, there are a lot of CLI tools like npm, node,"><meta itemprop="datePublished" content="2021-12-11T15:19:48+08:00" />
<meta itemprop="dateModified" content="2021-12-11T15:19:48+08:00" />
<meta itemprop="wordCount" content="2537">
<meta itemprop="keywords" content="golang,cobra," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Creating CLI Applications with Cobra in Golang"/>
<meta name="twitter:description" content="Although most of the software we use today is visual and easy to use, that doesn&rsquo;t mean that CLI (command line) applications are useless, especially for developers who deal with CLI applications on a regular basis. Golang is perfect for building CLI applications, and we will introduce how to build a CLI application in Golang in the following. For developers, there are a lot of CLI tools like npm, node,"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Creating CLI Applications with Cobra in Golang</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-12-11 15:19:48 </span>
        <div class="post-category">
            <a href="/categories/skills/"> skills </a>
            </div>
          <span class="more-meta"> 2537 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#concepts">Concepts</a></li>
        <li><a href="#example">Example</a>
          <ul>
            <li><a href="#rootcmd">rootCmd</a></li>
            <li><a href="#init">init</a></li>
            <li><a href="#initconfig">initConfig</a></li>
            <li><a href="#adding-data">Adding Data</a></li>
            <li><a href="#adding-even-numbers">Adding even numbers</a></li>
          </ul>
        </li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Although most of the software we use today is visual and easy to use, that doesn&rsquo;t mean that CLI (command line) applications are useless, especially for developers who deal with CLI applications on a regular basis. Golang is perfect for building CLI applications, and we will introduce how to build a CLI application in Golang in the following.</p>
<p>For developers, there are a lot of CLI tools like npm, node, go, python, docker, kubectl, etc. which are very small, dependency-free, ideal for system management or automation tasks, etc.</p>
<p>We chose to use the famous <a href="https://github.com/spf13/cobra">Cobra</a> library in Golang for our CLI tool development. Cobra is a powerful and modern CLI application library, and there are many well-known Go projects that use Cobra for building, such as Kubernetes, Docker, Hugo, etc.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2021/12/11/11501c3963894f79a6c8f7a775ee0548.png" alt=""></p>
<h2 id="concepts">Concepts</h2>
<p>Cobra is built on top of commands, parameters and identifiers: the</p>
<ul>
<li><code>Commands</code> means execute actions</li>
<li><code>Args</code> are the execution parameters</li>
<li><code>Flags</code> are the identifiers for these actions</li>
</ul>
<p>The basic execution commands are shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ APPNAME Command Args --Flags 
# or
$ APPNAME Command --Flags Args
</code></pre></td></tr></table>
</div>
</div><p>For example, some of the command-line tools we normally use are</p>
<ul>
<li>git clone URL -bare</li>
<li>go get -u URL</li>
<li>npm install package -save</li>
<li>kubectl get pods -n kube-system -l app=cobra</li>
</ul>
<h2 id="example">Example</h2>
<p>Let&rsquo;s take a look at using Cobra, here we are using go1.13.3 and using Go Modules for package management.</p>
<p>Create a new directory called <code>my-calc</code> as the project directory, and initialize modules.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ mkdir my-calc <span class="o">&amp;&amp;</span> <span class="nb">cd</span> my-calc
<span class="c1"># 如果 go modules 默认没有开启，需要执行 export GO111MODULE=on 开启</span>
$ go mod init my-calc
go: creating new go.mod: module my-calc
</code></pre></td></tr></table>
</div>
</div><p>After initialization, you can see that there is a <code>go.mod</code> file under the project root. Now that we don&rsquo;t have the <code>cobra</code> library installed, run the following command to install it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 强烈推荐配置该环境变量</span>
$ <span class="nb">export</span> <span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.cn
$ go get -u github.com/spf13/cobra/cobra
</code></pre></td></tr></table>
</div>
</div><p>After successful installation, we can now initialize the scaffolding of the CLI application using the <code>cobra init</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ cobra init --pkg-name my-calc
Your Cobra applicaton is ready at
/Users/ych/devs/workspace/youdianzhishi/course/my-calc
</code></pre></td></tr></table>
</div>
</div><p>Note that newer versions of the cobra library require a <code>-pkg-name</code> argument for initialization, which specifies the name of the module we initialized above. The init command above will create a minimal CLI application project.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">$ tree .
.
├── LICENSE
├── cmd
│   └── root.go
├── go.mod
├── go.sum
└── main.go

1 directory, 5 files
</code></pre></td></tr></table>
</div>
</div><p>The <code>main.go</code> is the entry point for the CLI application, and the <code>Execute</code> function under <code>cmd/root.go</code> is called in <code>main.go</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// main.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;my-calc/cmd&#34;</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">cmd</span><span class="p">.</span><span class="nf">Execute</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then we&rsquo;ll look at the <code>cmd/root.go</code> file.</p>
<h3 id="rootcmd">rootCmd</h3>
<p>The root command is the most basic command of the CLI tools, for example, for the <code>go get URL</code> we used earlier, where <code>go</code> is the root command, and <code>get</code> is a subcommand of the <code>go</code> root command, and the cobra command is used directly in <code>root.go</code> to initialize the <code>rootCmd</code> structure, all other commands in the CLI will be subcommands of the <code>rootCmd</code> root command. All other commands in the CLI will be subcommands of the root command <code>rootCmd</code>.</p>
<p>Here we remove the comment inside the <code>rootCmd</code> variable in <code>cmd/root.go</code> and add the phrase <code>fmt.Println(&quot;Hello Cobra CLI&quot;)</code> to the <code>Run</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">rootCmd</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
	<span class="nx">Use</span><span class="p">:</span>   <span class="s">&#34;my-calc&#34;</span><span class="p">,</span>
	<span class="nx">Short</span><span class="p">:</span> <span class="s">&#34;A brief description of your application&#34;</span><span class="p">,</span>
	<span class="nx">Long</span><span class="p">:</span> <span class="s">`A longer description that spans multiple lines and likely contains
</span><span class="s">examples and usage of using your application. For example:
</span><span class="s">
</span><span class="s">Cobra is a CLI library for Go that empowers applications.
</span><span class="s">This application is a tool to generate the needed files
</span><span class="s">to quickly create a Cobra application.`</span><span class="p">,</span>
	<span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello Cobra CLI&#34;</span><span class="p">)</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>At this point we execute the following command under the root of the project to build.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go build -o my-calc
</code></pre></td></tr></table>
</div>
</div><p>This command generates a binary file named <code>my-calc</code> in the root of the project, which can be executed directly to see the following output.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ ./my-calc
Hello Cobra CLI
</code></pre></td></tr></table>
</div>
</div><h3 id="init">init</h3>
<p>We know that the <code>init</code> function is the first function called when initializing a package in Golang. In <code>cmd/root.go</code> we can see that the <code>init</code> function calls <code>cobra.OnInitialize(initConfig)</code>, which means that whenever a command is executed or invoked, it executes all the functions in the <code>init</code> function before executing the <code>execute</code> method. This initialization can be used for loading configuration files or for constructors and so on, depending entirely on the real situation of our application.</p>
<p>OnInitialize(initConfig)<code>calls the</code>initConfig<code>function inside the initialization function, so that when the</code>rootCmd<code>execution method</code>RUN: func<code>is run, the</code>rootCmd<code>root command will first run the</code>initConfig<code>function, and when all the The</code>RUN: func<code>execution function of</code>rootCmd` will be executed only after all the initialization functions have been executed.</p>
<p>We can add some Debug information to the <code>initConfig</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">initConfig</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;I&#39;m inside initConfig function in cmd/root.go&#34;</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, again, reconstruct and execute.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go build -o my-calc
$ ./my-calc 
I<span class="err">&#39;</span>m inside initConfig <span class="k">function</span> in cmd/root.go
Hello Cobra CLI
</code></pre></td></tr></table>
</div>
</div><p>You can see that the information inside the <code>initConfig</code> function is run first, and then the actual execution of the function is done.</p>
<p>In order to understand the whole CLI execution flow, we add some debug information to <code>main.go</code> as well.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/root.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;I&#39;m inside init function in cmd/root.go&#34;</span><span class="p">)</span>
    <span class="nx">cobra</span><span class="p">.</span><span class="nf">OnInitialize</span><span class="p">(</span><span class="nx">initConfig</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">initConfig</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;I&#39;m inside initConfig function in cmd/root.go&#34;</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="c1">// main.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;I&#39;m inside main function in main.go&#34;</span><span class="p">)</span>
     <span class="nx">cmd</span><span class="p">.</span><span class="nf">Execute</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, again, reconstruct and execute.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go build -o my-calc
$ ./my-calc 
I<span class="s1">&#39;m inside init function in cmd/root.go
</span><span class="s1">I&#39;</span>m inside main <span class="k">function</span> in main.go
I<span class="err">&#39;</span>m inside initConfig <span class="k">function</span> in cmd/root.go
Hello Cobra CLI
</code></pre></td></tr></table>
</div>
</div><p>Based on the above log information, we can understand the flow of CLI commands.</p>
<p>The last thing the <code>init</code> function deals with is <code>flags</code>. <code>Flags</code> are similar to command identifiers, we can think of them as conditional operations of some kind, two types of identifiers are provided in Cobra: <code>Persistent Flags</code> and <code>Local Flags</code>.</p>
<ul>
<li><code>Persistent Flags</code>: This flag can be used for the command to which it is assigned and for all subcommands of that command.</li>
<li><code>Local Flags</code>: This flag can only be used for the command to which it is assigned.</li>
</ul>
<h3 id="initconfig">initConfig</h3>
<p>This function is used to set a configuration file named <code>.my-calc</code> in the home directory, which will be used if the file exists.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/root.go
</span><span class="c1">// initConfig 读取配置文件和环境变量
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">initConfig</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">cfgFile</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
        <span class="c1">// 使用 flag 标志中传递的配置文件
</span><span class="c1"></span>		<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigFile</span><span class="p">(</span><span class="nx">cfgFile</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// 获取 Home 目录
</span><span class="c1"></span>		<span class="nx">home</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">homedir</span><span class="p">.</span><span class="nf">Dir</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
			<span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="c1">// 在 Home 目录下面查找名为 &#34;.my-calc&#34; 的配置文件
</span><span class="c1"></span>		<span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="nx">home</span><span class="p">)</span>
		<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigName</span><span class="p">(</span><span class="s">&#34;.my-calc&#34;</span><span class="p">)</span>
	<span class="p">}</span>
    <span class="c1">// 读取匹配的环境变量
</span><span class="c1"></span>	<span class="nx">viper</span><span class="p">.</span><span class="nf">AutomaticEnv</span><span class="p">()</span>
	<span class="c1">// 如果有配置文件，则读取它
</span><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">();</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Using config file:&#34;</span><span class="p">,</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ConfigFileUsed</span><span class="p">())</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>viper</code> is an excellent Golang library for solving configuration files. It can read information from JSON, TOML, YAML, HCL, envfile, and Java properties configuration files, which is very powerful and goes beyond reading configuration. Introduction: <a href="https://github.com/spf13/viper">https://github.com/spf13/viper</a>.</p>
<p>Now that we can remove some of the print statements we added earlier, we&rsquo;ve created a <code>my-calc</code> command as a <code>rootCmd</code> command that will print the <code>Hello Cobra CLI</code> message when we execute the root command, so let&rsquo;s add some other commands to our CLI application.</p>
<h3 id="adding-data">Adding Data</h3>
<p>Create a command named <code>add</code> in the root of the project. The way <code>Cobra</code> adds a new command is: <code>cobra add &lt;commandName&gt;</code>, so we&rsquo;ll do it here directly like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ cobra add add
add created at /Users/ych/devs/workspace/youdianzhishi/course/my-calc
$ tree .
.
├── LICENSE
├── cmd
│   ├── add.go
│   └── root.go
├── go.mod
├── go.sum
├── main.go
└── my-calc

<span class="m">1</span> directory, <span class="m">7</span> files
</code></pre></td></tr></table>
</div>
</div><p>Now we can see that a new <code>add.go</code> file has been added to the <code>cmd/root.go</code> file, and if we look closely we can see that the file is relatively similar to <code>cmd/root.go</code>. Command<code>has a</code>RUN<code>function with a</code>*cobra.Command` pointer and a string slicing parameter.</p>
<p>Then it is initialized in the <code>init</code> function, and after initialization, it is added to the <code>rootCmd</code> root command <code>rootCmd.AddCommand(addCmd)</code>, so we can think of <code>addCmd</code> as a subcommand of <code>rootCmd</code>.</p>
<p>Again, now rebuild the application and execute :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go build -o my-calc
$ ./my-calc 
Hello Cobra CLI
$ ./my-calc add
add called
</code></pre></td></tr></table>
</div>
</div><p>We know that the <code>RUN</code> function takes the user string slice as an argument, so to support adding numbers, we first need to convert the string to int type and return the calculation result.</p>
<p>Add a function named <code>intAdd</code> to the <code>cmd/add.go</code> file, defined as follows</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/add.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">intAdd</span><span class="p">(</span><span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">sum</span> <span class="kt">int</span>
	<span class="c1">// 循环 args 参数，循环的第一个值为 args 的索引，这里我们不需要，所以用 _ 忽略掉
</span><span class="c1"></span>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ival</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">args</span> <span class="p">{</span>
		<span class="c1">// 将 string 转换成 int 类型
</span><span class="c1"></span>		<span class="nx">temp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">ival</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">sum</span> <span class="p">=</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">temp</span>
	<span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Addition of numbers %s is %d\n&#34;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">sum</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then, in the <code>addCmd</code> variable, update the <code>RUN</code> function to remove the default print message and call the <code>addInt</code> function declared above.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// addCmd
</span><span class="c1"></span><span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">intAdd</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
<span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>Then rebuild the application by executing the command shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ go build -o my-calc
$ ./my-calc 
Hello Cobra CLI
<span class="c1"># 注意参数之间的空格</span>
$ ./my-calc add <span class="m">1</span> <span class="m">2</span> <span class="m">3</span>
Addition of numbers <span class="o">[</span><span class="m">1</span> <span class="m">2</span> 3<span class="o">]</span> is <span class="m">6</span>
</code></pre></td></tr></table>
</div>
</div><p>Since the <code>args</code> argument in the <code>RUN</code> function is a string slice, we can pass any number of arguments, but it does have the drawback that it can only compute integers, not decimals. For example, if we perform the following calculation, we will just panic:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ ./my-calc add <span class="m">1</span> <span class="m">2</span> 3.5
panic: strconv.Atoi: parsing <span class="s2">&#34;3.5&#34;</span>: invalid syntax

goroutine <span class="m">1</span> <span class="o">[</span>running<span class="o">]</span>:
my-calc/cmd.intAdd<span class="o">(</span>0xc0000a5890, 0x3, 0x3<span class="o">)</span>
......
</code></pre></td></tr></table>
</div>
</div><p>Since inside the <code>intAdd</code> function we are only converting strings to int, not float32/64 types, we can add a <code>flag</code> identifier to the <code>addCmd</code> command to help the CLI determine whether it is an int calculation or a float calculation.</p>
<p>Inside the <code>init</code> function in the <code>cmd/add.go</code> file, we create a local identifier of type Bool, named <code>float</code>, abbreviated to <code>f</code>, with a default value of false. this default value is very important, meaning that the value of the flag identifier will be false even if it is not called on the command line.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/add.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">rootCmd</span><span class="p">.</span><span class="nf">AddCommand</span><span class="p">(</span><span class="nx">addCmd</span><span class="p">)</span>
	<span class="nx">addCmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">BoolP</span><span class="p">(</span><span class="s">&#34;float&#34;</span><span class="p">,</span> <span class="s">&#34;f&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;Add Floating Numbers&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then create a <code>floatAdd</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">floatAdd</span><span class="p">(</span><span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">sum</span> <span class="kt">float64</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">fval</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">args</span> <span class="p">{</span>
		<span class="c1">// 将字符串转换成 float64 类型
</span><span class="c1"></span>		<span class="nx">temp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">ParseFloat</span><span class="p">(</span><span class="nx">fval</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">sum</span> <span class="p">=</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">temp</span>
	<span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Sum of floating numbers %s is %f\n&#34;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">sum</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This function is almost identical to the <code>intAdd</code> function above, except that it converts a string to float64. Then in the <code>RUN</code> function of <code>addCmd</code>, we determine whether <code>intAdd</code> or <code>floatAdd</code> should be called based on the passed identifier, and if the <code>-float</code> or <code>-f</code> flags are passed, the <code>floatAdd</code> function will be called.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/add.go
</span><span class="c1">// addCmd
</span><span class="c1"></span><span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 获取 float 标识符的值，默认为 false
</span><span class="c1"></span>    <span class="nx">fstatus</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">GetBool</span><span class="p">(</span><span class="s">&#34;float&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">fstatus</span> <span class="p">{</span> <span class="c1">// 如果为 true，则调用 floatAdd 函数
</span><span class="c1"></span>        <span class="nf">floatAdd</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">intAdd</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>Now recompile the build CLI application and execute it as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="err">$</span> <span class="k">go</span> <span class="nx">build</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">my</span><span class="o">-</span><span class="nx">calc</span>  
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">calc</span> <span class="nx">add</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="nx">Addition</span> <span class="nx">of</span> <span class="nx">numbers</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="nx">is</span> <span class="mi">6</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">calc</span> <span class="nx">add</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.5</span> <span class="o">-</span><span class="nx">f</span>
<span class="nx">Sum</span> <span class="nx">of</span> <span class="nx">floating</span> <span class="nx">numbers</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.5</span><span class="p">]</span> <span class="nx">is</span> <span class="mf">6.500000</span>
<span class="err">$</span><span class="p">.</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">calc</span> <span class="nx">add</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.5</span> <span class="o">--</span><span class="kt">float</span>
<span class="nx">Sum</span> <span class="nx">of</span> <span class="nx">floating</span> <span class="nx">numbers</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.5</span><span class="p">]</span> <span class="nx">is</span> <span class="mf">6.500000</span>
</code></pre></td></tr></table>
</div>
</div><p>Then we extend it by adding some subcommands to <code>addCmd</code>.</p>
<h3 id="adding-even-numbers">Adding even numbers</h3>
<p>Also add a command named <code>even</code> to the root of the project with the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">$ cobra add even
even created at /Users/ych/devs/workspace/youdianzhishi/course/my-calc
</code></pre></td></tr></table>
</div>
</div><p>As above, a new file named <code>even.go</code> will be added under the <code>root</code> directory. Modify the <code>init</code> function in this file, and change <code>rootCmd</code> to <code>addCmd</code>, since we are adding a subcommand for <code>addCmd</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/even.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">addCmd</span><span class="p">.</span><span class="nf">AddCommand</span><span class="p">(</span><span class="nx">evenCmd</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Then update the <code>RUN</code> function of the <code>evenCmd</code> structure parameter:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/even.go
</span><span class="c1"></span><span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">evenSum</span> <span class="kt">int</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ival</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">args</span> <span class="p">{</span>
        <span class="nx">temp</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">ival</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">temp</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nx">evenSum</span> <span class="p">=</span> <span class="nx">evenSum</span> <span class="o">+</span> <span class="nx">temp</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;The even addition of %s is %d\n&#34;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">evenSum</span><span class="p">)</span>
<span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><p>First convert the string to an integer, then determine if it is even before adding it up. Then recompile and build the application:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="err">$</span> <span class="k">go</span> <span class="nx">build</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">my</span><span class="o">-</span><span class="nx">calc</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">calc</span> <span class="nx">add</span> <span class="nx">even</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span>
<span class="nx">The</span> <span class="nx">even</span> <span class="nx">addition</span> <span class="nx">of</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">]</span> <span class="nx">is</span> <span class="mi">12</span>
</code></pre></td></tr></table>
</div>
</div><p><code>my-calc</code> is our root command, <code>add</code> is a subcommand of <code>rootCmd</code>, and <code>even</code> is a subcommand of <code>addCmd</code>, so call it in the same way as above. You can add another subcommand for adding odd numbers in the same way.</p>
<p>Here we have created a simple CLI application in Golang using <code>Cobra</code>. This article is relatively simple, but it&rsquo;s a good way to get started learning the basics of <code>Cobra</code>, and we can try to add some more complex use cases later.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/spf13/cobra">https://github.com/spf13/cobra</a></li>
<li><a href="https://github.com/spf13/viper">https://github.com/spf13/viper</a></li>
<li><a href="https://schadokar.dev/posts/how-to-create-a-cli-in-golang-with-cobra/">How to create a CLI in golang with cobra</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          <a href="/tags/cobra/">cobra</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2021-12/encrypt-k8s-secrets-with-sealed-secrets/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Encrypting Kubernetes Secrets with Sealed Secrets</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2021-12/k8s-ui-kubevious/">
            <span class="next-text nav-default">Kubernetes Dashboard with Time Machine - Kubevious</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
